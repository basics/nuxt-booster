/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{334:function(module,exports,__webpack_require__){(function(global){(function(){var innerGlobal="undefined"!=typeof window?window:global,exportTo={};for(var k in function(window,global,module){var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}},$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.SIMPLE_FROUND_POLYFILL=!1,$jscomp.ISOLATE_POLYFILLS=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){return a==Array.prototype||a==Object.prototype||(a[b]=e.value),a},$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var e=a[b];if(e&&e.Math==Math)return e}throw Error("Cannot find global object")},$jscomp.global=$jscomp.getGlobal(this),$jscomp.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE,$jscomp.polyfills={},$jscomp.propertyToPolyfillSymbol={},$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var e=$jscomp.propertyToPolyfillSymbol[b];return null==e?a[b]:void 0!==(e=a[e])?e:a[b]};$jscomp.polyfill=function(a,b,e,t){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,e,t):$jscomp.polyfillUnisolated(a,b,e,t))},$jscomp.polyfillUnisolated=function(a,b,e,t){for(e=$jscomp.global,a=a.split("."),t=0;t<a.length-1;t++){var r=a[t];r in e||(e[r]={}),e=e[r]}(b=b(t=e[a=a[a.length-1]]))!=t&&null!=b&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:b})},$jscomp.polyfillIsolated=function(a,b,e,t){var r=a.split(".");a=1===r.length,t=r[0],t=!a&&t in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var n=0;n<r.length-1;n++){var g=r[n];g in t||(t[g]={}),t=t[g]}r=r[r.length-1],null!=(b=b(e=$jscomp.IS_SYMBOL_NATIVE&&"es6"===e?t[r]:null))&&(a?$jscomp.defineProperty($jscomp.polyfills,r,{configurable:!0,writable:!0,value:b}):b!==e&&($jscomp.propertyToPolyfillSymbol[r]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(r):$jscomp.POLYFILL_PREFIX+r,r=$jscomp.propertyToPolyfillSymbol[r],$jscomp.defineProperty(t,r,{configurable:!0,writable:!0,value:b})))},$jscomp.initSymbol=function(){},$jscomp.polyfill("Symbol",(function(a){if(a)return a;var b=function(a,b){this.$jscomp$symbol$id_=a,$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var e=0,t=function(a){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(a||"")+"_"+e++,a)};return t}),"es6","es3"),$jscomp.initSymbolIterator=function(){},$jscomp.polyfill("Symbol.iterator",(function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),e=0;e<b.length;e++){var t=$jscomp.global[b[e]];"function"==typeof t&&"function"!=typeof t.prototype[a]&&$jscomp.defineProperty(t.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a}),"es6","es3"),$jscomp.initSymbolAsyncIterator=function(){},$jscomp.iteratorPrototype=function(a){return(a={next:a})[Symbol.iterator]=function(){return this},a},$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a},$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){return a.raw=b,a},$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)},$jscomp.arrayFromIterator=function(a){for(var b,e=[];!(b=a.next()).done;)e.push(b.value);return e},$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))},$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};return b.prototype=a,new b},$jscomp.underscoreProtoCanBeSet=function(){var b={};try{return b.__proto__={a:!0},b.a}catch(e){}return!1},$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){if(a.__proto__=b,a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null,$jscomp.inherits=function(a,b){if(a.prototype=$jscomp.objectCreate(b.prototype),a.prototype.constructor=a,$jscomp.setPrototypeOf){var e=$jscomp.setPrototypeOf;e(a,b)}else for(e in b)if("prototype"!=e)if(Object.defineProperties){var t=Object.getOwnPropertyDescriptor(b,e);t&&Object.defineProperty(a,e,t)}else a[e]=b[e];a.superClass_=b.prototype},$jscomp.generator={},$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object")},$jscomp.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1},$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a},$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0},this.jumpToErrorHandler_()},$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a},this.nextAddress=this.finallyAddress_},$jscomp.generator.Context.prototype.yield=function(a,b){return this.nextAddress=b,{value:a}},$jscomp.generator.Context.prototype.yieldAll=function(a,b){var e=$jscomp.makeIterator(a),t=e.next();if($jscomp.generator.ensureIteratorResultIsObject_(t),!t.done)return this.yieldAllIterator_=e,this.yield(t.value,b);this.yieldResult=t.value,this.nextAddress=b},$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a},$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a,null!=b&&(this.finallyAddress_=b)},$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0,this.finallyAddress_=a||0},$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a,this.catchAddress_=b||0},$jscomp.generator.Context.prototype.enterCatchBlock=function(a){return this.catchAddress_=a||0,a=this.abruptCompletion_.exception,this.abruptCompletion_=null,a},$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,e){e?this.finallyContexts_[e]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=a||0,this.finallyAddress_=b||0},$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){var e=this.finallyContexts_.splice(b||0)[0];if(e=this.abruptCompletion_=this.abruptCompletion_||e){if(e.isException)return this.jumpToErrorHandler_();null!=e.jumpTo&&this.finallyAddress_<e.jumpTo?(this.nextAddress=e.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a},$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)},$jscomp.generator.Context.PropertyIterator=function(a){for(var b in this.object_=a,this.properties_=[],a)this.properties_.push(b);this.properties_.reverse()},$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null},$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context,this.program_=a},$jscomp.generator.Engine_.prototype.next_=function(a){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_):(this.context_.next_(a),this.nextStep_())},$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;return b?this.yieldAllStep_("return"in b?b.return:function(a){return{value:a,done:!0}},a,this.context_.return):(this.context_.return(a),this.nextStep_())},$jscomp.generator.Engine_.prototype.throw_=function(a){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,a,this.context_.next_):(this.context_.throw_(a),this.nextStep_())},$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,e){try{var t=a.call(this.context_.yieldAllIterator_,b);if($jscomp.generator.ensureIteratorResultIsObject_(t),!t.done)return this.context_.stop_(),t;var r=t.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}return this.context_.yieldAllIterator_=null,e.call(this.context_,r),this.nextStep_()},$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(a=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}},$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)},this.throw=function(b){return a.throw_(b)},this.return=function(b){return a.return_(b)},this[Symbol.iterator]=function(){return this}},$jscomp.generator.createGenerator=function(a,b){var e=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));return $jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(e,a.prototype),e},$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.polyfill("Promise",(function(a){function b(){this.batch_=null}function e(a){return a instanceof r?a:new r((function(b,e){b(a)}))}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction((function(){b.executeBatch_()}))}this.batch_.push(a)};var t=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){t(a,0)},b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var e=a[b];a[b]=null;try{e()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction((function(){throw a}))};var r=function(a){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(e){b.reject(e)}};r.prototype.createResolveAndReject_=function(){function a(a){return function(t){e||(e=!0,a.call(b,t))}}var b=this,e=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}},r.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof r)this.settleSameAsPromise_(a);else{e:switch(typeof a){case"object":var b=null!=a;break e;case"function":b=!0;break e;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}},r.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(e){return void this.reject_(e)}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)},r.prototype.reject_=function(a){this.settle_(2,a)},r.prototype.fulfill_=function(a){this.settle_(1,a)},r.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a,this.result_=b,this.executeOnSettledCallbacks_()},r.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)n.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var n=new b;return r.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)},r.prototype.settleSameAsThenable_=function(a,b){var e=this.createResolveAndReject_();try{a.call(b,e.resolve,e.reject)}catch(t){e.reject(t)}},r.prototype.then=function(a,b){function e(a,b){return"function"==typeof a?function(b){try{t(a(b))}catch(e){n(e)}}:b}var t,n,g=new r((function(a,b){t=a,n=b}));return this.callWhenSettled_(e(a,t),e(b,n)),g},r.prototype.catch=function(a){return this.then(void 0,a)},r.prototype.callWhenSettled_=function(a,b){function e(){switch(t.state_){case 1:a(t.result_);break;case 2:b(t.result_);break;default:throw Error("Unexpected state: "+t.state_)}}var t=this;null==this.onSettledCallbacks_?n.asyncExecute(e):this.onSettledCallbacks_.push(e)},r.resolve=e,r.reject=function(a){return new r((function(b,e){e(a)}))},r.race=function(a){return new r((function(b,t){for(var r=$jscomp.makeIterator(a),n=r.next();!n.done;n=r.next())e(n.value).callWhenSettled_(b,t)}))},r.all=function(a){var b=$jscomp.makeIterator(a),t=b.next();return t.done?e([]):new r((function(a,r){function n(b){return function(e){g[b]=e,0==--o&&a(g)}}var g=[],o=0;do{g.push(void 0),o++,e(t.value).callWhenSettled_(n(g.length-1),r),t=b.next()}while(!t.done)}))},r}),"es6","es3"),$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function e(b){return a.throw(b)}return new Promise((function(t,r){!function n(a){a.done?t(a.value):Promise.resolve(a.value).then(b,e).then(n,r)}(a.next())}))},$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())},$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))},$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(e,t,r){return e==a&&"q"==t&&r==b}}));return!0===b.q}catch(e){return!1}},$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy(),$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},$jscomp.polyfill("WeakMap",(function(a){function e(){}function t(a){var b=typeof a;return"object"===b&&null!==a||"function"===b}function r(a){if(!$jscomp.owns(a,g)){var b=new e;$jscomp.defineProperty(a,g,{value:b})}}function n(a){var b=Object[a];b&&(Object[a]=function(a){return a instanceof e?a:(r(a),b(a))})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),e=Object.seal({}),t=new a([[b,2],[e,3]]);return 2==t.get(b)&&3==t.get(e)&&(t.delete(b),t.set(e,4),!t.has(b)&&4==t.get(e))}catch(e){return!1}}())return a;var g="$jscomp_hidden_"+Math.random();n("freeze"),n("preventExtensions"),n("seal");var o=0,l=function(a){if(this.id_=(o+=Math.random()+1).toString(),a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};return l.prototype.set=function(a,b){if(!t(a))throw Error("Invalid WeakMap key");if(r(a),!$jscomp.owns(a,g))throw Error("WeakMap key fail: "+a);return a[g][this.id_]=b,this},l.prototype.get=function(a){return t(a)&&$jscomp.owns(a,g)?a[g][this.id_]:void 0},l.prototype.has=function(a){return t(a)&&$jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_)},l.prototype.delete=function(a){return!!(t(a)&&$jscomp.owns(a,g)&&$jscomp.owns(a[g],this.id_))&&delete a[g][this.id_]},l}),"es6","es3"),$jscomp.MapEntry=function(){},$jscomp.polyfill("Map",(function(a){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(function(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),e=new a($jscomp.makeIterator([[b,"s"]]));if("s"!=e.get(b)||1!=e.size||e.get({x:4})||e.set({x:4},"t")!=e||2!=e.size)return!1;var t=e.entries(),r=t.next();return!r.done&&r.value[0]==b&&"s"==r.value[1]&&!((r=t.next()).done||4!=r.value[0].x||"t"!=r.value[1]||!t.next().done)}catch(e){return!1}}())return a;var e=new WeakMap,t=function(a){if(this.data_={},this.head_=g(),this.size=0,a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};t.prototype.set=function(a,b){var e=r(this,a=0===a?0:a);return e.list||(e.list=this.data_[e.id]=[]),e.entry?e.entry.value=b:(e.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:b},e.list.push(e.entry),this.head_.previous.next=e.entry,this.head_.previous=e.entry,this.size++),this},t.prototype.delete=function(a){return!(!(a=r(this,a)).entry||!a.list)&&(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0)},t.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=g(),this.size=0},t.prototype.has=function(a){return!!r(this,a).entry},t.prototype.get=function(a){return(a=r(this,a).entry)&&a.value},t.prototype.entries=function(){return n(this,(function(a){return[a.key,a.value]}))},t.prototype.keys=function(){return n(this,(function(a){return a.key}))},t.prototype.values=function(){return n(this,(function(a){return a.value}))},t.prototype.forEach=function(a,b){for(var e,t=this.entries();!(e=t.next()).done;)e=e.value,a.call(b,e[1],e[0],this)},t.prototype[Symbol.iterator]=t.prototype.entries;var r=function(a,b){var t=b&&typeof b;"object"==t||"function"==t?e.has(b)?t=e.get(b):(t=""+ ++o,e.set(b,t)):t="p_"+b;var r=a.data_[t];if(r&&$jscomp.owns(a.data_,t))for(var n=0;n<r.length;n++){var g=r[n];if(b!=b&&g.key!=g.key||b===g.key)return{id:t,list:r,index:n,entry:g}}return{id:t,list:r,index:-1,entry:void 0}},n=function(a,b){var e=a.head_;return $jscomp.iteratorPrototype((function(){if(e){for(;e.head!=a.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:b(e)};e=null}return{done:!0,value:void 0}}))},g=function(){var a={};return a.previous=a.next=a.head=a},o=0;return t}),"es6","es3"),$jscomp.polyfill("Set",(function(a){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(function(){if($jscomp.ASSUME_NO_NATIVE_SET||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),e=new a($jscomp.makeIterator([b]));if(!e.has(b)||1!=e.size||e.add(b)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var t=e.entries(),g=t.next();return!g.done&&g.value[0]==b&&g.value[1]==b&&(!(g=t.next()).done&&g.value[0]!=b&&4==g.value[0].x&&g.value[1]==g.value[0]&&t.next().done)}catch(e){return!1}}())return a;var e=function(a){if(this.map_=new Map,a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};return e.prototype.add=function(a){return a=0===a?0:a,this.map_.set(a,a),this.size=this.map_.size,this},e.prototype.delete=function(a){return a=this.map_.delete(a),this.size=this.map_.size,a},e.prototype.clear=function(){this.map_.clear(),this.size=0},e.prototype.has=function(a){return this.map_.has(a)},e.prototype.entries=function(){return this.map_.entries()},e.prototype.values=function(){return this.map_.values()},e.prototype.keys=e.prototype.values,e.prototype[Symbol.iterator]=e.prototype.values,e.prototype.forEach=function(a,b){var e=this;this.map_.forEach((function(t){return a.call(b,t,t,e)}))},e}),"es6","es3"),$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var e=0,t={next:function(){if(e<a.length){var r=e++;return{value:b(r,a[r]),done:!1}}return t.next=function(){return{done:!0,value:void 0}},t.next()}};return t[Symbol.iterator]=function(){return t},t},$jscomp.polyfill("Array.from",(function(a){return a||function(a,e,t){e=null!=e?e:function(a){return a};var b=[],r="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof r){a=r.call(a);for(var g=0;!(r=a.next()).done;)b.push(e.call(t,r.value,g++))}else for(r=a.length,g=0;g<r;g++)b.push(e.call(t,a[g],g));return b}}),"es6","es3"),$jscomp.findInternal=function(a,b,e){a instanceof String&&(a=String(a));for(var t=a.length,r=0;r<t;r++){var n=a[r];if(b.call(e,n,r,a))return{i:r,v:n}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.findIndex",(function(a){return a||function(a,e){return $jscomp.findInternal(this,a,e).i}}),"es6","es3"),$jscomp.polyfill("Promise.prototype.finally",(function(a){return a||function(a){return this.then((function(b){return Promise.resolve(a()).then((function(){return b}))}),(function(b){return Promise.resolve(a()).then((function(){throw b}))}))}}),"es9","es3"),$jscomp.polyfill("Object.is",(function(a){return a||function(a,e){return a===e?0!==a||1/a==1/e:a!=a&&e!=e}}),"es6","es3"),$jscomp.polyfill("Array.prototype.includes",(function(a){return a||function(a,e){var b=this;b instanceof String&&(b=String(b));var t=b.length,r=e||0;for(0>r&&(r=Math.max(r+t,0));r<t;r++){var g=b[r];if(g===a||Object.is(g,a))return!0}return!1}}),"es7","es3"),$jscomp.checkStringArgs=function(a,b,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""},$jscomp.polyfill("String.prototype.includes",(function(a){return a||function(a,e){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,e||0)}}),"es6","es3"),$jscomp.polyfill("Math.sign",(function(a){return a||function(a){return 0===(a=Number(a))||isNaN(a)?a:0<a?1:-1}}),"es6","es3"),$jscomp.polyfill("Array.prototype.find",(function(a){return a||function(a,e){return $jscomp.findInternal(this,a,e).v}}),"es6","es3"),$jscomp.polyfill("Math.log2",(function(a){return a||function(a){return Math.log(a)/Math.LN2}}),"es6","es3"),$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)$jscomp.owns(t,r)&&(a[r]=t[r])}return a},$jscomp.polyfill("Object.assign",(function(a){return a||$jscomp.assign}),"es6","es3"),$jscomp.polyfill("Object.values",(function(a){return a||function(a){var e,b=[];for(e in a)$jscomp.owns(a,e)&&b.push(a[e]);return b}}),"es8","es3"),$jscomp.polyfill("String.prototype.startsWith",(function(a){return a||function(a,e){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var t=b.length,r=a.length,g=Math.max(0,Math.min(0|e,b.length)),n=0;n<r&&g<t;)if(b[g++]!=a[n++])return!1;return n>=r}}),"es6","es3");var COMPILED=!0,goog=goog||{};goog.global=this||self,goog.exportPath_=function(a,b,e){a=a.split("."),e=e||goog.global,a[0]in e||void 0===e.execScript||e.execScript("var "+a[0]);for(var t;a.length&&(t=a.shift());)a.length||void 0===b?e=e[t]&&e[t]!==Object.prototype[t]?e[t]:e[t]={}:e[t]=b},goog.define=function(a,b){var e=b;if(!COMPILED){var t=goog.global.CLOSURE_UNCOMPILED_DEFINES,r=goog.global.CLOSURE_DEFINES;t&&void 0===t.nodeType&&Object.prototype.hasOwnProperty.call(t,a)?e=t[a]:r&&void 0===r.nodeType&&Object.prototype.hasOwnProperty.call(r,a)&&(e=r[a])}return e},goog.FEATURESET_YEAR=2012,goog.DEBUG=!0,goog.LOCALE="en",goog.TRUSTED_SITE=!0,goog.STRICT_MODE_COMPATIBLE=!0,goog.DISALLOW_TEST_ONLY_CODE=COMPILED&&!goog.DEBUG,goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING=!1,goog.provide=function(a){if(goog.isInModuleLoader_())throw Error("goog.provide cannot be used within a module.");if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)},goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var e=a;(e=e.substring(0,e.lastIndexOf(".")))&&!goog.getObjectByName(e);)goog.implicitNamespaces_[e]=!0}goog.exportPath_(a,b)},goog.getScriptNonce=function(a){return a&&a!=goog.global?goog.getScriptNonce_(a.document):(null===goog.cspNonce_&&(goog.cspNonce_=goog.getScriptNonce_(goog.global.document)),goog.cspNonce_)},goog.NONCE_PATTERN_=/^[\w+/_-]+[=]{0,2}$/,goog.cspNonce_=null,goog.getScriptNonce_=function(a){return(a=a.querySelector&&a.querySelector("script[nonce]"))&&(a=a.nonce||a.getAttribute("nonce"))&&goog.NONCE_PATTERN_.test(a)?a:""},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(a){if("string"!=typeof a||!a||-1==a.search(goog.VALID_MODULE_RE_))throw Error("Invalid module identifier");if(!goog.isInGoogModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=a,!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}},goog.module.get=function(a){return goog.module.getInternal_(a)},goog.module.getInternal_=function(a){if(!COMPILED){if(a in goog.loadedModules_)return goog.loadedModules_[a].exports;if(!goog.implicitNamespaces_[a])return null!=(a=goog.getObjectByName(a))?a:null}return null},goog.ModuleType={ES6:"es6",GOOG:"goog"},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return goog.isInGoogModuleLoader_()||goog.isInEs6ModuleLoader_()},goog.isInGoogModuleLoader_=function(){return!!goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.GOOG},goog.isInEs6ModuleLoader_=function(){if(goog.moduleLoaderState_&&goog.moduleLoaderState_.type==goog.ModuleType.ES6)return!0;var a=goog.global.$jscomp;return!!a&&("function"==typeof a.getCurrentModulePath&&!!a.getCurrentModulePath())},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInGoogModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.declareModuleId=function(a){if(!COMPILED){if(!goog.isInEs6ModuleLoader_())throw Error("goog.declareModuleId may only be called from within an ES6 module");if(goog.moduleLoaderState_&&goog.moduleLoaderState_.moduleName)throw Error("goog.declareModuleId may only be called once per module.");if(a in goog.loadedModules_)throw Error('Module with namespace "'+a+'" already exists.')}if(goog.moduleLoaderState_)goog.moduleLoaderState_.moduleName=a;else{var b=goog.global.$jscomp;if(!b||"function"!=typeof b.getCurrentModulePath)throw Error('Module with namespace "'+a+'" has been loaded incorrectly.');b=b.require(b.getCurrentModulePath()),goog.loadedModules_[a]={exports:b,type:goog.ModuleType.ES6,moduleId:a}}},goog.setTestOnly=function(a){if(goog.DISALLOW_TEST_ONLY_CODE)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."))},goog.forwardDeclare=function(a){},COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&null!=goog.getObjectByName(a)},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(a,b){for(var e=a.split("."),t=b||goog.global,r=0;r<e.length;r++)if(null==(t=t[e[r]]))return null;return t},goog.globalize=function(a,b){var e,t=b||goog.global;for(e in a)t[e]=a[e]},goog.addDependency=function(a,b,e,t){!COMPILED&&goog.DEPENDENCIES_ENABLED&&goog.debugLoader_.addDependency(a,b,e,t)},goog.ENABLE_DEBUG_LOADER=!1,goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)},goog.require=function(a){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.debugLoader_.requested(a),goog.isProvided_(a)){if(goog.isInModuleLoader_())return goog.module.getInternal_(a)}else if(goog.ENABLE_DEBUG_LOADER){var b=goog.moduleLoaderState_;goog.moduleLoaderState_=null;try{goog.debugLoader_.load_(a)}finally{goog.moduleLoaderState_=b}}return null}},goog.requireType=function(a){return{}},goog.basePath="",goog.nullFunction=function(){},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(a){a.instance_=void 0,a.getInstance=function(){return a.instance_?a.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a),a.instance_=new a)}},goog.instantiatedSingletons_=[],goog.LOAD_MODULE_USING_EVAL=!0,goog.SEAL_MODULE_EXPORTS=goog.DEBUG,goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.TRANSPILE="detect",goog.ASSUME_ES_MODULES_TRANSPILED=!1,goog.TRANSPILE_TO_LANGUAGE="",goog.TRANSPILER="transpile.js",goog.hasBadLetScoping=null,goog.useSafari10Workaround=function(){if(null==goog.hasBadLetScoping){try{var a=!eval('"use strict";let x = 1; function f() { return typeof x; };f() == "number";')}catch(e){a=!1}goog.hasBadLetScoping=a}return goog.hasBadLetScoping},goog.workaroundSafari10EvalBug=function(a){return"(function(){"+a+"\n;})();\n"},goog.loadModule=function(a){var b=goog.moduleLoaderState_;try{if(goog.moduleLoaderState_={moduleName:"",declareLegacyNamespace:!1,type:goog.ModuleType.GOOG},goog.isFunction(a))var e=a.call(void 0,{});else{if("string"!=typeof a)throw Error("Invalid module definition");goog.useSafari10Workaround()&&(a=goog.workaroundSafari10EvalBug(a)),e=goog.loadModuleFromSource_.call(void 0,a)}var t=goog.moduleLoaderState_.moduleName;if("string"!=typeof t||!t)throw Error('Invalid module name "'+t+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(t,e):goog.SEAL_MODULE_EXPORTS&&Object.seal&&"object"==typeof e&&null!=e&&Object.seal(e),goog.loadedModules_[t]={exports:e,type:goog.ModuleType.GOOG,moduleId:goog.moduleLoaderState_.moduleName}}finally{goog.moduleLoaderState_=b}},goog.loadModuleFromSource_=function(a){return eval(a),{}},goog.normalizePath_=function(a){a=a.split("/");for(var b=0;b<a.length;)"."==a[b]?a.splice(b,1):b&&".."==a[b]&&a[b-1]&&".."!=a[b-1]?a.splice(--b,2):b++;return a.join("/")},goog.loadFileSync_=function(a){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(a);try{var b=new goog.global.XMLHttpRequest;return b.open("get",a,!1),b.send(),0==b.status||200==b.status?b.responseText:null}catch(e){return null}},goog.transpile_=function(a,b,e){var t=goog.global.$jscomp;t||(goog.global.$jscomp=t={});var r=t.transpile;if(!r){var n=goog.basePath+goog.TRANSPILER,g=goog.loadFileSync_(n);if(g){if(function(){(0,eval)(g+"\n//# sourceURL="+n)}.call(goog.global),goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile,r=(t=goog.global.$jscomp).transpile}}return r||(r=t.transpile=function(a,b){return goog.logToConsole_(b+" requires transpilation but no transpiler was found."),a}),r(a,b,e)},goog.typeOf=function(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return b;var e=Object.prototype.toString.call(a);if("[object Window]"==e)return"object";if("[object Array]"==e||"number"==typeof a.length&&void 0!==a.splice&&void 0!==a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==e||void 0!==a.call&&void 0!==a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==b&&void 0===a.call)return"object";return b},goog.isArray=function(a){return Array.isArray(a)},goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length},goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear},goog.isFunction=function(a){return"function"==goog.typeOf(a)},goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b},goog.getUid=function(a){return Object.prototype.hasOwnProperty.call(a,goog.UID_PROPERTY_)&&a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]},goog.removeUid=function(a){null!==a&&"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(e){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if("function"==typeof a.clone)return a.clone();for(var e in b="array"==b?[]:{},a)b[e]=goog.cloneObject(a[e]);return b}return a},goog.bindNative_=function(a,b,e){return a.call.apply(a.bind,arguments)},goog.bindJs_=function(a,b,e){if(!a)throw Error();if(2<arguments.length){var t=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,t),a.apply(b,e)}}return function(){return a.apply(b,arguments)}},goog.bind=function(a,b,e){return Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(a,b){var e=Array.prototype.slice.call(arguments,1);return function(){var b=e.slice();return b.push.apply(b,arguments),a.apply(this,b)}},goog.mixin=function(a,b){for(var e in b)a[e]=b[e]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorks_)try{goog.global.eval(""),goog.evalWorks_=!0}catch(e){goog.evalWorks_=!1}if(goog.evalWorks_)goog.global.eval(a);else{var b=goog.global.document,e=b.createElement("script");e.type="text/javascript",e.defer=!1,e.appendChild(b.createTextNode(a)),b.head.appendChild(e),b.head.removeChild(e)}}},goog.evalWorks_=null,goog.getCssName=function(a,b){if("."==String(a).charAt(0))throw Error('className passed in goog.getCssName must not start with ".". You passed: '+a);var e=function(a){return goog.cssNameMapping_[a]||a},t=function(a){a=a.split("-");for(var b=[],t=0;t<a.length;t++)b.push(e(a[t]));return b.join("-")};return t=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?e:t:function(a){return a},t=b?a+"-"+t(b):t(a),goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(t):t},goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a,goog.cssNameMappingStyle_=b},!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(a,b,e){return e&&e.html&&(a=a.replace(/</g,"&lt;")),b&&(a=a.replace(/\{\$([^}]+)}/g,(function(a,e){return null!=b&&e in b?b[e]:a}))),a},goog.getMsgWithFallback=function(a,b){return a},goog.exportSymbol=function(a,b,e){goog.exportPath_(a,b,e)},goog.exportProperty=function(a,b,e){a[b]=e},goog.inherits=function(a,b){function e(){}e.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new e,a.prototype.constructor=a,a.base=function(a,e,t){for(var r=Array(arguments.length-2),n=2;n<arguments.length;n++)r[n-2]=arguments[n];return b.prototype[e].apply(a,r)}},goog.scope=function(a){if(goog.isInModuleLoader_())throw Error("goog.scope is not supported within a module.");a.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(a,b){var e=b.constructor,t=b.statics;return e&&e!=Object.prototype.constructor||(e=function(){throw Error("cannot instantiate an interface (no constructor defined).")}),e=goog.defineClass.createSealingConstructor_(e,a),a&&goog.inherits(e,a),delete b.constructor,delete b.statics,goog.defineClass.applyProperties_(e.prototype,b),null!=t&&(t instanceof Function?t(e):goog.defineClass.applyProperties_(e,t)),e},goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG,goog.defineClass.createSealingConstructor_=function(a,b){return goog.defineClass.SEAL_CLASS_INSTANCES?function(){var b=a.apply(this,arguments)||this;return b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_],b}:a},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),goog.defineClass.applyProperties_=function(a,b){for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);for(var t=0;t<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;t++)e=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[t],Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])},!COMPILED&&goog.DEPENDENCIES_ENABLED&&(goog.inHtmlDocument_=function(){var a=goog.global.document;return null!=a&&"write"in a},goog.isDocumentLoading_=function(){var a=goog.global.document;return a.attachEvent?"complete"!=a.readyState:"loading"==a.readyState},goog.findBasePath_=function(){if(null!=goog.global.CLOSURE_BASE_PATH&&"string"==typeof goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_()){var a=goog.global.document,b=a.currentScript;for(b=(a=b?[b]:a.getElementsByTagName("SCRIPT")).length-1;0<=b;--b){var e=a[b].src,t=e.lastIndexOf("?");if(t=-1==t?e.length:t,"base.js"==e.substr(t-7,7)){goog.basePath=e.substr(0,t-7);break}}}},goog.findBasePath_(),goog.Transpiler=function(){this.requiresTranspilation_=null,this.transpilationTarget_=goog.TRANSPILE_TO_LANGUAGE},goog.Transpiler.prototype.createRequiresTranspilation_=function(){function a(a,b){e?d[a]=!0:b()?(c=a,d[a]=!1):e=d[a]=!0}function b(a){try{return!!eval(a)}catch(e){return!1}}var c="es3",d={es3:!1},e=!1,f=goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"";return a("es5",(function(){return b("[1,].length==1")})),a("es6",(function(){return!f.match(/Edge\/(\d+)(\.\d)*/i)&&b('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')})),a("es7",(function(){return b("2 ** 2 == 4")})),a("es8",(function(){return b("async () => 1, true")})),a("es9",(function(){return b("({...rest} = {}), true")})),a("es_next",(function(){return!1})),{target:c,map:d}},goog.Transpiler.prototype.needsTranspile=function(a,b){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;if(!this.requiresTranspilation_){var e=this.createRequiresTranspilation_();this.requiresTranspilation_=e.map,this.transpilationTarget_=this.transpilationTarget_||e.target}if(a in this.requiresTranspilation_)return!!this.requiresTranspilation_[a]||!(!goog.inHtmlDocument_()||"es6"!=b||"noModule"in goog.global.document.createElement("script"));throw Error("Unknown language mode: "+a)},goog.Transpiler.prototype.transpile=function(a,b){return goog.transpile_(a,b,this.transpilationTarget_)},goog.transpiler_=new goog.Transpiler,goog.protectScriptTag_=function(a){return a.replace(/<\/(SCRIPT)/gi,"\\x3c/$1")},goog.DebugLoader_=function(){this.dependencies_={},this.idToPath_={},this.written_={},this.loadingDeps_=[],this.depsToLoad_=[],this.paused_=!1,this.factory_=new goog.DependencyFactory(goog.transpiler_),this.deferredCallbacks_={},this.deferredQueue_=[]},goog.DebugLoader_.prototype.bootstrap=function(a,b){function e(){t&&(goog.global.setTimeout(t,0),t=null)}var t=b;if(a.length){for(var r=[],n=0;n<a.length;n++){var g=this.getPathFromDeps_(a[n]);if(!g)throw Error("Unregonized namespace: "+a[n]);r.push(this.dependencies_[g])}g=goog.require;var o=0;for(n=0;n<a.length;n++)g(a[n]),r[n].onLoad((function(){++o==a.length&&e()}))}else e()},goog.DebugLoader_.prototype.loadClosureDeps=function(){this.depsToLoad_.push(this.factory_.createDependency(goog.normalizePath_(goog.basePath+"deps.js"),"deps.js",[],[],{},!1)),this.loadDeps_()},goog.DebugLoader_.prototype.requested=function(a,b){var e=this.getPathFromDeps_(a);if(e&&(b||this.areDepsLoaded_(this.dependencies_[e].requires))){var t=this.deferredCallbacks_[e];t&&(delete this.deferredCallbacks_[e],t())}},goog.DebugLoader_.prototype.setDependencyFactory=function(a){this.factory_=a},goog.DebugLoader_.prototype.load_=function(a){if(!this.getPathFromDeps_(a))throw a="goog.require could not find: "+a,goog.logToConsole_(a),Error(a);var b=this,e=[],t=function(a){var r=b.getPathFromDeps_(a);if(!r)throw Error("Bad dependency path or symbol: "+a);if(!b.written_[r]){for(b.written_[r]=!0,a=b.dependencies_[r],r=0;r<a.requires.length;r++)goog.isProvided_(a.requires[r])||t(a.requires[r]);e.push(a)}};t(a),a=!!this.depsToLoad_.length,this.depsToLoad_=this.depsToLoad_.concat(e),this.paused_||a||this.loadDeps_()},goog.DebugLoader_.prototype.loadDeps_=function(){for(var a=this,b=this.paused_;this.depsToLoad_.length&&!b;)!function(){var e=!1,t=a.depsToLoad_.shift(),r=!1;a.loading_(t);var n={pause:function(){if(e)throw Error("Cannot call pause after the call to load.");b=!0},resume:function(){e?a.resume_():b=!1},loaded:function(){if(r)throw Error("Double call to loaded.");r=!0,a.loaded_(t)},pending:function(){for(var b=[],e=0;e<a.loadingDeps_.length;e++)b.push(a.loadingDeps_[e]);return b},setModuleState:function(a){goog.moduleLoaderState_={type:a,moduleName:"",declareLegacyNamespace:!1}},registerEs6ModuleExports:function(a,b,e){e&&(goog.loadedModules_[e]={exports:b,type:goog.ModuleType.ES6,moduleId:e||""})},registerGoogModuleExports:function(a,b){goog.loadedModules_[a]={exports:b,type:goog.ModuleType.GOOG,moduleId:a}},clearModuleState:function(){goog.moduleLoaderState_=null},defer:function(b){if(e)throw Error("Cannot register with defer after the call to load.");a.defer_(t,b)},areDepsLoaded:function(){return a.areDepsLoaded_(t.requires)}};try{t.load(n)}finally{e=!0}}();b&&this.pause_()},goog.DebugLoader_.prototype.pause_=function(){this.paused_=!0},goog.DebugLoader_.prototype.resume_=function(){this.paused_&&(this.paused_=!1,this.loadDeps_())},goog.DebugLoader_.prototype.loading_=function(a){this.loadingDeps_.push(a)},goog.DebugLoader_.prototype.loaded_=function(a){for(var b=0;b<this.loadingDeps_.length;b++)if(this.loadingDeps_[b]==a){this.loadingDeps_.splice(b,1);break}for(b=0;b<this.deferredQueue_.length;b++)if(this.deferredQueue_[b]==a.path){this.deferredQueue_.splice(b,1);break}if(this.loadingDeps_.length==this.deferredQueue_.length&&!this.depsToLoad_.length)for(;this.deferredQueue_.length;)this.requested(this.deferredQueue_.shift(),!0);a.loaded()},goog.DebugLoader_.prototype.areDepsLoaded_=function(a){for(var b=0;b<a.length;b++){var e=this.getPathFromDeps_(a[b]);if(!e||!(e in this.deferredCallbacks_)&&!goog.isProvided_(a[b]))return!1}return!0},goog.DebugLoader_.prototype.getPathFromDeps_=function(a){return a in this.idToPath_?this.idToPath_[a]:a in this.dependencies_?a:null},goog.DebugLoader_.prototype.defer_=function(a,b){this.deferredCallbacks_[a.path]=b,this.deferredQueue_.push(a.path)},goog.LoadController=function(){},goog.LoadController.prototype.pause=function(){},goog.LoadController.prototype.resume=function(){},goog.LoadController.prototype.loaded=function(){},goog.LoadController.prototype.pending=function(){},goog.LoadController.prototype.registerEs6ModuleExports=function(a,b,e){},goog.LoadController.prototype.setModuleState=function(a){},goog.LoadController.prototype.clearModuleState=function(){},goog.LoadController.prototype.defer=function(a){},goog.LoadController.prototype.areDepsLoaded=function(){},goog.Dependency=function(a,b,e,t,r){this.path=a,this.relativePath=b,this.provides=e,this.requires=t,this.loadFlags=r,this.loaded_=!1,this.loadCallbacks_=[]},goog.Dependency.prototype.getPathName=function(){var a=this.path,b=a.indexOf("://");return 0<=b&&(0<=(b=(a=a.substring(b+3)).indexOf("/"))&&(a=a.substring(b+1))),a},goog.Dependency.prototype.onLoad=function(a){this.loaded_?a():this.loadCallbacks_.push(a)},goog.Dependency.prototype.loaded=function(){this.loaded_=!0;var a=this.loadCallbacks_;this.loadCallbacks_=[];for(var b=0;b<a.length;b++)a[b]()},goog.Dependency.defer_=!1,goog.Dependency.callbackMap_={},goog.Dependency.registerCallback_=function(a){var b=Math.random().toString(32);return goog.Dependency.callbackMap_[b]=a,b},goog.Dependency.unregisterCallback_=function(a){delete goog.Dependency.callbackMap_[a]},goog.Dependency.callback_=function(a,b){if(!(a in goog.Dependency.callbackMap_))throw Error("Callback key "+a+" does not exist (was base.js loaded more than once?).");for(var e=goog.Dependency.callbackMap_[a],t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);e.apply(void 0,t)},goog.Dependency.prototype.load=function(a){if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?a.loaded():a.pause();else if(goog.inHtmlDocument_()){var b=goog.global.document;if("complete"==b.readyState&&!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING){if(/\bdeps.js$/.test(this.path))return void a.loaded();throw Error('Cannot write "'+this.path+'" after document load')}if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&goog.isDocumentLoading_()){var e=goog.Dependency.registerCallback_((function(b){goog.DebugLoader_.IS_OLD_IE_&&"complete"!=b.readyState||(goog.Dependency.unregisterCallback_(e),a.loaded())})),t=!goog.DebugLoader_.IS_OLD_IE_&&goog.getScriptNonce()?' nonce="'+goog.getScriptNonce()+'"':"";t='<script src="'+this.path+'" '+(goog.DebugLoader_.IS_OLD_IE_?"onreadystatechange":"onload")+"=\"goog.Dependency.callback_('"+e+'\', this)" type="text/javascript" '+(goog.Dependency.defer_?"defer":"")+t+"><\/script>",b.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(t):t)}else{var r=b.createElement("script");r.defer=goog.Dependency.defer_,r.async=!1,r.type="text/javascript",(t=goog.getScriptNonce())&&r.setAttribute("nonce",t),goog.DebugLoader_.IS_OLD_IE_?(a.pause(),r.onreadystatechange=function(){"loaded"!=r.readyState&&"complete"!=r.readyState||(a.loaded(),a.resume())}):r.onload=function(){r.onload=null,a.loaded()},r.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(this.path):this.path,b.head.appendChild(r)}}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),"deps.js"==this.relativePath?(goog.logToConsole_("Consider setting CLOSURE_IMPORT_SCRIPT before loading base.js, or setting CLOSURE_NO_DEPS to true."),a.loaded()):a.pause()},goog.Es6ModuleDependency=function(a,b,e,t,r){goog.Dependency.call(this,a,b,e,t,r)},goog.inherits(goog.Es6ModuleDependency,goog.Dependency),goog.Es6ModuleDependency.prototype.load=function(a){if(goog.global.CLOSURE_IMPORT_SCRIPT)goog.global.CLOSURE_IMPORT_SCRIPT(this.path)?a.loaded():a.pause();else if(goog.inHtmlDocument_()){var e=goog.global.document,t=this;if(goog.isDocumentLoading_()){var r=function(a,b){var t=b?'<script type="module" crossorigin>'+b+"<\/script>":'<script type="module" crossorigin src="'+a+'"><\/script>';e.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(t):t)};goog.Dependency.defer_=!0}else r=function(a,b){var t=e.createElement("script");t.defer=!0,t.async=!1,t.type="module",t.setAttribute("crossorigin",!0);var r=goog.getScriptNonce();r&&t.setAttribute("nonce",r),b?t.textContent=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScript(b):b:t.src=goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createScriptURL(a):a,e.head.appendChild(t)};var g=goog.Dependency.registerCallback_((function(){goog.Dependency.unregisterCallback_(g),a.setModuleState(goog.ModuleType.ES6)}));r(void 0,'goog.Dependency.callback_("'+g+'")'),r(this.path,void 0);var n=goog.Dependency.registerCallback_((function(b){goog.Dependency.unregisterCallback_(n),a.registerEs6ModuleExports(t.path,b,goog.moduleLoaderState_.moduleName)}));r(void 0,'import * as m from "'+this.path+'"; goog.Dependency.callback_("'+n+'", m)');var o=goog.Dependency.registerCallback_((function(){goog.Dependency.unregisterCallback_(o),a.clearModuleState(),a.loaded()}));r(void 0,'goog.Dependency.callback_("'+o+'")')}else goog.logToConsole_("Cannot use default debug loader outside of HTML documents."),a.pause()},goog.TransformedDependency=function(a,b,e,t,r){goog.Dependency.call(this,a,b,e,t,r),this.contents_=null,this.lazyFetch_=!goog.inHtmlDocument_()||!("noModule"in goog.global.document.createElement("script"))},goog.inherits(goog.TransformedDependency,goog.Dependency),goog.TransformedDependency.prototype.load=function(a){function b(){t.contents_=goog.loadFileSync_(t.path),t.contents_&&(t.contents_=t.transform(t.contents_),t.contents_&&(t.contents_+="\n//# sourceURL="+t.path))}function e(){if(t.lazyFetch_&&b(),t.contents_){r&&a.setModuleState(goog.ModuleType.ES6);try{var e=t.contents_;if(t.contents_=null,goog.globalEval(e),r)var n=goog.moduleLoaderState_.moduleName}finally{r&&a.clearModuleState()}r&&goog.global.$jscomp.require.ensure([t.getPathName()],(function(){a.registerEs6ModuleExports(t.path,goog.global.$jscomp.require(t.getPathName()),n)})),a.loaded()}}var t=this;if(goog.global.CLOSURE_IMPORT_SCRIPT)b(),this.contents_&&goog.global.CLOSURE_IMPORT_SCRIPT("",this.contents_)?(this.contents_=null,a.loaded()):a.pause();else{var r=this.loadFlags.module==goog.ModuleType.ES6;this.lazyFetch_||b();var g=1<a.pending().length,n=g&&goog.DebugLoader_.IS_OLD_IE_;if(g=goog.Dependency.defer_&&(g||goog.isDocumentLoading_()),n||g)a.defer((function(){e()}));else{var o=goog.global.document;if(n=goog.inHtmlDocument_()&&"ActiveXObject"in goog.global,r&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()&&!n){goog.Dependency.defer_=!0,a.pause();var l=o.onreadystatechange;o.onreadystatechange=function(){"interactive"==o.readyState&&(o.onreadystatechange=l,e(),a.resume()),goog.isFunction(l)&&l.apply(void 0,arguments)}}else!goog.DebugLoader_.IS_OLD_IE_&&goog.inHtmlDocument_()&&goog.isDocumentLoading_()?function(){var a=goog.global.document,b=goog.Dependency.registerCallback_((function(){goog.Dependency.unregisterCallback_(b),e()})),t='<script type="text/javascript">'+goog.protectScriptTag_('goog.Dependency.callback_("'+b+'");')+"<\/script>";a.write(goog.TRUSTED_TYPES_POLICY_?goog.TRUSTED_TYPES_POLICY_.createHTML(t):t)}():e()}}},goog.TransformedDependency.prototype.transform=function(a){},goog.TranspiledDependency=function(a,b,e,t,r,n){goog.TransformedDependency.call(this,a,b,e,t,r),this.transpiler=n},goog.inherits(goog.TranspiledDependency,goog.TransformedDependency),goog.TranspiledDependency.prototype.transform=function(a){return this.transpiler.transpile(a,this.getPathName())},goog.PreTranspiledEs6ModuleDependency=function(a,b,e,t,r){goog.TransformedDependency.call(this,a,b,e,t,r)},goog.inherits(goog.PreTranspiledEs6ModuleDependency,goog.TransformedDependency),goog.PreTranspiledEs6ModuleDependency.prototype.transform=function(a){return a},goog.GoogModuleDependency=function(a,b,e,t,r,n,g){goog.TransformedDependency.call(this,a,b,e,t,r),this.needsTranspile_=n,this.transpiler_=g},goog.inherits(goog.GoogModuleDependency,goog.TransformedDependency),goog.GoogModuleDependency.prototype.transform=function(a){return this.needsTranspile_&&(a=this.transpiler_.transpile(a,this.getPathName())),goog.LOAD_MODULE_USING_EVAL&&void 0!==goog.global.JSON?"goog.loadModule("+goog.global.JSON.stringify(a+"\n//# sourceURL="+this.path+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+a+"\n;return exports});\n//# sourceURL="+this.path+"\n"},goog.DebugLoader_.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all),goog.DebugLoader_.prototype.addDependency=function(a,b,e,t){b=b||[],a=a.replace(/\\/g,"/");var r=goog.normalizePath_(goog.basePath+a);for(t&&"boolean"!=typeof t||(t=t?{module:goog.ModuleType.GOOG}:{}),e=this.factory_.createDependency(r,a,b,e,t,goog.transpiler_.needsTranspile(t.lang||"es3",t.module)),this.dependencies_[r]=e,e=0;e<b.length;e++)this.idToPath_[b[e]]=r;this.idToPath_[a]=r},goog.DependencyFactory=function(a){this.transpiler=a},goog.DependencyFactory.prototype.createDependency=function(a,b,e,t,r,n){return r.module==goog.ModuleType.GOOG?new goog.GoogModuleDependency(a,b,e,t,r,n,this.transpiler):n?new goog.TranspiledDependency(a,b,e,t,r,this.transpiler):r.module==goog.ModuleType.ES6?"never"==goog.TRANSPILE&&goog.ASSUME_ES_MODULES_TRANSPILED?new goog.PreTranspiledEs6ModuleDependency(a,b,e,t,r):new goog.Es6ModuleDependency(a,b,e,t,r):new goog.Dependency(a,b,e,t,r)},goog.debugLoader_=new goog.DebugLoader_,goog.loadClosureDeps=function(){goog.debugLoader_.loadClosureDeps()},goog.setDependencyFactory=function(a){goog.debugLoader_.setDependencyFactory(a)},goog.TRUSTED_TYPES_POLICY_=goog.TRUSTED_TYPES_POLICY_NAME?goog.createTrustedTypesPolicy(goog.TRUSTED_TYPES_POLICY_NAME+"#base"):null,goog.global.CLOSURE_NO_DEPS||goog.debugLoader_.loadClosureDeps(),goog.bootstrap=function(a,b){goog.debugLoader_.bootstrap(a,b)}),goog.TRUSTED_TYPES_POLICY_NAME="",goog.identity_=function(a){return a},goog.createTrustedTypesPolicy=function(a){var b=null,e=goog.global.trustedTypes;if(!e||!e.createPolicy)return b;try{b=e.createPolicy(a,{createHTML:goog.identity_,createScript:goog.identity_,createScriptURL:goog.identity_})}catch(e){goog.logToConsole_(e.message)}return b};var shaka={util:{}};if(shaka.util.FakeEvent=function(a,b){for(var e in b=void 0===b?{}:b)Object.defineProperty(this,e,{value:b[e],writable:!0,enumerable:!0});this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now(),this.type=a,this.isTrusted=!1,this.target=this.currentTarget=null,this.stopped=!1},shaka.util.FakeEvent.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},shaka.util.FakeEvent.prototype.stopImmediatePropagation=function(){this.stopped=!0},shaka.util.FakeEvent.prototype.stopPropagation=function(){},goog.asserts=function(){},goog.asserts.assert=function(a,b){},goog.asserts.ENABLE_ASSERTS=!0,goog.asserts.ENABLE_ASSERTS&&console.assert&&console.assert.bind&&(goog.asserts.assert=console.assert.bind(console)),shaka.log=function(){},shaka.log.alwaysError=function(a){},shaka.log.alwaysWarn=function(a){},shaka.log.warnOnce=function(a,b){for(var e=[],t=1;t<arguments.length;++t)e[t-1]=arguments[t];shaka.log.oneTimeWarningIssued_.has(a)||(shaka.log.oneTimeWarningIssued_.add(a),shaka.log.alwaysWarn.apply(shaka.log,$jscomp.arrayFromIterable(e)))},shaka.log.error=function(a){},shaka.log.warning=function(a){},shaka.log.info=function(a){},shaka.log.debug=function(a){},shaka.log.v1=function(a){},shaka.log.v2=function(a){},shaka.log.Level={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4,V1:5,V2:6},shaka.log.MAX_LOG_LEVEL=4,shaka.log.oneTimeWarningIssued_=new Set,window.console&&window.console.log.bind){var $jscomp$compprop0={};shaka.log.logMap_=($jscomp$compprop0[shaka.log.Level.ERROR]=console.error.bind(console),$jscomp$compprop0[shaka.log.Level.WARNING]=console.warn.bind(console),$jscomp$compprop0[shaka.log.Level.INFO]=console.info.bind(console),$jscomp$compprop0[shaka.log.Level.DEBUG]=console.log.bind(console),$jscomp$compprop0[shaka.log.Level.V1]=console.debug.bind(console),$jscomp$compprop0[shaka.log.Level.V2]=console.debug.bind(console),$jscomp$compprop0),shaka.log.alwaysWarn=shaka.log.logMap_[shaka.log.Level.WARNING],shaka.log.alwaysError=shaka.log.logMap_[shaka.log.Level.ERROR],goog.DEBUG?(goog.exportSymbol("shaka.log",shaka.log),shaka.log.setLevel=function(a){var b=function(b){return b<=a?(goog.asserts.assert(shaka.log.logMap_[b],"Unexpected log level"),shaka.log.logMap_[b]):function(){}};shaka.log.currentLevel=a,shaka.log.error=b(shaka.log.Level.ERROR),shaka.log.warning=b(shaka.log.Level.WARNING),shaka.log.info=b(shaka.log.Level.INFO),shaka.log.debug=b(shaka.log.Level.DEBUG),shaka.log.v1=b(shaka.log.Level.V1),shaka.log.v2=b(shaka.log.Level.V2)},shaka.log.setLevel(shaka.log.MAX_LOG_LEVEL)):(shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.ERROR&&(shaka.log.error=shaka.log.logMap_[shaka.log.Level.ERROR]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.WARNING&&(shaka.log.warning=shaka.log.logMap_[shaka.log.Level.WARNING]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.INFO&&(shaka.log.info=shaka.log.logMap_[shaka.log.Level.INFO]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.DEBUG&&(shaka.log.debug=shaka.log.logMap_[shaka.log.Level.DEBUG]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.V1&&(shaka.log.v1=shaka.log.logMap_[shaka.log.Level.V1]),shaka.log.MAX_LOG_LEVEL>=shaka.log.Level.V2&&(shaka.log.v2=shaka.log.logMap_[shaka.log.Level.V2]))}shaka.util.MultiMap=function(){this.map_={}},shaka.util.MultiMap.prototype.push=function(a,b){this.map_.hasOwnProperty(a)?this.map_[a].push(b):this.map_[a]=[b]},shaka.util.MultiMap.prototype.get=function(a){return(a=this.map_[a])?a.slice():null},shaka.util.MultiMap.prototype.getAll=function(){var b,a=[];for(b in this.map_)a.push.apply(a,$jscomp.arrayFromIterable(this.map_[b]));return a},shaka.util.MultiMap.prototype.remove=function(a,b){a in this.map_&&(this.map_[a]=this.map_[a].filter((function(a){return a!=b})))},shaka.util.MultiMap.prototype.clear=function(){this.map_={}},shaka.util.MultiMap.prototype.forEach=function(a){for(var b in this.map_)a(b,this.map_[b])},shaka.util.FakeEventTarget=function(){this.listeners_=new shaka.util.MultiMap,this.dispatchTarget=this},shaka.util.FakeEventTarget.prototype.addEventListener=function(a,b,e){this.listeners_.push(a,b)},shaka.util.FakeEventTarget.prototype.removeEventListener=function(a,b,e){this.listeners_.remove(a,b)},shaka.util.FakeEventTarget.prototype.dispatchEvent=function(a){goog.asserts.assert(a instanceof shaka.util.FakeEvent,"FakeEventTarget can only dispatch FakeEvents!");for(var b=this.listeners_.get(a.type)||[],e=(b=$jscomp.makeIterator(b)).next();!e.done;e=b.next()){e=e.value,a.target=this.dispatchTarget,a.currentTarget=this.dispatchTarget;try{e.handleEvent?e.handleEvent(a):e.call(this,a)}catch(e){shaka.log.error("Uncaught exception in event handler",e,e?e.message:null,e?e.stack:null)}if(a.stopped)break}return a.defaultPrevented},shaka.util.Iterables=function(){},shaka.util.Iterables.map=function(a,b){for(var e=[],t=$jscomp.makeIterator(a),r=t.next();!r.done;r=t.next())e.push(b(r.value));return e},shaka.util.Iterables.every=function(a,b){for(var e=$jscomp.makeIterator(a),t=e.next();!t.done;t=e.next())if(!b(t.value))return!1;return!0},shaka.util.Iterables.some=function(a,b){for(var e=$jscomp.makeIterator(a),t=e.next();!t.done;t=e.next())if(b(t.value))return!0;return!1},shaka.util.Iterables.filter=function(a,b){for(var e=[],t=$jscomp.makeIterator(a),r=t.next();!r.done;r=t.next())b(r=r.value)&&e.push(r);return e},shaka.util.Iterables.range=function e(a){var t;return $jscomp.generator.createGenerator(e,(function(e){return 1==e.nextAddress&&(t=0),3!=e.nextAddress?t<a?e.yield(t,3):e.jumpTo(0):(t++,e.jumpTo(2))}))},shaka.util.Iterables.enumerate=function e(a){var t,r,n,o,g,l;return $jscomp.generator.createGenerator(e,(function(e){return 1==e.nextAddress&&(t=-1,n=r=void 0,o=$jscomp.makeIterator(a),g=o.next()),5!=e.nextAddress?g.done?-1==t?e.jumpTo(0):e.yield({i:t,prev:r,item:n,next:void 0},0):(l=g.value,0<=t?e.yield({i:t,item:n,prev:r,next:l},5):e.jumpTo(5)):(t++,r=n,n=l,g=o.next(),e.jumpTo(2))}))},goog.uri={},goog.uri.utils={},goog.uri.utils.splitRe_=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,goog.uri.utils.ComponentIndex={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7},goog.uri.utils.split=function(a){return a.match(goog.uri.utils.splitRe_)},goog.Uri=function(a){var b;a instanceof goog.Uri?(this.setScheme(a.getScheme()),this.setUserInfo(a.getUserInfo()),this.setDomain(a.getDomain()),this.setPort(a.getPort()),this.setPath(a.getPath()),this.setQueryData(a.getQueryData().clone()),this.setFragment(a.getFragment())):a&&(b=goog.uri.utils.split(String(a)))?(this.setScheme(b[goog.uri.utils.ComponentIndex.SCHEME]||"",!0),this.setUserInfo(b[goog.uri.utils.ComponentIndex.USER_INFO]||"",!0),this.setDomain(b[goog.uri.utils.ComponentIndex.DOMAIN]||"",!0),this.setPort(b[goog.uri.utils.ComponentIndex.PORT]),this.setPath(b[goog.uri.utils.ComponentIndex.PATH]||"",!0),this.setQueryData(b[goog.uri.utils.ComponentIndex.QUERY_DATA]||"",!0),this.setFragment(b[goog.uri.utils.ComponentIndex.FRAGMENT]||"",!0)):this.queryData_=new goog.Uri.QueryData(null,null)},goog.Uri.prototype.scheme_="",goog.Uri.prototype.userInfo_="",goog.Uri.prototype.domain_="",goog.Uri.prototype.port_=null,goog.Uri.prototype.path_="",goog.Uri.prototype.fragment_="",goog.Uri.prototype.toString=function(){var a=[],b=this.getScheme();if(b&&a.push(goog.Uri.encodeSpecialChars_(b,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),":"),b=this.getDomain()){a.push("//");var e=this.getUserInfo();e&&a.push(goog.Uri.encodeSpecialChars_(e,goog.Uri.reDisallowedInSchemeOrUserInfo_,!0),"@"),a.push(goog.Uri.removeDoubleEncoding_(encodeURIComponent(b))),null!=(b=this.getPort())&&a.push(":",String(b))}return(b=this.getPath())&&(this.hasDomain()&&"/"!=b.charAt(0)&&a.push("/"),a.push(goog.Uri.encodeSpecialChars_(b,"/"==b.charAt(0)?goog.Uri.reDisallowedInAbsolutePath_:goog.Uri.reDisallowedInRelativePath_,!0))),(b=this.getEncodedQuery())&&a.push("?",b),(b=this.getFragment())&&a.push("#",goog.Uri.encodeSpecialChars_(b,goog.Uri.reDisallowedInFragment_)),a.join("")},goog.Uri.prototype.resolve=function(a){var b=this.clone();"data"===b.scheme_&&(b=new goog.Uri);var e=a.hasScheme();e?b.setScheme(a.getScheme()):e=a.hasUserInfo(),e?b.setUserInfo(a.getUserInfo()):e=a.hasDomain(),e?b.setDomain(a.getDomain()):e=a.hasPort();var t=a.getPath();if(e)b.setPort(a.getPort());else if(e=a.hasPath()){if("/"!=t.charAt(0))if(this.hasDomain()&&!this.hasPath())t="/"+t;else{var r=b.getPath().lastIndexOf("/");-1!=r&&(t=b.getPath().substr(0,r+1)+t)}t=goog.Uri.removeDotSegments(t)}return e?b.setPath(t):e=a.hasQuery(),e?b.setQueryData(a.getQueryData().clone()):e=a.hasFragment(),e&&b.setFragment(a.getFragment()),b},goog.Uri.prototype.clone=function(){return new goog.Uri(this)},goog.Uri.prototype.getScheme=function(){return this.scheme_},goog.Uri.prototype.setScheme=function(a,b){return(this.scheme_=b?goog.Uri.decodeOrEmpty_(a,!0):a)&&(this.scheme_=this.scheme_.replace(/:$/,"")),this},goog.Uri.prototype.hasScheme=function(){return!!this.scheme_},goog.Uri.prototype.getUserInfo=function(){return this.userInfo_},goog.Uri.prototype.setUserInfo=function(a,b){return this.userInfo_=b?goog.Uri.decodeOrEmpty_(a):a,this},goog.Uri.prototype.hasUserInfo=function(){return!!this.userInfo_},goog.Uri.prototype.getDomain=function(){return this.domain_},goog.Uri.prototype.setDomain=function(a,b){return this.domain_=b?goog.Uri.decodeOrEmpty_(a,!0):a,this},goog.Uri.prototype.hasDomain=function(){return!!this.domain_},goog.Uri.prototype.getPort=function(){return this.port_},goog.Uri.prototype.setPort=function(a){if(a){if(a=Number(a),isNaN(a)||0>a)throw Error("Bad port number "+a);this.port_=a}else this.port_=null;return this},goog.Uri.prototype.hasPort=function(){return null!=this.port_},goog.Uri.prototype.getPath=function(){return this.path_},goog.Uri.prototype.setPath=function(a,b){return this.path_=b?goog.Uri.decodeOrEmpty_(a,!0):a,this},goog.Uri.prototype.hasPath=function(){return!!this.path_},goog.Uri.prototype.hasQuery=function(){return""!==this.queryData_.toString()},goog.Uri.prototype.setQueryData=function(a,b){return a instanceof goog.Uri.QueryData?this.queryData_=a:(b||(a=goog.Uri.encodeSpecialChars_(a,goog.Uri.reDisallowedInQuery_)),this.queryData_=new goog.Uri.QueryData(a,null)),this},goog.Uri.prototype.getEncodedQuery=function(){return this.queryData_.toString()},goog.Uri.prototype.getDecodedQuery=function(){return this.queryData_.toDecodedString()},goog.Uri.prototype.getQueryData=function(){return this.queryData_},goog.Uri.prototype.getFragment=function(){return this.fragment_},goog.Uri.prototype.setFragment=function(a,b){return this.fragment_=b?goog.Uri.decodeOrEmpty_(a):a,this},goog.Uri.prototype.hasFragment=function(){return!!this.fragment_},goog.Uri.removeDotSegments=function(a){if(".."==a||"."==a)return"";if(-1==a.indexOf("./")&&-1==a.indexOf("/."))return a;var b=0==a.lastIndexOf("/",0);a=a.split("/");for(var e=[],t=0;t<a.length;){var r=a[t++];"."==r?b&&t==a.length&&e.push(""):".."==r?((1<e.length||1==e.length&&""!=e[0])&&e.pop(),b&&t==a.length&&e.push("")):(e.push(r),b=!0)}return e.join("/")},goog.Uri.decodeOrEmpty_=function(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""},goog.Uri.encodeSpecialChars_=function(a,b,e){return null!=a?(a=encodeURI(a).replace(b,goog.Uri.encodeChar_),e&&(a=goog.Uri.removeDoubleEncoding_(a)),a):null},goog.Uri.encodeChar_=function(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)},goog.Uri.removeDoubleEncoding_=function(a){return a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")},goog.Uri.reDisallowedInSchemeOrUserInfo_=/[#\/\?@]/g,goog.Uri.reDisallowedInRelativePath_=/[#\?:]/g,goog.Uri.reDisallowedInAbsolutePath_=/[#\?]/g,goog.Uri.reDisallowedInQuery_=/[#\?@]/g,goog.Uri.reDisallowedInFragment_=/#/g,goog.Uri.QueryData=function(a,b){this.encodedQuery_=a||null},goog.Uri.QueryData.prototype.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_={},this.count_=0,this.encodedQuery_))for(var a=this.encodedQuery_.split("&"),b=0;b<a.length;b++){var e=a[b].indexOf("="),t=null;if(0<=e){var r=a[b].substring(0,e);t=a[b].substring(e+1)}else r=a[b];r=decodeURIComponent(r.replace(/\+/g," ")),t=t||"",this.add(r,decodeURIComponent(t.replace(/\+/g," ")))}},goog.Uri.QueryData.prototype.keyMap_=null,goog.Uri.QueryData.prototype.count_=null,goog.Uri.QueryData.prototype.getCount=function(){return this.ensureKeyMapInitialized_(),this.count_},goog.Uri.QueryData.prototype.add=function(a,b){this.ensureKeyMapInitialized_(),this.encodedQuery_=null;var e=this.keyMap_.hasOwnProperty(a)&&this.keyMap_[a];return e||(this.keyMap_[a]=e=[]),e.push(b),goog.asserts.assert(null!=this.count_,"Should not be null."),this.count_++,this},goog.Uri.QueryData.prototype.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";var b,a=[];for(b in this.keyMap_)for(var e=encodeURIComponent(b),t=this.keyMap_[b],r=0;r<t.length;r++){var n=e;""!==t[r]&&(n+="="+encodeURIComponent(t[r])),a.push(n)}return this.encodedQuery_=a.join("&")},goog.Uri.QueryData.prototype.toDecodedString=function(){return goog.Uri.decodeOrEmpty_(this.toString())},goog.Uri.QueryData.prototype.clone=function(){var a=new goog.Uri.QueryData;if(a.encodedQuery_=this.encodedQuery_,this.keyMap_){var e,b={};for(e in this.keyMap_)b[e]=this.keyMap_[e].concat();a.keyMap_=b,a.count_=this.count_}return a},shaka.deprecate={},shaka.deprecate.Version=function(a,b){this.major_=a,this.minor_=b},shaka.deprecate.Version.prototype.major=function(){return this.major_},shaka.deprecate.Version.prototype.minor=function(){return this.minor_},shaka.deprecate.Version.prototype.compareTo=function(a){var b=this.minor_-a.minor_;return this.major_-a.major_||b},shaka.deprecate.Version.prototype.toString=function(){return"v"+this.major_+"."+this.minor_},shaka.deprecate.Version.parse=function(a){return a=a.substring(1).split(".",2),new shaka.deprecate.Version(Number(a[0]),Number(a[1]))},shaka.deprecate.Enforcer=function(a,b,e){this.libraryVersion_=a,this.onPending_=b,this.onExpired_=e},shaka.deprecate.Enforcer.prototype.enforce=function(a,b,e){(0<a.compareTo(this.libraryVersion_)?this.onPending_:this.onExpired_)(this.libraryVersion_,a,b,e)},shaka.Deprecate=function(){},shaka.Deprecate.init=function(a){goog.asserts.assert(null==shaka.Deprecate.enforcer_,"Deprecate.init should only be called once."),shaka.Deprecate.enforcer_=new shaka.deprecate.Enforcer(shaka.deprecate.Version.parse(a),shaka.Deprecate.onPending_,shaka.Deprecate.onExpired_)},shaka.Deprecate.deprecateFeature=function(a,b,e){var t=shaka.Deprecate.enforcer_;goog.asserts.assert(t,"Missing deprecation enforcer. Was |init| called?"),a=new shaka.deprecate.Version(a,0),t.enforce(a,b,e)},shaka.Deprecate.onPending_=function(a,b,e,t){shaka.log.alwaysWarn([e,"has been deprecated and will be removed in",b,". We are currently at version",a,". Additional information:",t].join(" "))},shaka.Deprecate.onExpired_=function(a,b,e,t){a=[e,"has been deprecated and has been removed in",b,". We are now at version",a,". Additional information:",t].join(""),shaka.log.alwaysError(a),goog.asserts.assert(!1,a)},shaka.Deprecate.enforcer_=null,shaka.util.Functional=function(){},shaka.util.Functional.createFallbackPromiseChain=function(a,b){return a.reduce((function(a,e){return a.catch((function(){return b(e)}))}),Promise.reject())},shaka.util.Functional.collapseArrays=function(a,b){return a.concat(b)},shaka.util.Functional.ignored=function(a){},shaka.util.Functional.noop=function(){},shaka.util.Functional.isNotNull=function(a){return null!=a},shaka.util.Functional.callFactory=function(a){var b=Object.create(a.prototype||Object.prototype);return(a=a.call(b))||(shaka.Deprecate.deprecateFeature(4,"Factories requiring new","Factories should be plain functions"),a=b),a},shaka.util.ManifestParserUtils=function(){},shaka.util.ManifestParserUtils.resolveUris=function(a,b){var e=shaka.util.Functional;if(0==b.length)return a;var t=b.map((function(a){return new goog.Uri(a)}));return a.map((function(a){return new goog.Uri(a)})).map((function(a){return t.map((function(b){return a.resolve(b)}))})).reduce(e.collapseArrays,[]).map((function(a){return a.toString()}))},shaka.util.ManifestParserUtils.createDrmInfo=function(a,b){return{keySystem:a,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:b||[],keyIds:new Set}},shaka.util.ManifestParserUtils.ContentType={VIDEO:"video",AUDIO:"audio",TEXT:"text",IMAGE:"image",APPLICATION:"application"},shaka.util.ManifestParserUtils.TextStreamKind={SUBTITLE:"subtitle",CLOSED_CAPTION:"caption"},shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS=1/15,shaka.util.LanguageUtils=function(){},shaka.util.LanguageUtils.areLocaleCompatible=function(a,b){var e=shaka.util.LanguageUtils;return(a=e.normalize(a))==(b=e.normalize(b))},shaka.util.LanguageUtils.areLanguageCompatible=function(a,b){var e=shaka.util.LanguageUtils;a=e.normalize(a),b=e.normalize(b);var t=e.disassembleLocale_(a);return e=e.disassembleLocale_(b),t[0]==e[0]},shaka.util.LanguageUtils.isParentOf=function(a,b){var e=shaka.util.LanguageUtils;a=e.normalize(a),b=e.normalize(b);var t=e.disassembleLocale_(a);return e=e.disassembleLocale_(b),t[0]==e[0]&&1==t.length&&2==e.length},shaka.util.LanguageUtils.isSiblingOf=function(a,b){var e=shaka.util.LanguageUtils;a=e.normalize(a),b=e.normalize(b);var t=e.disassembleLocale_(a);return e=e.disassembleLocale_(b),2==t.length&&2==e.length&&t[0]==e[0]},shaka.util.LanguageUtils.normalize=function(a){var b=shaka.util.LanguageUtils,e=a.split("-");return a=e[0]||"",e=e[1]||"",a=a.toLowerCase(),a=b.isoMap_.get(a)||a,(e=e.toUpperCase())?a+"-"+e:a},shaka.util.LanguageUtils.areSiblings=function(a,b){var e=shaka.util.LanguageUtils,t=e.getBase(a);return e=e.getBase(b),a!=t&&b!=e&&t==e},shaka.util.LanguageUtils.relatedness=function(a,b){var e=shaka.util.LanguageUtils;return a=e.normalize(a),(b=e.normalize(b))==a?4:e.isParentOf(b,a)?3:e.isSiblingOf(b,a)?2:e.isParentOf(a,b)?1:0},shaka.util.LanguageUtils.getBase=function(a){var b=shaka.util.LanguageUtils,e=a.indexOf("-");return a=(a=0<=e?a.substring(0,e):a).toLowerCase(),b.isoMap_.get(a)||a},shaka.util.LanguageUtils.getLocaleForText=function(a){var b=shaka.util.LanguageUtils;return goog.asserts.assert(a.type==shaka.util.ManifestParserUtils.ContentType.TEXT,"Can only get language from text streams"),b.normalize(a.language||"und")},shaka.util.LanguageUtils.getLocaleForVariant=function(a){var b=shaka.util.LanguageUtils;return a.language?b.normalize(a.language):a.audio&&a.audio.language?b.normalize(a.audio.language):a.video&&a.video.language?b.normalize(a.video.language):"und"},shaka.util.LanguageUtils.findClosestLocale=function(a,b){for(var e=shaka.util.LanguageUtils,t=e.normalize(a),r=new Set,n=$jscomp.makeIterator(b),g=n.next();!g.done;g=n.next())r.add(e.normalize(g.value));for(g=(n=$jscomp.makeIterator(r)).next();!g.done;g=n.next())if((g=g.value)==t)return g;for(g=(n=$jscomp.makeIterator(r)).next();!g.done;g=n.next())if(g=g.value,e.isParentOf(g,t))return g;for(g=(n=$jscomp.makeIterator(r)).next();!g.done;g=n.next())if(g=g.value,e.isSiblingOf(g,t))return g;for(g=(r=$jscomp.makeIterator(r)).next();!g.done;g=r.next())if(g=g.value,e.isParentOf(t,g))return g;return null},shaka.util.LanguageUtils.disassembleLocale_=function(a){var b=a.split("-");return goog.asserts.assert(2>=b.length,["Locales should not have more than 2 components. ",a," has too many components."].join()),b},shaka.util.LanguageUtils.isoMap_=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]),shaka.ui={},shaka.ui.Localization=function(a){this.fallbackLocale_=shaka.util.LanguageUtils.normalize(a),this.currentMap_=new Map,this.currentLocales_=new Set,this.localizations_=new Map,this.events_=new shaka.util.FakeEventTarget},shaka.ui.Localization.prototype.addEventListener=function(a,b,e){this.events_.addEventListener(a,b,e)},shaka.ui.Localization.prototype.removeEventListener=function(a,b,e){this.events_.removeEventListener(a,b,e||void 0)},shaka.ui.Localization.prototype.dispatchEvent=function(a){return this.events_.dispatchEvent(a)},shaka.ui.Localization.prototype.changeLocale=function(a){var b=this,e=shaka.ui.Localization;this.currentLocales_.clear();for(var t=(a=$jscomp.makeIterator(a)).next();!t.done;t=a.next())this.currentLocales_.add(shaka.util.LanguageUtils.normalize(t.value));this.updateCurrentMap_(),(a=shaka.util.Iterables.filter(this.currentLocales_,(function(a){return!b.localizations_.has(a)}))).length&&this.events_.dispatchEvent(new shaka.util.FakeEvent(e.UNKNOWN_LOCALES,{locales:a})),a=shaka.util.Iterables.filter(this.currentLocales_,(function(a){return b.localizations_.has(a)})),this.events_.dispatchEvent(new shaka.util.FakeEvent(e.LOCALE_CHANGED,{locales:a.length?a:[this.fallbackLocale_]}))},shaka.ui.Localization.prototype.insert=function(a,b,e){var t=shaka.ui.Localization,r=shaka.ui.Localization.ConflictResolution,n=shaka.util.FakeEvent;a=shaka.util.LanguageUtils.normalize(a),void 0===e&&(e=r.USE_NEW);var g=this.localizations_.get(a)||new Map;return b.forEach((function(a,b){g.has(b)&&e!=r.USE_NEW||g.set(b,a)})),this.localizations_.set(a,g),this.updateCurrentMap_(),this.events_.dispatchEvent(new n(t.LOCALE_UPDATED)),this},shaka.ui.Localization.prototype.resolveDictionary=function(a){for(var b=$jscomp.makeIterator(a.keys()),e=b.next();!e.done;e=b.next())e=e.value,a.set(e,this.resolve(e))},shaka.ui.Localization.prototype.resolve=function(a){var b=shaka.ui.Localization,e=shaka.util.FakeEvent,t=this.currentMap_.get(a);return t||(a={locales:Array.from(this.currentLocales_),missing:a},this.events_.dispatchEvent(new e(b.UNKNOWN_LOCALIZATION,a)),"")},shaka.ui.Localization.prototype.updateCurrentMap_=function(){for(var a=this,b=shaka.util.LanguageUtils,e=this.localizations_,t=this.fallbackLocale_,r=this.currentLocales_,n=new Set,g={},o=$jscomp.makeIterator(r),l=o.next();!l.done;g={$jscomp$loop$prop$locale$525:g.$jscomp$loop$prop$locale$525},l=o.next()){g.$jscomp$loop$prop$locale$525=l.value,n.add(g.$jscomp$loop$prop$locale$525),n.add(b.getBase(g.$jscomp$loop$prop$locale$525)),(l=shaka.util.Iterables.filter(e.keys(),function(a){return function(e){return b.areSiblings(e,a.$jscomp$loop$prop$locale$525)}}(g))).sort();var h=$jscomp.makeIterator(l);for(l=h.next();!l.done;l=h.next())n.add(l.value);for((l=shaka.util.Iterables.filter(e.keys(),function(a){return function(e){return b.getBase(e)==a.$jscomp$loop$prop$locale$525}}(g))).sort(),l=(h=$jscomp.makeIterator(l)).next();!l.done;l=h.next())n.add(l.value)}for(n.add(t),t=[],l=(n=$jscomp.makeIterator(n)).next();!l.done;l=n.next())(l=e.get(l.value))&&t.push(l);for(t.reverse(),this.currentMap_.clear(),l=(e=$jscomp.makeIterator(t)).next();!l.done;l=e.next())l.value.forEach((function(b,e){a.currentMap_.set(e,b)}));for(e=this.currentMap_.keys(),n=new Set,l=(t=$jscomp.makeIterator(this.currentLocales_)).next();!l.done;l=t.next())l=this.localizations_.get(l.value)||new Map,shaka.ui.Localization.findMissingKeys_(l,e,n);0<n.size&&(r={locales:Array.from(r),missing:Array.from(n)},this.events_.dispatchEvent(new shaka.util.FakeEvent(shaka.ui.Localization.MISSING_LOCALIZATIONS,r)))},shaka.ui.Localization.findMissingKeys_=function(a,b,e){for(var t=(b=$jscomp.makeIterator(b)).next();!t.done;t=b.next())t=t.value,a.get(t)||e.add(t)},goog.exportSymbol("shaka.ui.Localization",shaka.ui.Localization),goog.exportProperty(shaka.ui.Localization.prototype,"resolve",shaka.ui.Localization.prototype.resolve),goog.exportProperty(shaka.ui.Localization.prototype,"resolveDictionary",shaka.ui.Localization.prototype.resolveDictionary),goog.exportProperty(shaka.ui.Localization.prototype,"insert",shaka.ui.Localization.prototype.insert),goog.exportProperty(shaka.ui.Localization.prototype,"changeLocale",shaka.ui.Localization.prototype.changeLocale),goog.exportProperty(shaka.ui.Localization.prototype,"dispatchEvent",shaka.ui.Localization.prototype.dispatchEvent),goog.exportProperty(shaka.ui.Localization.prototype,"removeEventListener",shaka.ui.Localization.prototype.removeEventListener),goog.exportProperty(shaka.ui.Localization.prototype,"addEventListener",shaka.ui.Localization.prototype.addEventListener),shaka.ui.Localization.ConflictResolution={USE_OLD:0,USE_NEW:1},goog.exportProperty(shaka.ui.Localization,"ConflictResolution",shaka.ui.Localization.ConflictResolution),shaka.ui.Localization.UNKNOWN_LOCALES="unknown-locales",goog.exportProperty(shaka.ui.Localization,"UNKNOWN_LOCALES",shaka.ui.Localization.UNKNOWN_LOCALES),shaka.ui.Localization.UNKNOWN_LOCALIZATION="unknown-localization",goog.exportProperty(shaka.ui.Localization,"UNKNOWN_LOCALIZATION",shaka.ui.Localization.UNKNOWN_LOCALIZATION),shaka.ui.Localization.MISSING_LOCALIZATIONS="missing-localizations",goog.exportProperty(shaka.ui.Localization,"MISSING_LOCALIZATIONS",shaka.ui.Localization.MISSING_LOCALIZATIONS),shaka.ui.Localization.LOCALE_CHANGED="locale-changed",goog.exportProperty(shaka.ui.Localization,"LOCALE_CHANGED",shaka.ui.Localization.LOCALE_CHANGED),shaka.ui.Localization.LOCALE_UPDATED="locale-updated",goog.exportProperty(shaka.ui.Localization,"LOCALE_UPDATED",shaka.ui.Localization.LOCALE_UPDATED),shaka.ui.Locales={},shaka.ui.Locales.addTo=function(a){a.insert("ar",new Map([["AD_DURATION"," "],["AD_PROGRESS"," [AD_ON]  [NUM_ADS]"],["AD_TIME",": [AD_TIME]"],["AUTO_QUALITY",""],["BACK",""],["CAPTIONS"," "],["CAST","..."],["ENTER_LOOP_MODE","  "],["ENTER_PICTURE_IN_PICTURE",'   "  "'],["EXIT_FULL_SCREEN","   "],["EXIT_LOOP_MODE","   "],["EXIT_PICTURE_IN_PICTURE",'   "  "'],["FAST_FORWARD"," "],["FULL_SCREEN"," "],["LANGUAGE",""],["LIVE",""],["LOOP",""],["MORE_SETTINGS","  "],["MULTIPLE_LANGUAGES"," "],["MUTE"," "],["NOT_APPLICABLE"," "],["OFF",""],["ON",""],["PAUSE"," "],["PICTURE_IN_PICTURE","  "],["PLAY",""],["PLAYBACK_RATE"," "],["RESOLUTION"," "],["REWIND",""],["SEEK"," "],["SKIP_AD"," "],["SKIP_TO_LIVE","   "],["UNDETERMINED_LANGUAGE"," "],["UNMUTE"," "],["UNRECOGNIZED_LANGUAGE"," "],["VOLUME"," "]])),a.insert("de",new Map([["AD_DURATION","Dauer der Werbeanzeige"],["AD_PROGRESS","Werbung[AD_ON] von[NUM_ADS]"],["AD_TIME","Werbeanzeige: [AD_TIME]"],["AUTO_QUALITY","Automatisch"],["BACK","Zurck"],["CAPTIONS","Untertitel"],["CAST","Streamen..."],["ENTER_LOOP_MODE","In Endlosschleife spielen"],["ENTER_PICTURE_IN_PICTURE","Bild-im-Bild-Modus aktivieren"],["EXIT_FULL_SCREEN","Vollbildmodus beenden"],["EXIT_LOOP_MODE","Endlosschleife stoppen"],["EXIT_PICTURE_IN_PICTURE","Bild-im-Bild-Modus beenden"],["FAST_FORWARD","Vorspulen"],["FULL_SCREEN","Vollbildmodus"],["LANGUAGE","Sprache"],["LIVE","Live"],["LOOP","Schleife"],["MORE_SETTINGS","Weitere Einstellungen"],["MULTIPLE_LANGUAGES","Mehrere Sprachen"],["MUTE","Stummschalten"],["NOT_APPLICABLE","Nicht zutreffend"],["OFF","Aus"],["ON","Ein"],["PAUSE","Pause"],["PICTURE_IN_PICTURE","Bild im Bild"],["PLAY","Wiedergabe"],["PLAYBACK_RATE","Geschwindigkeit"],["RESOLUTION","Auflsung"],["REWIND","Zurckspulen"],["SEEK","Suche"],["SKIP_AD","berspringen"],["SKIP_TO_LIVE","Zum Live-Videostream wechseln"],["UNDETERMINED_LANGUAGE","Unbestimmt"],["UNMUTE","Stummschaltung aufheben"],["UNRECOGNIZED_LANGUAGE","Unbekannt"],["VOLUME","Lautstrke"]])),a.insert("en",new Map([["AD_DURATION","Ad duration"],["AD_PROGRESS","Ad [AD_ON] of [NUM_ADS]"],["AD_TIME","Ad: [AD_TIME]"],["AIRPLAY","AirPlay"],["AUTO_QUALITY","Auto"],["BACK","Back"],["CAPTIONS","Captions"],["CAST","Cast..."],["ENTER_LOOP_MODE","Loop the current video"],["ENTER_PICTURE_IN_PICTURE","Enter Picture-in-Picture"],["EXIT_FULL_SCREEN","Exit full screen"],["EXIT_LOOP_MODE","Stop looping the current video"],["EXIT_PICTURE_IN_PICTURE","Exit Picture-in-Picture"],["FAST_FORWARD","Fast-forward"],["FULL_SCREEN","Full screen"],["LANGUAGE","Language"],["LIVE","Live"],["LOOP","Loop"],["MORE_SETTINGS","More settings"],["MULTIPLE_LANGUAGES","Multiple languages"],["MUTE","Mute"],["NOT_APPLICABLE","Not applicable"],["OFF","Off"],["ON","On"],["PAUSE","Pause"],["PICTURE_IN_PICTURE","Picture-in-Picture"],["PLAY","Play"],["PLAYBACK_RATE","Playback speed"],["RESOLUTION","Resolution"],["REWIND","Rewind"],["SEEK","Seek"],["SKIP_AD","Skip Ad"],["SKIP_TO_LIVE","Skip ahead to live"],["UNDETERMINED_LANGUAGE","Undetermined"],["UNMUTE","Unmute"],["UNRECOGNIZED_LANGUAGE","Unrecognized"],["VOLUME","Volume"]])),a.insert("en-GB",new Map([["AD_DURATION","Ad duration"],["AD_PROGRESS","Ad [AD_ON] of [NUM_ADS]"],["AD_TIME","Ad: [AD_TIME]"],["AUTO_QUALITY","Auto"],["BACK","Back"],["CAPTIONS","Captions"],["CAST","Cast..."],["ENTER_LOOP_MODE","Loop the current video"],["ENTER_PICTURE_IN_PICTURE","Enter picture-in-picture"],["EXIT_FULL_SCREEN","Exit full screen"],["EXIT_LOOP_MODE","Stop looping the current video"],["EXIT_PICTURE_IN_PICTURE","Exit picture-in-picture"],["FAST_FORWARD","Fast-forward"],["FULL_SCREEN","Full screen"],["LANGUAGE","Language"],["LIVE","Live"],["LOOP","Loop"],["MORE_SETTINGS","More settings"],["MULTIPLE_LANGUAGES","Multiple languages"],["MUTE","Mute"],["NOT_APPLICABLE","Not applicable"],["OFF","Off"],["ON","On"],["PAUSE","Pause"],["PICTURE_IN_PICTURE","Picture-in-picture"],["PLAY","Play"],["PLAYBACK_RATE","Playback speed"],["RESOLUTION","Resolution"],["REWIND","Rewind"],["SEEK","Seek"],["SKIP_AD","Skip ad"],["SKIP_TO_LIVE","Skip ahead to live"],["UNDETERMINED_LANGUAGE","Undetermined"],["UNMUTE","Unmute"],["UNRECOGNIZED_LANGUAGE","Unrecognised"],["VOLUME","volume"]])),a.insert("es",new Map([["AD_DURATION","Duracin del anuncio"],["AD_PROGRESS","Anuncio [AD_ON] de [NUM_ADS]"],["AD_TIME","Anuncio: [AD_TIME]"],["AUTO_QUALITY","Automtico"],["BACK","Atrs"],["CAPTIONS","Subttulos"],["CAST","Enviar..."],["ENTER_LOOP_MODE","Reproducir en bucle el vdeo actual"],["ENTER_PICTURE_IN_PICTURE","Activar el modo imagen en imagen"],["EXIT_FULL_SCREEN","Salir del modo de pantalla completa"],["EXIT_LOOP_MODE","Dejar de reproducir en bucle el vdeo actual"],["EXIT_PICTURE_IN_PICTURE","Salir del modo imagen en imagen"],["FAST_FORWARD","Avanzar rpidamente"],["FULL_SCREEN","Pantalla completa"],["LANGUAGE","Idioma"],["LIVE","En directo"],["LOOP","Reproducir en bucle"],["MORE_SETTINGS","Ms ajustes"],["MULTIPLE_LANGUAGES","Varios idiomas"],["MUTE","Silenciar"],["NOT_APPLICABLE","No aplicable"],["OFF","Desactivado"],["ON","Activado"],["PAUSE","Pausar"],["PICTURE_IN_PICTURE","Imagen en imagen"],["PLAY","Reproducir"],["PLAYBACK_RATE","Velocidad de reproduccin"],["RESOLUTION","Resolucin"],["REWIND","Rebobinar"],["SEEK","Buscar"],["SKIP_AD","Saltar anuncio"],["SKIP_TO_LIVE","Ir al vdeo en directo"],["UNDETERMINED_LANGUAGE","Sin especificar"],["UNMUTE","Activar sonido"],["UNRECOGNIZED_LANGUAGE","No reconocida"],["VOLUME","Volumen"]])),a.insert("es-419",new Map([["AD_DURATION","Duracin del anuncio"],["AD_PROGRESS","Anuncio [AD_ON] de [NUM_ADS]"],["AD_TIME","Anuncio: [AD_TIME]"],["AUTO_QUALITY","Automtico"],["BACK","Atrs"],["CAPTIONS","Subttulos"],["CAST","Transmitir..."],["ENTER_LOOP_MODE","Repetir indefinidamente el video actual"],["ENTER_PICTURE_IN_PICTURE","Ingresar al modo de pantalla en pantalla"],["EXIT_FULL_SCREEN","Salir de pantalla completa"],["EXIT_LOOP_MODE","Detener la repeticin indefinida del video actual"],["EXIT_PICTURE_IN_PICTURE","Salir del modo de pantalla en pantalla"],["FAST_FORWARD","Avanzar"],["FULL_SCREEN","Pantalla completa"],["LANGUAGE","Idioma"],["LIVE","En directo"],["LOOP","Repetir indefinidamente"],["MORE_SETTINGS","Ms opciones de configuracin"],["MULTIPLE_LANGUAGES","Varios idiomas"],["MUTE","Silenciar"],["NOT_APPLICABLE","No aplicable"],["OFF","Desactivado"],["ON","Activado"],["PAUSE","Detener"],["PICTURE_IN_PICTURE","Pantalla en pantalla"],["PLAY","Reproducir"],["PLAYBACK_RATE","Velocidad de reproduccin"],["RESOLUTION","Resolucin"],["REWIND","Retroceder"],["SEEK","Buscar"],["SKIP_AD","Omitir anuncio"],["SKIP_TO_LIVE","Adelantar hasta la transmisin en vivo"],["UNDETERMINED_LANGUAGE","Sin especificar"],["UNMUTE","Dejar de silenciar"],["UNRECOGNIZED_LANGUAGE","No reconocida"],["VOLUME","Volumen"]])),a.insert("fr",new Map([["AD_DURATION","Dure de l'annonce"],["AD_PROGRESS","Annonce[AD_ON] sur[NUM_ADS]"],["AD_TIME","Annonce: [AD_TIME]"],["AUTO_QUALITY","Automatique"],["BACK","Retour"],["CAPTIONS","Sous-titres"],["CAST","Caster"],["ENTER_LOOP_MODE","Lire en boucle la vido en cours"],["ENTER_PICTURE_IN_PICTURE","Utiliser le mode Picture-in-Picture"],["EXIT_FULL_SCREEN","Quitter le mode plein cran"],["EXIT_LOOP_MODE","Arrter la lecture en boucle de la vido en cours"],["EXIT_PICTURE_IN_PICTURE","Quitter le modePIP (Picture-in-picture)"],["FAST_FORWARD","Avance rapide"],["FULL_SCREEN","Plein cran"],["LANGUAGE","Langue"],["LIVE","En direct"],["LOOP","Rpter"],["MORE_SETTINGS","Plus de paramtres"],["MULTIPLE_LANGUAGES","Plusieurs langues"],["MUTE","Couper le son"],["NOT_APPLICABLE","Non applicable"],["OFF","Dsactive"],["ON","Active"],["PAUSE","Pause"],["PICTURE_IN_PICTURE","Picture-in-Picture"],["PLAY","Visionner"],["PLAYBACK_RATE","Vitesse de lecture"],["RESOLUTION","Rsolution"],["REWIND","Retour arrire"],["SEEK","Chercher"],["SKIP_AD","Passer l'annonce"],["SKIP_TO_LIVE","Accder  la partie la plus rcente du direct"],["UNDETERMINED_LANGUAGE","Langue indtermine"],["UNMUTE","Ractiver le son"],["UNRECOGNIZED_LANGUAGE","Non reconnu"],["VOLUME","Volume"]])),a.insert("it",new Map([["AD_DURATION","Durata dell'annuncio"],["AD_PROGRESS","Annuncio [AD_ON] di [NUM_ADS]"],["AD_TIME","Annuncio: [AD_TIME]"],["AUTO_QUALITY","Automatica"],["BACK","Indietro"],["CAPTIONS","Sottotitoli"],["CAST","Trasmetti..."],["ENTER_LOOP_MODE","Riproduci in loop il video corrente"],["ENTER_PICTURE_IN_PICTURE","Attiva Picture in picture"],["EXIT_FULL_SCREEN","Esci da schermo intero"],["EXIT_LOOP_MODE","Interrompi riproduzione in loop del video corrente"],["EXIT_PICTURE_IN_PICTURE","Esci da Picture in picture"],["FAST_FORWARD","Avanti veloce"],["FULL_SCREEN","Schermo intero"],["LANGUAGE","Lingua"],["LIVE","Dal vivo"],["LOOP","Riproduci in loop"],["MORE_SETTINGS","Altre impostazioni"],["MULTIPLE_LANGUAGES","Pi lingue"],["MUTE","Disattiva audio"],["NOT_APPLICABLE","Non applicabile"],["OFF","Disattivo"],["ON","Attivo"],["PAUSE","Metti in pausa"],["PICTURE_IN_PICTURE","Picture in picture"],["PLAY","Riproduci"],["PLAYBACK_RATE","Velocit di riproduzione"],["RESOLUTION","Risoluzione"],["REWIND","Riavvolgi"],["SEEK","Cerca"],["SKIP_AD","Salta annuncio"],["SKIP_TO_LIVE","Passa alla trasmissione dal vivo"],["UNDETERMINED_LANGUAGE","Indeterminata"],["UNMUTE","Riattiva audio"],["UNRECOGNIZED_LANGUAGE","Non riconosciuto"],["VOLUME","Volume"]])),a.insert("ja",new Map([["AD_DURATION",""],["AD_PROGRESS","[AD_ON]  [NUM_ADS] "],["AD_TIME",": [AD_TIME]"],["AUTO_QUALITY",""],["BACK",""],["CAPTIONS",""],["CAST","..."],["ENTER_LOOP_MODE",""],["ENTER_PICTURE_IN_PICTURE","  "],["EXIT_FULL_SCREEN",""],["EXIT_LOOP_MODE",""],["EXIT_PICTURE_IN_PICTURE","  "],["FAST_FORWARD",""],["FULL_SCREEN",""],["LANGUAGE",""],["LIVE",""],["LOOP",""],["MORE_SETTINGS",""],["MULTIPLE_LANGUAGES",""],["MUTE",""],["NOT_APPLICABLE",""],["OFF",""],["ON",""],["PAUSE",""],["PICTURE_IN_PICTURE","  "],["PLAY",""],["PLAYBACK_RATE",""],["RESOLUTION",""],["REWIND",""],["SEEK",""],["SKIP_AD",""],["SKIP_TO_LIVE",""],["UNDETERMINED_LANGUAGE",""],["UNMUTE",""],["UNRECOGNIZED_LANGUAGE",""],["VOLUME",""]])),a.insert("ko",new Map([["AD_DURATION"," "],["AD_PROGRESS"," [AD_ON]/[NUM_ADS]"],["AD_TIME",": [AD_TIME]"],["AUTO_QUALITY",""],["BACK",""],["CAPTIONS",""],["CAST","..."],["ENTER_LOOP_MODE","   "],["ENTER_PICTURE_IN_PICTURE","PIP  "],["EXIT_FULL_SCREEN"," "],["EXIT_LOOP_MODE","    "],["EXIT_PICTURE_IN_PICTURE","PIP  "],["FAST_FORWARD"," "],["FULL_SCREEN",""],["LANGUAGE",""],["LIVE",""],["LOOP"," "],["MORE_SETTINGS"," "],["MULTIPLE_LANGUAGES"," "],["MUTE",""],["NOT_APPLICABLE","  "],["OFF"," "],["ON",""],["PAUSE",""],["PICTURE_IN_PICTURE","PIP "],["PLAY",""],["PLAYBACK_RATE"," "],["RESOLUTION",""],["REWIND",""],["SEEK",""],["SKIP_AD"," "],["SKIP_TO_LIVE","  "],["UNDETERMINED_LANGUAGE",""],["UNMUTE"," "],["UNRECOGNIZED_LANGUAGE","  "],["VOLUME",""]])),a.insert("nl",new Map([["AD_DURATION","Advertentieduur"],["AD_PROGRESS","Advertentie [AD_ON] van [NUM_ADS]"],["AD_TIME","Advertentie: [AD_TIME]"],["AUTO_QUALITY","Automatisch"],["BACK","Terug"],["CAPTIONS","Ondertiteling"],["CAST","Casten..."],["ENTER_LOOP_MODE","De huidige video lussen"],["ENTER_PICTURE_IN_PICTURE","Scherm-in-scherm openen"],["EXIT_FULL_SCREEN","Volledig scherm sluiten"],["EXIT_LOOP_MODE","De huidige video niet meer lussen"],["EXIT_PICTURE_IN_PICTURE","Scherm-in-scherm afsluiten"],["FAST_FORWARD","Vooruitspoelen"],["FULL_SCREEN","Volledig scherm"],["LANGUAGE","Taal"],["LIVE","Live"],["LOOP","Lussen"],["MORE_SETTINGS","Meer instellingen"],["MULTIPLE_LANGUAGES","Meerdere talen"],["MUTE","Dempen"],["NOT_APPLICABLE","Niet van toepassing"],["OFF","Uit"],["ON","Aan"],["PAUSE","Onderbreken"],["PICTURE_IN_PICTURE","Scherm-in-scherm"],["PLAY","Afspelen"],["PLAYBACK_RATE","Afspeelsnelheid"],["RESOLUTION","Resolutie"],["REWIND","Terugspoelen"],["SEEK","Zoeken"],["SKIP_AD","Advertentie overslaan"],["SKIP_TO_LIVE","Doorgaan naar live"],["UNDETERMINED_LANGUAGE","Onbepaald"],["UNMUTE","Dempen opheffen"],["UNRECOGNIZED_LANGUAGE","Onbekend"],["VOLUME","Volume"]])),a.insert("pl",new Map([["AD_DURATION","Czas trwania reklamy"],["AD_PROGRESS","Reklama[AD_ON] z[NUM_ADS]"],["AD_TIME","Reklama: [AD_TIME]"],["AUTO_QUALITY","Automatycznie"],["BACK","Wstecz"],["CAPTIONS","Napisy"],["CAST","Przesyaj..."],["ENTER_LOOP_MODE","Odtwarzaj biecy film wptli"],["ENTER_PICTURE_IN_PICTURE","Wcz tryb obrazu wobrazie"],["EXIT_FULL_SCREEN","Zamknij peny ekran"],["EXIT_LOOP_MODE","Wycz odtwarzanie biecego filmu wptli"],["EXIT_PICTURE_IN_PICTURE","Wycz tryb obrazu wobrazie"],["FAST_FORWARD","Przewi do przodu"],["FULL_SCREEN","Peny ekran"],["LANGUAGE","Jzyk"],["LIVE","Na ywo"],["LOOP","Odtwarzaj wptli"],["MORE_SETTINGS","Wicej ustawie"],["MULTIPLE_LANGUAGES","Wiele jzykw"],["MUTE","Wycisz"],["NOT_APPLICABLE","Nie dotyczy"],["OFF","Wyczone"],["ON","Wczone"],["PAUSE","Wstrzymaj"],["PICTURE_IN_PICTURE","Obraz wobrazie"],["PLAY","Odtwrz"],["PLAYBACK_RATE","Szybko odtwarzania"],["RESOLUTION","Rozdzielczo"],["REWIND","Przewi do tyu"],["SEEK","Szukaj"],["SKIP_AD","Pomi reklam"],["SKIP_TO_LIVE","Przejd do transmisji na ywo"],["UNDETERMINED_LANGUAGE","Nie okrelono"],["UNMUTE","Wycz wyciszenie"],["UNRECOGNIZED_LANGUAGE","Nierozpoznany"],["VOLUME","Gono"]])),a.insert("pt-BR",new Map([["AD_DURATION","Durao do anncio"],["AD_PROGRESS","Anncio [AD_ON] de [NUM_ADS]"],["AD_TIME","Anncio: [AD_TIME]"],["AUTO_QUALITY","Automtica"],["BACK","Voltar"],["CAPTIONS","Legendas"],["CAST","Transmitir..."],["ENTER_LOOP_MODE","Repetir o vdeo atual"],["ENTER_PICTURE_IN_PICTURE","Entrar no modo picture-in-picture"],["EXIT_FULL_SCREEN","Sair do modo tela cheia"],["EXIT_LOOP_MODE","Parar repetio do vdeo atual"],["EXIT_PICTURE_IN_PICTURE","Sair de picture-in-picture"],["FAST_FORWARD","Avanar"],["FULL_SCREEN","Tela cheia"],["LANGUAGE","Idioma"],["LIVE","Ao vivo"],["LOOP","Repetir"],["MORE_SETTINGS","Mais definies"],["MULTIPLE_LANGUAGES","Vrios idiomas"],["MUTE","Desativar som"],["NOT_APPLICABLE","No relevante"],["OFF","Desativado"],["ON","Ativado"],["PAUSE","Pausar"],["PICTURE_IN_PICTURE","Picture-in-picture"],["PLAY","Reproduzir"],["PLAYBACK_RATE","Velocidade da reproduo"],["RESOLUTION","Resoluo"],["REWIND","Retroceder"],["SEEK","Procurar"],["SKIP_AD","Pular anncio"],["SKIP_TO_LIVE","Pular para transmisso ao vivo"],["UNDETERMINED_LANGUAGE","Indeterminado"],["UNMUTE","Ativar som"],["UNRECOGNIZED_LANGUAGE","No reconhecido"],["VOLUME","Volume"]])),a.insert("ru",new Map([["AD_DURATION"," "],["AD_PROGRESS"," [AD_ON]  [NUM_ADS]"],["AD_TIME",": [AD_TIME]"],["AUTO_QUALITY",""],["BACK",""],["CAPTIONS",""],["CAST","..."],["ENTER_LOOP_MODE","  "],["ENTER_PICTURE_IN_PICTURE",'   "  "'],["EXIT_FULL_SCREEN"," "],["EXIT_LOOP_MODE","   "],["EXIT_PICTURE_IN_PICTURE",'   "  "'],["FAST_FORWARD"," "],["FULL_SCREEN"," "],["LANGUAGE",""],["LIVE"," "],["LOOP",""],["MORE_SETTINGS"," "],["MULTIPLE_LANGUAGES"," "],["MUTE"," "],["NOT_APPLICABLE",""],["OFF",""],["ON",""],["PAUSE",""],["PICTURE_IN_PICTURE","  "],["PLAY",""],["PLAYBACK_RATE"," "],["RESOLUTION",""],["REWIND"," "],["SEEK",""],["SKIP_AD",""],["SKIP_TO_LIVE","     "],["UNDETERMINED_LANGUAGE"," "],["UNMUTE"," "],["UNRECOGNIZED_LANGUAGE"," "],["VOLUME",""]])),a.insert("th",new Map([["AD_DURATION",""],["AD_PROGRESS"," [AD_ON]  [NUM_ADS] "],["AD_TIME",": [AD_TIME]"],["AUTO_QUALITY",""],["BACK",""],["CAPTIONS",""],["CAST","..."],["ENTER_LOOP_MODE",""],["ENTER_PICTURE_IN_PICTURE",""],["EXIT_FULL_SCREEN",""],["EXIT_LOOP_MODE",""],["EXIT_PICTURE_IN_PICTURE",""],["FAST_FORWARD",""],["FULL_SCREEN",""],["LANGUAGE",""],["LIVE",""],["LOOP",""],["MORE_SETTINGS",""],["MULTIPLE_LANGUAGES",""],["MUTE",""],["NOT_APPLICABLE",""],["OFF",""],["ON",""],["PAUSE",""],["PICTURE_IN_PICTURE",""],["PLAY",""],["PLAYBACK_RATE",""],["RESOLUTION",""],["REWIND",""],["SEEK",""],["SKIP_AD",""],["SKIP_TO_LIVE",""],["UNDETERMINED_LANGUAGE",""],["UNMUTE",""],["UNRECOGNIZED_LANGUAGE",""],["VOLUME",""]])),a.insert("tr",new Map([["AD_DURATION","Reklam sresi"],["AD_PROGRESS","[AD_ON]/[NUM_ADS] reklam"],["AD_TIME","Reklam: [AD_TIME]"],["AUTO_QUALITY","Otomatik"],["BACK","Geri"],["CAPTIONS","Altyazlar"],["CAST","Yaynla..."],["ENTER_LOOP_MODE","Mevcut videoyu dngye al"],["ENTER_PICTURE_IN_PICTURE","Pencere iinde Pencere moduna gir"],["EXIT_FULL_SCREEN","Tam ekrandan k"],["EXIT_LOOP_MODE","Mevcut videonun dngsn durdur"],["EXIT_PICTURE_IN_PICTURE","Pencere inde Pencereden k"],["FAST_FORWARD","leri sar"],["FULL_SCREEN","Tam ekran"],["LANGUAGE","Dil"],["LIVE","Canl"],["LOOP","Dng"],["MORE_SETTINGS","Daha fazla ayar"],["MULTIPLE_LANGUAGES","Birden ok dil"],["MUTE","Sesi kapat"],["NOT_APPLICABLE","Geerli deil"],["OFF","Kapal"],["ON","Ak"],["PAUSE","Duraklat"],["PICTURE_IN_PICTURE","Pencere inde Pencere"],["PLAY","Oynat"],["PLAYBACK_RATE","alma hz"],["RESOLUTION","znrlk"],["REWIND","Geri sar"],["SEEK","Ara"],["SKIP_AD","Reklam Atla"],["SKIP_TO_LIVE","Canl yayna atla"],["UNDETERMINED_LANGUAGE","Belirsiz"],["UNMUTE","Sesi a"],["UNRECOGNIZED_LANGUAGE","Tannmayan"],["VOLUME","Ses"]])),a.insert("zh",new Map([["AD_DURATION",""],["AD_PROGRESS"," [AD_ON]/[NUM_ADS]"],["AD_TIME","[AD_TIME]"],["AUTO_QUALITY",""],["BACK",""],["CAPTIONS",""],["CAST",""],["ENTER_LOOP_MODE",""],["ENTER_PICTURE_IN_PICTURE",""],["EXIT_FULL_SCREEN",""],["EXIT_LOOP_MODE",""],["EXIT_PICTURE_IN_PICTURE",""],["FAST_FORWARD",""],["FULL_SCREEN",""],["LANGUAGE",""],["LIVE",""],["LOOP",""],["MORE_SETTINGS",""],["MULTIPLE_LANGUAGES",""],["MUTE",""],["NOT_APPLICABLE",""],["OFF",""],["ON",""],["PAUSE",""],["PICTURE_IN_PICTURE",""],["PLAY",""],["PLAYBACK_RATE",""],["RESOLUTION",""],["REWIND",""],["SEEK",""],["SKIP_AD",""],["SKIP_TO_LIVE",""],["UNDETERMINED_LANGUAGE",""],["UNMUTE",""],["UNRECOGNIZED_LANGUAGE",""],["VOLUME",""]])),a.insert("zh-TW",new Map([["AD_DURATION",""],["AD_PROGRESS"," [AD_ON]/[NUM_ADS]"],["AD_TIME","[AD_TIME]"],["AUTO_QUALITY",""],["BACK",""],["CAPTIONS",""],["CAST","..."],["ENTER_LOOP_MODE",""],["ENTER_PICTURE_IN_PICTURE",""],["EXIT_FULL_SCREEN",""],["EXIT_LOOP_MODE",""],["EXIT_PICTURE_IN_PICTURE",""],["FAST_FORWARD",""],["FULL_SCREEN",""],["LANGUAGE",""],["LIVE",""],["LOOP",""],["MORE_SETTINGS",""],["MULTIPLE_LANGUAGES",""],["MUTE",""],["NOT_APPLICABLE",""],["OFF",""],["ON",""],["PAUSE",""],["PICTURE_IN_PICTURE",""],["PLAY",""],["PLAYBACK_RATE",""],["RESOLUTION",""],["REWIND",""],["SEEK",""],["SKIP_AD",""],["SKIP_TO_LIVE",""],["UNDETERMINED_LANGUAGE",""],["UNMUTE",""],["UNRECOGNIZED_LANGUAGE",""],["VOLUME",""]]))},shaka.ui.Locales.Ids={AD_PROGRESS:"AD_PROGRESS",ENTER_PICTURE_IN_PICTURE:"ENTER_PICTURE_IN_PICTURE",MULTIPLE_LANGUAGES:"MULTIPLE_LANGUAGES",BACK:"BACK",VOLUME:"VOLUME",PAUSE:"PAUSE",EXIT_FULL_SCREEN:"EXIT_FULL_SCREEN",NOT_APPLICABLE:"NOT_APPLICABLE",SEEK:"SEEK",AD_DURATION:"AD_DURATION",LANGUAGE:"LANGUAGE",SKIP_TO_LIVE:"SKIP_TO_LIVE",FULL_SCREEN:"FULL_SCREEN",CAST:"CAST",LIVE:"LIVE",UNRECOGNIZED_LANGUAGE:"UNRECOGNIZED_LANGUAGE",RESOLUTION:"RESOLUTION",PICTURE_IN_PICTURE:"PICTURE_IN_PICTURE",PLAY:"PLAY",EXIT_LOOP_MODE:"EXIT_LOOP_MODE",OFF:"OFF",MUTE:"MUTE",AIRPLAY:"AIRPLAY",UNDETERMINED_LANGUAGE:"UNDETERMINED_LANGUAGE",CAPTIONS:"CAPTIONS",AD_TIME:"AD_TIME",AUTO_QUALITY:"AUTO_QUALITY",ON:"ON",PLAYBACK_RATE:"PLAYBACK_RATE",MORE_SETTINGS:"MORE_SETTINGS",EXIT_PICTURE_IN_PICTURE:"EXIT_PICTURE_IN_PICTURE",ENTER_LOOP_MODE:"ENTER_LOOP_MODE",UNMUTE:"UNMUTE",FAST_FORWARD:"FAST_FORWARD",REWIND:"REWIND",SKIP_AD:"SKIP_AD",LOOP:"LOOP"},shaka.abr={},shaka.abr.Ewma=function(a){goog.asserts.assert(0<a,"expected halfLife to be positive"),this.alpha_=Math.exp(Math.log(.5)/a),this.totalWeight_=this.estimate_=0},shaka.abr.Ewma.prototype.sample=function(a,b){var e=Math.pow(this.alpha_,a);e=b*(1-e)+e*this.estimate_,isNaN(e)||(this.estimate_=e,this.totalWeight_+=a)},shaka.abr.Ewma.prototype.getEstimate=function(){return this.estimate_/(1-Math.pow(this.alpha_,this.totalWeight_))},shaka.abr.EwmaBandwidthEstimator=function(){this.fast_=new shaka.abr.Ewma(2),this.slow_=new shaka.abr.Ewma(5),this.bytesSampled_=0,this.minTotalBytes_=128e3,this.minBytes_=16e3},shaka.abr.EwmaBandwidthEstimator.prototype.sample=function(a,b){if(!(b<this.minBytes_)){var e=8e3*b/a,t=a/1e3;this.bytesSampled_+=b,this.fast_.sample(t,e),this.slow_.sample(t,e)}},shaka.abr.EwmaBandwidthEstimator.prototype.getBandwidthEstimate=function(a){return this.bytesSampled_<this.minTotalBytes_?a:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())},shaka.abr.EwmaBandwidthEstimator.prototype.hasGoodEstimate=function(){return this.bytesSampled_>=this.minTotalBytes_},shaka.util.Error=function(a,b,e,t){for(var r=[],n=3;n<arguments.length;++n)r[n-3]=arguments[n];if(this.severity=a,this.category=b,this.code=e,this.data=r,this.handled=!1,goog.DEBUG){for(var g in n=r="UNKNOWN",shaka.util.Error.Category)shaka.util.Error.Category[g]==this.category&&(r=g);for(var o in shaka.util.Error.Code)shaka.util.Error.Code[o]==this.code&&(n=o);if(this.message="Shaka Error "+r+"."+n+" ("+this.data.toString()+")",shaka.util.Error.createStack)try{throw Error(this.message)}catch(e){this.stack=e.stack}}},shaka.util.Error.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},goog.exportSymbol("shaka.util.Error",shaka.util.Error),goog.DEBUG&&(shaka.util.Error.createStack=!0),shaka.util.Error.Severity={RECOVERABLE:1,CRITICAL:2},goog.exportProperty(shaka.util.Error,"Severity",shaka.util.Error.Severity),shaka.util.Error.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9,ADS:10},goog.exportProperty(shaka.util.Error,"Category",shaka.util.Error.Category),shaka.util.Error.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,ATTEMPTS_EXHAUSTED:1010,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,INVALID_MP4_CEA:2010,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,RESTRICTIONS_CANNOT_BE_MET:4012,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,HLS_INTERNAL_SKIP_STREAM:4035,NO_VARIANTS:4036,PERIOD_FLATTENING_FAILED:4037,INCONSISTENT_DRM_ACROSS_PERIODS:4038,HLS_VARIABLE_NOT_FOUND:4039,STREAMING_ENGINE_STARTUP_INVALID_STATE:5006,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,OBJECT_DESTROYED:7003,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013,CS_IMA_SDK_MISSING:1e4,CS_AD_MANAGER_NOT_INITIALIZED:10001,SS_IMA_SDK_MISSING:10002,SS_AD_MANAGER_NOT_INITIALIZED:10003,CURRENT_DAI_REQUEST_NOT_FINISHED:10004},goog.exportProperty(shaka.util.Error,"Code",shaka.util.Error.Code),shaka.util.DelayedTick=function(a){this.onTick_=a,this.cancelPending_=null},shaka.util.DelayedTick.prototype.tickAfter=function(a){var b=this;this.stop();var e=!0,t=null;return this.cancelPending_=function(){window.clearTimeout(t),e=!1},t=window.setTimeout((function(){e&&b.onTick_()}),1e3*a),this},shaka.util.DelayedTick.prototype.stop=function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)},shaka.util.Timer=function(a){this.onTick_=a,this.ticker_=null},shaka.util.Timer.prototype.tickNow=function(){return this.stop(),this.onTick_(),this},shaka.util.Timer.prototype.tickAfter=function(a){var b=this;return this.stop(),this.ticker_=new shaka.util.DelayedTick((function(){b.onTick_()})).tickAfter(a),this},shaka.util.Timer.prototype.tickEvery=function(a){var b=this;return this.stop(),this.ticker_=new shaka.util.DelayedTick((function(){b.ticker_.tickAfter(a),b.onTick_()})).tickAfter(a),this},shaka.util.Timer.prototype.stop=function(){this.ticker_&&(this.ticker_.stop(),this.ticker_=null)},goog.exportSymbol("shaka.util.Timer",shaka.util.Timer),goog.exportProperty(shaka.util.Timer.prototype,"stop",shaka.util.Timer.prototype.stop),goog.exportProperty(shaka.util.Timer.prototype,"tickEvery",shaka.util.Timer.prototype.tickEvery),goog.exportProperty(shaka.util.Timer.prototype,"tickAfter",shaka.util.Timer.prototype.tickAfter),goog.exportProperty(shaka.util.Timer.prototype,"tickNow",shaka.util.Timer.prototype.tickNow),shaka.net={},shaka.net.Backoff=function(a,b){b=void 0!==b&&b;var e=shaka.net.Backoff.defaultRetryParameters();this.maxAttempts_=null==a.maxAttempts?e.maxAttempts:a.maxAttempts,goog.asserts.assert(1<=this.maxAttempts_,"maxAttempts should be >= 1"),this.baseDelay_=null==a.baseDelay?e.baseDelay:a.baseDelay,goog.asserts.assert(0<=this.baseDelay_,"baseDelay should be >= 0"),this.fuzzFactor_=null==a.fuzzFactor?e.fuzzFactor:a.fuzzFactor,goog.asserts.assert(0<=this.fuzzFactor_,"fuzzFactor should be >= 0"),this.backoffFactor_=null==a.backoffFactor?e.backoffFactor:a.backoffFactor,goog.asserts.assert(0<=this.backoffFactor_,"backoffFactor should be >= 0"),this.numAttempts_=0,this.nextUnfuzzedDelay_=this.baseDelay_,(this.autoReset_=b)&&(goog.asserts.assert(2<=this.maxAttempts_,"maxAttempts must be >= 2 for autoReset == true"),this.numAttempts_=1)},shaka.net.Backoff.prototype.attempt=function(){var b,e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){if(1==t.nextAddress){if(a.numAttempts_>=a.maxAttempts_){if(!a.autoReset_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.ATTEMPTS_EXHAUSTED);a.reset_()}return b=a.numAttempts_,a.numAttempts_++,0==b?(goog.asserts.assert(!a.autoReset_,"Failed to delay with auto-reset!"),t.return()):(e=shaka.net.Backoff.fuzz_(a.nextUnfuzzedDelay_,a.fuzzFactor_),t.yield(new Promise((function(a){shaka.net.Backoff.defer(e,a)})),2))}a.nextUnfuzzedDelay_*=a.backoffFactor_,t.jumpToEnd()}))},shaka.net.Backoff.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}},shaka.net.Backoff.fuzz_=function(a,b){return a*(1+(2*Math.random()-1)*b)},shaka.net.Backoff.prototype.reset_=function(){goog.asserts.assert(this.autoReset_,"Should only be used for auto-reset!"),this.numAttempts_=1,this.nextUnfuzzedDelay_=this.baseDelay_},shaka.net.Backoff.defer=function(a,b){new shaka.util.Timer(b).tickAfter(a/1e3)},shaka.util.PublicPromise=function(){var a,b,e=new Promise((function(e,t){a=e,b=t}));return e.resolve=a,e.reject=b,e},shaka.util.PublicPromise.prototype.resolve=function(a){},shaka.util.PublicPromise.prototype.reject=function(a){},shaka.util.AbortableOperation=function(a,b){this.promise=a,this.onAbort_=b,this.aborted_=!1},shaka.util.AbortableOperation.failed=function(a){return new shaka.util.AbortableOperation(Promise.reject(a),(function(){return Promise.resolve()}))},shaka.util.AbortableOperation.aborted=function(){var a=Promise.reject(shaka.util.AbortableOperation.abortError());return a.catch((function(){})),new shaka.util.AbortableOperation(a,(function(){return Promise.resolve()}))},shaka.util.AbortableOperation.abortError=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED)},shaka.util.AbortableOperation.completed=function(a){return new shaka.util.AbortableOperation(Promise.resolve(a),(function(){return Promise.resolve()}))},shaka.util.AbortableOperation.notAbortable=function(a){return new shaka.util.AbortableOperation(a,(function(){return a.catch((function(){}))}))},shaka.util.AbortableOperation.prototype.abort=function(){return this.aborted_=!0,this.onAbort_()},shaka.util.AbortableOperation.all=function(a){return new shaka.util.AbortableOperation(Promise.all(a.map((function(a){return a.promise}))),(function(){return Promise.all(a.map((function(a){return a.abort()})))}))},shaka.util.AbortableOperation.prototype.finally=function(a){return this.promise.then((function(b){return a(!0)}),(function(b){return a(!1)})),this},shaka.util.AbortableOperation.prototype.chain=function(a,b){var e=this,t=new shaka.util.PublicPromise,r=shaka.util.AbortableOperation.abortError(),n=function(){return t.reject(r),e.abort()},g=function(g){return function(o){if(e.aborted_&&g)t.reject(r);else{var l=g?a:b;l?n=shaka.util.AbortableOperation.wrapChainCallback_(l,o,t):(g?t.resolve:t.reject)(o)}}};return this.promise.then(g(!0),g(!1)),new shaka.util.AbortableOperation(t,(function(){return n()}))},shaka.util.AbortableOperation.wrapChainCallback_=function(a,b,e){try{var t=a(b);return t&&t.promise&&t.abort?(e.resolve(t.promise),function(){return t.abort()}):(e.resolve(t),function(){return Promise.resolve(t).then((function(){}),(function(){}))})}catch(t){return e.reject(t),function(){return Promise.resolve()}}},goog.exportSymbol("shaka.util.AbortableOperation",shaka.util.AbortableOperation),goog.exportProperty(shaka.util.AbortableOperation.prototype,"chain",shaka.util.AbortableOperation.prototype.chain),goog.exportProperty(shaka.util.AbortableOperation.prototype,"finally",shaka.util.AbortableOperation.prototype.finally),goog.exportProperty(shaka.util.AbortableOperation,"all",shaka.util.AbortableOperation.all),goog.exportProperty(shaka.util.AbortableOperation.prototype,"abort",shaka.util.AbortableOperation.prototype.abort),goog.exportProperty(shaka.util.AbortableOperation,"notAbortable",shaka.util.AbortableOperation.notAbortable),goog.exportProperty(shaka.util.AbortableOperation,"completed",shaka.util.AbortableOperation.completed),goog.exportProperty(shaka.util.AbortableOperation,"aborted",shaka.util.AbortableOperation.aborted),goog.exportProperty(shaka.util.AbortableOperation,"failed",shaka.util.AbortableOperation.failed),shaka.util.BufferUtils=function(){},shaka.util.BufferUtils.equal=function(a,b){var e=shaka.util.BufferUtils;if(!a&&!b)return!0;if(!a||!b||a.byteLength!=b.byteLength)return!1;if(e.unsafeGetArrayBuffer_(a)==e.unsafeGetArrayBuffer_(b)&&(a.byteOffset||0)==(b.byteOffset||0))return!0;e=shaka.util.BufferUtils.toUint8(a);for(var t=shaka.util.BufferUtils.toUint8(b),r=$jscomp.makeIterator(shaka.util.Iterables.range(a.byteLength)),n=r.next();!n.done;n=r.next())if(e[n=n.value]!=t[n])return!1;return!0},shaka.util.BufferUtils.unsafeGetArrayBuffer_=function(a){return a instanceof ArrayBuffer?a:a.buffer},shaka.util.BufferUtils.toArrayBuffer=function(a){return a instanceof ArrayBuffer?a:0==a.byteOffset&&a.byteLength==a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer},shaka.util.BufferUtils.toUint8=function(a,b,e){return e=void 0===e?1/0:e,shaka.util.BufferUtils.view_(a,void 0===b?0:b,e,Uint8Array)},shaka.util.BufferUtils.toDataView=function(a,b,e){return e=void 0===e?1/0:e,shaka.util.BufferUtils.view_(a,void 0===b?0:b,e,DataView)},shaka.util.BufferUtils.view_=function(a,b,e,t){var r=shaka.util.BufferUtils.unsafeGetArrayBuffer_(a),n=(a.byteOffset||0)+a.byteLength;return new t(r,a=Math.max(0,Math.min((a.byteOffset||0)+b,n)),Math.min(a+Math.max(e,0),n)-a)},goog.exportSymbol("shaka.util.BufferUtils",shaka.util.BufferUtils),goog.exportProperty(shaka.util.BufferUtils,"toDataView",shaka.util.BufferUtils.toDataView),goog.exportProperty(shaka.util.BufferUtils,"toUint8",shaka.util.BufferUtils.toUint8),goog.exportProperty(shaka.util.BufferUtils,"toArrayBuffer",shaka.util.BufferUtils.toArrayBuffer),goog.exportProperty(shaka.util.BufferUtils,"equal",shaka.util.BufferUtils.equal),shaka.util.IDestroyable=function(){},shaka.util.IDestroyable.prototype.destroy=function(){},shaka.util.ObjectUtils=function(){},shaka.util.ObjectUtils.cloneObject=function(a){var b=new Set,e=function(a){switch(typeof a){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return a;default:if(!a||a.buffer&&a.buffer.constructor==ArrayBuffer)return a;if(b.has(a))return null;var t=a.constructor==Array;if(a.constructor!=Object&&!t)return null;b.add(a);var g,r=t?[]:{};for(g in a)r[g]=e(a[g]);return t&&(r.length=a.length),r}};return e(a)},shaka.util.ObjectUtils.shallowCloneObject=function(a){var e,b={};for(e in a)b[e]=a[e];return b},shaka.util.ArrayUtils=function(){},shaka.util.ArrayUtils.defaultEquals=function(a,b){return!("number"!=typeof a||"number"!=typeof b||!isNaN(a)||!isNaN(b))||a===b},shaka.util.ArrayUtils.remove=function(a,b){var e=a.indexOf(b);-1<e&&a.splice(e,1)},shaka.util.ArrayUtils.count=function(a,b){for(var e=0,t=$jscomp.makeIterator(a),r=t.next();!r.done;r=t.next())e+=b(r.value)?1:0;return e},shaka.util.ArrayUtils.hasSameElements=function(a,b,e){if(e||(e=shaka.util.ArrayUtils.defaultEquals),a.length!=b.length)return!1;b=b.slice();for(var t={},r=(a=$jscomp.makeIterator(a)).next();!r.done;t={$jscomp$loop$prop$item$527:t.$jscomp$loop$prop$item$527},r=a.next()){if(t.$jscomp$loop$prop$item$527=r.value,-1==(r=b.findIndex(function(a){return function(b){return e(a.$jscomp$loop$prop$item$527,b)}}(t))))return!1;b[r]=b[b.length-1],b.pop()}return 0==b.length},shaka.util.OperationManager=function(){this.operations_=[]},shaka.util.OperationManager.prototype.manage=function(a){var b=this;this.operations_.push(a.finally((function(){shaka.util.ArrayUtils.remove(b.operations_,a)})))},shaka.util.OperationManager.prototype.destroy=function(){for(var a=[],b=$jscomp.makeIterator(this.operations_),e=b.next();!e.done;e=b.next())(e=e.value).promise.catch((function(){})),a.push(e.abort());return this.operations_=[],Promise.all(a)},shaka.net.NetworkingEngine=function(a){shaka.util.FakeEventTarget.call(this),this.destroyed_=!1,this.operationManager_=new shaka.util.OperationManager,this.requestFilters_=new Set,this.responseFilters_=new Set,this.onProgressUpdated_=a||null},$jscomp.inherits(shaka.net.NetworkingEngine,shaka.util.FakeEventTarget),shaka.net.NetworkingEngine.registerScheme=function(a,b,e){goog.asserts.assert(null==e||0<e,"explicit priority must be > 0"),e=e||shaka.net.NetworkingEngine.PluginPriority.APPLICATION;var t=shaka.net.NetworkingEngine.schemes_[a];(!t||e>=t.priority)&&(shaka.net.NetworkingEngine.schemes_[a]={priority:e,plugin:b})},shaka.net.NetworkingEngine.unregisterScheme=function(a){delete shaka.net.NetworkingEngine.schemes_[a]},shaka.net.NetworkingEngine.prototype.registerRequestFilter=function(a){this.requestFilters_.add(a)},shaka.net.NetworkingEngine.prototype.unregisterRequestFilter=function(a){this.requestFilters_.delete(a)},shaka.net.NetworkingEngine.prototype.clearAllRequestFilters=function(){this.requestFilters_.clear()},shaka.net.NetworkingEngine.prototype.registerResponseFilter=function(a){this.responseFilters_.add(a)},shaka.net.NetworkingEngine.prototype.unregisterResponseFilter=function(a){this.responseFilters_.delete(a)},shaka.net.NetworkingEngine.prototype.clearAllResponseFilters=function(){this.responseFilters_.clear()},shaka.net.NetworkingEngine.defaultRetryParameters=function(){return shaka.net.Backoff.defaultRetryParameters()},shaka.net.NetworkingEngine.makeRequest=function(a,b){return{uris:a,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:b,licenseRequestType:null,sessionId:null}},shaka.net.NetworkingEngine.prototype.destroy=function(){return this.destroyed_=!0,this.requestFilters_.clear(),this.responseFilters_.clear(),this.operationManager_.destroy()},shaka.net.NetworkingEngine.prototype.request=function(a,b){var e=this,t=shaka.util.ObjectUtils,r=new shaka.net.NetworkingEngine.NumBytesRemainingClass;if(this.destroyed_)return(t=Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED))).catch((function(){})),new shaka.net.NetworkingEngine.PendingRequest(t,(function(){return Promise.resolve()}),r);goog.asserts.assert(b.uris&&b.uris.length,"Request without URIs!"),b.method=b.method||"GET",b.headers=b.headers||{},b.retryParameters=b.retryParameters?t.cloneObject(b.retryParameters):shaka.net.NetworkingEngine.defaultRetryParameters(),b.uris=t.cloneObject(b.uris);var n=(t=this.filterRequest_(a,b)).chain((function(){return e.makeRequestWithRetry_(a,b,r)})),g=n.chain((function(b){return e.filterResponse_(a,b)})),o=Date.now(),l=0;t.promise.then((function(){l=Date.now()-o}),(function(){}));var h=0;n.promise.then((function(){h=Date.now()}),(function(){}));var d=g.chain((function(b){var t=Date.now()-h,r=b.response;return r.timeMs+=l,r.timeMs+=t,b.gotProgress||!e.onProgressUpdated_||r.fromCache||a!=shaka.net.NetworkingEngine.RequestType.SEGMENT||e.onProgressUpdated_(r.timeMs,r.data.byteLength),r}),(function(a){throw a&&(goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type"),a.severity=shaka.util.Error.Severity.CRITICAL),a}));return t=new shaka.net.NetworkingEngine.PendingRequest(d.promise,(function(){return d.abort()}),r),this.operationManager_.manage(t),t},shaka.net.NetworkingEngine.prototype.filterRequest_=function(a,b){for(var e=shaka.util.AbortableOperation.completed(void 0),t={},r=$jscomp.makeIterator(this.requestFilters_),n=r.next();!n.done;t={$jscomp$loop$prop$requestFilter$529:t.$jscomp$loop$prop$requestFilter$529},n=r.next())t.$jscomp$loop$prop$requestFilter$529=n.value,e=e.chain(function(e){return function(){return b.body&&(b.body=shaka.util.BufferUtils.toArrayBuffer(b.body)),e.$jscomp$loop$prop$requestFilter$529(a,b)}}(t));return e.chain(void 0,(function(a){if(a instanceof shaka.util.Error&&a.code==shaka.util.Error.Code.OPERATION_ABORTED)throw a;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.REQUEST_FILTER_ERROR,a)}))},shaka.net.NetworkingEngine.prototype.makeRequestWithRetry_=function(a,b,e){var t=new shaka.net.Backoff(b.retryParameters,!1);return this.send_(a,b,t,0,null,e)},shaka.net.NetworkingEngine.prototype.send_=function(a,b,e,t,r,n){var g=this,o=new goog.Uri(b.uris[t]),l=o.getScheme(),h=!1;l||(l=shaka.net.NetworkingEngine.getLocationProtocol_(),goog.asserts.assert(":"==l[l.length-1],"location.protocol expected to end with a colon!"),l=l.slice(0,-1),o.setScheme(l),b.uris[t]=o.toString()),l=l.toLowerCase();var d,c=(l=shaka.net.NetworkingEngine.schemes_[l])?l.plugin:null;return c?shaka.util.AbortableOperation.notAbortable(e.attempt()).chain((function(){if(g.destroyed_)return shaka.util.AbortableOperation.aborted();d=Date.now();var e=shaka.net.NetworkingEngine.RequestType.SEGMENT;return c(b.uris[t],b,a,(function(b,t,r){g.onProgressUpdated_&&a==e&&(g.onProgressUpdated_(b,t),h=!0,n.setBytes(r))}))})).chain((function(a){return null==a.timeMs&&(a.timeMs=Date.now()-d),{response:a,gotProgress:h}}),(function(o){if(g.destroyed_)return shaka.util.AbortableOperation.aborted();if(o instanceof shaka.util.Error){if(o.code==shaka.util.Error.Code.OPERATION_ABORTED)throw o;if(o.code==shaka.util.Error.Code.ATTEMPTS_EXHAUSTED)throw goog.asserts.assert(r,"Should have last error"),r;if(o.severity==shaka.util.Error.Severity.RECOVERABLE){var l=new shaka.util.FakeEvent("retry",{error:o});return g.dispatchEvent(l),t=(t+1)%b.uris.length,g.send_(a,b,e,t,o,n)}}throw o})):shaka.util.AbortableOperation.failed(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.UNSUPPORTED_SCHEME,o))},shaka.net.NetworkingEngine.prototype.filterResponse_=function(a,b){for(var e=shaka.util.AbortableOperation.completed(void 0),t={},r=$jscomp.makeIterator(this.responseFilters_),n=r.next();!n.done;t={$jscomp$loop$prop$responseFilter$531:t.$jscomp$loop$prop$responseFilter$531},n=r.next())t.$jscomp$loop$prop$responseFilter$531=n.value,e=e.chain(function(e){return function(){var t=b.response;return t.data&&(t.data=shaka.util.BufferUtils.toArrayBuffer(t.data)),e.$jscomp$loop$prop$responseFilter$531(a,t)}}(t));return e.chain((function(){return b}),(function(a){var b=shaka.util.Error.Severity.CRITICAL;if(a instanceof shaka.util.Error){if(a.code==shaka.util.Error.Code.OPERATION_ABORTED)throw a;b=a.severity}throw new shaka.util.Error(b,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.RESPONSE_FILTER_ERROR,a)}))},shaka.net.NetworkingEngine.getLocationProtocol_=function(){return location.protocol},goog.exportSymbol("shaka.net.NetworkingEngine",shaka.net.NetworkingEngine),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"request",shaka.net.NetworkingEngine.prototype.request),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"destroy",shaka.net.NetworkingEngine.prototype.destroy),goog.exportProperty(shaka.net.NetworkingEngine,"makeRequest",shaka.net.NetworkingEngine.makeRequest),goog.exportProperty(shaka.net.NetworkingEngine,"defaultRetryParameters",shaka.net.NetworkingEngine.defaultRetryParameters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"clearAllResponseFilters",shaka.net.NetworkingEngine.prototype.clearAllResponseFilters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"unregisterResponseFilter",shaka.net.NetworkingEngine.prototype.unregisterResponseFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"registerResponseFilter",shaka.net.NetworkingEngine.prototype.registerResponseFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"clearAllRequestFilters",shaka.net.NetworkingEngine.prototype.clearAllRequestFilters),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"unregisterRequestFilter",shaka.net.NetworkingEngine.prototype.unregisterRequestFilter),goog.exportProperty(shaka.net.NetworkingEngine.prototype,"registerRequestFilter",shaka.net.NetworkingEngine.prototype.registerRequestFilter),goog.exportProperty(shaka.net.NetworkingEngine,"unregisterScheme",shaka.net.NetworkingEngine.unregisterScheme),goog.exportProperty(shaka.net.NetworkingEngine,"registerScheme",shaka.net.NetworkingEngine.registerScheme),shaka.net.NetworkingEngine.NumBytesRemainingClass=function(){this.bytesToLoad_=0},shaka.net.NetworkingEngine.NumBytesRemainingClass.prototype.setBytes=function(a){this.bytesToLoad_=a},shaka.net.NetworkingEngine.NumBytesRemainingClass.prototype.getBytes=function(){return this.bytesToLoad_},goog.exportProperty(shaka.net.NetworkingEngine,"NumBytesRemainingClass",shaka.net.NetworkingEngine.NumBytesRemainingClass),shaka.net.NetworkingEngine.PendingRequest=function(a,b,e){shaka.util.AbortableOperation.call(this,a,b),this.bytesRemaining_=e},$jscomp.inherits(shaka.net.NetworkingEngine.PendingRequest,shaka.util.AbortableOperation),shaka.net.NetworkingEngine.PendingRequest.wrapChainCallback_=shaka.util.AbortableOperation.wrapChainCallback_,shaka.net.NetworkingEngine.PendingRequest.all=shaka.util.AbortableOperation.all,shaka.net.NetworkingEngine.PendingRequest.notAbortable=shaka.util.AbortableOperation.notAbortable,shaka.net.NetworkingEngine.PendingRequest.completed=shaka.util.AbortableOperation.completed,shaka.net.NetworkingEngine.PendingRequest.abortError=shaka.util.AbortableOperation.abortError,shaka.net.NetworkingEngine.PendingRequest.aborted=shaka.util.AbortableOperation.aborted,shaka.net.NetworkingEngine.PendingRequest.failed=shaka.util.AbortableOperation.failed,shaka.net.NetworkingEngine.PendingRequest.prototype.getBytesRemaining=function(){return this.bytesRemaining_.getBytes()},goog.exportProperty(shaka.net.NetworkingEngine,"PendingRequest",shaka.net.NetworkingEngine.PendingRequest),shaka.net.NetworkingEngine.RequestType={MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4},goog.exportProperty(shaka.net.NetworkingEngine,"RequestType",shaka.net.NetworkingEngine.RequestType),shaka.net.NetworkingEngine.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:3},goog.exportProperty(shaka.net.NetworkingEngine,"PluginPriority",shaka.net.NetworkingEngine.PluginPriority),shaka.net.NetworkingEngine.schemes_={},shaka.util.Destroyer=function(a){this.destroyed_=!1,this.waitOnDestroy_=new shaka.util.PublicPromise,this.onDestroy_=a},shaka.util.Destroyer.prototype.destroyed=function(){return this.destroyed_},shaka.util.Destroyer.prototype.destroy=function(){var a=this;return this.destroyed_?this.waitOnDestroy_:(this.destroyed_=!0,this.onDestroy_().then((function(){a.waitOnDestroy_.resolve()}),(function(){a.waitOnDestroy_.resolve()})))},shaka.util.Destroyer.prototype.ensureNotDestroyed=function(a){if(this.destroyed_){if(a instanceof shaka.util.Error&&a.code==shaka.util.Error.Code.OBJECT_DESTROYED)throw a;throw shaka.util.Destroyer.destroyedError(a)}},shaka.util.Destroyer.destroyedError=function(a){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OBJECT_DESTROYED,a)},shaka.util.IReleasable=function(){},shaka.util.IReleasable.prototype.release=function(){},shaka.util.EventManager=function(){this.bindingMap_=new shaka.util.MultiMap},shaka.util.EventManager.prototype.release=function(){this.removeAll(),this.bindingMap_=null},shaka.util.EventManager.prototype.listen=function(a,b,e,t){this.bindingMap_&&(a=new shaka.util.EventManager.Binding_(a,b,e,t),this.bindingMap_.push(b,a))},shaka.util.EventManager.prototype.listenOnce=function(a,b,e,t){var r=this,n=function(t){r.unlisten(a,b,n),e(t)};this.listen(a,b,n,t)},shaka.util.EventManager.prototype.unlisten=function(a,b,e){if(this.bindingMap_)for(var t=this.bindingMap_.get(b)||[],r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())(r=r.value).target!=a||e!=r.listener&&e||(r.unlisten(),this.bindingMap_.remove(b,r))},shaka.util.EventManager.prototype.removeAll=function(){if(this.bindingMap_){for(var a=this.bindingMap_.getAll(),b=(a=$jscomp.makeIterator(a)).next();!b.done;b=a.next())b.value.unlisten();this.bindingMap_.clear()}},goog.exportSymbol("shaka.util.EventManager",shaka.util.EventManager),goog.exportProperty(shaka.util.EventManager.prototype,"removeAll",shaka.util.EventManager.prototype.removeAll),goog.exportProperty(shaka.util.EventManager.prototype,"unlisten",shaka.util.EventManager.prototype.unlisten),goog.exportProperty(shaka.util.EventManager.prototype,"listenOnce",shaka.util.EventManager.prototype.listenOnce),goog.exportProperty(shaka.util.EventManager.prototype,"listen",shaka.util.EventManager.prototype.listen),goog.exportProperty(shaka.util.EventManager.prototype,"release",shaka.util.EventManager.prototype.release),shaka.util.EventManager.Binding_=function(a,b,e,t){this.target=a,this.type=b,this.listener=e,this.options=shaka.util.EventManager.Binding_.convertOptions_(a,t),this.target.addEventListener(b,e,this.options)},shaka.util.EventManager.Binding_.prototype.unlisten=function(){goog.asserts.assert(this.target,"Missing target"),this.target.removeEventListener(this.type,this.listener,this.options),this.listener=this.target=null,this.options=!1},shaka.util.EventManager.Binding_.convertOptions_=function(a,b){if(null==b)return!1;if("boolean"==typeof b)return b;var e=new Set(["passive","capture"]),t=Object.keys(b).filter((function(a){return!e.has(a)}));return goog.asserts.assert(0==t.length,"Unsupported flag(s) to addEventListener: "+t.join(",")),shaka.util.EventManager.Binding_.doesSupportObject_(a)?b:b.capture||!1},shaka.util.EventManager.Binding_.doesSupportObject_=function(a){var b=shaka.util.EventManager.Binding_.supportsObject_;if(null==b){b=!1;try{var e={},t={get:function(){return b=!0,!1}};Object.defineProperty(e,"passive",t),Object.defineProperty(e,"capture",t),t=function(){},a.addEventListener("test",t,e),a.removeEventListener("test",t,e)}catch(e){b=!1}shaka.util.EventManager.Binding_.supportsObject_=b}return b||!1},shaka.util.EventManager.Binding_.supportsObject_=void 0,shaka.util.Lazy=function(a){this.gen_=a,this.value_=void 0},shaka.util.Lazy.prototype.value=function(){return null==this.value_&&(this.value_=this.gen_(),goog.asserts.assert(null!=this.value_,"Unable to create lazy value")),this.value_},shaka.util.Lazy.prototype.reset=function(){this.value_=void 0},shaka.util.StringUtils=function(){},shaka.util.StringUtils.fromUTF8=function(a){if(!a)return"";239==(a=shaka.util.BufferUtils.toUint8(a))[0]&&187==a[1]&&191==a[2]&&(a=a.subarray(3)),a=shaka.util.StringUtils.fromCharCode(a),a=escape(a);try{return decodeURIComponent(a)}catch(e){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BAD_ENCODING)}},shaka.util.StringUtils.fromUTF16=function(a,b,e){if(!a)return"";if(!e&&0!=a.byteLength%2)throw shaka.log.error("Data has an incorrect length, must be even."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.BAD_ENCODING);var t=Math.floor(a.byteLength/2);e=new Uint16Array(t),a=shaka.util.BufferUtils.toDataView(a);for(var r=(t=$jscomp.makeIterator(shaka.util.Iterables.range(t))).next();!r.done;r=t.next())e[r=r.value]=a.getUint16(2*r,b);return shaka.util.StringUtils.fromCharCode(e)},shaka.util.StringUtils.fromBytesAutoDetect=function(a){var b=shaka.util.StringUtils;if(!a)return"";var e=shaka.util.BufferUtils.toUint8(a);if(239==e[0]&&187==e[1]&&191==e[2])return b.fromUTF8(e);if(254==e[0]&&255==e[1])return b.fromUTF16(e.subarray(2),!1);if(255==e[0]&&254==e[1])return b.fromUTF16(e.subarray(2),!0);var t=function(a){return e.byteLength<=a||32<=e[a]&&126>=e[a]};if(shaka.log.debug("Unable to find byte-order-mark, making an educated guess."),0==e[0]&&0==e[2])return b.fromUTF16(a,!1);if(0==e[1]&&0==e[3])return b.fromUTF16(a,!0);if(t(0)&&t(1)&&t(2)&&t(3))return b.fromUTF8(a);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.UNABLE_TO_DETECT_ENCODING)},shaka.util.StringUtils.toUTF8=function(a){a=encodeURIComponent(a);var b=unescape(a);a=new Uint8Array(b.length);for(var e=(b=$jscomp.makeIterator(shaka.util.Iterables.enumerate(b))).next();!e.done;e=b.next())a[(e=e.value).i]=e.item.charCodeAt(0);return shaka.util.BufferUtils.toArrayBuffer(a)},shaka.util.StringUtils.toUTF16=function(a,b){for(var e=new ArrayBuffer(2*a.length),t=new DataView(e),r=$jscomp.makeIterator(shaka.util.Iterables.enumerate(a)),n=r.next();!n.done;n=r.next()){var g=n.value;n=g.i,g=g.item.charCodeAt(0),t.setUint16(2*n,g,b)}return e},shaka.util.StringUtils.fromCharCode=function(a){return shaka.util.StringUtils.fromCharCodeImpl_.value()(a)},shaka.util.StringUtils.resetFromCharCode=function(){shaka.util.StringUtils.fromCharCodeImpl_.reset()},goog.exportSymbol("shaka.util.StringUtils",shaka.util.StringUtils),goog.exportProperty(shaka.util.StringUtils,"resetFromCharCode",shaka.util.StringUtils.resetFromCharCode),goog.exportProperty(shaka.util.StringUtils,"toUTF16",shaka.util.StringUtils.toUTF16),goog.exportProperty(shaka.util.StringUtils,"toUTF8",shaka.util.StringUtils.toUTF8),goog.exportProperty(shaka.util.StringUtils,"fromBytesAutoDetect",shaka.util.StringUtils.fromBytesAutoDetect),goog.exportProperty(shaka.util.StringUtils,"fromUTF16",shaka.util.StringUtils.fromUTF16),goog.exportProperty(shaka.util.StringUtils,"fromUTF8",shaka.util.StringUtils.fromUTF8),shaka.util.StringUtils.fromCharCodeImpl_=new shaka.util.Lazy((function(){for(var a=function(a){try{var b=new Uint8Array(a),e=String.fromCharCode.apply(null,b);return goog.asserts.assert(e,"Should get value"),0<e.length}catch(e){return!1}},b={$jscomp$loop$prop$size$533:65536};0<b.$jscomp$loop$prop$size$533;(b={$jscomp$loop$prop$size$533:b.$jscomp$loop$prop$size$533}).$jscomp$loop$prop$size$533/=2)if(a(b.$jscomp$loop$prop$size$533))return function(a){return function(b){for(var e="",t=0;t<b.length;t+=a.$jscomp$loop$prop$size$533){var g=b.subarray(t,t+a.$jscomp$loop$prop$size$533);e+=String.fromCharCode.apply(null,g)}return e}}(b);return goog.asserts.assert(!1,"Unable to create a fromCharCode method"),null})),shaka.util.FairPlayUtils=function(){},shaka.util.FairPlayUtils.defaultGetContentId=function(a){return a=shaka.util.StringUtils.fromBytesAutoDetect(a),new goog.Uri(a).getDomain()},shaka.util.FairPlayUtils.initDataTransform=function(a,b,e){if(!e||!e.byteLength)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.SERVER_CERTIFICATE_REQUIRED);b="string"==typeof b?shaka.util.StringUtils.toUTF16(b,!0):b,a=shaka.util.StringUtils.fromBytesAutoDetect(a),a=shaka.util.StringUtils.toUTF16(a,!0);var t=new Uint8Array(12+a.byteLength+b.byteLength+e.byteLength),r=0,n=function(a){shaka.util.BufferUtils.toDataView(t).setUint32(r,a.byteLength,!0),r+=4,t.set(shaka.util.BufferUtils.toUint8(a),r),r+=a.byteLength};return n(a),n(b),n(e),goog.asserts.assert(r==t.length,"Inconsistent init data length"),t},goog.exportSymbol("shaka.util.FairPlayUtils",shaka.util.FairPlayUtils),goog.exportProperty(shaka.util.FairPlayUtils,"initDataTransform",shaka.util.FairPlayUtils.initDataTransform),goog.exportProperty(shaka.util.FairPlayUtils,"defaultGetContentId",shaka.util.FairPlayUtils.defaultGetContentId),shaka.util.MapUtils=function(){},shaka.util.MapUtils.asMap=function(a){for(var b=new Map,e=$jscomp.makeIterator(Object.keys(a)),t=e.next();!t.done;t=e.next())t=t.value,b.set(t,a[t]);return b},shaka.util.MapUtils.asObject=function(a){var b={};return a.forEach((function(a,e){b[e]=a})),b},shaka.util.MapUtils.hasSameElements=function(a,b){if(!a&&!b)return!0;if(a&&!b||b&&!a)return!1;if(a.size!=b.size)return!1;for(var e=$jscomp.makeIterator(a),t=e.next();!t.done;t=e.next()){var r=$jscomp.makeIterator(t.value);if(t=r.next().value,r=r.next().value,!b.has(t))return!1;if((t=b.get(t))!=r||null==t)return!1}return!0},shaka.util.MimeUtils=function(){},shaka.util.MimeUtils.getFullType=function(a,b){var e=a;return b&&(e+='; codecs="'+b+'"'),e},shaka.util.MimeUtils.getExtendedType=function(a){var b=[a.mimeType];return shaka.util.MimeUtils.EXTENDED_MIME_PARAMETERS_.forEach((function(e,t){var r=a[t];r&&b.push(e+'="'+r+'"')})),b.join(";")},shaka.util.MimeUtils.splitCodecs=function(a){return a.split(",")},shaka.util.MimeUtils.getCodecBase=function(a){return shaka.util.MimeUtils.getCodecParts_(a)[0]},shaka.util.MimeUtils.getCodecParts_=function(a){var b=a.split(".");return a=b[0],b.pop(),[a,b=b.join(".")]},shaka.util.MimeUtils.EXTENDED_MIME_PARAMETERS_=(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE="application/cea-608",shaka.util.Platform=function(){},shaka.util.Platform.supportsMediaSource=function(){return!(!window.MediaSource||!MediaSource.isTypeSupported)},shaka.util.Platform.supportsMediaType=function(a){return""!=shaka.util.Platform.anyMediaElement().canPlayType(a)},shaka.util.Platform.isEdge=function(){return shaka.util.Platform.userAgentContains_("Edge/")},shaka.util.Platform.isIE=function(){return shaka.util.Platform.userAgentContains_("Trident/")},shaka.util.Platform.isTizen=function(){return shaka.util.Platform.userAgentContains_("Tizen")},shaka.util.Platform.isTizen4=function(){return shaka.util.Platform.userAgentContains_("Tizen 4")},shaka.util.Platform.isTizen3=function(){return shaka.util.Platform.userAgentContains_("Tizen 3")},shaka.util.Platform.isTizen2=function(){return shaka.util.Platform.userAgentContains_("Tizen 2")},shaka.util.Platform.isVideoFutur=function(){return shaka.util.Platform.userAgentContains_("VITIS")},shaka.util.Platform.isWebOS=function(){return shaka.util.Platform.userAgentContains_("Web0S")},shaka.util.Platform.isTiVo=function(){return shaka.util.Platform.userAgentContains_("TiVo")},shaka.util.Platform.isChromecast=function(){return shaka.util.Platform.userAgentContains_("CrKey")},shaka.util.Platform.isChrome=function(){return shaka.util.Platform.userAgentContains_("Chrome")&&!shaka.util.Platform.isEdge()},shaka.util.Platform.isApple=function(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!shaka.util.Platform.isTizen()},shaka.util.Platform.safariVersion=function(){if(!shaka.util.Platform.isApple())return null;var a=navigator.userAgent.match(/Version\/(\d+)/);return a||(a=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(a[1],10):null},shaka.util.Platform.isMobile=function(){return!!/(?:iPhone|iPad|iPod|Android)/.test(navigator.userAgent)||shaka.util.Platform.isApple()&&1<navigator.maxTouchPoints},shaka.util.Platform.userAgentContains_=function(a){return(navigator.userAgent||"").includes(a)},shaka.util.Platform.anyMediaElement=function(){var a=shaka.util.Platform;return a.cachedMediaElement_||(a.cacheExpirationTimer_||(a.cacheExpirationTimer_=new shaka.util.Timer((function(){a.cachedMediaElement_=null}))),a.cachedMediaElement_=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0],a.cachedMediaElement_||(a.cachedMediaElement_=document.createElement("video")),a.cacheExpirationTimer_.tickAfter(1)),a.cachedMediaElement_},shaka.util.Platform.cacheExpirationTimer_=null,shaka.util.Platform.cachedMediaElement_=null,shaka.util.Uint8ArrayUtils=function(){},shaka.util.Uint8ArrayUtils.equal=function(a,b){return shaka.Deprecate.deprecateFeature(4,"shaka.util.Uint8ArrayUtils.equal","Please use shaka.util.BufferUtils.equal instead."),shaka.util.BufferUtils.equal(a,b)},shaka.util.Uint8ArrayUtils.toStandardBase64=function(a){return a=shaka.util.StringUtils.fromCharCode(shaka.util.BufferUtils.toUint8(a)),btoa(a)},shaka.util.Uint8ArrayUtils.toBase64=function(a,b){b=null==b||b;var e=shaka.util.Uint8ArrayUtils.toStandardBase64(a).replace(/\+/g,"-").replace(/\//g,"_");return b?e:e.replace(/[=]*$/,"")},shaka.util.Uint8ArrayUtils.fromBase64=function(a){var b=window.atob(a.replace(/-/g,"+").replace(/_/g,"/"));a=new Uint8Array(b.length);for(var e=(b=$jscomp.makeIterator(shaka.util.Iterables.enumerate(b))).next();!e.done;e=b.next())a[(e=e.value).i]=e.item.charCodeAt(0);return a},shaka.util.Uint8ArrayUtils.fromHex=function(a){for(var b=a.length/2,e=new Uint8Array(b),t=(b=$jscomp.makeIterator(shaka.util.Iterables.range(b))).next();!t.done;t=b.next())e[t=t.value]=window.parseInt(a.substr(2*t,2),16);return e},shaka.util.Uint8ArrayUtils.toHex=function(a){var b=shaka.util.BufferUtils.toUint8(a);a="";for(var e=(b=$jscomp.makeIterator(b)).next();!e.done;e=b.next())1==(e=(e=e.value).toString(16)).length&&(e="0"+e),a+=e;return a},shaka.util.Uint8ArrayUtils.concat=function(a){for(var b=[],e=0;e<arguments.length;++e)b[e-0]=arguments[e];var t=0,r=$jscomp.makeIterator(b);for(e=r.next();!e.done;e=r.next())t+=e.value.byteLength;for(t=new Uint8Array(t),r=0,e=(b=$jscomp.makeIterator(b)).next();!e.done;e=b.next())e=e.value,t.set(shaka.util.BufferUtils.toUint8(e),r),r+=e.byteLength;return t},goog.exportSymbol("shaka.util.Uint8ArrayUtils",shaka.util.Uint8ArrayUtils),goog.exportProperty(shaka.util.Uint8ArrayUtils,"concat",shaka.util.Uint8ArrayUtils.concat),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toHex",shaka.util.Uint8ArrayUtils.toHex),goog.exportProperty(shaka.util.Uint8ArrayUtils,"fromHex",shaka.util.Uint8ArrayUtils.fromHex),goog.exportProperty(shaka.util.Uint8ArrayUtils,"fromBase64",shaka.util.Uint8ArrayUtils.fromBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toBase64",shaka.util.Uint8ArrayUtils.toBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"toStandardBase64",shaka.util.Uint8ArrayUtils.toStandardBase64),goog.exportProperty(shaka.util.Uint8ArrayUtils,"equal",shaka.util.Uint8ArrayUtils.equal),shaka.media={},shaka.media.DrmEngine=function(a,b){var e=this;b=void 0===b?1:b,this.playerInterface_=a,this.supportedTypes_=new Set,this.video_=this.mediaKeys_=null,this.initialized_=!1,this.licenseTimeSeconds_=0,this.currentDrmInfo_=null,this.eventManager_=new shaka.util.EventManager,this.activeSessions_=new Map,this.offlineSessionIds_=[],this.allSessionsLoaded_=new shaka.util.PublicPromise,this.config_=null,this.onError_=function(b){e.allSessionsLoaded_.reject(b),a.onError(b)},this.keyStatusByKeyId_=new Map,this.announcedKeyStatusByKeyId_=new Map,this.keyStatusTimer_=new shaka.util.Timer((function(){return e.processKeyStatusChanges_()})),this.usePersistentLicenses_=!1,this.mediaKeyMessageEvents_=[],this.initialRequestsSent_=!1,this.expirationTimer_=new shaka.util.Timer((function(){e.pollExpiration_()})).tickEvery(b),this.allSessionsLoaded_.catch((function(){})),this.destroyer_=new shaka.util.Destroyer((function(){return e.destroyNow_()}))},shaka.media.DrmEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.DrmEngine.prototype.destroyNow_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){switch(b.nextAddress){case 1:return a.eventManager_.release(),a.eventManager_=null,a.allSessionsLoaded_.reject(),a.expirationTimer_.stop(),a.expirationTimer_=null,a.keyStatusTimer_.stop(),a.keyStatusTimer_=null,b.yield(a.closeOpenSessions_(),2);case 2:if(!a.video_){b.jumpTo(3);break}return goog.asserts.assert(!a.video_.src,"video src must be removed first!"),b.setCatchFinallyBlocks(4),b.yield(a.video_.setMediaKeys(null),6);case 6:b.leaveTryBlock(5);break;case 4:b.enterCatchBlock();case 5:a.video_=null;case 3:a.currentDrmInfo_=null,a.supportedTypes_.clear(),a.mediaKeys_=null,a.offlineSessionIds_=[],a.config_=null,a.onError_=function(){},a.playerInterface_=null,b.jumpToEnd()}}))},shaka.media.DrmEngine.prototype.configure=function(a){this.config_=a},shaka.media.DrmEngine.prototype.initForStorage=function(a,b){return this.offlineSessionIds_=[],this.usePersistentLicenses_=b,this.init_(a)},shaka.media.DrmEngine.prototype.initForPlayback=function(a,b){return this.offlineSessionIds_=b,this.usePersistentLicenses_=0<b.length,this.init_(a)},shaka.media.DrmEngine.prototype.initForRemoval=function(a,b,e,t,r){var n=new Map;return(t={audioCapabilities:t,videoCapabilities:r,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:a}).drmInfos=[{keySystem:a,licenseServerUri:b,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:e,initData:null,keyIds:null}],n.set(a,t),this.queryMediaKeys_(n)},shaka.media.DrmEngine.prototype.init_=function(a){goog.asserts.assert(this.config_,"DrmEngine configure() must be called before init()!");var b=this.configureClearKey_();if(b)for(var e=$jscomp.makeIterator(a),t=e.next();!t.done;t=e.next())(t=t.value).video&&t.video.encrypted&&(t.video.drmInfos=[b]),t.audio&&t.audio.encrypted&&(t.audio.drmInfos=[b]);for((b=a.some((function(a){return!!(a.video&&a.video.drmInfos.length||a.audio&&a.audio.drmInfos.length)})))||(e=shaka.util.MapUtils.asMap(this.config_.servers),shaka.media.DrmEngine.replaceDrmInfo_(a,e)),t=(e=$jscomp.makeIterator(a)).next();!t.done;t=e.next()){t=((t=t.value).video?t.video.drmInfos:[]).concat(t.audio?t.audio.drmInfos:[]);for(var r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())shaka.media.DrmEngine.fillInDrmInfoDefaults_(r.value,shaka.util.MapUtils.asMap(this.config_.servers),shaka.util.MapUtils.asMap(this.config_.advanced||{}))}return(a=this.prepareMediaKeyConfigsForVariants_(a)).size?(a=this.queryMediaKeys_(a),b?a:a.catch((function(){}))):(this.initialized_=!0,Promise.resolve())},shaka.media.DrmEngine.prototype.attach=function(a){var e,t,r,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){if(1==n.nextAddress)return b.mediaKeys_?(b.video_=a,b.eventManager_.listenOnce(b.video_,"play",(function(){return b.onPlay_()})),"webkitCurrentPlaybackTargetIsWireless"in b.video_&&b.eventManager_.listen(b.video_,"webkitcurrentplaybacktargetiswirelesschanged",(function(){return b.closeOpenSessions_()})),e=(e=b.video_.setMediaKeys(b.mediaKeys_)).catch((function(a){return goog.asserts.assert(a instanceof Error,"Wrong error type!"),Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_ATTACH_TO_VIDEO,a.message))})),t=b.setServerCertificate(),n.yield(Promise.all([e,t]),2)):(b.eventManager_.listenOnce(a,"encrypted",(function(a){b.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.ENCRYPTED_CONTENT_WITHOUT_DRM_INFO))})),n.return());b.destroyer_.ensureNotDestroyed(),b.createOrLoad(),b.currentDrmInfo_.initData.length||b.offlineSessionIds_.length||(r=function(a){return b.newInitData(a.initDataType,shaka.util.BufferUtils.toUint8(a.initData))},b.eventManager_.listen(b.video_,"encrypted",r)),n.jumpToEnd()}))},shaka.media.DrmEngine.prototype.setServerCertificate=function(){var e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){if(1==t.nextAddress)return goog.asserts.assert(a.initialized_,"Must call init() before setServerCertificate"),a.mediaKeys_&&a.currentDrmInfo_&&a.currentDrmInfo_.serverCertificate&&a.currentDrmInfo_.serverCertificate.length?(t.setCatchFinallyBlocks(3),t.yield(a.mediaKeys_.setServerCertificate(a.currentDrmInfo_.serverCertificate),5)):t.jumpTo(0);if(3!=t.nextAddress)return t.yieldResult||shaka.log.warning("Server certificates are not supported by the key system.  The server certificate has been ignored."),t.leaveTryBlock(0);throw e=t.enterCatchBlock(),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.INVALID_SERVER_CERTIFICATE,e.message)}))},shaka.media.DrmEngine.prototype.removeSession=function(a){var e,t,r,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){return 1==n.nextAddress?(goog.asserts.assert(b.mediaKeys_,"Must call init() before removeSession"),n.yield(b.loadOfflineSession_(a),2)):(e=n.yieldResult)?(t=[],(r=b.activeSessions_.get(e))&&(r.updatePromise=new shaka.util.PublicPromise,t.push(r.updatePromise)),shaka.log.v2("Attempting to remove session",a),t.push(e.remove()),n.yield(Promise.all(t),0)):(shaka.log.v2("Ignoring attempt to remove missing session",a),n.return())}))},shaka.media.DrmEngine.prototype.createOrLoad=function(){for(var a=(this.currentDrmInfo_?this.currentDrmInfo_.initData:[])||[],b=$jscomp.makeIterator(a),e=b.next();!e.done;e=b.next())e=e.value,this.newInitData(e.initDataType,e.initData);for(e=(b=$jscomp.makeIterator(this.offlineSessionIds_)).next();!e.done;e=b.next())this.loadOfflineSession_(e.value);return a.length||this.offlineSessionIds_.length||this.allSessionsLoaded_.resolve(),this.allSessionsLoaded_},shaka.media.DrmEngine.prototype.newInitData=function(a,b){for(var e=this.activeSessions_.values(),t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next())if(shaka.util.BufferUtils.equal(b,t.value.initData)&&!shaka.util.Platform.isTizen2())return void shaka.log.debug("Ignoring duplicate init data.");this.createTemporarySession_(a,b)},shaka.media.DrmEngine.prototype.initialized=function(){return this.initialized_},shaka.media.DrmEngine.keySystem=function(a){return a?a.keySystem:""},shaka.media.DrmEngine.prototype.willSupport=function(a){return!!shaka.util.Platform.isEdge()||this.supportedTypes_.has(a)},shaka.media.DrmEngine.prototype.getSessionIds=function(){var a=this.activeSessions_.keys();return a=shaka.util.Iterables.map(a,(function(a){return a.sessionId})),Array.from(a)},shaka.media.DrmEngine.prototype.getExpiration=function(){for(var a=1/0,b=this.activeSessions_.keys(),e=(b=$jscomp.makeIterator(b)).next();!e.done;e=b.next())e=e.value,isNaN(e.expiration)||(a=Math.min(a,e.expiration));return a},shaka.media.DrmEngine.prototype.getLicenseTime=function(){return this.licenseTimeSeconds_?this.licenseTimeSeconds_:NaN},shaka.media.DrmEngine.prototype.getDrmInfo=function(){return this.currentDrmInfo_},shaka.media.DrmEngine.prototype.getKeyStatuses=function(){return shaka.util.MapUtils.asObject(this.announcedKeyStatusByKeyId_)},shaka.media.DrmEngine.prototype.prepareMediaKeyConfigsForVariants_=function(a){for(var b=shaka.util.ManifestParserUtils.ContentType,e=new Set,t=$jscomp.makeIterator(a),r=t.next();!r.done;r=t.next()){r=((r=r.value).video?r.video.drmInfos:[]).concat(r.audio?r.audio.drmInfos:[]);var n=$jscomp.makeIterator(r);for(r=n.next();!r.done;r=n.next())e.add(r.value)}for(r=(t=$jscomp.makeIterator(e)).next();!r.done;r=t.next())shaka.media.DrmEngine.fillInDrmInfoDefaults_(r.value,shaka.util.MapUtils.asMap(this.config_.servers),shaka.util.MapUtils.asMap(this.config_.advanced||{}));n=this.usePersistentLicenses_?"required":"optional";var g=this.usePersistentLicenses_?["persistent-license"]:["temporary"];for(t=new Map,r=(e=$jscomp.makeIterator(e)).next();!r.done;r=e.next())r=r.value,t.set(r.keySystem,{audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:n,sessionTypes:g,label:r.keySystem,drmInfos:[]});for(r=(a=$jscomp.makeIterator(a)).next();!r.done;r=a.next())for(r=r.value,r=(e=$jscomp.makeIterator([r.audio,r.video])).next();!r.done;r=e.next())if(n=r.value){g=shaka.util.MimeUtils.getFullType(n.mimeType,n.codecs);var o=$jscomp.makeIterator(n.drmInfos);for(r=o.next();!r.done;r=o.next()){var l=r.value;r=t.get(l.keySystem),goog.asserts.assert(r,"Any missing configs should have be filled in before."),r.drmInfos.push(l),l.distinctiveIdentifierRequired&&(r.distinctiveIdentifier="required"),l.persistentStateRequired&&(r.persistentState="required"),l={robustness:(n.type==b.AUDIO?l.audioRobustness:l.videoRobustness)||"",contentType:g},n.type==b.AUDIO?r.audioCapabilities.push(l):r.videoCapabilities.push(l)}}return t},shaka.media.DrmEngine.prototype.queryMediaKeys_=function(a){var e,t,r,n,g,o,l,h,d,c,p,m,u,f,_,y,k,E,S,v,T,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(P){switch(P.nextAddress){case 1:if(1==a.size&&a.has(""))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_RECOGNIZED_KEY_SYSTEMS);for(e=$jscomp.makeIterator(a.values()),t=e.next();!t.done;t=e.next())0==(r=t.value).audioCapabilities.length&&delete r.audioCapabilities,0==r.videoCapabilities.length&&delete r.videoCapabilities;g=$jscomp.makeIterator([!0,!1]),o=g.next();case 2:if(o.done){P.jumpTo(4);break}l=o.value,h=$jscomp.makeIterator(a.keys()),d=h.next();case 5:if(d.done){P.jumpTo(7);break}if(c=d.value,p=a.get(c),p.drmInfos.some((function(a){return!!a.licenseServerUri}))!=l){P.jumpTo(6);break}return P.setCatchFinallyBlocks(8),P.yield(navigator.requestMediaKeySystemAccess(c,[p]),10);case 10:n=P.yieldResult,P.jumpTo(7);break;case 8:P.enterCatchBlock();case 9:b.destroyer_.ensureNotDestroyed();case 6:d=h.next(),P.jumpTo(5);break;case 7:if(n){P.jumpTo(4);break}o=g.next(),P.jumpTo(2);break;case 4:if(!n)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE);for(b.destroyer_.ensureNotDestroyed(),P.setCatchFinallyBlocks(11),b.supportedTypes_.clear(),m=n.getConfiguration(),u=m.audioCapabilities||[],f=m.videoCapabilities||[],_=$jscomp.makeIterator(u),y=_.next();!y.done;y=_.next())k=y.value,b.supportedTypes_.add(k.contentType);for(E=$jscomp.makeIterator(f),y=E.next();!y.done;y=E.next())S=y.value,b.supportedTypes_.add(S.contentType);if(goog.asserts.assert(b.supportedTypes_.size,"We should get at least one supported MIME type"),b.currentDrmInfo_=shaka.media.DrmEngine.createDrmInfoFor_(n.keySystem,a.get(n.keySystem)),!b.currentDrmInfo_.licenseServerUri)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.NO_LICENSE_SERVER_GIVEN,b.currentDrmInfo_.keySystem);return P.yield(n.createMediaKeys(),13);case 13:v=P.yieldResult,b.destroyer_.ensureNotDestroyed(),shaka.log.info("Created MediaKeys object for key system",b.currentDrmInfo_.keySystem),b.mediaKeys_=v,b.initialized_=!0,P.leaveTryBlock(0);break;case 11:if(T=P.enterCatchBlock(),b.destroyer_.ensureNotDestroyed(T),b.currentDrmInfo_=null,b.supportedTypes_.clear(),T instanceof shaka.util.Error)throw T;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_CDM,T.message)}}))},shaka.media.DrmEngine.prototype.configureClearKey_=function(){var a=shaka.util.MapUtils.asMap(this.config_.clearKeys);if(0==a.size)return null;var b=shaka.util.StringUtils,e=shaka.util.Uint8ArrayUtils,t=[],r=[];a.forEach((function(a,b){var n=e.fromHex(b),g=e.fromHex(a);n={kty:"oct",kid:e.toBase64(n,!1),k:e.toBase64(g,!1)},t.push(n),r.push(n.kid)})),a=JSON.stringify({keys:t});var n=JSON.stringify({kids:r});return b=[{initData:shaka.util.BufferUtils.toUint8(b.toUTF8(n)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+window.btoa(a),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:b,keyIds:new Set(r)}},shaka.media.DrmEngine.prototype.loadOfflineSession_=function(a){var e,t,r,n,g,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){switch(o.nextAddress){case 1:try{shaka.log.v1("Attempting to load an offline session",a),e=b.mediaKeys_.createSession("persistent-license")}catch(e){return t=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,e.message),b.onError_(t),o.return(Promise.reject(t))}return b.eventManager_.listen(e,"message",(function(a){return b.onSessionMessage_(a)})),b.eventManager_.listen(e,"keystatuseschange",(function(a){return b.onKeyStatusesChange_(a)})),r={initData:null,loaded:!1,oldExpiration:1/0,updatePromise:null},b.activeSessions_.set(e,r),o.setCatchFinallyBlocks(2),o.yield(e.load(a),4);case 4:return n=o.yieldResult,b.destroyer_.ensureNotDestroyed(),shaka.log.v2("Loaded offline session",a,n),n?(r.loaded=!0,b.areAllSessionsLoaded_()&&b.allSessionsLoaded_.resolve(),o.return(e)):(b.activeSessions_.delete(e),b.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.OFFLINE_SESSION_REMOVED)),o.return(Promise.resolve()));case 2:g=o.enterCatchBlock(),b.destroyer_.ensureNotDestroyed(g),b.activeSessions_.delete(e),b.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,g.message));case 3:return o.return(Promise.resolve())}}))},shaka.media.DrmEngine.prototype.createTemporarySession_=function(a,b){var e=this;try{if(this.usePersistentLicenses_){shaka.log.v1("Creating new persistent session");var t=this.mediaKeys_.createSession("persistent-license")}else shaka.log.v1("Creating new temporary session"),t=this.mediaKeys_.createSession()}catch(e){return void this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_CREATE_SESSION,e.message))}this.eventManager_.listen(t,"message",(function(a){return e.onSessionMessage_(a)})),this.eventManager_.listen(t,"keystatuseschange",(function(a){return e.onKeyStatusesChange_(a)})),this.activeSessions_.set(t,{initData:b,loaded:!1,oldExpiration:1/0,updatePromise:null});try{b=this.config_.initDataTransform(b,a,this.currentDrmInfo_)}catch(e){var r=e;return e instanceof shaka.util.Error||(r=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.INIT_DATA_TRANSFORM_ERROR,e)),void this.onError_(r)}this.config_.logLicenseExchange&&(r=shaka.util.Uint8ArrayUtils.toBase64(b),shaka.log.info("EME init data: type=",a,"data=",r)),t.generateRequest(a,b).catch((function(a){if(!e.destroyer_.destroyed()){goog.asserts.assert(a instanceof Error,"Wrong error type!"),e.activeSessions_.delete(t);var b=a.errorCode;if(b&&b.systemCode){var r=b.systemCode;0>r&&(r+=Math.pow(2,32)),r="0x"+r.toString(16)}e.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.FAILED_TO_GENERATE_LICENSE_REQUEST,a.message,a,r))}}))},shaka.media.DrmEngine.defaultInitDataTransform=function(a,b,e){return"skd"==b&&(b=e.serverCertificate,e=shaka.util.FairPlayUtils.defaultGetContentId(a),a=shaka.util.FairPlayUtils.initDataTransform(a,e,b)),a},shaka.media.DrmEngine.prototype.onSessionMessage_=function(a){this.delayLicenseRequest_()?this.mediaKeyMessageEvents_.push(a):this.sendLicenseRequest_(a)},shaka.media.DrmEngine.prototype.delayLicenseRequest_=function(){return!!this.video_&&(this.config_.delayLicenseRequestUntilPlayed&&this.video_.paused&&!this.initialRequestsSent_)},shaka.media.DrmEngine.prototype.sendLicenseRequest_=function(a){var e,t,r,n,g,o,l,h,d,c,p,q,m,u,f,_,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(y){switch(y.nextAddress){case 1:return e=a.target,shaka.log.v1("Sending license request for session",e.sessionId,"of type",a.messageType),b.config_.logLicenseExchange&&(t=shaka.util.Uint8ArrayUtils.toBase64(a.message),shaka.log.info("EME license request",t)),r=b.activeSessions_.get(e),n=b.currentDrmInfo_.licenseServerUri,g=b.config_.advanced[b.currentDrmInfo_.keySystem],"individualization-request"==a.messageType&&g&&g.individualizationServer&&(n=g.individualizationServer),o=shaka.net.NetworkingEngine.RequestType.LICENSE,(l=shaka.net.NetworkingEngine.makeRequest([n],b.config_.retryParameters)).body=a.message,l.method="POST",l.licenseRequestType=a.messageType,l.sessionId=e.sessionId,"com.microsoft.playready"!=b.currentDrmInfo_.keySystem&&"com.chromecast.playready"!=b.currentDrmInfo_.keySystem||b.unpackPlayReadyRequest_(l),h=Date.now(),y.setCatchFinallyBlocks(2),c=b.playerInterface_.netEngine.request(o,l),y.yield(c.promise,4);case 4:d=y.yieldResult,y.leaveTryBlock(3);break;case 2:return p=y.enterCatchBlock(),goog.asserts.assert(p instanceof shaka.util.Error,"Wrong NetworkingEngine error type!"),q=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_REQUEST_FAILED,p),b.onError_(q),r&&r.updatePromise&&r.updatePromise.reject(q),y.return();case 3:return b.destroyer_.destroyed()?y.return():(b.licenseTimeSeconds_+=(Date.now()-h)/1e3,b.config_.logLicenseExchange&&(m=shaka.util.Uint8ArrayUtils.toBase64(d.data),shaka.log.info("EME license response",m)),y.setCatchFinallyBlocks(5),shaka.log.v1("Updating session",e.sessionId),y.yield(e.update(d.data),7));case 7:y.leaveTryBlock(6);break;case 5:return u=y.enterCatchBlock(),f=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.LICENSE_RESPONSE_REJECTED,u.message),b.onError_(f),r&&r.updatePromise&&r.updatePromise.reject(f),y.return();case 6:_=new shaka.util.FakeEvent("drmsessionupdate"),b.playerInterface_.onEvent(_),r&&(r.updatePromise&&r.updatePromise.resolve(),new shaka.util.Timer((function(){r.loaded=!0,b.areAllSessionsLoaded_()&&b.allSessionsLoaded_.resolve()})).tickAfter(shaka.media.DrmEngine.SESSION_LOAD_TIMEOUT_)),y.jumpToEnd()}}))},shaka.media.DrmEngine.prototype.unpackPlayReadyRequest_=function(a){var b=shaka.util.StringUtils.fromUTF16(a.body,!0,!0);if(b.includes("PlayReadyKeyMessage")){shaka.log.debug("Unwrapping PlayReady request.");for(var e=(b=(new DOMParser).parseFromString(b,"application/xml")).getElementsByTagName("HttpHeader"),t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next()){var r=t.value;t=r.getElementsByTagName("name")[0],r=r.getElementsByTagName("value")[0],goog.asserts.assert(t&&r,"Malformed PlayReady headers!"),a.headers[t.textContent]=r.textContent}b=b.getElementsByTagName("Challenge")[0],goog.asserts.assert(b,"Malformed PlayReady challenge!"),goog.asserts.assert("base64encoded"==b.getAttribute("encoding"),"Unexpected PlayReady challenge encoding!"),a.body=shaka.util.Uint8ArrayUtils.fromBase64(b.textContent)}else shaka.log.debug("PlayReady request is already unwrapped."),a.headers["Content-Type"]="text/xml; charset=utf-8"},shaka.media.DrmEngine.prototype.onKeyStatusesChange_=function(a){var b=this;a=a.target,shaka.log.v2("Key status changed for session",a.sessionId);var e=this.activeSessions_.get(a),t=!1;a.keyStatuses.forEach((function(a,r){if("string"==typeof r){var n=r;r=a,a=n}if(!("com.microsoft.playready"!=b.currentDrmInfo_.keySystem||16!=r.byteLength||shaka.util.Platform.isTizen()||shaka.util.Platform.isVideoFutur()||shaka.util.Platform.isWebOS()||shaka.util.Platform.isTiVo())){var g=(n=shaka.util.BufferUtils.toDataView(r)).getUint32(0,!0),o=n.getUint16(4,!0),l=n.getUint16(6,!0);n.setUint32(0,g,!1),n.setUint16(4,o,!1),n.setUint16(6,l,!1)}"com.microsoft.playready"==b.currentDrmInfo_.keySystem&&"status-pending"==a&&(a="usable"),"status-pending"!=a&&(e.loaded=!0),e||goog.asserts.assert("usable"!=a,"Usable keys found in closed session"),"expired"==a&&(t=!0),n=shaka.util.Uint8ArrayUtils.toHex(r),b.keyStatusByKeyId_.set(n,a)}));var r=a.expiration-Date.now();(0>r||t&&1e3>r)&&e&&!e.updatePromise&&(shaka.log.debug("Session has expired",a.sessionId),this.activeSessions_.delete(a),a.close().catch((function(){}))),this.areAllSessionsLoaded_()&&(this.allSessionsLoaded_.resolve(),this.keyStatusTimer_.tickAfter(shaka.media.DrmEngine.KEY_STATUS_BATCH_TIME))},shaka.media.DrmEngine.prototype.processKeyStatusChanges_=function(){var a=this.keyStatusByKeyId_,b=this.announcedKeyStatusByKeyId_;b.clear(),a.forEach((function(a,e){return b.set(e,a)})),(a=Array.from(b.values())).length&&a.every((function(a){return"expired"==a}))&&this.onError_(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.DRM,shaka.util.Error.Code.EXPIRED)),this.playerInterface_.onKeyStatus(shaka.util.MapUtils.asObject(b))},shaka.media.DrmEngine.isBrowserSupported=function(){return!!(window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration)},shaka.media.DrmEngine.probeSupport=function(){var a,b,e,t,g,r;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){return 1==n.nextAddress?(goog.asserts.assert(shaka.media.DrmEngine.isBrowserSupported(),"Must have basic EME support"),a="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" "),e=[{videoCapabilities:b=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],persistentState:"required",sessionTypes:["persistent-license"]},{videoCapabilities:b}],t=new Map,g=function(a){var b,r,n;return $jscomp.asyncExecutePromiseGeneratorProgram((function(g){switch(g.nextAddress){case 1:return g.setCatchFinallyBlocks(2),g.yield(navigator.requestMediaKeySystemAccess(a,e),4);case 4:return b=g.yieldResult,n=!!(r=b.getConfiguration().sessionTypes)&&r.includes("persistent-license"),shaka.util.Platform.isTizen3()&&(n=!1),t.set(a,{persistentState:n}),g.yield(b.createMediaKeys(),5);case 5:g.leaveTryBlock(0);break;case 2:g.enterCatchBlock(),t.set(a,null),g.jumpToEnd()}}))},r=a.map((function(a){return g(a)})),n.yield(Promise.all(r),2)):n.return(shaka.util.MapUtils.asObject(t))}))},shaka.media.DrmEngine.prototype.onPlay_=function(){for(var a=$jscomp.makeIterator(this.mediaKeyMessageEvents_),b=a.next();!b.done;b=a.next())this.sendLicenseRequest_(b.value);this.initialRequestsSent_=!0,this.mediaKeyMessageEvents_=[]},shaka.media.DrmEngine.prototype.closeSession_=function(a){var b,e;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(b=shaka.media.DrmEngine,e=new Promise((function(a,e){new shaka.util.Timer(e).tickAfter(b.CLOSE_TIMEOUT_)})),t.setCatchFinallyBlocks(2),t.yield(Promise.race([Promise.all([a.close(),a.closed]),e]),4)):2!=t.nextAddress?t.leaveTryBlock(0):(t.enterCatchBlock(),shaka.log.warning("Timeout waiting for session close"),void t.jumpToEnd())}))},shaka.media.DrmEngine.prototype.closeOpenSessions_=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return b=Array.from(a.activeSessions_.keys()),a.activeSessions_.clear(),e.yield(Promise.all(b.map((function(b){return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?(shaka.log.v1("Closing session",b.sessionId),e.setCatchFinallyBlocks(2),e.yield(a.closeSession_(b),4)):2!=e.nextAddress?e.leaveTryBlock(0):(e.enterCatchBlock(),void e.jumpToEnd())}))}))),0)}))},shaka.media.DrmEngine.prototype.supportsVariant=function(a){var b=a.audio;if(a=a.video,b&&b.encrypted){var e=shaka.util.MimeUtils.getFullType(b.mimeType,b.codecs);if(!this.willSupport(e))return!1}if(a&&a.encrypted&&(e=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs),!this.willSupport(e)))return!1;var t=shaka.media.DrmEngine.keySystem(this.currentDrmInfo_);return 0==(b=(a?a.drmInfos:[]).concat(b?b.drmInfos:[])).length||b.some((function(a){return a.keySystem==t}))},shaka.media.DrmEngine.areDrmCompatible=function(a,b){return!a.length||!b.length||0<shaka.media.DrmEngine.getCommonDrmInfos(a,b).length},shaka.media.DrmEngine.getCommonDrmInfos=function(a,b){if(!a.length)return b;if(!b.length)return a;for(var e=[],t=$jscomp.makeIterator(a),r=t.next();!r.done;r=t.next()){r=r.value;for(var n=$jscomp.makeIterator(b),g=n.next();!g.done;g=n.next())if(g=g.value,r.keySystem==g.keySystem){n=(n=(n=[]).concat(r.initData||[])).concat(g.initData||[]);var o=r.keyIds&&g.keyIds?new Set([].concat($jscomp.arrayFromIterable(r.keyIds),$jscomp.arrayFromIterable(g.keyIds))):r.keyIds||g.keyIds;e.push({keySystem:r.keySystem,licenseServerUri:r.licenseServerUri||g.licenseServerUri,distinctiveIdentifierRequired:r.distinctiveIdentifierRequired||g.distinctiveIdentifierRequired,persistentStateRequired:r.persistentStateRequired||g.persistentStateRequired,videoRobustness:r.videoRobustness||g.videoRobustness,audioRobustness:r.audioRobustness||g.audioRobustness,serverCertificate:r.serverCertificate||g.serverCertificate,initData:n,keyIds:o});break}}return e},shaka.media.DrmEngine.prototype.pollExpiration_=function(){var a=this;this.activeSessions_.forEach((function(b,e){var t=b.oldExpiration,r=e.expiration;isNaN(r)&&(r=1/0),r!=t&&(a.playerInterface_.onExpirationUpdated(e.sessionId,r),b.oldExpiration=r)}))},shaka.media.DrmEngine.prototype.areAllSessionsLoaded_=function(){var a=this.activeSessions_.values();return shaka.util.Iterables.every(a,(function(a){return a.loaded}))},shaka.media.DrmEngine.replaceDrmInfo_=function(a,b){var e=[];b.forEach((function(a,b){e.push({keySystem:b,licenseServerUri:a,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:[],keyIds:new Set})}));for(var t=$jscomp.makeIterator(a),r=t.next();!r.done;r=t.next())(r=r.value).video&&r.video.encrypted&&(r.video.drmInfos=e),r.audio&&r.audio.encrypted&&(r.audio.drmInfos=e)},shaka.media.DrmEngine.createDrmInfoFor_=function(a,b){var e=[],t=[],r=[],n=new Set;return shaka.media.DrmEngine.processDrmInfos_(b.drmInfos,e,t,r,n),1<t.length&&shaka.log.warning("Multiple unique server certificates found! Only the first will be used."),1<e.length&&shaka.log.warning("Multiple unique license server URIs found! Only the first will be used."),{keySystem:a,licenseServerUri:e[0],distinctiveIdentifierRequired:"required"==b.distinctiveIdentifier,persistentStateRequired:"required"==b.persistentState,audioRobustness:(b.audioCapabilities?b.audioCapabilities[0].robustness:"")||"",videoRobustness:(b.videoCapabilities?b.videoCapabilities[0].robustness:"")||"",serverCertificate:t[0],initData:r,keyIds:n}},shaka.media.DrmEngine.processDrmInfos_=function(a,b,e,t,r){for(var n={},g=(a=$jscomp.makeIterator(a)).next();!g.done;n={$jscomp$loop$prop$drmInfo$535:n.$jscomp$loop$prop$drmInfo$535},g=a.next()){if(n.$jscomp$loop$prop$drmInfo$535=g.value,b.includes(n.$jscomp$loop$prop$drmInfo$535.licenseServerUri)||b.push(n.$jscomp$loop$prop$drmInfo$535.licenseServerUri),n.$jscomp$loop$prop$drmInfo$535.serverCertificate&&(e.some(function(a){return function(b){return shaka.util.BufferUtils.equal(b,a.$jscomp$loop$prop$drmInfo$535.serverCertificate)}}(n))||e.push(n.$jscomp$loop$prop$drmInfo$535.serverCertificate)),n.$jscomp$loop$prop$drmInfo$535.initData){g={};for(var o=$jscomp.makeIterator(n.$jscomp$loop$prop$drmInfo$535.initData),l=o.next();!l.done;g={$jscomp$loop$prop$initDataOverride$537:g.$jscomp$loop$prop$initDataOverride$537},l=o.next())g.$jscomp$loop$prop$initDataOverride$537=l.value,t.some(function(a){return function(b){var e=a.$jscomp$loop$prop$initDataOverride$537;return b=!(!b.keyId||b.keyId!=e.keyId)||b.initDataType==e.initDataType&&shaka.util.BufferUtils.equal(b.initData,e.initData)}}(g))||t.push(g.$jscomp$loop$prop$initDataOverride$537)}if(n.$jscomp$loop$prop$drmInfo$535.keyIds)for(o=(g=$jscomp.makeIterator(n.$jscomp$loop$prop$drmInfo$535.keyIds)).next();!o.done;o=g.next())r.add(o.value)}},shaka.media.DrmEngine.fillInDrmInfoDefaults_=function(a,b,e){!a.keySystem||"org.w3.clearkey"==a.keySystem&&a.licenseServerUri||(b.size&&(b=b.get(a.keySystem)||"",a.licenseServerUri=b),a.keyIds||(a.keyIds=new Set),(e=e.get(a.keySystem))&&(a.distinctiveIdentifierRequired||(a.distinctiveIdentifierRequired=e.distinctiveIdentifierRequired),a.persistentStateRequired||(a.persistentStateRequired=e.persistentStateRequired),a.videoRobustness||(a.videoRobustness=e.videoRobustness),a.audioRobustness||(a.audioRobustness=e.audioRobustness),a.serverCertificate||(a.serverCertificate=e.serverCertificate)),window.cast&&window.cast.__platform__&&"com.microsoft.playready"==a.keySystem&&(a.keySystem="com.chromecast.playready"))},shaka.media.DrmEngine.CLOSE_TIMEOUT_=1,shaka.media.DrmEngine.SESSION_LOAD_TIMEOUT_=5,shaka.media.DrmEngine.KEY_STATUS_BATCH_TIME=.5,shaka.media.DrmEngine.DUMMY_KEY_ID=new shaka.util.Lazy((function(){return shaka.util.BufferUtils.toArrayBuffer(new Uint8Array([0]))})),shaka.media.IClosedCaptionParser=function(){},shaka.media.IClosedCaptionParser.prototype.init=function(a){},shaka.media.IClosedCaptionParser.prototype.parseFrom=function(a){},shaka.media.IClosedCaptionParser.prototype.reset=function(){},shaka.media.ClosedCaptionParser=function(){this.ceaParser_=new shaka.cea.Mp4CeaParser,this.ceaDecoder_=new shaka.cea.CeaDecoder},shaka.media.ClosedCaptionParser.prototype.init=function(a){this.ceaParser_.init(a)},shaka.media.ClosedCaptionParser.prototype.parseFrom=function(a){a=this.ceaParser_.parse(a);for(var b=(a=$jscomp.makeIterator(a)).next();!b.done;b=a.next()){b=b.value;var e=shaka.util.BufferUtils.toUint8(b.packet);this.ceaDecoder_.extract(e,b.pts)}return this.ceaDecoder_.decode()},shaka.media.ClosedCaptionParser.prototype.reset=function(){this.ceaDecoder_.clear()},shaka.media.TimeRangesUtils=function(){},shaka.media.TimeRangesUtils.bufferStart=function(a){return!a||1==a.length&&1e-6>a.end(0)-a.start(0)?null:1==a.length&&0>a.start(0)?0:a.length?a.start(0):null},shaka.media.TimeRangesUtils.bufferEnd=function(a){return!a||1==a.length&&1e-6>a.end(0)-a.start(0)?null:a.length?a.end(a.length-1):null},shaka.media.TimeRangesUtils.isBuffered=function(a,b,e){return e=void 0===e?0:e,!(!a||!a.length||1==a.length&&1e-6>a.end(0)-a.start(0)||b>a.end(a.length-1))&&b+e>=a.start(0)},shaka.media.TimeRangesUtils.bufferedAheadOf=function(a,b){if(!a||!a.length||1==a.length&&1e-6>a.end(0)-a.start(0))return 0;for(var e=0,t=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(a)),r=t.next();!r.done;r=t.next()){var n=r.value;r=n.start,(n=n.end)>b&&(e+=n-Math.max(r,b))}return e},shaka.media.TimeRangesUtils.getGapIndex=function(a,b){var e=shaka.util.Platform,t=shaka.media.TimeRangesUtils;if(!a||!a.length||1==a.length&&1e-6>a.end(0)-a.start(0))return null;var r=e.isEdge()||e.isIE()||e.isTizen()||e.isChromecast()?.5:.1;return 0<=(e=t.getBufferedInfo(a).findIndex((function(a,e,t){return a.start>b&&(0==e||t[e-1].end-b<=r)})))?e:null},shaka.media.TimeRangesUtils.getBufferedInfo=function(a){if(!a)return[];for(var b=[],e=$jscomp.makeIterator(shaka.util.Iterables.range(a.length)),t=e.next();!t.done;t=e.next())t=t.value,b.push({start:a.start(t),end:a.end(t)});return b},shaka.dependencies=function(){},shaka.dependencies.add=function(a,b){if(!shaka.dependencies.Allowed[a])throw Error(a+" is not supported");shaka.dependencies.dependencies_.set(a,b)},shaka.dependencies.has=function(a){return shaka.dependencies.dependencies_.has(a)},shaka.dependencies.muxjs=function(){return shaka.dependencies.dependencies_.get(shaka.dependencies.Allowed.muxjs)},goog.exportSymbol("shaka.dependencies",shaka.dependencies),goog.exportProperty(shaka.dependencies,"has",shaka.dependencies.has),goog.exportProperty(shaka.dependencies,"add",shaka.dependencies.add),shaka.dependencies.dependencies_=new Map,shaka.dependencies.Allowed={muxjs:"muxjs"},goog.exportProperty(shaka.dependencies,"Allowed",shaka.dependencies.Allowed),shaka.dependencies.dependencies_.set(shaka.dependencies.Allowed.muxjs,window.muxjs),shaka.media.Transmuxer=function(){var a=this;this.muxjs_=shaka.dependencies.muxjs(),this.muxTransmuxer_=new this.muxjs_.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.transmuxPromise_=null,this.transmuxedData_=[],this.captions_=[],this.metadata_=[],this.isTransmuxing_=!1,this.muxTransmuxer_.on("data",(function(b){return a.onTransmuxed_(b)})),this.muxTransmuxer_.on("done",(function(){return a.onTransmuxDone_()}))},shaka.media.Transmuxer.prototype.destroy=function(){return this.muxTransmuxer_.dispose(),this.muxTransmuxer_=null,Promise.resolve()},shaka.media.Transmuxer.isSupported=function(a,b){var e=shaka.media.Transmuxer;if(!shaka.dependencies.muxjs()||!e.isTsContainer(a))return!1;if(b)return MediaSource.isTypeSupported(e.convertTsCodecs(b,a));var t=shaka.util.ManifestParserUtils.ContentType,r=e.convertTsCodecs(t.AUDIO,a);return e=e.convertTsCodecs(t.VIDEO,a),MediaSource.isTypeSupported(r)||MediaSource.isTypeSupported(e)},shaka.media.Transmuxer.isTsContainer=function(a){return"mp2t"==a.toLowerCase().split(";")[0].split("/")[1]},shaka.media.Transmuxer.convertTsCodecs=function(a,b){var e=shaka.util.ManifestParserUtils.ContentType,t=b.replace(/mp2t/i,"mp4");if(a==e.AUDIO&&(t=t.replace("video","audio")),e=/avc1\.(66|77|100)\.(\d+)/.exec(t)){var r="avc1.",n=e[1];"66"==n?r+="4200":"77"==n?r+="4d00":(goog.asserts.assert("100"==n,"Legacy avc1 parsing code out of sync with regex!"),r+="6400"),n=Number(e[2]),goog.asserts.assert(256>n,"Invalid legacy avc1 level number!"),r+=(n>>4).toString(16),r+=(15&n).toString(16),t=t.replace(e[0],r)}return t},shaka.media.Transmuxer.prototype.transmux=function(a){return goog.asserts.assert(!this.isTransmuxing_,"No transmuxing should be in progress."),this.isTransmuxing_=!0,this.transmuxPromise_=new shaka.util.PublicPromise,this.transmuxedData_=[],this.captions_=[],this.metadata_=[],a=shaka.util.BufferUtils.toUint8(a),this.muxTransmuxer_.push(a),this.muxTransmuxer_.flush(),this.isTransmuxing_&&this.transmuxPromise_.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.TRANSMUXING_FAILED)),this.transmuxPromise_},shaka.media.Transmuxer.prototype.onTransmuxed_=function(a){this.captions_=a.captions,this.metadata_=a.metadata,this.transmuxedData_.push(shaka.util.Uint8ArrayUtils.concat(a.initSegment,a.data))},shaka.media.Transmuxer.prototype.onTransmuxDone_=function(){var a={data:shaka.util.Uint8ArrayUtils.concat.apply(shaka.util.Uint8ArrayUtils,$jscomp.arrayFromIterable(this.transmuxedData_)),captions:this.captions_,metadata:this.metadata_};this.transmuxPromise_.resolve(a),this.isTransmuxing_=!1},shaka.text={},shaka.text.Cue=function(a,b,e){var t=shaka.text.Cue;this.startTime=a,this.direction=t.direction.HORIZONTAL_LEFT_TO_RIGHT,this.endTime=b,this.payload=e,this.region=new shaka.text.CueRegion,this.position=null,this.positionAlign=t.positionAlign.AUTO,this.size=0,this.textAlign=t.textAlign.CENTER,this.writingMode=t.writingMode.HORIZONTAL_TOP_TO_BOTTOM,this.lineInterpretation=t.lineInterpretation.LINE_NUMBER,this.line=null,this.lineHeight="",this.lineAlign=t.lineAlign.START,this.displayAlign=t.displayAlign.AFTER,this.fontSize=this.border=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=t.fontWeight.NORMAL,this.fontStyle=t.fontStyle.NORMAL,this.linePadding=this.letterSpacing=this.fontFamily="",this.opacity=1,this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=!1,this.cellResolution={columns:32,rows:15}},shaka.text.Cue.prototype.clone=function(){var b,a=new shaka.text.Cue(0,0,"");for(b in this)a[b]=this[b],a[b]&&a[b].constructor==Array&&(a[b]=a[b].slice());return a},goog.exportSymbol("shaka.text.Cue",shaka.text.Cue),shaka.text.Cue.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:"auto"},goog.exportProperty(shaka.text.Cue,"positionAlign",shaka.text.Cue.positionAlign),shaka.text.Cue.textAlign={LEFT:"left",RIGHT:"right",CENTER:"center",START:"start",END:"end"},goog.exportProperty(shaka.text.Cue,"textAlign",shaka.text.Cue.textAlign),shaka.text.Cue.displayAlign={BEFORE:"before",CENTER:"center",AFTER:"after"},goog.exportProperty(shaka.text.Cue,"displayAlign",shaka.text.Cue.displayAlign),shaka.text.Cue.direction={HORIZONTAL_LEFT_TO_RIGHT:"ltr",HORIZONTAL_RIGHT_TO_LEFT:"rtl"},goog.exportProperty(shaka.text.Cue,"direction",shaka.text.Cue.direction),shaka.text.Cue.writingMode={HORIZONTAL_TOP_TO_BOTTOM:"horizontal-tb",VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"},goog.exportProperty(shaka.text.Cue,"writingMode",shaka.text.Cue.writingMode),shaka.text.Cue.lineInterpretation={LINE_NUMBER:0,PERCENTAGE:1},goog.exportProperty(shaka.text.Cue,"lineInterpretation",shaka.text.Cue.lineInterpretation),shaka.text.Cue.lineAlign={CENTER:"center",START:"start",END:"end"},goog.exportProperty(shaka.text.Cue,"lineAlign",shaka.text.Cue.lineAlign),shaka.text.Cue.fontWeight={NORMAL:400,BOLD:700},goog.exportProperty(shaka.text.Cue,"fontWeight",shaka.text.Cue.fontWeight),shaka.text.Cue.fontStyle={NORMAL:"normal",ITALIC:"italic",OBLIQUE:"oblique"},goog.exportProperty(shaka.text.Cue,"fontStyle",shaka.text.Cue.fontStyle),shaka.text.Cue.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},goog.exportProperty(shaka.text.Cue,"textDecoration",shaka.text.Cue.textDecoration),shaka.text.CueRegion=function(){var a=shaka.text.CueRegion;this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=a.units.PERCENTAGE,this.scroll=a.scrollMode.NONE},goog.exportSymbol("shaka.text.CueRegion",shaka.text.CueRegion),shaka.text.CueRegion.units={PX:0,PERCENTAGE:1,LINES:2},goog.exportProperty(shaka.text.CueRegion,"units",shaka.text.CueRegion.units),shaka.text.CueRegion.scrollMode={NONE:"",UP:"up"},goog.exportProperty(shaka.text.CueRegion,"scrollMode",shaka.text.CueRegion.scrollMode),shaka.text.TextEngine=function(a){this.parser_=null,this.displayer_=a,this.appendWindowStart_=this.timestampOffset_=0,this.appendWindowEnd_=1/0,this.bufferEnd_=this.bufferStart_=null,this.selectedClosedCaptionId_="",this.closedCaptionsMap_=new Map},shaka.text.TextEngine.registerParser=function(a,b){shaka.text.TextEngine.parserMap_[a]=b},shaka.text.TextEngine.unregisterParser=function(a){delete shaka.text.TextEngine.parserMap_[a]},shaka.text.TextEngine.isTypeSupported=function(a){return!(!shaka.text.TextEngine.parserMap_[a]&&a!=shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE)},shaka.text.TextEngine.prototype.destroy=function(){return this.displayer_=this.parser_=null,this.closedCaptionsMap_.clear(),Promise.resolve()},shaka.text.TextEngine.prototype.setDisplayer=function(a){this.displayer_=a},shaka.text.TextEngine.prototype.initParser=function(a){a!=shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE&&(a=shaka.text.TextEngine.parserMap_[a],goog.asserts.assert(a,"Text type negotiation should have happened already"),this.parser_=shaka.util.Functional.callFactory(a))},shaka.text.TextEngine.prototype.appendBuffer=function(a,b,e){var t,r,g,n=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){return 1==o.nextAddress?(goog.asserts.assert(n.parser_,"The parser should already be initialized"),o.yield(Promise.resolve(),2)):n.parser_&&n.displayer_?null==b||null==e?(n.parser_.parseInit(shaka.util.BufferUtils.toUint8(a)),o.return()):(t={periodStart:n.timestampOffset_,segmentStart:b,segmentEnd:e},r=n.parser_.parseMedia(shaka.util.BufferUtils.toUint8(a),t),g=r.filter((function(a){return a.startTime>=n.appendWindowStart_&&a.startTime<n.appendWindowEnd_})),n.displayer_.append(g),null==n.bufferStart_?n.bufferStart_=Math.max(b,n.appendWindowStart_):(goog.asserts.assert(null!=n.bufferEnd_,"There should already be a buffered range end."),goog.asserts.assert(1>=b-n.bufferEnd_,"There should not be a gap in text references >1s")),n.bufferEnd_=Math.min(e,n.appendWindowEnd_),void o.jumpToEnd()):o.return()}))},shaka.text.TextEngine.prototype.remove=function(a,b){var e=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){if(1==t.nextAddress)return t.yield(Promise.resolve(),2);e.displayer_&&e.displayer_.remove(a,b)&&(null==e.bufferStart_?goog.asserts.assert(null==e.bufferEnd_,"end must be null if startTime is null"):(goog.asserts.assert(null!=e.bufferEnd_,"end must be non-null if startTime is non-null"),b<=e.bufferStart_||a>=e.bufferEnd_||(a<=e.bufferStart_&&b>=e.bufferEnd_?e.bufferStart_=e.bufferEnd_=null:a<=e.bufferStart_&&b<e.bufferEnd_?e.bufferStart_=b:a>e.bufferStart_&&b>=e.bufferEnd_?e.bufferEnd_=a:goog.asserts.assert(!1,"removal from the middle is not supported by TextEngine")))),t.jumpToEnd()}))},shaka.text.TextEngine.prototype.setTimestampOffset=function(a){this.timestampOffset_=a},shaka.text.TextEngine.prototype.setAppendWindow=function(a,b){this.appendWindowStart_=a,this.appendWindowEnd_=b},shaka.text.TextEngine.prototype.bufferStart=function(){return this.bufferStart_},shaka.text.TextEngine.prototype.bufferEnd=function(){return this.bufferEnd_},shaka.text.TextEngine.prototype.isBuffered=function(a){return null!=this.bufferStart_&&null!=this.bufferEnd_&&(a>=this.bufferStart_&&a<this.bufferEnd_)},shaka.text.TextEngine.prototype.bufferedAheadOf=function(a){return null==this.bufferEnd_||this.bufferEnd_<a?0:(goog.asserts.assert(null!=this.bufferStart_,"start should not be null if end is not null"),this.bufferEnd_-Math.max(a,this.bufferStart_))},shaka.text.TextEngine.prototype.setSelectedClosedCaptionId=function(a,b){this.selectedClosedCaptionId_=a;var e=this.closedCaptionsMap_.get(a);if(e)for(var t=$jscomp.makeIterator(e.keys()),r=t.next();!r.done;r=t.next())(r=e.get(r.value).filter((function(a){return a.endTime<=b})))&&this.displayer_.append(r)},shaka.text.TextEngine.prototype.convertMuxjsCaptionsToShakaCaptions=function(a){for(var b=[],e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next()){e=e.value;var t=new shaka.text.Cue(e.startTime,e.endTime,e.text);b.push({stream:e.stream,cue:t})}return b},shaka.text.TextEngine.prototype.storeAndAppendClosedCaptions=function(a,b,e,t){for(var r=b+" "+e,n=new Map,g=(a=$jscomp.makeIterator(a)).next();!g.done;g=a.next()){var o=g.value;g=o.stream,o=o.cue,n.has(g)||n.set(g,new Map),n.get(g).has(r)||n.get(g).set(r,[]),o.startTime+=t,o.endTime+=t,o.startTime>=this.appendWindowStart_&&o.startTime<this.appendWindowEnd_&&(n.get(g).get(r).push(o),g==this.selectedClosedCaptionId_&&this.displayer_.append([o]))}for(r=(t=$jscomp.makeIterator(n.keys())).next();!r.done;r=t.next())for(r=r.value,this.closedCaptionsMap_.has(r)||this.closedCaptionsMap_.set(r,new Map),g=(a=$jscomp.makeIterator(n.get(r).keys())).next();!g.done;g=a.next())g=g.value,o=n.get(r).get(g),this.closedCaptionsMap_.get(r).set(g,o);this.bufferStart_=null==this.bufferStart_?Math.max(b,this.appendWindowStart_):Math.min(this.bufferStart_,Math.max(b,this.appendWindowStart_)),this.bufferEnd_=Math.max(this.bufferEnd_,Math.min(e,this.appendWindowEnd_))},shaka.text.TextEngine.prototype.getNumberOfClosedCaptionChannels=function(){return this.closedCaptionsMap_.size},shaka.text.TextEngine.prototype.getNumberOfClosedCaptionsInChannel=function(a){return(a=this.closedCaptionsMap_.get(a))?a.size:0},goog.exportSymbol("shaka.text.TextEngine",shaka.text.TextEngine),goog.exportProperty(shaka.text.TextEngine.prototype,"destroy",shaka.text.TextEngine.prototype.destroy),goog.exportProperty(shaka.text.TextEngine,"unregisterParser",shaka.text.TextEngine.unregisterParser),goog.exportProperty(shaka.text.TextEngine,"registerParser",shaka.text.TextEngine.registerParser),shaka.text.TextEngine.parserMap_={},shaka.media.MediaSourceEngine=function(a,b,e,t){var r=this;this.video_=a,this.textDisplayer_=e,this.sourceBuffers_={},this.textEngine_=null,a=function(a,b,e){},this.onMetadata_=t||a,this.queues_={},this.eventManager_=new shaka.util.EventManager,this.transmuxers_={},this.captionParser_=b,this.mediaSourceOpen_=new shaka.util.PublicPromise,this.mediaSource_=this.createMediaSource(this.mediaSourceOpen_),this.destroyer_=new shaka.util.Destroyer((function(){return r.doDestroy_()}))},shaka.media.MediaSourceEngine.prototype.createMediaSource=function(a){var b=new MediaSource;return this.eventManager_.listenOnce(b,"sourceopen",a.resolve),this.video_.src=shaka.media.MediaSourceEngine.createObjectURL(b),b},shaka.media.MediaSourceEngine.isStreamSupported=function(a){var b=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs),e=shaka.util.MimeUtils.getExtendedType(a);return shaka.text.TextEngine.isTypeSupported(b)||MediaSource.isTypeSupported(e)||shaka.media.Transmuxer.isSupported(b,a.type)},shaka.media.MediaSourceEngine.probeSupport=function(){for(var a={},b=$jscomp.makeIterator('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",")),e=b.next();!e.done;e=b.next()){e=e.value,shaka.util.Platform.supportsMediaSource()?shaka.text.TextEngine.isTypeSupported(e)?a[e]=!0:a[e]=MediaSource.isTypeSupported(e)||shaka.media.Transmuxer.isSupported(e):a[e]=shaka.util.Platform.supportsMediaType(e);var t=e.split(";")[0];a[t]=a[t]||a[e]}return a},shaka.media.MediaSourceEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.MediaSourceEngine.prototype.doDestroy_=function(){var b,e,t,r,n,g,o,l,h,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(d){if(1==d.nextAddress){for(t in b=shaka.util.Functional,e=[],a.queues_)for(r=a.queues_[t],n=r[0],a.queues_[t]=r.slice(0,1),n&&e.push(n.p.catch(b.noop)),g=$jscomp.makeIterator(r.slice(1)),o=g.next();!o.done;o=g.next())o.value.p.reject(shaka.util.Destroyer.destroyedError());for(l in a.textEngine_&&e.push(a.textEngine_.destroy()),a.textDisplayer_&&e.push(a.textDisplayer_.destroy()),a.transmuxers_)e.push(a.transmuxers_[l].destroy());return d.yield(Promise.all(e),2)}if(a.eventManager_&&(a.eventManager_.release(),a.eventManager_=null),a.video_&&(a.video_.removeAttribute("src"),a.video_.load(),a.video_=null),a.mediaSource_=null,a.textEngine_=null,a.textDisplayer_=null,a.sourceBuffers_={},a.transmuxers_={},a.captionParser_=null,goog.DEBUG)for(h in a.queues_)goog.asserts.assert(0==a.queues_[h].length,h+" queue should be empty after destroy!");a.queues_={},d.jumpToEnd()}))},shaka.media.MediaSourceEngine.prototype.open=function(){return this.mediaSourceOpen_},shaka.media.MediaSourceEngine.prototype.init=function(a,b){var e,t,r,g,n,o,l,h=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(d){if(1==d.nextAddress)return e=shaka.util.ManifestParserUtils.ContentType,d.yield(h.mediaSourceOpen_,2);for(t={},r=$jscomp.makeIterator(a.keys()),g=r.next();!g.done;t={$jscomp$loop$prop$contentType$540:t.$jscomp$loop$prop$contentType$540},g=r.next())t.$jscomp$loop$prop$contentType$540=g.value,n=a.get(t.$jscomp$loop$prop$contentType$540),goog.asserts.assert(shaka.media.MediaSourceEngine.isStreamSupported(n),"Type negotiation should happen before MediaSourceEngine.init!"),o=shaka.util.MimeUtils.getFullType(n.mimeType,n.codecs),t.$jscomp$loop$prop$contentType$540==e.TEXT?h.reinitText(o):(!b&&MediaSource.isTypeSupported(o)||!shaka.media.Transmuxer.isSupported(o,t.$jscomp$loop$prop$contentType$540)||(h.transmuxers_[t.$jscomp$loop$prop$contentType$540]=new shaka.media.Transmuxer,o=shaka.media.Transmuxer.convertTsCodecs(t.$jscomp$loop$prop$contentType$540,o)),l=h.mediaSource_.addSourceBuffer(o),h.eventManager_.listen(l,"error",function(a){return function(){return h.onError_(a.$jscomp$loop$prop$contentType$540)}}(t)),h.eventManager_.listen(l,"updateend",function(a){return function(){return h.onUpdateEnd_(a.$jscomp$loop$prop$contentType$540)}}(t)),h.sourceBuffers_[t.$jscomp$loop$prop$contentType$540]=l,h.queues_[t.$jscomp$loop$prop$contentType$540]=[]);d.jumpToEnd()}))},shaka.media.MediaSourceEngine.prototype.reinitText=function(a){this.textEngine_||(this.textEngine_=new shaka.text.TextEngine(this.textDisplayer_)),this.textEngine_.initParser(a)},shaka.media.MediaSourceEngine.prototype.ended=function(){return!this.mediaSource_||"ended"==this.mediaSource_.readyState},shaka.media.MediaSourceEngine.prototype.bufferStart=function(a){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferStart():shaka.media.TimeRangesUtils.bufferStart(this.getBuffered_(a))},shaka.media.MediaSourceEngine.prototype.bufferEnd=function(a){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.bufferEnd():shaka.media.TimeRangesUtils.bufferEnd(this.getBuffered_(a))},shaka.media.MediaSourceEngine.prototype.isBuffered=function(a,b,e){return a==shaka.util.ManifestParserUtils.ContentType.TEXT?this.textEngine_.isBuffered(b):(a=this.getBuffered_(a),shaka.media.TimeRangesUtils.isBuffered(a,b,e))},shaka.media.MediaSourceEngine.prototype.bufferedAheadOf=function(a,b){if(a==shaka.util.ManifestParserUtils.ContentType.TEXT)return this.textEngine_.bufferedAheadOf(b);var e=this.getBuffered_(a);return shaka.media.TimeRangesUtils.bufferedAheadOf(e,b)},shaka.media.MediaSourceEngine.prototype.getBufferedInfo=function(){var a=shaka.util.ManifestParserUtils.ContentType,b=shaka.media.TimeRangesUtils;if(a={total:b.getBufferedInfo(this.video_.buffered),audio:b.getBufferedInfo(this.getBuffered_(a.AUDIO)),video:b.getBufferedInfo(this.getBuffered_(a.VIDEO)),text:[]},this.textEngine_){b=this.textEngine_.bufferStart();var e=this.textEngine_.bufferEnd();null!=b&&null!=e&&a.text.push({start:b,end:e})}return a},shaka.media.MediaSourceEngine.prototype.getBuffered_=function(a){try{return this.sourceBuffers_[a].buffered}catch(e){return a in this.sourceBuffers_&&shaka.log.error("failed to get buffered range for "+a,e),null}},shaka.media.MediaSourceEngine.prototype.appendBuffer=function(a,b,e,t,r){var g,n,o,l,h,d,p,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(q){return 1==q.nextAddress?(g=shaka.util.ManifestParserUtils.ContentType,a==g.TEXT?q.yield(c.textEngine_.appendBuffer(b,e,t),0):c.transmuxers_[a]?q.yield(c.transmuxers_[a].transmux(b),10):(r&&(c.textEngine_||c.reinitText("text/vtt"),null==e&&null==t?c.captionParser_.init(b):(n=c.captionParser_.parseFrom(b)).length&&(o=c.sourceBuffers_[g.VIDEO].timestampOffset,c.textEngine_.storeAndAppendClosedCaptions(n,e,t,o))),q.yield(c.enqueueOperation_(a,(function(){return c.append_(a,b)})),0))):(l=q.yieldResult,c.textEngine_||c.reinitText("text/vtt"),l.metadata&&(h=c.sourceBuffers_[a].timestampOffset,c.onMetadata_(l.metadata,h,t)),l.captions&&l.captions.length&&(d=c.sourceBuffers_[g.VIDEO].timestampOffset,p=c.textEngine_.convertMuxjsCaptionsToShakaCaptions(l.captions),c.textEngine_.storeAndAppendClosedCaptions(p,e,t,d)),q.yield(c.enqueueOperation_(a,(function(){return c.append_(a,l.data)})),0))}))},shaka.media.MediaSourceEngine.prototype.setSelectedClosedCaptionId=function(a){var b=this.bufferEnd(shaka.util.ManifestParserUtils.ContentType.VIDEO)||0;this.textEngine_.setSelectedClosedCaptionId(a,b)},shaka.media.MediaSourceEngine.prototype.remove=function(a,b,e){var t,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){return goog.asserts.assert(e<Number.MAX_VALUE,"remove() with MAX_VALUE or Infinity is not IE-compatible!"),t=shaka.util.ManifestParserUtils.ContentType,a==t.TEXT?n.yield(r.textEngine_.remove(b,e),0):n.yield(r.enqueueOperation_(a,(function(){return r.remove_(a,b,e)})),0)}))},shaka.media.MediaSourceEngine.prototype.clear=function(a){var e,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return e=shaka.util.ManifestParserUtils.ContentType,a==e.TEXT?b.textEngine_?t.yield(b.textEngine_.remove(0,1/0),0):t.return():t.yield(b.enqueueOperation_(a,(function(){return b.remove_(a,0,b.mediaSource_.duration)})),0)}))},shaka.media.MediaSourceEngine.prototype.resetCaptionParser=function(){this.captionParser_.reset()},shaka.media.MediaSourceEngine.prototype.flush=function(a){var e,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return e=shaka.util.ManifestParserUtils.ContentType,a==e.TEXT?t.return():t.yield(b.enqueueOperation_(a,(function(){return b.flush_(a)})),0)}))},shaka.media.MediaSourceEngine.prototype.setStreamProperties=function(a,b,e,t){var r,n=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(g){return r=shaka.util.ManifestParserUtils.ContentType,a==r.TEXT?(n.textEngine_.setTimestampOffset(b),n.textEngine_.setAppendWindow(e,t),g.return()):g.yield(Promise.all([n.enqueueOperation_(a,(function(){return n.abort_(a)})),n.enqueueOperation_(a,(function(){return n.setTimestampOffset_(a,b)})),n.enqueueOperation_(a,(function(){return n.setAppendWindow_(a,e,t)}))]),0)}))},shaka.media.MediaSourceEngine.prototype.endOfStream=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return e.yield(b.enqueueBlockingOperation_((function(){b.ended()||(a?b.mediaSource_.endOfStream(a):b.mediaSource_.endOfStream())})),0)}))},shaka.media.MediaSourceEngine.prototype.setDuration=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return goog.asserts.assert(isNaN(b.mediaSource_.duration)||b.mediaSource_.duration<=a,"duration cannot decrease: "+b.mediaSource_.duration+" -> "+a),e.yield(b.enqueueBlockingOperation_((function(){b.mediaSource_.duration=a})),0)}))},shaka.media.MediaSourceEngine.prototype.getDuration=function(){return this.mediaSource_.duration},shaka.media.MediaSourceEngine.prototype.append_=function(a,b){this.sourceBuffers_[a].appendBuffer(b)},shaka.media.MediaSourceEngine.prototype.remove_=function(a,b,e){e<=b?this.onUpdateEnd_(a):this.sourceBuffers_[a].remove(b,e)},shaka.media.MediaSourceEngine.prototype.abort_=function(a){var b=this.sourceBuffers_[a].appendWindowStart,e=this.sourceBuffers_[a].appendWindowEnd;this.sourceBuffers_[a].abort(),this.sourceBuffers_[a].appendWindowStart=b,this.sourceBuffers_[a].appendWindowEnd=e,this.onUpdateEnd_(a)},shaka.media.MediaSourceEngine.prototype.flush_=function(a){goog.asserts.assert(0==this.video_.buffered.length,"MediaSourceEngine.flush_ should only be used after clearing all data!"),this.video_.currentTime-=.001,this.onUpdateEnd_(a)},shaka.media.MediaSourceEngine.prototype.setTimestampOffset_=function(a,b){0>b&&(b+=.001),this.sourceBuffers_[a].timestampOffset=b,this.onUpdateEnd_(a)},shaka.media.MediaSourceEngine.prototype.setAppendWindow_=function(a,b,e){this.sourceBuffers_[a].appendWindowStart=0,this.sourceBuffers_[a].appendWindowEnd=e,this.sourceBuffers_[a].appendWindowStart=b,this.onUpdateEnd_(a)},shaka.media.MediaSourceEngine.prototype.onError_=function(a){var b=this.queues_[a][0];goog.asserts.assert(b,"Spurious error event!"),goog.asserts.assert(!this.sourceBuffers_[a].updating,"SourceBuffer should not be updating on error!"),b.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_FAILED,this.video_.error?this.video_.error.code:0))},shaka.media.MediaSourceEngine.prototype.onUpdateEnd_=function(a){var b=this.queues_[a][0];goog.asserts.assert(b,"Spurious updateend event!"),b&&(goog.asserts.assert(!this.sourceBuffers_[a].updating,"SourceBuffer should not be updating on updateend!"),b.p.resolve(),this.popFromQueue_(a))},shaka.media.MediaSourceEngine.prototype.enqueueOperation_=function(a,b){this.destroyer_.ensureNotDestroyed();var e={start:b,p:new shaka.util.PublicPromise};return this.queues_[a].push(e),1==this.queues_[a].length&&this.startOperation_(a),e.p},shaka.media.MediaSourceEngine.prototype.enqueueBlockingOperation_=function(a){var e,t,r,n,g,o,l,h,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(d){switch(d.nextAddress){case 1:for(r in b.destroyer_.ensureNotDestroyed(),e=[],t={},b.sourceBuffers_)t.$jscomp$loop$prop$ready$542=new shaka.util.PublicPromise,n={start:function(a){return function(){return a.$jscomp$loop$prop$ready$542.resolve()}}(t),p:t.$jscomp$loop$prop$ready$542},b.queues_[r].push(n),e.push(t.$jscomp$loop$prop$ready$542),1==b.queues_[r].length&&n.start(),t={$jscomp$loop$prop$ready$542:t.$jscomp$loop$prop$ready$542};return d.setCatchFinallyBlocks(2),d.yield(Promise.all(e),4);case 4:d.leaveTryBlock(3);break;case 2:if(g=d.enterCatchBlock(),goog.asserts.assert(b.destroyer_.destroyed(),"Should be destroyed by now"),goog.DEBUG)for(o in b.sourceBuffers_)b.queues_[o].length&&(goog.asserts.assert(1==b.queues_[o].length,"Should be at most one item in queue!"),goog.asserts.assert(e.includes(b.queues_[o][0].p),"The item in queue should be one of our waiters!"),b.queues_[o].shift());throw g;case 3:if(goog.DEBUG)for(l in b.sourceBuffers_)goog.asserts.assert(0==b.sourceBuffers_[l].updating,"SourceBuffers should not be updating after a blocking op!");try{a()}catch(e){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,e)}finally{for(h in b.sourceBuffers_)b.popFromQueue_(h)}d.jumpToEnd()}}))},shaka.media.MediaSourceEngine.prototype.popFromQueue_=function(a){this.queues_[a].shift(),this.startOperation_(a)},shaka.media.MediaSourceEngine.prototype.startOperation_=function(a){var b=this.queues_[a][0];if(b)try{b.start()}catch(e){"QuotaExceededError"==e.name?b.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.QUOTA_EXCEEDED_ERROR,a)):b.p.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MEDIA_SOURCE_OPERATION_THREW,e)),this.popFromQueue_(a)}},shaka.media.MediaSourceEngine.prototype.getTextDisplayer=function(){return goog.asserts.assert(this.textDisplayer_,"TextDisplayer should only be null when this is destroyed"),this.textDisplayer_},shaka.media.MediaSourceEngine.prototype.setTextDisplayer=function(a){var b=this.textDisplayer_;this.textDisplayer_=a,b&&(a.setTextVisibility(b.isTextVisible()),b.destroy()),this.textEngine_&&this.textEngine_.setDisplayer(a)},shaka.media.MediaSourceEngine.createObjectURL=window.URL.createObjectURL,shaka.util.StreamUtils=function(){},shaka.util.StreamUtils.chooseCodecsAndFilterManifest=function(a,b){function e(a){var b="";a.video&&(b=t.getCodecBase(a.video.codecs));var e="";return a.audio&&(e=t.getCodecBase(a.audio.codecs)),b+"-"+e}for(var t=shaka.util.MimeUtils,r=shaka.util.StreamUtils.filterVariantsByAudioChannelCount(a.variants,b),n=new shaka.util.MultiMap,g=(r=$jscomp.makeIterator(r)).next();!g.done;g=r.next()){var o=e(g=g.value);n.push(o,g)}var l=null,h=1/0;n.forEach((function(a,b){for(var e=0,t=0,r=$jscomp.makeIterator(b),n=r.next();!n.done;n=r.next())e+=n.value.bandwidth||0,++t;e/=t,shaka.log.debug("codecs",a,"avg bandwidth",e),e<h&&(l=a,h=e)})),goog.asserts.assert(null!=l,"Should have chosen codecs!"),goog.asserts.assert(!isNaN(h),"Bandwidth should be a number!"),a.variants=a.variants.filter((function(a){return e(a)==l||(shaka.log.debug("Dropping Variant (better codec available)",a),!1)}))},shaka.util.StreamUtils.meetsRestrictions=function(a,b,e){var t=function(a,b,e){return a>=b&&a<=e},r=a.video;if(r&&r.width&&r.height){var n=b.orientation;if(0!==n&&Math.sign(r.width/r.height-1)!==n||!t(r.width,b.minWidth,Math.min(b.maxWidth,e.width))||!t(r.height,b.minHeight,Math.min(b.maxHeight,e.height))||!t(r.width*r.height,b.minPixels,b.maxPixels))return!1}return!(a&&a.video&&a.video.frameRate&&!t(a.video.frameRate,b.minFrameRate,b.maxFrameRate)||!t(a.bandwidth,b.minBandwidth,b.maxBandwidth))},shaka.util.StreamUtils.applyRestrictions=function(a,b,e){for(var t=!1,r=(a=$jscomp.makeIterator(a)).next();!r.done;r=a.next()){var n=(r=r.value).allowedByApplication;r.allowedByApplication=shaka.util.StreamUtils.meetsRestrictions(r,b,e),n!=r.allowedByApplication&&(t=!0)}return t},shaka.util.StreamUtils.filterManifest=function(a,b,e){var t=shaka.util.StreamUtils;e.variants=e.variants.filter((function(e){if(a&&a.initialized()&&!a.supportsVariant(e))return shaka.log.debug("Dropping variant - not compatible with key system",e),!1;var r=e.audio;return e=e.video,r&&!shaka.media.MediaSourceEngine.isStreamSupported(r)?(shaka.log.debug("Dropping variant - audio not compatible with platform",t.getStreamSummaryString_(r)),!1):e&&!shaka.media.MediaSourceEngine.isStreamSupported(e)?(shaka.log.debug("Dropping variant - video not compatible with platform",t.getStreamSummaryString_(e)),!1):r&&b&&b.audio&&!t.areStreamsCompatible_(r,b.audio)?(shaka.log.debug("Droping variant - not compatible with active audio","active audio",t.getStreamSummaryString_(b.audio),"variant.audio",t.getStreamSummaryString_(r)),!1):!(e&&b&&b.video&&!t.areStreamsCompatible_(e,b.video))||(shaka.log.debug("Droping variant - not compatible with active video","active video",t.getStreamSummaryString_(b.video),"variant.video",t.getStreamSummaryString_(e)),!1)})),e.textStreams=e.textStreams.filter((function(a){var b=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs);return(b=shaka.text.TextEngine.isTypeSupported(b))||shaka.log.debug("Dropping text stream. Is not supported by the platform.",a),b}))},shaka.util.StreamUtils.areStreamsCompatible_=function(a,b){return a.mimeType==b.mimeType&&a.codecs.split(".")[0]==b.codecs.split(".")[0]},shaka.util.StreamUtils.variantToTrack=function(a){var b=a.audio,e=a.video,t=b?b.codecs:null,r=e?e.codecs:null,n=[];r&&n.push(r),t&&n.push(t);var g=[];e&&g.push(e.mimeType),b&&g.push(b.mimeType),g=g[0]||null;var o=[];b&&o.push(b.kind),e&&o.push(e.kind),o=o[0]||null;var l=new Set;if(b)for(var h=$jscomp.makeIterator(b.roles),d=h.next();!d.done;d=h.next())l.add(d.value);if(e)for(d=(h=$jscomp.makeIterator(e.roles)).next();!d.done;d=h.next())l.add(d.value);return a={id:a.id,active:!1,type:"variant",bandwidth:a.bandwidth,language:a.language,label:null,kind:o,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:g,codecs:n.join(", "),audioCodec:t,videoCodec:r,primary:a.primary,roles:Array.from(l),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null},e&&(a.videoId=e.id,a.originalVideoId=e.originalId,a.width=e.width||null,a.height=e.height||null,a.frameRate=e.frameRate||null,a.pixelAspectRatio=e.pixelAspectRatio||null,a.videoBandwidth=e.bandwidth||null),b&&(a.audioId=b.id,a.originalAudioId=b.originalId,a.channelsCount=b.channelsCount,a.audioSamplingRate=b.audioSamplingRate,a.audioBandwidth=b.bandwidth||null,a.label=b.label,a.audioRoles=b.roles),a},shaka.util.StreamUtils.textStreamToTrack=function(a){return{id:a.id,active:!1,type:shaka.util.ManifestParserUtils.ContentType.TEXT,bandwidth:0,language:a.language,label:a.label,kind:a.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:a.mimeType,codecs:a.codecs||null,audioCodec:null,videoCodec:null,primary:a.primary,roles:a.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:a.originalId}},shaka.util.StreamUtils.html5TrackId=function(a){return a.__shaka_id||(a.__shaka_id=shaka.util.StreamUtils.nextTrackId_++),a.__shaka_id},shaka.util.StreamUtils.html5TextTrackToTrack=function(a){var b=shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE,e=shaka.util.StreamUtils.html5TrackToGenericShakaTrack_(a);return e.active="disabled"!=a.mode,e.type="text",e.originalTextId=a.id,"captions"==a.kind&&(e.mimeType=b),a.kind&&(e.roles=[a.kind]),e},shaka.util.StreamUtils.html5AudioTrackToTrack=function(a){var b=shaka.util.StreamUtils.html5TrackToGenericShakaTrack_(a);return b.active=a.enabled,b.type="variant",b.originalAudioId=a.id,"main"==a.kind&&(b.primary=!0),a.kind&&(b.roles=[a.kind],b.audioRoles=[a.kind]),b},shaka.util.StreamUtils.html5TrackToGenericShakaTrack_=function(a){return{id:shaka.util.StreamUtils.html5TrackId(a),active:!1,type:"",bandwidth:0,language:shaka.util.LanguageUtils.normalize(a.language),label:a.label,kind:a.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null}},shaka.util.StreamUtils.isPlayable=function(a){return a.allowedByApplication&&a.allowedByKeySystem},shaka.util.StreamUtils.getPlayableVariants=function(a){return a.filter((function(a){return shaka.util.StreamUtils.isPlayable(a)}))},shaka.util.StreamUtils.filterVariantsByAudioChannelCount=function(a,b){for(var e=a.filter((function(a){return a.audio&&a.audio.channelsCount})),t=new Map,r=(e=$jscomp.makeIterator(e)).next();!r.done;r=e.next()){var n=(r=r.value).audio.channelsCount;goog.asserts.assert(null!=n,"Must have count after filtering!"),t.has(n)||t.set(n,[]),t.get(n).push(r)}return 0==(e=Array.from(t.keys())).length?a:(r=e.filter((function(a){return a<=b}))).length?t.get(Math.max.apply(Math,$jscomp.arrayFromIterable(r))):t.get(Math.min.apply(Math,$jscomp.arrayFromIterable(e)))},shaka.util.StreamUtils.filterStreamsByLanguageAndRole=function(a,b,e){var t=shaka.util.LanguageUtils,r=a,n=a.filter((function(a){return a.primary}));n.length&&(r=n);var g=r.length?r[0].language:"";if(r=r.filter((function(a){return a.language==g})),b){var o=t.findClosestLocale(t.normalize(b),a.map((function(a){return a.language})));o&&(r=a.filter((function(a){return t.normalize(a.language)==o})))}if(e){if((a=shaka.util.StreamUtils.filterTextStreamsByRole_(r,e)).length)return a;shaka.log.warning("No exact match for the text role could be found.")}else if((a=r.filter((function(a){return 0==a.roles.length}))).length)return a;return(a=r.map((function(a){return a.roles})).reduce(shaka.util.Functional.collapseArrays,[])).length?shaka.util.StreamUtils.filterTextStreamsByRole_(r,a[0]):r},shaka.util.StreamUtils.filterTextStreamsByRole_=function(a,b){return a.filter((function(a){return a.roles.includes(b)}))},shaka.util.StreamUtils.isAudio=function(a){return a.type==shaka.util.ManifestParserUtils.ContentType.AUDIO},shaka.util.StreamUtils.isVideo=function(a){return a.type==shaka.util.ManifestParserUtils.ContentType.VIDEO},shaka.util.StreamUtils.getVariantStreams=function(a){var b=[];return a.audio&&b.push(a.audio),a.video&&b.push(a.video),b},shaka.util.StreamUtils.getStreamSummaryString_=function(a){return shaka.util.StreamUtils.isAudio(a)?"type=audio codecs="+a.codecs+" bandwidth="+a.bandwidth+" channelsCount="+a.channelsCount+" audioSamplingRate="+a.audioSamplingRate:shaka.util.StreamUtils.isVideo(a)?"type=video codecs="+a.codecs+" bandwidth="+a.bandwidth+" frameRate="+a.frameRate+" width="+a.width+" height="+a.height:"unexpected stream type"},shaka.util.StreamUtils.nextTrackId_=0,shaka.abr.SimpleAbrManager=function(){var a=this;this.switch_=null,this.enabled_=!1,this.bandwidthEstimator_=new shaka.abr.EwmaBandwidthEstimator,navigator.connection&&navigator.connection.addEventListener("change",(function(){if(a.config_.useNetworkInformation){a.bandwidthEstimator_=new shaka.abr.EwmaBandwidthEstimator;var b=a.chooseVariant();b&&a.switch_(b)}})),this.variants_=[],this.playbackRate_=1,this.startupComplete_=!1,this.config_=this.lastTimeChosenMs_=null},shaka.abr.SimpleAbrManager.prototype.stop=function(){this.switch_=null,this.enabled_=!1,this.variants_=[],this.playbackRate_=1,this.lastTimeChosenMs_=null},shaka.abr.SimpleAbrManager.prototype.init=function(a){this.switch_=a},shaka.abr.SimpleAbrManager.prototype.chooseVariant=function(){var a=shaka.abr.SimpleAbrManager,b=a.filterAndSortVariants_(this.config_.restrictions,this.variants_),e=this.getDefaultBandwidth_();e=this.bandwidthEstimator_.getBandwidthEstimate(e),this.variants_.length&&!b.length&&(shaka.log.warning("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),b=[(b=a.filterAndSortVariants_(null,this.variants_))[0]]),a=b[0]||null;for(var t=(b=$jscomp.makeIterator(shaka.util.Iterables.enumerate(b))).next();!t.done;t=b.next()){var r=t.value;t=r.item;var n=r.next,g=isNaN(this.playbackRate_)?1:Math.abs(this.playbackRate_),o=(r=g*t.bandwidth)/this.config_.bandwidthDowngradeTarget;n=g*(n||{bandwidth:1/0}).bandwidth/this.config_.bandwidthUpgradeTarget,shaka.log.v2("Bandwidth ranges:",(r/1e6).toFixed(3),(o/1e6).toFixed(3),(n/1e6).toFixed(3)),e>=o&&e<=n&&(a=t)}return this.lastTimeChosenMs_=Date.now(),a},shaka.abr.SimpleAbrManager.prototype.enable=function(){this.enabled_=!0},shaka.abr.SimpleAbrManager.prototype.disable=function(){this.enabled_=!1},shaka.abr.SimpleAbrManager.prototype.segmentDownloaded=function(a,b){shaka.log.v2("Segment downloaded:","deltaTimeMs="+a,"numBytes="+b,"lastTimeChosenMs="+this.lastTimeChosenMs_,"enabled="+this.enabled_),goog.asserts.assert(0<=a,"expected a non-negative duration"),this.bandwidthEstimator_.sample(a,b),null!=this.lastTimeChosenMs_&&this.enabled_&&this.suggestStreams_()},shaka.abr.SimpleAbrManager.prototype.getBandwidthEstimate=function(){return this.bandwidthEstimator_.getBandwidthEstimate(this.config_.defaultBandwidthEstimate)},shaka.abr.SimpleAbrManager.prototype.setVariants=function(a){this.variants_=a},shaka.abr.SimpleAbrManager.prototype.playbackRateChanged=function(a){this.playbackRate_=a},shaka.abr.SimpleAbrManager.prototype.configure=function(a){this.config_=a},shaka.abr.SimpleAbrManager.prototype.suggestStreams_=function(){if(shaka.log.v2("Suggesting Streams..."),goog.asserts.assert(null!=this.lastTimeChosenMs_,"lastTimeChosenMs_ should not be null"),this.startupComplete_){if(Date.now()-this.lastTimeChosenMs_<1e3*this.config_.switchInterval)return void shaka.log.v2("Still within switch interval...")}else{if(!this.bandwidthEstimator_.hasGoodEstimate())return void shaka.log.v2("Still waiting for a good estimate...");this.startupComplete_=!0}var a=this.chooseVariant(),b=this.getDefaultBandwidth_();b=this.bandwidthEstimator_.getBandwidthEstimate(b),b=Math.round(b/1e3),a&&(shaka.log.debug("Calling switch_(), bandwidth="+b+" kbps"),this.switch_(a))},shaka.abr.SimpleAbrManager.prototype.getDefaultBandwidth_=function(){var a=this.config_.defaultBandwidthEstimate;return navigator.connection&&navigator.connection.downlink&&this.config_.useNetworkInformation&&(a=1e6*navigator.connection.downlink),a},shaka.abr.SimpleAbrManager.filterAndSortVariants_=function(a,b){return a&&(b=b.filter((function(b){return goog.asserts.assert(a,"Restrictions should exist!"),shaka.util.StreamUtils.meetsRestrictions(b,a,{width:1/0,height:1/0})}))),b.sort((function(a,b){return a.bandwidth-b.bandwidth}))},goog.exportSymbol("shaka.abr.SimpleAbrManager",shaka.abr.SimpleAbrManager),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"configure",shaka.abr.SimpleAbrManager.prototype.configure),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"playbackRateChanged",shaka.abr.SimpleAbrManager.prototype.playbackRateChanged),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"setVariants",shaka.abr.SimpleAbrManager.prototype.setVariants),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"getBandwidthEstimate",shaka.abr.SimpleAbrManager.prototype.getBandwidthEstimate),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"segmentDownloaded",shaka.abr.SimpleAbrManager.prototype.segmentDownloaded),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"disable",shaka.abr.SimpleAbrManager.prototype.disable),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"enable",shaka.abr.SimpleAbrManager.prototype.enable),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"chooseVariant",shaka.abr.SimpleAbrManager.prototype.chooseVariant),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"init",shaka.abr.SimpleAbrManager.prototype.init),goog.exportProperty(shaka.abr.SimpleAbrManager.prototype,"stop",shaka.abr.SimpleAbrManager.prototype.stop),shaka.media.AdaptationSet=function(a,b){this.root_=a,this.variants_=new Set([a]),b=b||[];for(var e=$jscomp.makeIterator(b),t=e.next();!t.done;t=e.next())this.add(t.value)},shaka.media.AdaptationSet.prototype.add=function(a){return this.canInclude(a)?(this.variants_.add(a),!0):(shaka.log.warning("Rejecting variant - not compatible with root."),!1)},shaka.media.AdaptationSet.prototype.canInclude=function(a){return shaka.media.AdaptationSet.areAdaptable(this.root_,a)},shaka.media.AdaptationSet.areAdaptable=function(a,b){var e=shaka.media.AdaptationSet;return!!a.audio==!!b.audio&&!!a.video==!!b.video&&a.language==b.language&&(goog.asserts.assert(!!a.audio==!!b.audio,"Both should either have audio or not have audio."),!(a.audio&&b.audio&&!e.areAudiosCompatible_(a.audio,b.audio))&&(goog.asserts.assert(!!a.video==!!b.video,"Both should either have video or not have video."),!(a.video&&b.video&&!e.areVideosCompatible_(a.video,b.video))))},shaka.media.AdaptationSet.prototype.values=function(){return this.variants_.values()},shaka.media.AdaptationSet.areAudiosCompatible_=function(a,b){var e=shaka.media.AdaptationSet;return!(a.channelsCount!=b.channelsCount||!e.canTransitionBetween_(a,b)||!e.areRolesEqual_(a.roles,b.roles))},shaka.media.AdaptationSet.areVideosCompatible_=function(a,b){var e=shaka.media.AdaptationSet;return!(!e.canTransitionBetween_(a,b)||!e.areRolesEqual_(a.roles,b.roles))},shaka.media.AdaptationSet.canTransitionBetween_=function(a,b){if(a.mimeType!=b.mimeType)return!1;var e=shaka.util.MimeUtils.splitCodecs(a.codecs).map((function(a){return shaka.util.MimeUtils.getCodecBase(a)})),t=shaka.util.MimeUtils.splitCodecs(b.codecs).map((function(a){return shaka.util.MimeUtils.getCodecBase(a)}));if(e.length!=t.length)return!1;e.sort(),t.sort();for(var r=$jscomp.makeIterator(shaka.util.Iterables.range(e.length)),n=r.next();!n.done;n=r.next())if(e[n=n.value]!=t[n])return!1;return!0},shaka.media.AdaptationSet.areRolesEqual_=function(a,b){var e=new Set(a),t=new Set(b);if(e.delete("main"),t.delete("main"),e.size!=t.size)return!1;for(var r=(e=$jscomp.makeIterator(e)).next();!r.done;r=e.next())if(!t.has(r.value))return!1;return!0},shaka.media.AdaptationSetCriteria=function(){},shaka.media.AdaptationSetCriteria.prototype.create=function(a){},shaka.media.ExampleBasedCriteria=function(a){this.example_=a,this.fallback_=new shaka.media.PreferenceBasedCriteria(a.language,"",a.audio&&a.audio.channelsCount?a.audio.channelsCount:0,"")},shaka.media.ExampleBasedCriteria.prototype.create=function(a){var b=this,e=a.filter((function(a){return shaka.media.AdaptationSet.areAdaptable(b.example_,a)}));return e.length?new shaka.media.AdaptationSet(e[0],e):this.fallback_.create(a)},shaka.media.PreferenceBasedCriteria=function(a,b,e,t,r){this.language_=a,this.role_=b,this.channelCount_=e,this.label_=void 0===t?"":t,this.type_=void 0===r?"":r},shaka.media.PreferenceBasedCriteria.prototype.create=function(a){var b=shaka.media.PreferenceBasedCriteria,e=shaka.util.StreamUtils,t=[];t=b.filterByLanguage_(a,this.language_);var r=a.filter((function(a){return a.primary}));for(t=t.length?t:r.length?r:a,this.role_&&((a=b.filterVariantsByRole_(t,this.role_,this.type_)).length?t=a:shaka.log.warning("No exact match for variant role could be found.")),this.channelCount_&&((e=e.filterVariantsByAudioChannelCount(t,this.channelCount_)).length?t=e:shaka.log.warning("No exact match for the channel count could be found.")),this.label_&&((b=b.filterVariantsByLabel_(t,this.label_)).length?t=b:shaka.log.warning("No exact match for variant label could be found.")),b=new shaka.media.AdaptationSet(t[0]),e=(t=$jscomp.makeIterator(t)).next();!e.done;e=t.next())e=e.value,b.canInclude(e)&&b.add(e);return b},shaka.media.PreferenceBasedCriteria.filterByLanguage_=function(a,b){var e=shaka.util.LanguageUtils,t=e.normalize(b),r=e.findClosestLocale(t,a.map((function(a){return e.getLocaleForVariant(a)})));return r?a.filter((function(a){return r==e.getLocaleForVariant(a)})):[]},shaka.media.PreferenceBasedCriteria.filterVariantsByRole_=function(a,b,e){return a.filter((function(a){if(e){var t=a[e];return t&&t.roles.includes(b)}return t=a.audio,a=a.video,t&&t.roles.includes(b)||a&&a.roles.includes(b)}))},shaka.media.PreferenceBasedCriteria.filterVariantsByLabel_=function(a,b){return a.filter((function(a){return!!a.audio&&(a=a.audio.label.toLowerCase())==b.toLowerCase()}))},shaka.media.BufferingObserver=function(a,b){var e=shaka.media.BufferingObserver.State;this.previousState_=e.SATISFIED,this.thresholds_=(new Map).set(e.SATISFIED,b).set(e.STARVING,a)},shaka.media.BufferingObserver.prototype.setThresholds=function(a,b){var e=shaka.media.BufferingObserver.State;this.thresholds_.set(e.SATISFIED,b).set(e.STARVING,a)},shaka.media.BufferingObserver.prototype.update=function(a,b){var e=shaka.media.BufferingObserver.State,t=this.thresholds_.get(this.previousState_),r=this.previousState_;return this.previousState_=e=b||a>=t?e.SATISFIED:e.STARVING,r!=e},shaka.media.BufferingObserver.prototype.setState=function(a){this.previousState_=a},shaka.media.BufferingObserver.prototype.getState=function(){return this.previousState_},shaka.media.BufferingObserver.State={STARVING:0,SATISFIED:1},shaka.media.ManifestParser=function(){},shaka.media.ManifestParser.registerParserByExtension=function(a,b){shaka.media.ManifestParser.parsersByExtension[a]=b},shaka.media.ManifestParser.registerParserByMime=function(a,b){shaka.media.ManifestParser.parsersByMime[a]=b},shaka.media.ManifestParser.unregisterParserByMime=function(a){delete shaka.media.ManifestParser.parsersByMime[a]},shaka.media.ManifestParser.probeSupport=function(){var a=shaka.media.ManifestParser,b={};if(shaka.util.Platform.supportsMediaSource()){for(var e in a.parsersByMime)b[e]=!0;for(var t in a.parsersByExtension)b[t]=!0}e={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var r=(t=$jscomp.makeIterator(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!r.done;r=t.next())r=r.value,shaka.util.Platform.supportsMediaSource()?b[r]=!!a.parsersByMime[r]:b[r]=shaka.util.Platform.supportsMediaType(r);for(var n in e)shaka.util.Platform.supportsMediaSource()?b[n]=!!a.parsersByExtension[n]:b[n]=shaka.util.Platform.supportsMediaType(e[n]);return b},shaka.media.ManifestParser.getFactory=function(a,b,e,t){var r,n,g,o,l;return $jscomp.asyncExecutePromiseGeneratorProgram((function(h){if(1==h.nextAddress){if(r=shaka.media.ManifestParser,t){if(n=r.parsersByMime[t.toLowerCase()])return h.return(n);shaka.log.warning("Could not determine manifest type using MIME type ",t)}if(g=r.getExtension(a)){if(o=r.parsersByExtension[g])return h.return(o);shaka.log.warning("Could not determine manifest type for extension ",g)}else shaka.log.warning("Could not find extension for ",a);return t?h.jumpTo(2):h.yield(r.getMimeType(a,b,e),3)}if(2!=h.nextAddress&&(t=h.yieldResult)){if(l=shaka.media.ManifestParser.parsersByMime[t])return h.return(l);shaka.log.warning("Could not determine manifest type using MIME type",t)}throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.UNABLE_TO_GUESS_MANIFEST_TYPE,a)}))},shaka.media.ManifestParser.getMimeType=function(a,b,e){var t,r,n,g;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){return 1==o.nextAddress?(t=shaka.net.NetworkingEngine.RequestType.MANIFEST,(r=shaka.net.NetworkingEngine.makeRequest([a],e)).method="HEAD",o.yield(b.request(t,r).promise,2)):(n=o.yieldResult,g=n.headers["content-type"],o.return(g?g.toLowerCase().split(";").shift():""))}))},shaka.media.ManifestParser.getExtension=function(a){return 1==(a=new goog.Uri(a).getPath().split("/").pop().split(".")).length?"":a.pop().toLowerCase()},shaka.media.ManifestParser.isSupported=function(a,b){return!!shaka.util.Platform.supportsMediaSource()&&(b in shaka.media.ManifestParser.parsersByMime||shaka.media.ManifestParser.getExtension(a)in shaka.media.ManifestParser.parsersByExtension)},goog.exportSymbol("shaka.media.ManifestParser",shaka.media.ManifestParser),goog.exportProperty(shaka.media.ManifestParser,"unregisterParserByMime",shaka.media.ManifestParser.unregisterParserByMime),goog.exportProperty(shaka.media.ManifestParser,"registerParserByMime",shaka.media.ManifestParser.registerParserByMime),goog.exportProperty(shaka.media.ManifestParser,"registerParserByExtension",shaka.media.ManifestParser.registerParserByExtension),shaka.media.ManifestParser.parsersByMime={},shaka.media.ManifestParser.parsersByExtension={},shaka.media.PlayRateController=function(a){var b=this;this.harness_=a,this.isBuffering_=!1,this.rate_=this.harness_.getRate(),this.pollRate_=.25,this.timer_=new shaka.util.Timer((function(){b.harness_.movePlayhead(b.rate_*b.pollRate_)}))},shaka.media.PlayRateController.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.harness_=null},shaka.media.PlayRateController.prototype.setBuffering=function(a){this.isBuffering_=a,this.apply_()},shaka.media.PlayRateController.prototype.set=function(a){goog.asserts.assert(0!=a,"Should never set rate of 0 explicitly!"),this.rate_=a,this.apply_()},shaka.media.PlayRateController.prototype.getRealRate=function(){return this.rate_},shaka.media.PlayRateController.prototype.apply_=function(){this.timer_.stop();var a=this.calculateCurrentRate_();if(shaka.log.v1("Changing effective playback rate to",a),0<=a)try{return void this.applyRate_(a)}catch(e){}this.timer_.tickEvery(this.pollRate_),this.applyRate_(0)},shaka.media.PlayRateController.prototype.calculateCurrentRate_=function(){return this.isBuffering_?0:this.rate_},shaka.media.PlayRateController.prototype.applyRate_=function(a){var b=this.harness_.getRate();return b!=a&&this.harness_.setRate(a),b!=a},shaka.media.InitSegmentReference=function(a,b,e){this.getUris=a,this.startByte=b,this.endByte=e},shaka.media.InitSegmentReference.prototype.getStartByte=function(){return this.startByte},shaka.media.InitSegmentReference.prototype.getEndByte=function(){return this.endByte},shaka.media.InitSegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},goog.exportSymbol("shaka.media.InitSegmentReference",shaka.media.InitSegmentReference),goog.exportProperty(shaka.media.InitSegmentReference.prototype,"getEndByte",shaka.media.InitSegmentReference.prototype.getEndByte),goog.exportProperty(shaka.media.InitSegmentReference.prototype,"getStartByte",shaka.media.InitSegmentReference.prototype.getStartByte),shaka.media.SegmentReference=function(a,b,e,t,r,n,g,o,l,h){h=void 0===h?[]:h,goog.asserts.assert(a<=b,"startTime must be less than or equal to endTime"),goog.asserts.assert(null==r||t<r,"startByte must be < endByte"),this.startTime=a,this.endTime=b,this.getUris=e,this.startByte=t,this.endByte=r,this.initSegmentReference=n,this.timestampOffset=g,this.appendWindowStart=o,this.appendWindowEnd=l,this.partialReferences=h},shaka.media.SegmentReference.prototype.getStartTime=function(){return this.startTime},shaka.media.SegmentReference.prototype.getEndTime=function(){return this.endTime},shaka.media.SegmentReference.prototype.getStartByte=function(){return this.startByte},shaka.media.SegmentReference.prototype.getEndByte=function(){return this.endByte},shaka.media.SegmentReference.prototype.getSize=function(){return this.endByte?this.endByte-this.startByte:null},shaka.media.SegmentReference.prototype.hasPartialSegments=function(){return 0<this.partialReferences.length},goog.exportSymbol("shaka.media.SegmentReference",shaka.media.SegmentReference),goog.exportProperty(shaka.media.SegmentReference.prototype,"getEndByte",shaka.media.SegmentReference.prototype.getEndByte),goog.exportProperty(shaka.media.SegmentReference.prototype,"getStartByte",shaka.media.SegmentReference.prototype.getStartByte),goog.exportProperty(shaka.media.SegmentReference.prototype,"getEndTime",shaka.media.SegmentReference.prototype.getEndTime),goog.exportProperty(shaka.media.SegmentReference.prototype,"getStartTime",shaka.media.SegmentReference.prototype.getStartTime),shaka.media.PresentationTimeline=function(a,b,e){this.presentationStartTime_=a,this.presentationDelay_=b,this.segmentAvailabilityDuration_=this.duration_=1/0,this.maxSegmentDuration_=1,this.maxSegmentEndTime_=this.minSegmentStartTime_=null,this.clockOffset_=0,this.static_=!0,this.userSeekStart_=0,this.autoCorrectDrift_=void 0===e||e},shaka.media.PresentationTimeline.prototype.getDuration=function(){return this.duration_},shaka.media.PresentationTimeline.prototype.getMaxSegmentDuration=function(){return this.maxSegmentDuration_},shaka.media.PresentationTimeline.prototype.setDuration=function(a){goog.asserts.assert(0<a,"duration must be > 0"),this.duration_=a},shaka.media.PresentationTimeline.prototype.getPresentationStartTime=function(){return this.presentationStartTime_},shaka.media.PresentationTimeline.prototype.setClockOffset=function(a){this.clockOffset_=a},shaka.media.PresentationTimeline.prototype.setStatic=function(a){this.static_=a},shaka.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration=function(a){goog.asserts.assert(0<=a,"segmentAvailabilityDuration must be >= 0"),this.segmentAvailabilityDuration_=a},shaka.media.PresentationTimeline.prototype.setDelay=function(a){goog.asserts.assert(0<=a,"delay must be >= 0"),this.presentationDelay_=a},shaka.media.PresentationTimeline.prototype.getDelay=function(){return this.presentationDelay_},shaka.media.PresentationTimeline.prototype.notifySegments=function(a){if(0!=a.length){var b=a[a.length-1].endTime;this.notifyMinSegmentStartTime(a[0].startTime),this.maxSegmentDuration_=a.reduce((function(a,b){return Math.max(a,b.endTime-b.startTime)}),this.maxSegmentDuration_),this.maxSegmentEndTime_=Math.max(this.maxSegmentEndTime_,b),null!=this.presentationStartTime_&&this.autoCorrectDrift_&&(this.presentationStartTime_=(Date.now()+this.clockOffset_)/1e3-this.maxSegmentEndTime_-this.maxSegmentDuration_),shaka.log.v1("notifySegments:","maxSegmentDuration="+this.maxSegmentDuration_)}},shaka.media.PresentationTimeline.prototype.notifyMinSegmentStartTime=function(a){this.minSegmentStartTime_=null==this.minSegmentStartTime_?a:Math.min(this.minSegmentStartTime_,a)},shaka.media.PresentationTimeline.prototype.notifyMaxSegmentDuration=function(a){this.maxSegmentDuration_=Math.max(this.maxSegmentDuration_,a),shaka.log.v1("notifyNewSegmentDuration:","maxSegmentDuration="+this.maxSegmentDuration_)},shaka.media.PresentationTimeline.prototype.offset=function(a){null!=this.minSegmentStartTime_&&(this.minSegmentStartTime_+=a),null!=this.maxSegmentEndTime_&&(this.maxSegmentEndTime_+=a)},shaka.media.PresentationTimeline.prototype.isLive=function(){return 1/0==this.duration_&&!this.static_},shaka.media.PresentationTimeline.prototype.isInProgress=function(){return 1/0!=this.duration_&&!this.static_},shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityStart=function(){goog.asserts.assert(0<=this.segmentAvailabilityDuration_,"The availability duration should be positive");var a=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return Math.max(this.userSeekStart_,a)},shaka.media.PresentationTimeline.prototype.setUserSeekStart=function(a){this.userSeekStart_=a},shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd=function(){return this.isLive()||this.isInProgress()?Math.min(this.getLiveEdge_(),this.duration_):this.duration_},shaka.media.PresentationTimeline.prototype.getSafeSeekRangeStart=function(a){var b=Math.max(this.minSegmentStartTime_,this.userSeekStart_);if(1/0==this.segmentAvailabilityDuration_)return b;var e=this.getSegmentAvailabilityEnd()-this.segmentAvailabilityDuration_;return a=Math.min(e+a,this.getSeekRangeEnd()),Math.max(b,a)},shaka.media.PresentationTimeline.prototype.getSeekRangeStart=function(){return this.getSafeSeekRangeStart(0)},shaka.media.PresentationTimeline.prototype.getSeekRangeEnd=function(){var a=this.isLive()||this.isInProgress()?this.presentationDelay_:0;return Math.max(0,this.getSegmentAvailabilityEnd()-a)},shaka.media.PresentationTimeline.prototype.usingPresentationStartTime=function(){return!(null==this.presentationStartTime_||null!=this.maxSegmentEndTime_&&this.autoCorrectDrift_)},shaka.media.PresentationTimeline.prototype.getLiveEdge_=function(){goog.asserts.assert(null!=this.presentationStartTime_,"Cannot compute timeline live edge without start time");var a=(Date.now()+this.clockOffset_)/1e3;return Math.max(0,a-this.maxSegmentDuration_-this.presentationStartTime_)},shaka.media.PresentationTimeline.prototype.assertIsValid=function(){goog.DEBUG&&(this.isLive()?goog.asserts.assert(null!=this.presentationStartTime_,"Detected as live stream, but does not match our model of live!"):this.isInProgress()?goog.asserts.assert(null!=this.presentationStartTime_&&1/0==this.segmentAvailabilityDuration_,"Detected as IPR stream, but does not match our model of IPR!"):goog.asserts.assert(1/0==this.segmentAvailabilityDuration_&&1/0!=this.duration_&&this.static_,"Detected as VOD stream, but does not match our model of VOD!"))},goog.exportSymbol("shaka.media.PresentationTimeline",shaka.media.PresentationTimeline),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"usingPresentationStartTime",shaka.media.PresentationTimeline.prototype.usingPresentationStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSeekRangeEnd",shaka.media.PresentationTimeline.prototype.getSeekRangeEnd),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSeekRangeStart",shaka.media.PresentationTimeline.prototype.getSeekRangeStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSafeSeekRangeStart",shaka.media.PresentationTimeline.prototype.getSafeSeekRangeStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSegmentAvailabilityEnd",shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityEnd),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setUserSeekStart",shaka.media.PresentationTimeline.prototype.setUserSeekStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getSegmentAvailabilityStart",shaka.media.PresentationTimeline.prototype.getSegmentAvailabilityStart),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"isInProgress",shaka.media.PresentationTimeline.prototype.isInProgress),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"isLive",shaka.media.PresentationTimeline.prototype.isLive),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"offset",shaka.media.PresentationTimeline.prototype.offset),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifyMaxSegmentDuration",shaka.media.PresentationTimeline.prototype.notifyMaxSegmentDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifyMinSegmentStartTime",shaka.media.PresentationTimeline.prototype.notifyMinSegmentStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"notifySegments",shaka.media.PresentationTimeline.prototype.notifySegments),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getDelay",shaka.media.PresentationTimeline.prototype.getDelay),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setDelay",shaka.media.PresentationTimeline.prototype.setDelay),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setSegmentAvailabilityDuration",shaka.media.PresentationTimeline.prototype.setSegmentAvailabilityDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setStatic",shaka.media.PresentationTimeline.prototype.setStatic),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setClockOffset",shaka.media.PresentationTimeline.prototype.setClockOffset),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getPresentationStartTime",shaka.media.PresentationTimeline.prototype.getPresentationStartTime),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"setDuration",shaka.media.PresentationTimeline.prototype.setDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getMaxSegmentDuration",shaka.media.PresentationTimeline.prototype.getMaxSegmentDuration),goog.exportProperty(shaka.media.PresentationTimeline.prototype,"getDuration",shaka.media.PresentationTimeline.prototype.getDuration),shaka.media.StallDetector=function(a,b){this.implementation_=a,this.wasMakingProgress_=a.shouldBeMakingProgress(),this.value_=a.getPresentationSeconds(),this.lastUpdateSeconds_=a.getWallSeconds(),this.didJump_=!1,this.stallThresholdSeconds_=b,this.onStall_=function(){}},shaka.media.StallDetector.prototype.release=function(){this.implementation_=null,this.onStall_=function(){}},shaka.media.StallDetector.prototype.onStall=function(a){this.onStall_=a},shaka.media.StallDetector.prototype.poll=function(){var a=this.implementation_,b=a.shouldBeMakingProgress(),e=a.getPresentationSeconds(),t=a.getWallSeconds();return this.value_==e&&this.wasMakingProgress_==b||(this.lastUpdateSeconds_=t,this.value_=e,this.wasMakingProgress_=b,this.didJump_=!1),(b=(e=t-this.lastUpdateSeconds_)>=this.stallThresholdSeconds_&&b&&!this.didJump_)&&(this.onStall_(this.value_,e),this.didJump_=!0,this.value_=a.getPresentationSeconds()),b},shaka.media.StallDetector.Implementation=function(){},shaka.media.StallDetector.Implementation.prototype.shouldBeMakingProgress=function(){},shaka.media.StallDetector.Implementation.prototype.getPresentationSeconds=function(){},shaka.media.StallDetector.Implementation.prototype.getWallSeconds=function(){},shaka.media.StallDetector.MediaElementImplementation=function(a){this.mediaElement_=a},shaka.media.StallDetector.MediaElementImplementation.prototype.shouldBeMakingProgress=function(){return!this.mediaElement_.paused&&0!=this.mediaElement_.playbackRate&&0!=this.mediaElement_.buffered.length&&shaka.media.StallDetector.MediaElementImplementation.hasContentFor_(this.mediaElement_.buffered,this.mediaElement_.currentTime)},shaka.media.StallDetector.MediaElementImplementation.prototype.getPresentationSeconds=function(){return this.mediaElement_.currentTime},shaka.media.StallDetector.MediaElementImplementation.prototype.getWallSeconds=function(){return Date.now()/1e3},shaka.media.StallDetector.MediaElementImplementation.hasContentFor_=function(a,b){for(var e=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(a)),t=e.next();!t.done;t=e.next())if(!(b<(t=t.value).start-.1||b>t.end-.5))return!0;return!1},shaka.media.GapJumpingController=function(a,b,e,t,r){var n=this;this.video_=a,this.timeline_=b,this.config_=e,this.onEvent_=r,this.eventManager_=new shaka.util.EventManager,this.seekingEventReceived_=!1,this.prevReadyState_=a.readyState,this.didFireLargeGap_=!1,this.stallDetector_=t,this.hadSegmentAppended_=!1,this.eventManager_.listen(a,"waiting",(function(){return n.onPollGapJump_()})),this.gapJumpTimer_=new shaka.util.Timer((function(){n.onPollGapJump_()})).tickEvery(.25)},shaka.media.GapJumpingController.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),null!=this.gapJumpTimer_&&(this.gapJumpTimer_.stop(),this.gapJumpTimer_=null),this.stallDetector_&&(this.stallDetector_.release(),this.stallDetector_=null),this.video_=this.timeline_=this.onEvent_=null},shaka.media.GapJumpingController.prototype.onSegmentAppended=function(){this.hadSegmentAppended_=!0,this.onPollGapJump_()},shaka.media.GapJumpingController.prototype.onSeeking=function(){this.seekingEventReceived_=!0,this.didFireLargeGap_=this.hadSegmentAppended_=!1},shaka.media.GapJumpingController.prototype.onPollGapJump_=function(){if(0!=this.video_.readyState){if(this.video_.seeking){if(!this.seekingEventReceived_)return}else this.seekingEventReceived_=!1;if(!this.video_.paused&&(this.video_.readyState!=this.prevReadyState_&&(this.didFireLargeGap_=!1,this.prevReadyState_=this.video_.readyState),!this.stallDetector_||!this.stallDetector_.poll())){var a=this.config_.smallGapLimit,b=this.video_.currentTime,e=this.video_.buffered,t=shaka.media.TimeRangesUtils.getGapIndex(e,b);if(null!=t&&(0!=t||this.hadSegmentAppended_)){var r=e.start(t),n=this.timeline_.getSeekRangeEnd();if(!(r>=n)){a=(n=r-b)<=a;var g=!1;if(!(n<shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE)){if(!a&&!this.didFireLargeGap_){this.didFireLargeGap_=!0;var o=new shaka.util.FakeEvent("largegap",{currentTime:b,gapSize:n});o.cancelable=!0,this.onEvent_(o),this.config_.jumpLargeGaps&&!o.defaultPrevented?g=!0:shaka.log.info("Ignoring large gap at",b,"size",n)}(a||g)&&(0==t?shaka.log.info("Jumping forward",n,"seconds because of gap before start time of",r):shaka.log.info("Jumping forward",n,"seconds because of gap starting at",e.end(t-1),"and ending at",r),this.video_.currentTime=r)}}}}}},shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE=.001,shaka.util.MediaReadyState=function(){},shaka.util.MediaReadyState.waitForReadyState=function(a,b,e,t){b==HTMLMediaElement.HAVE_NOTHING||a.readyState>=b?t():(b=shaka.util.MediaReadyState.READY_STATES_TO_EVENT_NAMES_.get(b),e.listenOnce(a,b,t))},shaka.util.MediaReadyState.READY_STATES_TO_EVENT_NAMES_=new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]]),shaka.media.VideoWrapper=function(a,b,e){var t=this;this.video_=a,this.onSeek_=b,this.startTime_=e,this.started_=!1,this.eventManager_=new shaka.util.EventManager,this.mover_=new shaka.media.VideoWrapper.PlayheadMover(a,10),shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){t.setStartTime_(t.startTime_)}))},shaka.media.VideoWrapper.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),null!=this.mover_&&(this.mover_.release(),this.mover_=null),this.onSeek_=function(){},this.video_=null},shaka.media.VideoWrapper.prototype.getTime=function(){return this.started_?this.video_.currentTime:this.startTime_},shaka.media.VideoWrapper.prototype.setTime=function(a){var b=this;0<this.video_.readyState?this.mover_.moveTo(a):shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){b.setStartTime_(b.startTime_)}))},shaka.media.VideoWrapper.prototype.setStartTime_=function(a){var b=this;.001>Math.abs(this.video_.currentTime-a)?this.startListeningToSeeks_():(this.eventManager_.listenOnce(this.video_,"seeking",(function(){b.startListeningToSeeks_()})),this.mover_.moveTo(0==this.video_.currentTime?a:this.video_.currentTime))},shaka.media.VideoWrapper.prototype.startListeningToSeeks_=function(){var a=this;goog.asserts.assert(0<this.video_.readyState,"The media element should be ready before we listen for seeking."),this.started_=!0,this.eventManager_.listen(this.video_,"seeking",(function(){return a.onSeek_()}))},shaka.media.VideoWrapper.PlayheadMover=function(a,b){var e=this;this.mediaElement_=a,this.maxAttempts_=b,this.targetTime_=this.originTime_=this.remainingAttempts_=0,this.timer_=new shaka.util.Timer((function(){return e.onTick_()}))},shaka.media.VideoWrapper.PlayheadMover.prototype.release=function(){this.timer_&&(this.timer_.stop(),this.timer_=null),this.mediaElement_=null},shaka.media.VideoWrapper.PlayheadMover.prototype.moveTo=function(a){this.originTime_=this.mediaElement_.currentTime,this.targetTime_=a,this.remainingAttempts_=this.maxAttempts_,this.mediaElement_.currentTime=a,this.timer_.tickEvery(.1)},shaka.media.VideoWrapper.PlayheadMover.prototype.onTick_=function(){0>=this.remainingAttempts_?(shaka.log.warning(["Failed to move playhead from",this.originTime_,"to",this.targetTime_].join(" ")),this.timer_.stop()):this.mediaElement_.currentTime!=this.originTime_?this.timer_.stop():(this.mediaElement_.currentTime=this.targetTime_,this.remainingAttempts_--)},shaka.media.Playhead=function(){},shaka.media.Playhead.prototype.setStartTime=function(a){},shaka.media.Playhead.prototype.getTime=function(){},shaka.media.Playhead.prototype.notifyOfBufferingChange=function(){},shaka.media.SrcEqualsPlayhead=function(a){var b=this;this.mediaElement_=a,this.started_=!1,this.startTime_=null,this.eventManager_=new shaka.util.EventManager;shaka.util.MediaReadyState.waitForReadyState(this.mediaElement_,HTMLMediaElement.HAVE_CURRENT_DATA,this.eventManager_,(function(){null==b.startTime_?b.started_=!0:(b.eventManager_.listenOnce(b.mediaElement_,"seeking",(function(){b.started_=!0})),b.mediaElement_.currentTime=Math.max(0,b.mediaElement_.currentTime+b.startTime_))}))},shaka.media.SrcEqualsPlayhead.prototype.release=function(){this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),this.mediaElement_=null},shaka.media.SrcEqualsPlayhead.prototype.setStartTime=function(a){this.startTime_=this.started_?this.startTime_:a},shaka.media.SrcEqualsPlayhead.prototype.getTime=function(){return(this.started_?this.mediaElement_.currentTime:this.startTime_)||0},shaka.media.SrcEqualsPlayhead.prototype.notifyOfBufferingChange=function(){},shaka.media.MediaSourcePlayhead=function(a,b,e,t,r,n){var g=this;this.minSeekRange_=3,this.mediaElement_=a,this.timeline_=b.presentationTimeline,this.minBufferTime_=b.minBufferTime||0,this.config_=e,this.onSeek_=r,this.lastCorrectiveSeek_=null,this.gapController_=new shaka.media.GapJumpingController(a,b.presentationTimeline,e,this.createStallDetector_(a,e),n),this.videoWrapper_=new shaka.media.VideoWrapper(a,(function(){return g.onSeeking_()}),this.getStartTime_(t)),this.checkWindowTimer_=new shaka.util.Timer((function(){g.onPollWindow_()})).tickEvery(.25)},shaka.media.MediaSourcePlayhead.prototype.release=function(){this.videoWrapper_&&(this.videoWrapper_.release(),this.videoWrapper_=null),this.gapController_&&(this.gapController_.release(),this.gapController_=null),this.checkWindowTimer_&&(this.checkWindowTimer_.stop(),this.checkWindowTimer_=null),this.mediaElement_=this.videoWrapper_=this.timeline_=this.config_=null,this.onSeek_=function(){}},shaka.media.MediaSourcePlayhead.prototype.setStartTime=function(a){this.videoWrapper_.setTime(a)},shaka.media.MediaSourcePlayhead.prototype.getTime=function(){var a=this.videoWrapper_.getTime();return 0<this.mediaElement_.readyState&&!this.mediaElement_.paused?this.clampTime_(a):a},shaka.media.MediaSourcePlayhead.prototype.getStartTime_=function(a){return null==a?a=1/0>this.timeline_.getDuration()?this.timeline_.getSeekRangeStart():this.timeline_.getSeekRangeEnd():0>a&&(a=this.timeline_.getSeekRangeEnd()+a),this.clampSeekToDuration_(this.clampTime_(a))},shaka.media.MediaSourcePlayhead.prototype.notifyOfBufferingChange=function(){this.gapController_.onSegmentAppended()},shaka.media.MediaSourcePlayhead.prototype.onPollWindow_=function(){if(0!=this.mediaElement_.readyState&&!this.mediaElement_.paused){var a=this.mediaElement_.currentTime,b=this.timeline_.getSeekRangeStart(),e=this.timeline_.getSeekRangeEnd();e-b<this.minSeekRange_&&(b=e-this.minSeekRange_),a<b&&(b=this.reposition_(a),shaka.log.info("Jumping forward "+(b-a)+" seconds to catch up with the seek range."),this.mediaElement_.currentTime=b)}},shaka.media.MediaSourcePlayhead.prototype.onSeeking_=function(){this.gapController_.onSeeking();var a=this.videoWrapper_.getTime(),b=this.reposition_(a);if(Math.abs(b-a)>shaka.media.GapJumpingController.BROWSER_GAP_TOLERANCE){var e=(new Date).getTime()/1e3;if(!this.lastCorrectiveSeek_||this.lastCorrectiveSeek_<e-1)return this.lastCorrectiveSeek_=e,void this.videoWrapper_.setTime(b)}shaka.log.v1("Seek to "+a),this.onSeek_()},shaka.media.MediaSourcePlayhead.prototype.clampSeekToDuration_=function(a){var b=this.timeline_.getDuration();return a>=b?(goog.asserts.assert(0<=this.config_.durationBackoff,"Duration backoff must be non-negative!"),b-this.config_.durationBackoff):a},shaka.media.MediaSourcePlayhead.prototype.reposition_=function(a){goog.asserts.assert(this.config_,"Cannot reposition playhead when it has beeen destroyed");var b=Math.max(this.minBufferTime_,this.config_.rebufferingGoal),e=this.config_.safeSeekOffset,t=this.timeline_.getSeekRangeStart(),r=this.timeline_.getSeekRangeEnd(),n=this.timeline_.getDuration();r-t<this.minSeekRange_&&(t=r-this.minSeekRange_);var g=this.timeline_.getSafeSeekRangeStart(b),o=this.timeline_.getSafeSeekRangeStart(e);return b=this.timeline_.getSafeSeekRangeStart(b+e),a>=n?(shaka.log.v1("Playhead past duration."),this.clampSeekToDuration_(a)):a>r?(shaka.log.v1("Playhead past end."),r):a<t?shaka.media.TimeRangesUtils.isBuffered(this.mediaElement_.buffered,o)?(shaka.log.v1("Playhead before start & start is buffered"),o):(shaka.log.v1("Playhead before start & start is unbuffered"),b):a>=g||shaka.media.TimeRangesUtils.isBuffered(this.mediaElement_.buffered,a)?(shaka.log.v1("Playhead in safe region or in buffered region."),a):(shaka.log.v1("Playhead outside safe region & in unbuffered region."),b)},shaka.media.MediaSourcePlayhead.prototype.clampTime_=function(a){var b=this.timeline_.getSeekRangeStart();return a<b||a>(b=this.timeline_.getSeekRangeEnd())?b:a},shaka.media.MediaSourcePlayhead.prototype.createStallDetector_=function(a,b){if(!b.stallEnabled)return null;var e=b.stallThreshold,t=b.stallSkip;return(e=new shaka.media.StallDetector(new shaka.media.StallDetector.MediaElementImplementation(a),e)).onStall((function(b,e){shaka.log.debug("Stall detected at "+b+" for "+e+" seconds."),t?(shaka.log.debug("Seeking forward "+t+" seconds to break stall."),a.currentTime+=t):(shaka.log.debug("Pausing and unpausing to break stall."),a.pause(),a.play())})),e},shaka.media.IPlayheadObserver=function(){},shaka.media.IPlayheadObserver.prototype.poll=function(a,b){},shaka.media.PlayheadObserverManager=function(a){var b=this;this.mediaElement_=a,this.observers_=new Set,this.pollingLoop_=new shaka.util.Timer((function(){b.pollAllObservers_(!1)})).tickEvery(.25)},shaka.media.PlayheadObserverManager.prototype.release=function(){this.pollingLoop_.stop();for(var a=$jscomp.makeIterator(this.observers_),b=a.next();!b.done;b=a.next())b.value.release();this.observers_.clear()},shaka.media.PlayheadObserverManager.prototype.manage=function(a){this.observers_.add(a)},shaka.media.PlayheadObserverManager.prototype.notifyOfSeek=function(){this.pollAllObservers_(!0)},shaka.media.PlayheadObserverManager.prototype.pollAllObservers_=function(a){for(var b=$jscomp.makeIterator(this.observers_),e=b.next();!e.done;e=b.next())e.value.poll(this.mediaElement_.currentTime,a)},shaka.media.RegionTimeline=function(a){var b=this;this.onAddRegion_=function(a){},this.regions_=new Set,this.getSeekRange_=a,this.filterTimer_=new shaka.util.Timer((function(){b.filterBySeekRange_()})).tickEvery(shaka.media.RegionTimeline.REGION_FILTER_INTERVAL)},shaka.media.RegionTimeline.prototype.release=function(){this.onAddRegion_=function(a){},this.regions_.clear(),this.filterTimer_.stop()},shaka.media.RegionTimeline.prototype.setListeners=function(a){this.onAddRegion_=a},shaka.media.RegionTimeline.prototype.addRegion=function(a){null==this.findSimilarRegion_(a)&&(this.regions_.add(a),this.onAddRegion_(a))},shaka.media.RegionTimeline.prototype.filterBySeekRange_=function(){for(var a=this.getSeekRange_(),b=$jscomp.makeIterator(this.regions_),e=b.next();!e.done;e=b.next())(e=e.value).endTime<a.start&&this.regions_.delete(e)},shaka.media.RegionTimeline.prototype.findSimilarRegion_=function(a){for(var b=$jscomp.makeIterator(this.regions_),e=b.next();!e.done;e=b.next())if((e=e.value).schemeIdUri==a.schemeIdUri&&e.id==a.id&&e.startTime==a.startTime&&e.endTime==a.endTime)return e;return null},shaka.media.RegionTimeline.prototype.regions=function(){return this.regions_},shaka.media.RegionTimeline.REGION_FILTER_INTERVAL=2,shaka.media.RegionObserver=function(a){var b=this;this.timeline_=a,this.oldPosition_=new Map,this.onEnter_=function(a,b){},this.onExit_=function(a,b){},this.onSkip_=function(a,b){};var e=shaka.media.RegionObserver.RelativePosition_;a=e.BEFORE_THE_REGION;var t=e.IN_THE_REGION;e=e.AFTER_THE_REGION,this.rules_=[{weWere:null,weAre:t,invoke:function(a,e){return b.onEnter_(a,e)}},{weWere:a,weAre:t,invoke:function(a,e){return b.onEnter_(a,e)}},{weWere:e,weAre:t,invoke:function(a,e){return b.onEnter_(a,e)}},{weWere:t,weAre:a,invoke:function(a,e){return b.onExit_(a,e)}},{weWere:t,weAre:e,invoke:function(a,e){return b.onExit_(a,e)}},{weWere:a,weAre:e,invoke:function(a,e){return b.onSkip_(a,e)}},{weWere:e,weAre:a,invoke:function(a,e){return b.onSkip_(a,e)}}]},shaka.media.RegionObserver.prototype.release=function(){this.timeline_=null,this.oldPosition_.clear(),this.onEnter_=function(a,b){},this.onExit_=function(a,b){},this.onSkip_=function(a,b){}};shaka.media.RegionObserver.prototype.poll=function(a,b){for(var e=shaka.media.RegionObserver,t=$jscomp.makeIterator(this.timeline_.regions()),r=t.next();!r.done;r=t.next()){r=r.value;var n=this.oldPosition_.get(r),g=e.determinePositionRelativeTo_(r,a);this.oldPosition_.set(r,g);for(var o=$jscomp.makeIterator(this.rules_),l=o.next();!l.done;l=o.next())(l=l.value).weWere==n&&l.weAre==g&&l.invoke(r,b)}},shaka.media.RegionObserver.prototype.setListeners=function(a,b,e){this.onEnter_=a,this.onExit_=b,this.onSkip_=e},shaka.media.RegionObserver.determinePositionRelativeTo_=function(a,b){var e=shaka.media.RegionObserver.RelativePosition_;return b<a.startTime?e.BEFORE_THE_REGION:b>a.endTime?e.AFTER_THE_REGION:e.IN_THE_REGION},shaka.media.RegionObserver.RelativePosition_={BEFORE_THE_REGION:1,IN_THE_REGION:2,AFTER_THE_REGION:3},shaka.media.SegmentIndex=function(a){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(a),this.references=a,this.timer_=null,this.numEvicted=0},shaka.media.SegmentIndex.prototype.destroy=function(){return shaka.Deprecate.deprecateFeature(4,"shaka.media.SegmentIndex","Please use release() instead of destroy()."),this.release(),Promise.resolve()},shaka.media.SegmentIndex.prototype.release=function(){this.references=[],this.timer_&&this.timer_.stop(),this.timer_=null},shaka.media.SegmentIndex.prototype.find=function(a){for(var b=this.references.length-1;0<=b;--b){var e=this.references[b];if(a>=e.startTime&&a<e.endTime)return b+this.numEvicted}return this.references.length&&a<this.references[0].startTime?this.numEvicted:null},shaka.media.SegmentIndex.prototype.get=function(a){return 0==this.references.length||0>(a-=this.numEvicted)||a>=this.references.length?null:this.references[a]},shaka.media.SegmentIndex.prototype.offset=function(a){for(var b=$jscomp.makeIterator(this.references),e=b.next();!e.done;e=b.next())(e=e.value).startTime+=a,e.endTime+=a,e.timestampOffset+=a},shaka.media.SegmentIndex.prototype.merge=function(a){goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(a),a.length&&(this.references=this.references.filter((function(b){return b.startTime<a[0].startTime})),this.references.push.apply(this.references,$jscomp.arrayFromIterable(a)),goog.DEBUG&&shaka.media.SegmentIndex.assertCorrectReferences_(this.references))},shaka.media.SegmentIndex.prototype.evict=function(a){var b=this.references.length;this.references=this.references.filter((function(b){return b.endTime>a})),this.numEvicted+=b-this.references.length},shaka.media.SegmentIndex.prototype.fit=function(a,b){for(goog.asserts.assert(null!=b,"Content duration must be known for static content!"),goog.asserts.assert(1/0!=b,"Content duration must be finite for static content!");this.references.length&&this.references[this.references.length-1].startTime>=b;)this.references.pop();for(;this.references.length&&this.references[0].endTime<=a;)this.references.shift(),this.numEvicted++;if(0!=this.references.length){var e=this.references[this.references.length-1];this.references[this.references.length-1]=new shaka.media.SegmentReference(e.startTime,b,e.getUris,e.startByte,e.endByte,e.initSegmentReference,e.timestampOffset,e.appendWindowStart,e.appendWindowEnd)}},shaka.media.SegmentIndex.prototype.updateEvery=function(a,b){var e=this;goog.asserts.assert(!this.timer_,"SegmentIndex timer already started!"),this.timer_&&this.timer_.stop(),this.timer_=new shaka.util.Timer((function(){var a=b();e.references.push.apply(e.references,$jscomp.arrayFromIterable(a)),0==e.references.length&&(e.timer_.stop(),e.timer_=null)})),this.timer_.tickEvery(a)},shaka.media.SegmentIndex.prototype[Symbol.iterator]=function(){return new shaka.media.SegmentIterator(this)},shaka.media.SegmentIndex.forSingleSegment=function(a,b,e){return a=new shaka.media.SegmentReference(a,a+b,(function(){return e}),0,null,null,a,a,a+b),new shaka.media.SegmentIndex([a])},goog.exportSymbol("shaka.media.SegmentIndex",shaka.media.SegmentIndex),goog.exportProperty(shaka.media.SegmentIndex,"forSingleSegment",shaka.media.SegmentIndex.forSingleSegment),goog.exportProperty(shaka.media.SegmentIndex.prototype,"updateEvery",shaka.media.SegmentIndex.prototype.updateEvery),goog.exportProperty(shaka.media.SegmentIndex.prototype,"fit",shaka.media.SegmentIndex.prototype.fit),goog.exportProperty(shaka.media.SegmentIndex.prototype,"evict",shaka.media.SegmentIndex.prototype.evict),goog.exportProperty(shaka.media.SegmentIndex.prototype,"merge",shaka.media.SegmentIndex.prototype.merge),goog.exportProperty(shaka.media.SegmentIndex.prototype,"offset",shaka.media.SegmentIndex.prototype.offset),goog.exportProperty(shaka.media.SegmentIndex.prototype,"get",shaka.media.SegmentIndex.prototype.get),goog.exportProperty(shaka.media.SegmentIndex.prototype,"find",shaka.media.SegmentIndex.prototype.find),goog.exportProperty(shaka.media.SegmentIndex.prototype,"release",shaka.media.SegmentIndex.prototype.release),goog.exportProperty(shaka.media.SegmentIndex.prototype,"destroy",shaka.media.SegmentIndex.prototype.destroy),goog.DEBUG&&(shaka.media.SegmentIndex.assertCorrectReferences_=function(a){goog.asserts.assert(a.every((function(b,e){if(0==e)return!0;var t=a[e-1];return t.startTime<b.startTime||!(t.startTime>b.startTime)&&t.endTime<=b.endTime})),"SegmentReferences are incorrect")}),shaka.media.SegmentIterator=function(a){this.segmentIndex_=a,this.currentPosition_=(a=this.segmentIndex_.find(0))?a-1:-1,this.currentPartialPosition_=-1},shaka.media.SegmentIterator.prototype.seek=function(a){var b=this.segmentIndex_.find(a);if(null==b)return this.currentPosition_=Math.pow(2,31),null;if(this.currentPosition_=b,(b=this.segmentIndex_.get(this.currentPosition_))&&b.hasPartialSegments())for(var e=b.partialReferences,t=e.length-1;0<=t;--t){var r=e[t];if(a>=r.startTime&&a<r.endTime){this.currentPartialPosition_=t,b=r;break}}return b},shaka.media.SegmentIterator.prototype.current=function(){var a=this.segmentIndex_.get(this.currentPosition_);return a&&a.hasPartialSegments()&&a.getUris().length&&this.currentPartialPosition_>=a.partialReferences.length&&(this.currentPosition_++,this.currentPartialPosition_=0,a=this.segmentIndex_.get(this.currentPosition_)),a&&a.hasPartialSegments()?a.partialReferences[this.currentPartialPosition_]:a},shaka.media.SegmentIterator.prototype.next=function(){var a=this.segmentIndex_.get(this.currentPosition_);return a&&a.hasPartialSegments()?(this.currentPartialPosition_++,a.getUris().length&&this.currentPartialPosition_==a.partialReferences.length&&(this.currentPosition_++,this.currentPartialPosition_=0)):(this.currentPosition_++,this.currentPartialPosition_=0),{value:a=this.current(),done:!a}},goog.exportSymbol("shaka.media.SegmentIterator",shaka.media.SegmentIterator),goog.exportProperty(shaka.media.SegmentIterator.prototype,"next",shaka.media.SegmentIterator.prototype.next),goog.exportProperty(shaka.media.SegmentIterator.prototype,"current",shaka.media.SegmentIterator.prototype.current),goog.exportProperty(shaka.media.SegmentIterator.prototype,"seek",shaka.media.SegmentIterator.prototype.seek),shaka.media.MetaSegmentIndex=function(){shaka.media.SegmentIndex.call(this,[]),this.indexes_=[]},$jscomp.inherits(shaka.media.MetaSegmentIndex,shaka.media.SegmentIndex),shaka.media.MetaSegmentIndex.assertCorrectReferences_=shaka.media.SegmentIndex.assertCorrectReferences_,shaka.media.MetaSegmentIndex.forSingleSegment=shaka.media.SegmentIndex.forSingleSegment,shaka.media.MetaSegmentIndex.prototype.appendSegmentIndex=function(a){this.indexes_.push(a)},shaka.media.MetaSegmentIndex.prototype.clone=function(){var a=new shaka.media.MetaSegmentIndex;return a.indexes_=this.indexes_.slice(),a},shaka.media.MetaSegmentIndex.prototype.release=function(){for(var a=$jscomp.makeIterator(this.indexes_),b=a.next();!b.done;b=a.next())b.value.release();this.indexes_=[]},shaka.media.MetaSegmentIndex.prototype.find=function(a){for(var b=0,e=$jscomp.makeIterator(this.indexes_),t=e.next();!t.done;t=e.next()){var r=(t=t.value).find(a);if(null!=r)return r+b;b+=t.numEvicted+t.references.length}return null},shaka.media.MetaSegmentIndex.prototype.get=function(a){for(var b=0,e=$jscomp.makeIterator(this.indexes_),t=e.next();!t.done;t=e.next()){var r=(t=t.value).get(a-b);if(r)return r;b+=t.numEvicted+t.references.length}return null},shaka.media.MetaSegmentIndex.prototype.offset=function(a){goog.asserts.assert(!1,"offset() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.merge=function(a){goog.asserts.assert(!1,"merge() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.evict=function(a){goog.asserts.assert(!1,"evict() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.fit=function(a,b){goog.asserts.assert(!1,"fit() should not be used in MetaSegmentIndex!")},shaka.media.MetaSegmentIndex.prototype.updateEvery=function(a,b){goog.asserts.assert(!1,"updateEvery() should not be used in MetaSegmentIndex!")},goog.exportSymbol("shaka.media.MetaSegmentIndex",shaka.media.MetaSegmentIndex),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"updateEvery",shaka.media.MetaSegmentIndex.prototype.updateEvery),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"fit",shaka.media.MetaSegmentIndex.prototype.fit),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"evict",shaka.media.MetaSegmentIndex.prototype.evict),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"merge",shaka.media.MetaSegmentIndex.prototype.merge),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"offset",shaka.media.MetaSegmentIndex.prototype.offset),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"get",shaka.media.MetaSegmentIndex.prototype.get),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"find",shaka.media.MetaSegmentIndex.prototype.find),goog.exportProperty(shaka.media.MetaSegmentIndex.prototype,"release",shaka.media.MetaSegmentIndex.prototype.release),shaka.util.DataViewReader=function(a,b){this.dataView_=shaka.util.BufferUtils.toDataView(a),this.littleEndian_=b==shaka.util.DataViewReader.Endianness.LITTLE_ENDIAN,this.position_=0},shaka.util.DataViewReader.prototype.getDataView=function(){return this.dataView_},shaka.util.DataViewReader.prototype.hasMoreData=function(){return this.position_<this.dataView_.byteLength},shaka.util.DataViewReader.prototype.getPosition=function(){return this.position_},shaka.util.DataViewReader.prototype.getLength=function(){return this.dataView_.byteLength},shaka.util.DataViewReader.prototype.readUint8=function(){try{var a=this.dataView_.getUint8(this.position_);return this.position_+=1,a}catch(e){throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint16=function(){try{var a=this.dataView_.getUint16(this.position_,this.littleEndian_);return this.position_+=2,a}catch(e){throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint32=function(){try{var a=this.dataView_.getUint32(this.position_,this.littleEndian_);return this.position_+=4,a}catch(e){throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readInt32=function(){try{var a=this.dataView_.getInt32(this.position_,this.littleEndian_);return this.position_+=4,a}catch(e){throw this.outOfBounds_()}},shaka.util.DataViewReader.prototype.readUint64=function(){try{if(this.littleEndian_)var a=this.dataView_.getUint32(this.position_,!0),b=this.dataView_.getUint32(this.position_+4,!0);else b=this.dataView_.getUint32(this.position_,!1),a=this.dataView_.getUint32(this.position_+4,!1)}catch(e){throw this.outOfBounds_()}if(2097151<b)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);return this.position_+=8,b*Math.pow(2,32)+a},shaka.util.DataViewReader.prototype.readBytes=function(a){if(goog.asserts.assert(0<=a,"Bad call to DataViewReader.readBytes"),this.position_+a>this.dataView_.byteLength)throw this.outOfBounds_();var b=shaka.util.BufferUtils.toUint8(this.dataView_,this.position_,a);return this.position_+=a,b},shaka.util.DataViewReader.prototype.skip=function(a){if(goog.asserts.assert(0<=a,"Bad call to DataViewReader.skip"),this.position_+a>this.dataView_.byteLength)throw this.outOfBounds_();this.position_+=a},shaka.util.DataViewReader.prototype.rewind=function(a){if(goog.asserts.assert(0<=a,"Bad call to DataViewReader.rewind"),this.position_<a)throw this.outOfBounds_();this.position_-=a},shaka.util.DataViewReader.prototype.seek=function(a){if(goog.asserts.assert(0<=a,"Bad call to DataViewReader.seek"),0>a||a>this.dataView_.byteLength)throw this.outOfBounds_();this.position_=a},shaka.util.DataViewReader.prototype.readTerminatedString=function(){for(var a=this.position_;this.hasMoreData()&&0!=this.dataView_.getUint8(this.position_);)this.position_+=1;return a=shaka.util.BufferUtils.toUint8(this.dataView_,a,this.position_-a),this.position_+=1,shaka.util.StringUtils.fromUTF8(a)},shaka.util.DataViewReader.prototype.outOfBounds_=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.BUFFER_READ_OUT_OF_BOUNDS)},goog.exportSymbol("shaka.util.DataViewReader",shaka.util.DataViewReader),goog.exportProperty(shaka.util.DataViewReader.prototype,"readTerminatedString",shaka.util.DataViewReader.prototype.readTerminatedString),goog.exportProperty(shaka.util.DataViewReader.prototype,"seek",shaka.util.DataViewReader.prototype.seek),goog.exportProperty(shaka.util.DataViewReader.prototype,"rewind",shaka.util.DataViewReader.prototype.rewind),goog.exportProperty(shaka.util.DataViewReader.prototype,"skip",shaka.util.DataViewReader.prototype.skip),goog.exportProperty(shaka.util.DataViewReader.prototype,"readBytes",shaka.util.DataViewReader.prototype.readBytes),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint64",shaka.util.DataViewReader.prototype.readUint64),goog.exportProperty(shaka.util.DataViewReader.prototype,"readInt32",shaka.util.DataViewReader.prototype.readInt32),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint32",shaka.util.DataViewReader.prototype.readUint32),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint16",shaka.util.DataViewReader.prototype.readUint16),goog.exportProperty(shaka.util.DataViewReader.prototype,"readUint8",shaka.util.DataViewReader.prototype.readUint8),goog.exportProperty(shaka.util.DataViewReader.prototype,"getLength",shaka.util.DataViewReader.prototype.getLength),goog.exportProperty(shaka.util.DataViewReader.prototype,"getPosition",shaka.util.DataViewReader.prototype.getPosition),goog.exportProperty(shaka.util.DataViewReader.prototype,"hasMoreData",shaka.util.DataViewReader.prototype.hasMoreData),shaka.util.DataViewReader.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:1},goog.exportProperty(shaka.util.DataViewReader,"Endianness",shaka.util.DataViewReader.Endianness),shaka.util.Mp4Parser=function(){this.headers_=[],this.boxDefinitions_=[],this.done_=!1},shaka.util.Mp4Parser.prototype.box=function(a,b){var e=shaka.util.Mp4Parser.typeFromString_(a);return this.headers_[e]=shaka.util.Mp4Parser.BoxType_.BASIC_BOX,this.boxDefinitions_[e]=b,this},shaka.util.Mp4Parser.prototype.fullBox=function(a,b){var e=shaka.util.Mp4Parser.typeFromString_(a);return this.headers_[e]=shaka.util.Mp4Parser.BoxType_.FULL_BOX,this.boxDefinitions_[e]=b,this},shaka.util.Mp4Parser.prototype.stop=function(){this.done_=!0},shaka.util.Mp4Parser.prototype.parse=function(a,b){var e=new shaka.util.DataViewReader(a,shaka.util.DataViewReader.Endianness.BIG_ENDIAN);for(this.done_=!1;e.hasMoreData()&&!this.done_;)this.parseNext(0,e,b)},shaka.util.Mp4Parser.prototype.parseNext=function(a,b,e){var t=b.getPosition(),r=b.readUint32(),n=b.readUint32(),g=shaka.util.Mp4Parser.typeToString(n);switch(shaka.log.v2("Parsing MP4 box",g),r){case 0:r=b.getLength()-t;break;case 1:r=b.readUint64()}if(g=this.boxDefinitions_[n]){var o=null,l=null;this.headers_[n]==shaka.util.Mp4Parser.BoxType_.FULL_BOX&&(o=(l=b.readUint32())>>>24,l&=16777215),n=t+r,e&&n>b.getLength()&&(n=b.getLength()),n-=b.getPosition(),b=0<n?b.readBytes(n):new Uint8Array(0),g({parser:this,partialOkay:e||!1,version:o,flags:l,reader:b=new shaka.util.DataViewReader(b,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),size:r,start:t+a})}else a=Math.min(t+r-b.getPosition(),b.getLength()-b.getPosition()),b.skip(a)},shaka.util.Mp4Parser.children=function(a){for(var b=null!=a.flags?12:8;a.reader.hasMoreData()&&!a.parser.done_;)a.parser.parseNext(a.start+b,a.reader,a.partialOkay)},shaka.util.Mp4Parser.sampleDescription=function(a){for(var b=null!=a.flags?12:8,e=a.reader.readUint32(),t=(e=$jscomp.makeIterator(shaka.util.Iterables.range(e))).next();!t.done&&(shaka.util.Functional.ignored(t.value),a.parser.parseNext(a.start+b,a.reader,a.partialOkay),!a.parser.done_);t=e.next());},shaka.util.Mp4Parser.allData=function(a){return function(b){var e=b.reader.getLength()-b.reader.getPosition();a(b.reader.readBytes(e))}},shaka.util.Mp4Parser.typeFromString_=function(a){goog.asserts.assert(4==a.length,"Mp4 box names must be 4 characters long");for(var b=0,e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next())b=b<<8|e.value.charCodeAt(0);return b},shaka.util.Mp4Parser.typeToString=function(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)},goog.exportSymbol("shaka.util.Mp4Parser",shaka.util.Mp4Parser),goog.exportProperty(shaka.util.Mp4Parser,"typeToString",shaka.util.Mp4Parser.typeToString),goog.exportProperty(shaka.util.Mp4Parser,"allData",shaka.util.Mp4Parser.allData),goog.exportProperty(shaka.util.Mp4Parser,"sampleDescription",shaka.util.Mp4Parser.sampleDescription),goog.exportProperty(shaka.util.Mp4Parser,"children",shaka.util.Mp4Parser.children),goog.exportProperty(shaka.util.Mp4Parser.prototype,"parseNext",shaka.util.Mp4Parser.prototype.parseNext),goog.exportProperty(shaka.util.Mp4Parser.prototype,"parse",shaka.util.Mp4Parser.prototype.parse),goog.exportProperty(shaka.util.Mp4Parser.prototype,"stop",shaka.util.Mp4Parser.prototype.stop),goog.exportProperty(shaka.util.Mp4Parser.prototype,"fullBox",shaka.util.Mp4Parser.prototype.fullBox),goog.exportProperty(shaka.util.Mp4Parser.prototype,"box",shaka.util.Mp4Parser.prototype.box),shaka.util.Mp4Parser.BoxType_={BASIC_BOX:0,FULL_BOX:1},shaka.util.Networking=function(){},shaka.util.Networking.createSegmentRequest=function(a,b,e,t){return a=shaka.net.NetworkingEngine.makeRequest(a,t),0==b&&null==e||(a.headers.Range=e?"bytes="+b+"-"+e:"bytes="+b+"-"),a},shaka.media.StreamingEngine=function(a,b){var e=this;this.playerInterface_=b,this.manifest_=a,this.config_=null,this.bufferingGoalScale_=1,this.currentTextStream_=this.currentVariant_=null,this.mediaStates_=new Map,this.startupComplete_=!1,this.failureCallbackBackoff_=null,this.fatalError_=!1,this.destroyer_=new shaka.util.Destroyer((function(){return e.doDestroy_()}))},shaka.media.StreamingEngine.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.media.StreamingEngine.prototype.doDestroy_=function(){var b,e,t,r,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){if(1==n.nextAddress){for(b=[],e=$jscomp.makeIterator(a.mediaStates_.values()),t=e.next();!t.done;t=e.next())r=t.value,a.cancelUpdate_(r),b.push(a.abortOperations_(r));return n.yield(Promise.all(b),2)}a.mediaStates_.clear(),a.playerInterface_=null,a.manifest_=null,a.config_=null,n.jumpToEnd()}))},shaka.media.StreamingEngine.prototype.configure=function(a){this.config_=a,this.failureCallbackBackoff_=new shaka.net.Backoff({maxAttempts:Math.max(a.retryParameters.maxAttempts,2),baseDelay:a.retryParameters.baseDelay,backoffFactor:a.retryParameters.backoffFactor,fuzzFactor:a.retryParameters.fuzzFactor,timeout:0},!0)},shaka.media.StreamingEngine.prototype.start=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){if(1==b.nextAddress)return goog.asserts.assert(a.config_,"StreamingEngine configure() must be called before init()!"),b.yield(a.initStreams_(),2);a.destroyer_.ensureNotDestroyed(),shaka.log.debug("init: completed initial Stream setup"),a.startupComplete_=!0,b.jumpToEnd()}))},shaka.media.StreamingEngine.prototype.getCurrentVariant=function(){return this.currentVariant_},shaka.media.StreamingEngine.prototype.getCurrentTextStream=function(){return this.currentTextStream_},shaka.media.StreamingEngine.prototype.loadNewTextStream_=function(a){var e,t,r,n,o,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){switch(l.nextAddress){case 1:return e=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(!b.mediaStates_.has(e.TEXT),"Should not call loadNewTextStream_ while streaming text!"),l.setCatchFinallyBlocks(2),l.yield(b.playerInterface_.mediaSourceEngine.clear(e.TEXT),4);case 4:l.leaveTryBlock(3);break;case 2:t=l.enterCatchBlock(),b.playerInterface_&&b.playerInterface_.onError(t);case 3:r=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs),b.playerInterface_.mediaSourceEngine.reinitText(r),n=b.playerInterface_.mediaSourceEngine.getTextDisplayer(),(n.isTextVisible()||b.config_.alwaysStreamText)&&(o=b.createMediaState_(a),b.mediaStates_.set(e.TEXT,o),b.scheduleUpdate_(o,0)),l.jumpToEnd()}}))},shaka.media.StreamingEngine.prototype.unloadTextStream=function(){var a=shaka.util.ManifestParserUtils.ContentType,b=this.mediaStates_.get(a.TEXT);b&&(this.cancelUpdate_(b),this.abortOperations_(b).catch((function(){})),this.mediaStates_.delete(a.TEXT)),this.currentTextStream_=null},shaka.media.StreamingEngine.prototype.setTrickPlay=function(a){var b=this.mediaStates_.get(shaka.util.ManifestParserUtils.ContentType.VIDEO);if(b){var e=b.stream;e&&(shaka.log.debug("setTrickPlay",a),a?(a=e.trickModeVideo)&&!b.restoreStreamAfterTrickPlay&&(shaka.log.debug("Engaging trick mode stream",a),this.switchInternal_(a,!1,0,!1),b.restoreStreamAfterTrickPlay=e):(e=b.restoreStreamAfterTrickPlay)&&(shaka.log.debug("Restoring non-trick-mode stream",e),b.restoreStreamAfterTrickPlay=null,this.switchInternal_(e,!0,0,!1)))}},shaka.media.StreamingEngine.prototype.switchVariant=function(a,b,e){b=void 0!==b&&b,e=void 0===e?0:e,this.currentVariant_=a,this.startupComplete_&&(a.video&&this.switchInternal_(a.video,b,e,!1),a.audio&&this.switchInternal_(a.audio,b,e,!1))},shaka.media.StreamingEngine.prototype.switchTextStream=function(a){if(this.currentTextStream_=a,this.startupComplete_){var b=shaka.util.ManifestParserUtils.ContentType;goog.asserts.assert(a&&a.type==b.TEXT,"Wrong stream type passed to switchTextStream!"),this.switchInternal_(a,!0,0,!1)}},shaka.media.StreamingEngine.prototype.reloadTextStream=function(){var a=this.mediaStates_.get(shaka.util.ManifestParserUtils.ContentType.TEXT);a&&this.switchInternal_(a.stream,!0,0,!0)},shaka.media.StreamingEngine.prototype.switchInternal_=function(a,b,e,t){var r=this,n=shaka.util.ManifestParserUtils.ContentType,g=this.mediaStates_.get(a.type);g||a.type!=n.TEXT?(goog.asserts.assert(g,"switch: expected mediaState to exist"),g&&(g.restoreStreamAfterTrickPlay&&(shaka.log.debug("switch during trick play mode",a),a.trickModeVideo?(g.restoreStreamAfterTrickPlay=a,a=a.trickModeVideo,shaka.log.debug("switch found trick play stream",a)):(g.restoreStreamAfterTrickPlay=null,shaka.log.debug("switch found no special trick play stream"))),g.stream!=a||t?(a.type==n.TEXT&&(t=shaka.util.MimeUtils.getFullType(a.mimeType,a.codecs),this.playerInterface_.mediaSourceEngine.reinitText(t)),g.stream=a,g.segmentIterator=g.stream.segmentIndex?g.stream.segmentIndex[Symbol.iterator]():null,a=shaka.media.StreamingEngine.logPrefix_(g),shaka.log.debug("switch: switching to Stream "+a),b&&(g.clearingBuffer?g.waitingToFlushBuffer=!0:g.performingUpdate?(g.waitingToClearBuffer=!0,g.clearBufferSafeMargin=e,g.waitingToFlushBuffer=!0):(this.cancelUpdate_(g),this.clearBuffer_(g,!0,e).catch((function(a){r.playerInterface_&&(goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type!"),r.playerInterface_.onError(a))})))),this.makeAbortDecision_(g).catch((function(a){r.playerInterface_&&(goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type!"),r.playerInterface_.onError(a))}))):(b=shaka.media.StreamingEngine.logPrefix_(g),shaka.log.debug("switch: Stream "+b+" already active")))):this.loadNewTextStream_(a)},shaka.media.StreamingEngine.prototype.makeAbortDecision_=function(a){var e,t,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(r){return 1==r.nextAddress?a.operation?(e=a.stream,t=a.operation,e.segmentIndex?r.jumpTo(2):r.yield(e.createSegmentIndex(),2)):r.return():a.operation!=t||a.stream!=e?r.return():(a.segmentIterator=a.stream.segmentIndex[Symbol.iterator](),b.shouldAbortCurrentRequest_(a)&&(shaka.log.info("Aborting current segment request."),a.operation.abort()),void r.jumpToEnd())}))},shaka.media.StreamingEngine.prototype.shouldAbortCurrentRequest_=function(a){goog.asserts.assert(a.operation,"Abort logic requires an ongoing operation!");var b=this.playerInterface_.getPresentationTime(),e=this.playerInterface_.mediaSourceEngine.bufferEnd(a.type),t=this.getSegmentReferenceNeeded_(a,b,e),r=t?t.getSize():null;return t&&!r&&(r=(t.getEndTime()-t.getStartTime())*(a.stream.bandwidth||0)/8),!!r&&((t=t.initSegmentReference)&&(r+=t.getSize()||0),8*r/(t=this.playerInterface_.getBandwidthEstimate())<(e||0)-b-Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal)||a.operation.getBytesRemaining()>r)},shaka.media.StreamingEngine.prototype.seeked=function(){for(var a=this.playerInterface_.getPresentationTime(),b=this.config_.smallGapLimit,e=shaka.util.ManifestParserUtils.ContentType,t=!1,r=$jscomp.makeIterator(this.mediaStates_.keys()),n=r.next();!n.done;n=r.next())n=n.value,null==this.playerInterface_.mediaSourceEngine.bufferEnd(n)||this.playerInterface_.mediaSourceEngine.isBuffered(n,a,b)||(this.forceClearBuffer_(this.mediaStates_.get(n)),n===e.TEXT&&this.playerInterface_.mediaSourceEngine.resetCaptionParser(),t=!0);t||shaka.log.debug("(all): seeked: buffered seek: presentationTime="+a)},shaka.media.StreamingEngine.prototype.forceClearBuffer_=function(a){var b=this,e=shaka.media.StreamingEngine.logPrefix_(a);a.clearingBuffer?shaka.log.debug(e,"clear: already clearing the buffer"):a.waitingToClearBuffer?shaka.log.debug(e,"clear: already waiting"):a.performingUpdate?(shaka.log.debug(e,"clear: currently updating"),a.waitingToClearBuffer=!0,a.clearBufferSafeMargin=0):null==this.playerInterface_.mediaSourceEngine.bufferStart(a.type)?(shaka.log.debug(e,"clear: nothing buffered"),null==a.updateTimer&&this.scheduleUpdate_(a,0)):(shaka.log.debug(e,"clear: handling right now"),this.cancelUpdate_(a),this.clearBuffer_(a,!1,0).catch((function(a){b.playerInterface_&&(goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type!"),b.playerInterface_.onError(a))})))},shaka.media.StreamingEngine.prototype.initStreams_=function(){var b,e,t,r,n,g,o,l,h,d,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(c){if(1==c.nextAddress){if(b=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(a.config_,"StreamingEngine configure() must be called before init()!"),!a.currentVariant_)throw shaka.log.error("init: no Streams chosen"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STREAMING,shaka.util.Error.Code.STREAMING_ENGINE_STARTUP_INVALID_STATE);return e=new Map,t=new Set,a.currentVariant_.audio&&(e.set(b.AUDIO,a.currentVariant_.audio),t.add(a.currentVariant_.audio)),a.currentVariant_.video&&(e.set(b.VIDEO,a.currentVariant_.video),t.add(a.currentVariant_.video)),a.currentTextStream_&&(e.set(b.TEXT,a.currentTextStream_),t.add(a.currentTextStream_)),r=a.playerInterface_.mediaSourceEngine,n=a.config_.forceTransmuxTS,c.yield(r.init(e,n),2)}for(a.destroyer_.ensureNotDestroyed(),a.setDuration_(),g=$jscomp.makeIterator(e.keys()),o=g.next();!o.done;o=g.next())l=o.value,h=e.get(l),a.mediaStates_.has(l)||(d=a.createMediaState_(h),a.mediaStates_.set(l,d),a.scheduleUpdate_(d,0));c.jumpToEnd()}))},shaka.media.StreamingEngine.prototype.createMediaState_=function(a){var b=a.segmentIndex?a.segmentIndex[Symbol.iterator]():null;return{stream:a,type:a.type,lastStream:null,segmentIterator:b,lastSegmentReference:null,lastInitSegmentReference:null,lastTimestampOffset:null,lastAppendWindowStart:null,lastAppendWindowEnd:null,restoreStreamAfterTrickPlay:null,endOfStream:!1,performingUpdate:!1,updateTimer:null,waitingToClearBuffer:!1,clearBufferSafeMargin:0,waitingToFlushBuffer:!1,clearingBuffer:!1,recovering:!1,hasError:!1,operation:null}},shaka.media.StreamingEngine.prototype.setDuration_=function(){var a=this.manifest_.presentationTimeline.getDuration();1/0>a?this.playerInterface_.mediaSourceEngine.setDuration(a):this.playerInterface_.mediaSourceEngine.setDuration(Math.pow(2,32))},shaka.media.StreamingEngine.prototype.onUpdate_=function(a){var e,t,r,n,g,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){switch(o.nextAddress){case 1:if(b.destroyer_.ensureNotDestroyed(),e=shaka.media.StreamingEngine.logPrefix_(a),goog.asserts.assert(!a.performingUpdate&&null!=a.updateTimer,e+" unexpected call to onUpdate_()"),a.performingUpdate||null==a.updateTimer)return o.return();if(goog.asserts.assert(!a.clearingBuffer,e+" onUpdate_() should not be called when clearing the buffer"),a.clearingBuffer)return o.return();if(a.updateTimer=null,!a.waitingToClearBuffer){o.jumpTo(2);break}return shaka.log.debug(e,"skipping update and clearing the buffer"),o.yield(b.clearBuffer_(a,a.waitingToFlushBuffer,a.clearBufferSafeMargin),3);case 3:return o.return();case 2:if(a.stream.segmentIndex){o.jumpTo(4);break}return t=a.stream,o.yield(a.stream.createSegmentIndex(),5);case 5:if(t!=a.stream)return null==a.updateTimer&&b.scheduleUpdate_(a,0),o.return();shaka.media.StreamingEngine.isEmbeddedText_(a)||(goog.asserts.assert(a.stream.segmentIndex,"Segment index should exist by now!"),a.segmentIterator=a.stream.segmentIndex[Symbol.iterator]());case 4:try{null!=(r=b.update_(a))&&(b.scheduleUpdate_(a,r),a.hasError=!1)}catch(e){return b.handleStreamingError_(e),o.return()}if(n=Array.from(b.mediaStates_.values()),!b.startupComplete_||!n.every((function(a){return a.endOfStream}))){o.jumpTo(0);break}return shaka.log.v1(e,"calling endOfStream()..."),o.yield(b.playerInterface_.mediaSourceEngine.endOfStream(),7);case 7:b.destroyer_.ensureNotDestroyed(),0!=(g=b.playerInterface_.mediaSourceEngine.getDuration())&&g<b.manifest_.presentationTimeline.getDuration()&&b.manifest_.presentationTimeline.setDuration(g),o.jumpToEnd()}}))},shaka.media.StreamingEngine.prototype.update_=function(a){goog.asserts.assert(this.manifest_,"manifest_ should not be null"),goog.asserts.assert(this.config_,"config_ should not be null");var b=shaka.util.ManifestParserUtils.ContentType;if(shaka.media.StreamingEngine.isEmbeddedText_(a))return this.playerInterface_.mediaSourceEngine.setSelectedClosedCaptionId(a.stream.originalId||""),null;var e=shaka.media.StreamingEngine.logPrefix_(a),t=this.playerInterface_.getPresentationTime(),r=this.getTimeNeeded_(a,t);shaka.log.v2(e,"timeNeeded="+r);var n=this.playerInterface_.mediaSourceEngine.bufferedAheadOf(a.type,t);shaka.log.v2(e,"update_:","presentationTime="+t,"bufferedAhead="+n);var g=Math.max(this.manifest_.minBufferTime||0,this.config_.rebufferingGoal,this.config_.bufferingGoal)*this.bufferingGoalScale_;if(r>=this.manifest_.presentationTimeline.getDuration())return shaka.log.debug(e,"buffered to end of presentation"),a.endOfStream=!0,a.type==b.VIDEO&&(a=this.mediaStates_.get(b.TEXT))&&shaka.media.StreamingEngine.isEmbeddedText_(a)&&(a.endOfStream=!0),null;if(a.endOfStream=!1,n>=g)return shaka.log.v2(e,"buffering goal met"),.5;if(b=this.playerInterface_.mediaSourceEngine.bufferEnd(a.type),!(b=this.getSegmentReferenceNeeded_(a,t,b))||!this.isSegmentReferenceAvailable_(a,b))return 1;for(e=1/0,n=Array.from(this.mediaStates_.values()),g=(n=$jscomp.makeIterator(n)).next();!g.done;g=n.next())g=g.value,shaka.media.StreamingEngine.isEmbeddedText_(g)||(g=this.getTimeNeeded_(g,t),e=Math.min(e,g));return r>=e+(n=this.manifest_.presentationTimeline.getMaxSegmentDuration()*shaka.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_)?1:(this.fetchAndAppend_(a,t,b).catch((function(){})),null)},shaka.media.StreamingEngine.prototype.getTimeNeeded_=function(a,b){return a.lastStream&&a.lastSegmentReference?a.lastSegmentReference.endTime:b},shaka.media.StreamingEngine.prototype.getSegmentReferenceNeeded_=function(a,b,e){var t=shaka.media.StreamingEngine.logPrefix_(a);if(a.stream==a.lastStream)return a.segmentIterator.current();if(a.lastSegmentReference)return goog.asserts.assert(a.lastStream,"lastStream should not be null"),shaka.log.v1(t,"looking up segment from new stream","endTime:",a.lastSegmentReference.endTime),null==(b=a.segmentIterator.seek(a.lastSegmentReference.endTime))&&shaka.log.warning(t,"cannot find segment","endTime:",a.lastSegmentReference.endTime),b;if(e)return goog.asserts.assert(!a.lastStream,"lastStream should be null"),shaka.log.v1(t,"looking up segment","bufferEnd:",e),null==(a=a.segmentIterator.seek(e))&&shaka.log.warning(t,"cannot find segment","bufferEnd:",e),a;goog.asserts.assert(!a.lastStream,"lastStream should be null"),e=this.config_.inaccurateManifestTolerance;var r=Math.max(b-e,0);shaka.log.v1(t,"looking up segment","lookupTime:",r,"presentationTime:",b);var n=null;return e&&(n=a.segmentIterator.seek(r)),n&&this.isSegmentReferenceAvailable_(a,n)||(n=a.segmentIterator.seek(b)),null==n&&shaka.log.warning(t,"cannot find segment","lookupTime:",r,"presentationTime:",b),n},shaka.media.StreamingEngine.prototype.isSegmentReferenceAvailable_=function(a,b){var e=shaka.media.StreamingEngine.logPrefix_(a),t=this.manifest_.presentationTimeline,r=t.getSegmentAvailabilityStart();return t=t.getSegmentAvailabilityEnd(),!(b.endTime<r||b.startTime>t)||(shaka.log.v2(e,"segment is not available:","reference.startTime="+b.startTime,"reference.endTime="+b.endTime,"availabilityStart="+r,"availabilityEnd="+t),!1)},shaka.media.StreamingEngine.prototype.fetchAndAppend_=function(a,b,e){var t,r,g,n,o,l,h,d,p,q,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(m){switch(m.nextAddress){case 1:return t=shaka.util.ManifestParserUtils.ContentType,r=shaka.media.StreamingEngine,g=r.logPrefix_(a),shaka.log.v1(g,"fetchAndAppend_:","presentationTime="+b,"reference.startTime="+e.startTime,"reference.endTime="+e.endTime),n=a.stream,a.performingUpdate=!0,o=c.initSourceBuffer_(a,e),shaka.log.v2(g,"fetching segment"),l=c.fetch_(a,e),m.setCatchFinallyBlocks(2),m.yield(Promise.all([o,l]),4);case 4:return h=m.yieldResult,c.destroyer_.ensureNotDestroyed(),c.fatalError_?m.return():m.yield(c.append_(a,b,n,e,h[1]),5);case 5:if(c.destroyer_.ensureNotDestroyed(),c.fatalError_)return m.return();a.performingUpdate=!1,a.recovering=!1,d=c.playerInterface_.mediaSourceEngine.getBufferedInfo(),p=d[a.type],shaka.log.v1(g,"finished fetch and append",JSON.stringify(p)),a.waitingToClearBuffer||c.playerInterface_.onSegmentAppended(),c.scheduleUpdate_(a,0),m.leaveTryBlock(0);break;case 2:if(q=m.enterCatchBlock(),c.destroyer_.ensureNotDestroyed(q),c.fatalError_)return m.return();goog.asserts.assert(q instanceof shaka.util.Error,"Should only receive a Shaka error"),a.performingUpdate=!1,a.type==t.TEXT&&c.config_.ignoreTextStreamFailures?(q.code==shaka.util.Error.Code.BAD_HTTP_STATUS?shaka.log.warning(g,"Text stream failed to download. Proceeding without it."):shaka.log.warning(g,"Text stream failed to parse. Proceeding without it."),c.mediaStates_.delete(t.TEXT)):q.code==shaka.util.Error.Code.OPERATION_ABORTED?(a.performingUpdate=!1,a.updateTimer=null,c.scheduleUpdate_(a,0)):q.code==shaka.util.Error.Code.QUOTA_EXCEEDED_ERROR?c.handleQuotaExceeded_(a,q):(shaka.log.error(g,"failed fetch and append: code="+q.code),a.hasError=!0,q.severity=shaka.util.Error.Severity.CRITICAL,c.handleStreamingError_(q)),m.jumpToEnd()}}))},shaka.media.StreamingEngine.prototype.retry=function(){if(this.destroyer_.destroyed())return shaka.log.error("Unable to retry after StreamingEngine is destroyed!"),!1;if(this.fatalError_)return shaka.log.error("Unable to retry after StreamingEngine encountered a fatal error!"),!1;for(var a=$jscomp.makeIterator(this.mediaStates_.values()),b=a.next();!b.done;b=a.next()){b=b.value;var e=shaka.media.StreamingEngine.logPrefix_(b);b.hasError&&(shaka.log.info(e,"Retrying after failure..."),b.hasError=!1,this.scheduleUpdate_(b,.1))}return!0},shaka.media.StreamingEngine.prototype.handleQuotaExceeded_=function(a,b){var e=shaka.media.StreamingEngine.logPrefix_(a);if(Array.from(this.mediaStates_.values()).some((function(b){return b!=a&&b.recovering})))shaka.log.debug(e,"MediaSource threw QuotaExceededError:","waiting for another stream to recover...");else{var t=Math.round(100*this.bufferingGoalScale_);if(20<t)this.bufferingGoalScale_-=.2;else{if(!(4<t))return shaka.log.error(e,"MediaSource threw QuotaExceededError too many times"),this.fatalError_=a.hasError=!0,void this.playerInterface_.onError(b);this.bufferingGoalScale_-=.04}shaka.log.warning(e,"MediaSource threw QuotaExceededError:","reducing buffering goals by "+(100-Math.round(100*this.bufferingGoalScale_))+"%"),a.recovering=!0}this.scheduleUpdate_(a,4)},shaka.media.StreamingEngine.prototype.initSourceBuffer_=function(a,b){var e,t,r,g,n,o,l,h,d,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(p){return e=shaka.media.StreamingEngine,t=e.logPrefix_(a),r=[],g=Math.max(0,b.appendWindowStart-e.APPEND_WINDOW_START_FUDGE_),n=b.appendWindowEnd+e.APPEND_WINDOW_END_FUDGE_,goog.asserts.assert(b.startTime<=n,t+" segment should start before append window end"),(o=b.timestampOffset)==a.lastTimestampOffset&&g==a.lastAppendWindowStart&&n==a.lastAppendWindowEnd||(shaka.log.v1(t,"setting timestamp offset to "+o),shaka.log.v1(t,"setting append window start to "+g),shaka.log.v1(t,"setting append window end to "+n),l=function(){var b;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){if(1==e.nextAddress)return e.setCatchFinallyBlocks(2),a.lastAppendWindowStart=g,a.lastAppendWindowEnd=n,a.lastTimestampOffset=o,e.yield(c.playerInterface_.mediaSourceEngine.setStreamProperties(a.type,o,g,n),4);if(2!=e.nextAddress)return e.leaveTryBlock(0);throw b=e.enterCatchBlock(),a.lastAppendWindowStart=null,a.lastAppendWindowEnd=null,a.lastTimestampOffset=null,b}))},r.push(l())),b.initSegmentReference!=a.lastInitSegmentReference&&(a.lastInitSegmentReference=b.initSegmentReference)&&(shaka.log.v1(t,"fetching init segment"),h=c.fetch_(a,b.initSegmentReference),d=function(){var b,e,r;return $jscomp.asyncExecutePromiseGeneratorProgram((function(g){switch(g.nextAddress){case 1:return g.setCatchFinallyBlocks(2),g.yield(h,4);case 4:return b=g.yieldResult,c.destroyer_.ensureNotDestroyed(),shaka.log.v1(t,"appending init segment"),e=a.stream.closedCaptions&&0<a.stream.closedCaptions.size,g.yield(c.playerInterface_.mediaSourceEngine.appendBuffer(a.type,b,null,null,e),5);case 5:g.leaveTryBlock(0);break;case 2:throw r=g.enterCatchBlock(),a.lastInitSegmentReference=null,r}}))},r.push(d())),p.yield(Promise.all(r),0)}))},shaka.media.StreamingEngine.prototype.append_=function(a,b,e,t,r){var g,n,o,l=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(h){return 1==h.nextAddress?(g=shaka.media.StreamingEngine.logPrefix_(a),n=e.closedCaptions&&0<e.closedCaptions.size,null!=e.emsgSchemeIdUris&&0<e.emsgSchemeIdUris.length&&(new shaka.util.Mp4Parser).fullBox("emsg",(function(a){return l.parseEMSG_(t,e.emsgSchemeIdUris,a)})).parse(r),h.yield(l.evict_(a,b),2)):3!=h.nextAddress?(l.destroyer_.ensureNotDestroyed(),shaka.log.v1(g,"appending media segment"),h.yield(l.playerInterface_.mediaSourceEngine.appendBuffer(a.type,r,t.startTime,t.endTime,n),3)):(l.destroyer_.ensureNotDestroyed(),shaka.log.v2(g,"appended media segment"),a.lastStream=e,a.lastSegmentReference=t,a.stream==e&&(o=a.segmentIterator.next().value,shaka.log.v2(g,"advancing to next segment",o)),void h.jumpToEnd())}))},shaka.media.StreamingEngine.prototype.parseEMSG_=function(a,b,e){var t=e.reader.readTerminatedString(),r=e.reader.readTerminatedString(),n=e.reader.readUint32(),g=e.reader.readUint32(),o=e.reader.readUint32(),l=e.reader.readUint32();e=e.reader.readBytes(e.reader.getLength()-e.reader.getPosition()),a=a.startTime+g/n,b.includes(t)&&("urn:mpeg:dash:event:2012"==t?this.playerInterface_.onManifestUpdate():(b=new shaka.util.FakeEvent(shaka.Player.EventName.Emsg,{detail:{startTime:a,endTime:a+o/n,schemeIdUri:t,value:r,timescale:n,presentationTimeDelta:g,eventDuration:o,id:l,messageData:e}}),this.playerInterface_.onEvent(b)))},shaka.media.StreamingEngine.prototype.evict_=function(a,b){var e,t,r,g,n,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){if(1==l.nextAddress)return e=shaka.media.StreamingEngine.logPrefix_(a),shaka.log.v2(e,"checking buffer length"),t=Math.max(o.config_.bufferBehind,o.manifest_.presentationTimeline.getMaxSegmentDuration()),null==(r=o.playerInterface_.mediaSourceEngine.bufferStart(a.type))?(shaka.log.v2(e,"buffer behind okay because nothing buffered:","presentationTime="+b,"bufferBehind="+t),l.return()):0>=(n=(g=b-r)-t)?(shaka.log.v2(e,"buffer behind okay:","presentationTime="+b,"bufferedBehind="+g,"bufferBehind="+t,"underflow="+-n),l.return()):(shaka.log.v1(e,"buffer behind too large:","presentationTime="+b,"bufferedBehind="+g,"bufferBehind="+t,"overflow="+n),l.yield(o.playerInterface_.mediaSourceEngine.remove(a.type,r,r+n),2));o.destroyer_.ensureNotDestroyed(),shaka.log.v1(e,"evicted "+n+" seconds"),l.jumpToEnd()}))},shaka.media.StreamingEngine.isEmbeddedText_=function(a){var b=shaka.util.MimeUtils;return a&&a.type==shaka.util.ManifestParserUtils.ContentType.TEXT&&a.stream.mimeType==b.CLOSED_CAPTION_MIMETYPE},shaka.media.StreamingEngine.prototype.fetch_=function(a,b){var e,t,r,g,n=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){return 1==o.nextAddress?(e=shaka.net.NetworkingEngine.RequestType.SEGMENT,t=shaka.util.Networking.createSegmentRequest(b.getUris(),b.startByte,b.endByte,n.config_.retryParameters),shaka.log.v2("fetching: reference=",b),r=n.playerInterface_.netEngine.request(e,t),a.operation=r,o.yield(r.promise,2)):(g=o.yieldResult,a.operation=null,o.return(g.data))}))},shaka.media.StreamingEngine.prototype.clearBuffer_=function(a,b,e){var t,r,g,n=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){return 1==o.nextAddress?(t=shaka.media.StreamingEngine.logPrefix_(a),goog.asserts.assert(!a.performingUpdate&&null==a.updateTimer,t+" unexpected call to clearBuffer_()"),a.waitingToClearBuffer=!1,a.waitingToFlushBuffer=!1,a.clearBufferSafeMargin=0,a.clearingBuffer=!0,shaka.log.debug(t,"clearing buffer"),e?(r=n.playerInterface_.getPresentationTime(),g=n.playerInterface_.mediaSourceEngine.getDuration(),o.yield(n.playerInterface_.mediaSourceEngine.remove(a.type,r+e,g),3)):o.yield(n.playerInterface_.mediaSourceEngine.clear(a.type),4)):3!=o.nextAddress?(n.destroyer_.ensureNotDestroyed(),b?o.yield(n.playerInterface_.mediaSourceEngine.flush(a.type),3):o.jumpTo(3)):(n.destroyer_.ensureNotDestroyed(),shaka.log.debug(t,"cleared buffer"),a.lastStream=null,a.lastSegmentReference=null,a.clearingBuffer=!1,a.endOfStream=!1,n.scheduleUpdate_(a,0),void o.jumpToEnd())}))},shaka.media.StreamingEngine.prototype.scheduleUpdate_=function(a,b){var e=this,t=shaka.media.StreamingEngine.logPrefix_(a);shaka.log.v2(t,"updating in "+b+" seconds"),goog.asserts.assert(null==a.updateTimer,t+" did not expect update to be scheduled"),a.updateTimer=new shaka.util.DelayedTick((function(){var b;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(t.setCatchFinallyBlocks(2),t.yield(e.onUpdate_(a),4)):2!=t.nextAddress?t.leaveTryBlock(0):(b=t.enterCatchBlock(),e.playerInterface_&&e.playerInterface_.onError(b),void t.jumpToEnd())}))})).tickAfter(b)},shaka.media.StreamingEngine.prototype.cancelUpdate_=function(a){null!=a.updateTimer&&(a.updateTimer.stop(),a.updateTimer=null)},shaka.media.StreamingEngine.prototype.abortOperations_=function(a){return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return a.operation?b.yield(a.operation.abort(),0):b.jumpTo(0)}))},shaka.media.StreamingEngine.prototype.handleStreamingError_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){if(1==e.nextAddress)return e.yield(b.failureCallbackBackoff_.attempt(),2);b.destroyer_.ensureNotDestroyed(),b.playerInterface_.onError(a),a.handled||b.config_.failureCallback(a),e.jumpToEnd()}))},shaka.media.StreamingEngine.logPrefix_=function(a){return"("+a.type+":"+a.stream.id+")"},shaka.media.StreamingEngine.APPEND_WINDOW_START_FUDGE_=.1,shaka.media.StreamingEngine.APPEND_WINDOW_END_FUDGE_=.01,shaka.media.StreamingEngine.MAX_RUN_AHEAD_SEGMENTS_=1,shaka.routing={},shaka.routing.Walker=function(a,b,e){var t=this;this.implementation_=e,this.currentlyAt_=a,this.currentlyWith_=b,this.waitForWork_=null,this.requests_=[],this.currentStep_=this.currentRoute_=null,this.mainLoopPromise_=Promise.resolve().then((function(){return t.mainLoop_()})),this.destroyer_=new shaka.util.Destroyer((function(){return t.doDestroy_()}))},shaka.routing.Walker.prototype.getCurrentPayload=function(){return this.currentlyWith_},shaka.routing.Walker.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.routing.Walker.prototype.doDestroy_=function(){var b,e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){if(1==t.nextAddress)return a.currentStep_&&a.currentStep_.abort(),a.unblockMainLoop_(),t.yield(a.mainLoopPromise_,2);for(a.currentRoute_&&a.currentRoute_.listeners.onCancel(),b=$jscomp.makeIterator(a.requests_),e=b.next();!e.done;e=b.next())e.value.listeners.onCancel();a.currentRoute_=null,a.requests_=[],a.implementation_=null,t.jumpToEnd()}))},shaka.routing.Walker.prototype.startNewRoute=function(a){var b={onStart:function(){},onEnd:function(){},onCancel:function(){},onError:function(a){},onSkip:function(){},onEnter:function(){}};return this.requests_.push({create:a,listeners:b}),this.currentStep_&&this.currentStep_.abort(),this.unblockMainLoop_(),b},shaka.routing.Walker.prototype.mainLoop_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return a.destroyer_.destroyed()?b.jumpTo(0):b.yield(a.doOneThing_(),1)}))},shaka.routing.Walker.prototype.doOneThing_=function(){return this.tryNewRoute_()?Promise.resolve():this.currentRoute_?this.takeNextStep_():(goog.asserts.assert(null==this.waitForWork_,"We should not have a promise yet."),this.implementation_.onIdle(this.currentlyAt_),this.waitForWork_=new shaka.util.PublicPromise)},shaka.routing.Walker.prototype.tryNewRoute_=function(){if(goog.asserts.assert(null==this.currentStep_,"We should never have a current step between taking steps."),0==this.requests_.length||this.currentRoute_&&!this.currentRoute_.interruptible)return!1;this.currentRoute_&&(this.currentRoute_.listeners.onCancel(),this.currentRoute_=null);var a=this.requests_.shift(),b=a.create(this.currentlyWith_);return b?(a.listeners.onStart(),this.currentRoute_={node:b.node,payload:b.payload,interruptible:b.interruptible,listeners:a.listeners}):a.listeners.onSkip(),!0},shaka.routing.Walker.prototype.takeNextStep_=function(){var b,e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){switch(t.nextAddress){case 1:return goog.asserts.assert(a.currentRoute_,"We need a current route to take the next step."),a.currentlyAt_=a.implementation_.getNext(a.currentlyAt_,a.currentlyWith_,a.currentRoute_.node,a.currentRoute_.payload),a.currentRoute_.listeners.onEnter(a.currentlyAt_),t.setCatchFinallyBlocks(2),a.currentStep_=a.implementation_.enterNode(a.currentlyAt_,a.currentlyWith_,a.currentRoute_.payload),t.yield(a.currentStep_.promise,4);case 4:a.currentStep_=null,a.currentlyAt_==a.currentRoute_.node&&(a.currentRoute_.listeners.onEnd(),a.currentRoute_=null),t.leaveTryBlock(0);break;case 2:return(b=t.enterCatchBlock()).code==shaka.util.Error.Code.OPERATION_ABORTED?(goog.asserts.assert(a.currentRoute_.interruptible,"Do not put abortable steps in non-interruptible routes!"),a.currentRoute_.listeners.onCancel()):a.currentRoute_.listeners.onError(b),a.currentRoute_=null,a.currentStep_=null,e=a,t.yield(a.implementation_.handleError(a.currentlyWith_,b),5);case 5:e.currentlyAt_=t.yieldResult,t.jumpToEnd()}}))},shaka.routing.Walker.prototype.unblockMainLoop_=function(){this.waitForWork_&&(this.waitForWork_.resolve(),this.waitForWork_=null)},shaka.text.SimpleTextDisplayer=function(a){this.textTrack_=null;for(var b=$jscomp.makeIterator(Array.from(a.textTracks)),e=b.next();!e.done;e=b.next())(e=e.value).mode="disabled",e.label==shaka.Player.TextTrackLabel&&(this.textTrack_=e);this.textTrack_||(this.textTrack_=a.addTextTrack("subtitles",shaka.Player.TextTrackLabel)),this.textTrack_.mode="hidden"},shaka.text.SimpleTextDisplayer.prototype.remove=function(a,b){return!!this.textTrack_&&(shaka.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,(function(e){return e.startTime<b&&e.endTime>a})),!0)},shaka.text.SimpleTextDisplayer.prototype.append=function(a){var b=a.map((function(a){if(a.nestedCues.length){var b=a.nestedCues.map((function(a){return a.spacer?"\n":a.payload+" "})).join("").replace(/ $/m,"");return(a=a.clone()).nestedCues=[],a.payload=b,a}return a})),e=[];a=this.textTrack_.cues?Array.from(this.textTrack_.cues):[];for(var t={},r=(b=$jscomp.makeIterator(b)).next();!r.done;t={$jscomp$loop$prop$inCue$544:t.$jscomp$loop$prop$inCue$544},r=b.next())t.$jscomp$loop$prop$inCue$544=r.value,a.some(function(a){return function(b){return b.startTime==a.$jscomp$loop$prop$inCue$544.startTime&&b.endTime==a.$jscomp$loop$prop$inCue$544.endTime&&b.text==a.$jscomp$loop$prop$inCue$544.payload}}(t))||(r=shaka.text.SimpleTextDisplayer.convertToTextTrackCue_(t.$jscomp$loop$prop$inCue$544))&&e.push(r);for(a=e.slice().sort((function(a,b){return a.startTime!=b.startTime?a.startTime-b.startTime:a.endTime!=b.endTime?a.endTime-b.startTime:e.indexOf(b)-e.indexOf(a)})),t=(a=$jscomp.makeIterator(a)).next();!t.done;t=a.next())this.textTrack_.addCue(t.value)},shaka.text.SimpleTextDisplayer.prototype.destroy=function(){return this.textTrack_&&(shaka.text.SimpleTextDisplayer.removeWhere_(this.textTrack_,(function(a){return!0})),this.textTrack_.mode="disabled"),this.textTrack_=null,Promise.resolve()},shaka.text.SimpleTextDisplayer.prototype.isTextVisible=function(){return"showing"==this.textTrack_.mode},shaka.text.SimpleTextDisplayer.prototype.setTextVisibility=function(a){this.textTrack_.mode=a?"showing":"hidden"},shaka.text.SimpleTextDisplayer.convertToTextTrackCue_=function(a){if(a.startTime>=a.endTime)return shaka.log.warning("Invalid cue times: "+a.startTime+" - "+a.endTime),null;var b=shaka.text.Cue,e=new VTTCue(a.startTime,a.endTime,a.payload);e.lineAlign=a.lineAlign,e.positionAlign=a.positionAlign,a.size&&(e.size=a.size);try{e.align=a.textAlign}catch(e){}return"center"==a.textAlign&&"center"!=e.align&&(e.align="middle"),a.writingMode==b.writingMode.VERTICAL_LEFT_TO_RIGHT?e.vertical="lr":a.writingMode==b.writingMode.VERTICAL_RIGHT_TO_LEFT&&(e.vertical="rl"),a.lineInterpretation==b.lineInterpretation.PERCENTAGE&&(e.snapToLines=!1),null!=a.line&&(e.line=a.line),null!=a.position&&(e.position=a.position),e},shaka.text.SimpleTextDisplayer.removeWhere_=function(a,b){var e=a.mode,t="showing"==e?"showing":"hidden";a.mode=t,goog.asserts.assert(a.cues,'Cues should be accessible when mode is set to "'+t+'".');for(var r=(t=$jscomp.makeIterator(Array.from(a.cues))).next();!r.done;r=t.next())(r=r.value)&&b(r)&&a.removeCue(r);a.mode=e},goog.exportSymbol("shaka.text.SimpleTextDisplayer",shaka.text.SimpleTextDisplayer),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"setTextVisibility",shaka.text.SimpleTextDisplayer.prototype.setTextVisibility),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"isTextVisible",shaka.text.SimpleTextDisplayer.prototype.isTextVisible),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"destroy",shaka.text.SimpleTextDisplayer.prototype.destroy),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"append",shaka.text.SimpleTextDisplayer.prototype.append),goog.exportProperty(shaka.text.SimpleTextDisplayer.prototype,"remove",shaka.text.SimpleTextDisplayer.prototype.remove),shaka.util.Dom=function(){},shaka.util.Dom.createHTMLElement=function(a){return document.createElement(a)},shaka.util.Dom.createButton=function(){return document.createElement("button")},shaka.util.Dom.asHTMLElement=function(a){return a},shaka.util.Dom.asHTMLMediaElement=function(a){return a},shaka.util.Dom.getElementByClassName=function(a,b){var e=b.getElementsByClassName(a);return goog.asserts.assert(1==e.length,"Should only be one element with class name "+a),shaka.util.Dom.asHTMLElement(e[0])},shaka.util.Dom.removeAllChildren=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},goog.exportSymbol("shaka.util.Dom",shaka.util.Dom),goog.exportProperty(shaka.util.Dom,"removeAllChildren",shaka.util.Dom.removeAllChildren),shaka.text.UITextDisplayer=function(a,b){var e=this;goog.asserts.assert(b,"videoContainer should be valid."),this.isTextVisible_=!1,this.cues_=[],this.video_=a,this.videoContainer_=b,this.textContainer_=shaka.util.Dom.createHTMLElement("div"),this.textContainer_.classList.add("shaka-text-container"),this.videoContainer_.appendChild(this.textContainer_),this.captionsTimer_=new shaka.util.Timer((function(){e.updateCaptions_()})).tickEvery(.25),this.currentCuesMap_=new Map},shaka.text.UITextDisplayer.prototype.append=function(a){for(var b={},e=(a=$jscomp.makeIterator(a)).next();!e.done;b={$jscomp$loop$prop$cue$546:b.$jscomp$loop$prop$cue$546},e=a.next())b.$jscomp$loop$prop$cue$546=e.value,this.cues_.some(function(a){return function(b){return b.payload==a.$jscomp$loop$prop$cue$546.payload&&b.startTime==a.$jscomp$loop$prop$cue$546.startTime&&b.endTime==a.$jscomp$loop$prop$cue$546.endTime}}(b))||this.cues_.push(b.$jscomp$loop$prop$cue$546);this.updateCaptions_()},shaka.text.UITextDisplayer.prototype.destroy=function(){this.videoContainer_.removeChild(this.textContainer_),this.textContainer_=null,this.isTextVisible_=!1,this.cues_=[],this.captionsTimer_&&this.captionsTimer_.stop(),this.currentCuesMap_.clear()},shaka.text.UITextDisplayer.prototype.remove=function(a,b){return!!this.textContainer_&&(this.cues_=this.cues_.filter((function(e){return e.startTime<a||e.endTime>=b})),this.updateCaptions_(),!0)},shaka.text.UITextDisplayer.prototype.isTextVisible=function(){return this.isTextVisible_},shaka.text.UITextDisplayer.prototype.setTextVisibility=function(a){this.isTextVisible_=a},shaka.text.UITextDisplayer.prototype.updateCaptions_=function(){for(var a=this,b=this.video_.currentTime,e=function(e){return a.cues_.includes(e)&&a.isTextVisible_&&e.startTime<=b&&e.endTime>=b},t=$jscomp.makeIterator(this.currentCuesMap_.keys()),r=t.next();!r.done;r=t.next())if(r=r.value,!e(r)){var n=this.currentCuesMap_.get(r);this.textContainer_.removeChild(n),this.currentCuesMap_.delete(r)}for(t=new Set(this.currentCuesMap_.values()),n=(r=$jscomp.makeIterator(Array.from(this.textContainer_.childNodes))).next();!n.done;n=r.next())n=n.value,t.has(n)||this.textContainer_.removeChild(n);for(t=this.cues_.filter((function(b){return e(b)&&!a.currentCuesMap_.has(b)})).sort((function(a,b){return a.startTime!=b.startTime?a.startTime-b.startTime:a.endTime-b.endTime})),r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())this.displayCue_(this.textContainer_,r.value)},shaka.text.UITextDisplayer.prototype.displayLeafCue_=function(a,b,e){var t=shaka.util.Dom.createHTMLElement("span");return e&&t.classList.add("shaka-nested-cue"),b.spacer?t.style.display="block":this.setCaptionStyles_(t,b,!0),a.appendChild(t),t},shaka.text.UITextDisplayer.prototype.displayCue_=function(a,b){if(b.nestedCues.length){var e=shaka.util.Dom.createHTMLElement("p");e.style.width="100%",this.setCaptionStyles_(e,b,!1);for(var t=0;t<b.nestedCues.length;t++)this.displayLeafCue_(e,b.nestedCues[t],!0);a.appendChild(e),this.currentCuesMap_.set(b,e)}else this.currentCuesMap_.set(b,this.displayLeafCue_(a,b,!1))},shaka.text.UITextDisplayer.prototype.setCaptionStyles_=function(a,b,e){var t=shaka.text.Cue,r=a.style;if(r.whiteSpace="pre-line",a.textContent=b.payload,e&&(r.backgroundColor=b.backgroundColor),r.border=b.border,r.color=b.color,r.direction=b.direction,r.opacity=b.opacity,r.paddingLeft=shaka.text.UITextDisplayer.convertLengthValue_(b.linePadding,b,this.videoContainer_),r.paddingRight=shaka.text.UITextDisplayer.convertLengthValue_(b.linePadding,b,this.videoContainer_),b.backgroundImage&&(r.backgroundImage="url('"+b.backgroundImage+"')",r.backgroundRepeat="no-repeat",r.backgroundSize="contain",r.backgroundPosition="center",""==b.backgroundColor&&(r.backgroundColor="transparent")),b.backgroundImage&&b.region){a=shaka.text.CueRegion.units.PERCENTAGE;var n=b.region.widthUnits==a?"%":"px";r.height=b.region.height+(b.region.heightUnits==a?"%":"px"),r.width=b.region.width+n}r.justifyContent=b.displayAlign==t.displayAlign.BEFORE?"flex-start":b.displayAlign==t.displayAlign.CENTER?"center":"flex-end",b.nestedCues.length&&(r.display="flex",r.flexDirection="row",r.margin="0",r.alignItems=r.justifyContent,r.justifyContent="center"),e&&(r.maxWidth="100%"),r.fontFamily=b.fontFamily,r.fontWeight=b.fontWeight.toString(),r.fontStyle=b.fontStyle,r.letterSpacing=b.letterSpacing,r.fontSize=shaka.text.UITextDisplayer.convertLengthValue_(b.fontSize,b,this.videoContainer_),b.line?b.lineInterpretation==t.lineInterpretation.PERCENTAGE&&(r.position="absolute",b.writingMode==t.writingMode.HORIZONTAL_TOP_TO_BOTTOM?b.lineAlign==t.lineAlign.START?r.top=b.line+"%":b.lineAlign==t.lineAlign.END&&(r.bottom=b.line+"%"):b.writingMode==t.writingMode.VERTICAL_LEFT_TO_RIGHT?b.lineAlign==t.lineAlign.START?r.left=b.line+"%":b.lineAlign==t.lineAlign.END&&(r.right=b.line+"%"):b.lineAlign==t.lineAlign.START?r.right=b.line+"%":b.lineAlign==t.lineAlign.END&&(r.left=b.line+"%")):b.region&&b.region.id&&!e&&(e=shaka.text.CueRegion.units.PERCENTAGE,a=b.region.widthUnits==e?"%":"px",n=b.region.viewportAnchorUnits==e?"%":"px",r.height=b.region.height+(b.region.heightUnits==e?"%":"px"),r.width=b.region.width+a,r.position="absolute",r.top=b.region.viewportAnchorY+n,r.left=b.region.viewportAnchorX+n),r.lineHeight=b.lineHeight,b.position&&(b.writingMode==t.writingMode.HORIZONTAL_TOP_TO_BOTTOM?r.paddingLeft=b.position:r.paddingTop=b.position),b.positionAlign==t.positionAlign.LEFT?r.cssFloat="left":b.positionAlign==t.positionAlign.RIGHT&&(r.cssFloat="right"),r.textAlign=b.textAlign,r.textDecoration=b.textDecoration.join(" "),r.writingMode=b.writingMode,b.size&&(b.writingMode==t.writingMode.HORIZONTAL_TOP_TO_BOTTOM?r.width=b.size+"%":r.height=b.size+"%")},shaka.text.UITextDisplayer.getLengthValueInfo_=function(a){return(a=new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(a))?{value:Number(a[1]),unit:a[2]}:null},shaka.text.UITextDisplayer.convertLengthValue_=function(a,b,e){var t=shaka.text.UITextDisplayer.getLengthValueInfo_(a);if(!t)return a;var r=t.value;switch(t.unit){case"%":return shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_(r/100,b,e);case"c":return shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_(r,b,e);default:return a}},shaka.text.UITextDisplayer.getAbsoluteLengthInPixels_=function(a,b,e){return e.clientHeight*a/b.cellResolution.rows+"px"},goog.exportSymbol("shaka.text.UITextDisplayer",shaka.text.UITextDisplayer),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"setTextVisibility",shaka.text.UITextDisplayer.prototype.setTextVisibility),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"isTextVisible",shaka.text.UITextDisplayer.prototype.isTextVisible),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"remove",shaka.text.UITextDisplayer.prototype.remove),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"destroy",shaka.text.UITextDisplayer.prototype.destroy),goog.exportProperty(shaka.text.UITextDisplayer.prototype,"append",shaka.text.UITextDisplayer.prototype.append),shaka.util.ConfigUtils=function(){},shaka.util.ConfigUtils.mergeConfigObjects=function(a,b,e,t,r){goog.asserts.assert(a,"Destination config must not be null!");var n,o=r in t,g=!0;for(n in b){var l=r+"."+n,h=o?t[r]:e[n];o||n in e?void 0===b[n]?void 0===h||o?delete a[n]:a[n]=shaka.util.ObjectUtils.cloneObject(h):h.constructor==Object&&b[n]&&b[n].constructor==Object?(a[n]||(a[n]=shaka.util.ObjectUtils.cloneObject(h)),l=shaka.util.ConfigUtils.mergeConfigObjects(a[n],b[n],h,t,l),g=g&&l):typeof b[n]!=typeof h||null==b[n]||"function"!=typeof b[n]&&b[n].constructor!=h.constructor?(shaka.log.alwaysError("Invalid config, wrong type for "+l),g=!1):("function"==typeof e[n]&&e[n].length!=b[n].length&&shaka.log.alwaysWarn("Unexpected number of arguments for "+l),a[n]=b[n]):(shaka.log.alwaysError("Invalid config, unrecognized key "+l),g=!1)}return g},shaka.util.ConfigUtils.convertToConfigObject=function(a,b){for(var e={},t=e,r=0,n=0;!(0>(r=a.indexOf(".",r)));)0!=r&&"\\"==a[r-1]||(t[n=a.substring(n,r).replace(/\\\./g,".")]={},t=t[n],n=r+1),r+=1;return t[a.substring(n).replace(/\\\./g,".")]=b,e},goog.exportSymbol("shaka.util.ConfigUtils",shaka.util.ConfigUtils),goog.exportProperty(shaka.util.ConfigUtils,"convertToConfigObject",shaka.util.ConfigUtils.convertToConfigObject),goog.exportProperty(shaka.util.ConfigUtils,"mergeConfigObjects",shaka.util.ConfigUtils.mergeConfigObjects),shaka.util.PlayerConfiguration=function(){},shaka.util.PlayerConfiguration.createDefault=function(){var a=1/0;navigator.connection&&navigator.connection.saveData&&(a=360);var b={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:shaka.media.DrmEngine.defaultInitDataTransform,logLicenseExchange:!1,updateExpirationTime:1},e={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,defaultPresentationDelay:0,lowLatencyMode:!1,dash:{clockSyncUri:"",ignoreDrmInfo:!1,xlinkFailGracefully:!1,ignoreMinBufferTime:!1,autoCorrectDrift:!0,initialSegmentLimit:1e3,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1},hls:{ignoreTextStreamFailures:!1,useFullSegmentsForStartTime:!1}},t={retryParameters:shaka.net.NetworkingEngine.defaultRetryParameters(),failureCallback:function(a){return shaka.log.error("Unhandled streaming error",a),[a]},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0,inaccurateManifestTolerance:2};(shaka.util.Platform.isWebOS()||shaka.util.Platform.isTizen()||shaka.util.Platform.isChromecast())&&(t.stallSkip=0);var r={trackSelectionCallback:function(a){return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return b.return(a)}))},progressCallback:function(a,b){return[a,b]},usePersistentLicense:!0},n={drm:b,manifest:e,streaming:t,offline:r,abrFactory:function(){return new shaka.abr.SimpleAbrManager},abr:{enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:a,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0,orientation:0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0,orientation:0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return r.trackSelectionCallback=function(a){return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return b.return(shaka.util.PlayerConfiguration.defaultTrackSelect(a,n.preferredAudioLanguage))}))},n},shaka.util.PlayerConfiguration.mergeConfigObjects=function(a,b,e){var t={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:new Uint8Array(0),individualizationServer:""}};return shaka.util.ConfigUtils.mergeConfigObjects(a,b,e||shaka.util.PlayerConfiguration.createDefault(),t,"")},shaka.util.PlayerConfiguration.defaultTrackSelect=function(a,b){var e=shaka.util.ManifestParserUtils.ContentType,t=shaka.util.LanguageUtils,r=a.filter((function(a){return"variant"==a.type})),n=[],g=t.findClosestLocale(b,r.map((function(a){return a.language})));g&&(n=r.filter((function(a){return t.normalize(a.language)==g}))),0==n.length&&(n=r.filter((function(a){return a.primary}))),0==n.length&&(1<new Set(r.map((function(a){return a.language}))).size&&shaka.log.warning("Could not choose a good audio track based on language preferences or primary tracks.  An arbitrary language will be stored!"),n=r);var o=n.filter((function(a){return a.height&&480>=a.height}));if(o.length&&(o.sort((function(a,b){return goog.asserts.assert(null!=a.height,"Null height"),goog.asserts.assert(null!=b.height,"Null height"),b.height-a.height})),n=o.filter((function(a){return a.height==o[0].height}))),r=[],n.length){var l=Math.floor(n.length/2);n.sort((function(a,b){return a.bandwidth-b.bandwidth})),r.push(n[l])}for(l=(n=$jscomp.makeIterator(a)).next();!l.done;l=n.next())(l=l.value).type==e.TEXT&&r.push(l);return r},goog.exportSymbol("shaka.util.PlayerConfiguration",shaka.util.PlayerConfiguration),goog.exportProperty(shaka.util.PlayerConfiguration,"mergeConfigObjects",shaka.util.PlayerConfiguration.mergeConfigObjects),shaka.util.StateHistory=function(){this.open_=null,this.closed_=[]},shaka.util.StateHistory.prototype.update=function(a){null==this.open_?this.start_(a):this.update_(a)},shaka.util.StateHistory.prototype.getTimeSpentIn=function(a){var b=0;this.open_&&this.open_.state==a&&(b+=this.open_.duration);for(var e=$jscomp.makeIterator(this.closed_),t=e.next();!t.done;t=e.next())b+=(t=t.value).state==a?t.duration:0;return b},shaka.util.StateHistory.prototype.getCopy=function(){for(var a=function(a){return{timestamp:a.timestamp,state:a.state,duration:a.duration}},b=[],e=$jscomp.makeIterator(this.closed_),t=e.next();!t.done;t=e.next())b.push(a(t.value));return this.open_&&b.push(a(this.open_)),b},shaka.util.StateHistory.prototype.start_=function(a){goog.asserts.assert(null==this.open_,"There must be no open entry in order when we start"),shaka.log.v1("Changing Player state to",a),this.open_={timestamp:this.getNowInSeconds_(),state:a,duration:0}},shaka.util.StateHistory.prototype.update_=function(a){goog.asserts.assert(this.open_,"There must be an open entry in order to update it");var b=this.getNowInSeconds_();this.open_.duration=b-this.open_.timestamp,this.open_.state!=a&&(shaka.log.v1("Changing Player state to",a),this.closed_.push(this.open_),this.open_={timestamp:b,state:a,duration:0})},shaka.util.StateHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},shaka.util.SwitchHistory=function(){this.currentText_=this.currentVariant_=null,this.history_=[]},shaka.util.SwitchHistory.prototype.updateCurrentVariant=function(a,b){this.currentVariant_!=a&&(this.currentVariant_=a,this.history_.push({timestamp:this.getNowInSeconds_(),id:a.id,type:"variant",fromAdaptation:b,bandwidth:a.bandwidth}))},shaka.util.SwitchHistory.prototype.updateCurrentText=function(a,b){this.currentText_!=a&&(this.currentText_=a,this.history_.push({timestamp:this.getNowInSeconds_(),id:a.id,type:"text",fromAdaptation:b,bandwidth:null}))},shaka.util.SwitchHistory.prototype.getCopy=function(){for(var a=[],b=$jscomp.makeIterator(this.history_),e=b.next();!e.done;e=b.next())a.push(this.clone_(e.value));return a},shaka.util.SwitchHistory.prototype.getNowInSeconds_=function(){return Date.now()/1e3},shaka.util.SwitchHistory.prototype.clone_=function(a){return{timestamp:a.timestamp,id:a.id,type:a.type,fromAdaptation:a.fromAdaptation,bandwidth:a.bandwidth}},shaka.util.Stats=function(){this.bandwidthEstimate_=this.currentStreamBandwidth_=this.maxSegmentDurationSeconds_=this.liveLatencySeconds_=this.licenseTimeSeconds_=this.drmTimeSeconds_=this.manifestTimeSeconds_=this.loadLatencySeconds_=this.totalCorruptedFrames_=this.totalDecodedFrames_=this.totalDroppedFrames_=this.height_=this.width_=NaN,this.stateHistory_=new shaka.util.StateHistory,this.switchHistory_=new shaka.util.SwitchHistory},shaka.util.Stats.prototype.setDroppedFrames=function(a,b){this.totalDroppedFrames_=a,this.totalDecodedFrames_=b},shaka.util.Stats.prototype.setCorruptedFrames=function(a){this.totalCorruptedFrames_=a},shaka.util.Stats.prototype.setResolution=function(a,b){this.width_=a,this.height_=b},shaka.util.Stats.prototype.setLoadLatency=function(a){this.loadLatencySeconds_=a},shaka.util.Stats.prototype.setManifestTime=function(a){this.manifestTimeSeconds_=a},shaka.util.Stats.prototype.setDrmTime=function(a){this.drmTimeSeconds_=a},shaka.util.Stats.prototype.setLicenseTime=function(a){this.licenseTimeSeconds_=a},shaka.util.Stats.prototype.setLiveLatency=function(a){this.liveLatencySeconds_=a},shaka.util.Stats.prototype.setMaxSegmentDuration=function(a){this.maxSegmentDurationSeconds_=a},shaka.util.Stats.prototype.setCurrentStreamBandwidth=function(a){this.currentStreamBandwidth_=a},shaka.util.Stats.prototype.setBandwidthEstimate=function(a){this.bandwidthEstimate_=a},shaka.util.Stats.prototype.getStateHistory=function(){return this.stateHistory_},shaka.util.Stats.prototype.getSwitchHistory=function(){return this.switchHistory_},shaka.util.Stats.prototype.getBlob=function(){return{width:this.width_,height:this.height_,streamBandwidth:this.currentStreamBandwidth_,decodedFrames:this.totalDecodedFrames_,droppedFrames:this.totalDroppedFrames_,corruptedFrames:this.totalCorruptedFrames_,estimatedBandwidth:this.bandwidthEstimate_,loadLatency:this.loadLatencySeconds_,manifestTimeSeconds:this.manifestTimeSeconds_,drmTimeSeconds:this.drmTimeSeconds_,playTime:this.stateHistory_.getTimeSpentIn("playing"),pauseTime:this.stateHistory_.getTimeSpentIn("paused"),bufferingTime:this.stateHistory_.getTimeSpentIn("buffering"),licenseTime:this.licenseTimeSeconds_,liveLatency:this.liveLatencySeconds_,maxSegmentDuration:this.maxSegmentDurationSeconds_,stateHistory:this.stateHistory_.getCopy(),switchHistory:this.switchHistory_.getCopy()}},shaka.util.Stats.getEmptyBlob=function(){return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,manifestTimeSeconds:NaN,drmTimeSeconds:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,liveLatency:NaN,maxSegmentDuration:NaN,switchHistory:[],stateHistory:[]}},shaka.Player=function(a,b){shaka.util.FakeEventTarget.call(this);var e=this;this.loadMode_=shaka.Player.LoadMode.NOT_LOADED,this.videoContainer_=this.video_=null,this.isTextVisible_=!1,this.eventManager_=new shaka.util.EventManager,this.abrManagerFactory_=this.abrManager_=this.assetUri_=this.manifest_=this.parserFactory_=this.parser_=this.streamingEngine_=this.regionTimeline_=this.bufferObserver_=this.bufferPoller_=this.playRateController_=this.playheadObservers_=this.playhead_=this.mediaSourceEngine_=this.drmEngine_=this.networkingEngine_=null,this.nextExternalStreamId_=1e9,this.config_=this.defaultConfig_(),this.maxHwRes_={width:1/0,height:1/0},this.stats_=null,this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(this.config_.preferredAudioLanguage,this.config_.preferredVariantRole,this.config_.preferredAudioChannelCount),this.currentTextLanguage_=this.config_.preferredTextLanguage,this.currentTextRole_=this.config_.preferredTextRole,this.cleanupOnUnload_=[],b&&b(this),this.networkingEngine_=this.createNetworkingEngine(),this.adManager_=null,shaka.Player.adManagerFactory_&&(this.adManager_=shaka.util.Functional.callFactory(shaka.Player.adManagerFactory_)),this.eventManager_.listen(window,"online",(function(){e.retryStreaming()})),this.detachNode_={name:"detach"},this.attachNode_={name:"attach"},this.unloadNode_={name:"unload"},this.parserNode_={name:"manifest-parser"},this.manifestNode_={name:"manifest"},this.mediaSourceNode_={name:"media-source"},this.drmNode_={name:"drm-engine"},this.loadNode_={name:"load"},this.srcEqualsDrmNode_={name:"src-equals-drm-engine"},this.srcEqualsNode_={name:"src-equals"};var t=shaka.util.AbortableOperation,r=new Map;r.set(this.attachNode_,(function(a,b){return t.notAbortable(e.onAttach_(a,b))})),r.set(this.detachNode_,(function(a,b){return t.notAbortable(e.onDetach_(a,b))})),r.set(this.unloadNode_,(function(a,b){return t.notAbortable(e.onUnload_(a,b))})),r.set(this.mediaSourceNode_,(function(a,b){var r=e.onInitializeMediaSourceEngine_(a,b);return t.notAbortable(r)})),r.set(this.parserNode_,(function(a,b){var r=e.onInitializeParser_(a,b);return t.notAbortable(r)})),r.set(this.manifestNode_,(function(a,b){return e.onParseManifest_(a,b)})),r.set(this.drmNode_,(function(a,b){var r=e.onInitializeDrm_(a,b);return t.notAbortable(r)})),r.set(this.loadNode_,(function(a,b){return t.notAbortable(e.onLoad_(a,b))})),r.set(this.srcEqualsDrmNode_,(function(a,b){var r=e.onInitializeSrcEqualsDrm_(a,b);return t.notAbortable(r)})),r.set(this.srcEqualsNode_,(function(a,b){return e.onSrcEquals_(a,b)})),this.walker_=new shaka.routing.Walker(this.detachNode_,shaka.Player.createEmptyPayload_(),{getNext:function(a,b,t,r){return e.getNextStep_(a,b,t,r)},enterNode:function(a,b,t){return e.dispatchEvent(e.makeEvent_(shaka.Player.EventName.OnStateChange,{state:a.name})),r.get(a)(b,t)},handleError:function(a,b){return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(shaka.log.warning("The walker saw an error:"),b instanceof shaka.util.Error?shaka.log.warning("Error Code:",b.code):(shaka.log.warning("Error Message:",b.message),shaka.log.warning("Error Stack:",b.stack)),t.yield(e.onUnload_(a,shaka.Player.createEmptyPayload_()),2)):t.return(a.mediaElement?e.attachNode_:e.detachNode_)}))},onIdle:function(a){e.dispatchEvent(e.makeEvent_(shaka.Player.EventName.OnStateIdle,{state:a.name}))}}),a&&this.attach(a,!0)},$jscomp.inherits(shaka.Player,shaka.util.FakeEventTarget),shaka.Player.prototype.makeEvent_=function(a,b){return new shaka.util.FakeEvent(a,b)},shaka.Player.prototype.destroy=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){switch(e.nextAddress){case 1:return a.loadMode_==shaka.Player.LoadMode.DESTROYED?e.return():(a.loadMode_=shaka.Player.LoadMode.DESTROYED,b=a.walker_.startNewRoute((function(b){return{node:a.detachNode_,payload:shaka.Player.createEmptyPayload_(),interruptible:!1}})),e.yield(new Promise((function(a){b.onStart=function(){shaka.log.info("Preparing to destroy walker...")},b.onEnd=function(){a()},b.onCancel=function(){goog.asserts.assert(!1,"Our final detach call should never be cancelled."),a()},b.onError=function(){goog.asserts.assert(!1,"Our final detach call should never see an error"),a()},b.onSkip=function(){goog.asserts.assert(!1,"Our final detach call should never be skipped"),a()}})),2));case 2:return e.yield(a.walker_.destroy(),3);case 3:if(a.eventManager_&&(a.eventManager_.release(),a.eventManager_=null),a.abrManagerFactory_=null,a.abrManager_=null,a.config_=null,a.stats_=null,a.videoContainer_=null,!a.networkingEngine_){e.jumpTo(0);break}return e.yield(a.networkingEngine_.destroy(),5);case 5:a.networkingEngine_=null,e.jumpToEnd()}}))},shaka.Player.registerSupportPlugin=function(a,b){shaka.Player.supportPlugins_[a]=b},shaka.Player.setAdManagerFactory=function(a){shaka.Player.adManagerFactory_=a},shaka.Player.isBrowserSupported=function(){if(!(window.Promise&&window.Uint8Array&&Array.prototype.forEach))return!1;var a=shaka.util.Platform.safariVersion();return!(a&&12>a||!shaka.media.DrmEngine.isBrowserSupported())&&(!!shaka.util.Platform.supportsMediaSource()||shaka.util.Platform.supportsMediaType("application/x-mpegurl"))},shaka.Player.probeSupport=function(){var a,b,e,t,r,n;return $jscomp.asyncExecutePromiseGeneratorProgram((function(g){if(1==g.nextAddress)return goog.asserts.assert(shaka.Player.isBrowserSupported(),"Must have basic support"),g.yield(shaka.media.DrmEngine.probeSupport(),2);for(n in a=g.yieldResult,b=shaka.media.ManifestParser.probeSupport(),e=shaka.media.MediaSourceEngine.probeSupport(),t={manifest:b,media:e,drm:a},r=shaka.Player.supportPlugins_)t[n]=r[n]();return g.return(t)}))},shaka.Player.prototype.attach=function(a,b){if(b=void 0===b||b,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var e=shaka.Player.createEmptyPayload_();e.mediaElement=a,shaka.util.Platform.supportsMediaSource()||(b=!1);var t=b?this.mediaSourceNode_:this.attachNode_,r=this.walker_.startNewRoute((function(a){return{node:t,payload:e,interruptible:!1}}));return r.onStart=function(){return shaka.log.info("Starting attach...")},this.wrapWalkerListenersWithPromise_(r)},shaka.Player.prototype.detach=function(){var a=this;if(this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());var b=this.walker_.startNewRoute((function(b){return{node:a.detachNode_,payload:shaka.Player.createEmptyPayload_(),interruptible:!1}}));return b.onStart=function(){return shaka.log.info("Starting detach...")},this.wrapWalkerListenersWithPromise_(b)},shaka.Player.prototype.unload=function(a){var b=this;if(a=void 0===a||a,this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());shaka.util.Platform.supportsMediaSource()||(a=!1);var e=shaka.Player.createEmptyPayload_(),t=this.walker_.startNewRoute((function(t){var r=t.mediaElement&&a?b.mediaSourceNode_:t.mediaElement?b.attachNode_:b.detachNode_;return goog.asserts.assert(r,"We should have picked a destination."),e.mediaElement=t.mediaElement,{node:r,payload:e,interruptible:!1}}));return t.onStart=function(){return shaka.log.info("Starting unload...")},this.wrapWalkerListenersWithPromise_(t)},shaka.Player.prototype.load=function(a,b,e){var t=this;if(this.loadMode_==shaka.Player.LoadMode.DESTROYED)return Promise.reject(this.createAbortLoadError_());this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Loading));var r=shaka.Player.createEmptyPayload_();r.uri=a,r.startTimeOfLoad=Date.now()/1e3,e&&(r.mimeType=e),void 0!==b&&(r.startTime=b);var n=this.shouldUseSrcEquals_(r)?this.srcEqualsNode_:this.loadNode_,g=this.walker_.startNewRoute((function(a){return null==a.mediaElement?null:(r.mediaElement=a.mediaElement,{node:n,payload:r,interruptible:!0})}));return this.stats_=new shaka.util.Stats,g.onStart=function(){return shaka.log.info("Starting load of "+a+"...")},new Promise((function(a,b){g.onSkip=function(){return b(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.NO_VIDEO_ELEMENT))},g.onEnd=function(){a(),t.dispatchEvent(t.makeEvent_(shaka.Player.EventName.Loaded))},g.onCancel=function(){return b(t.createAbortLoadError_())},g.onError=function(a){return b(a)}}))},shaka.Player.prototype.shouldUseSrcEquals_=function(a){var b=shaka.util.Platform;if(!b.supportsMediaSource())return!0;var e=a.mimeType,t=a.uri||"";return e||(e={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"}[shaka.media.ManifestParser.getExtension(t)]),!!e&&((a=""!=(a.mediaElement||b.anyMediaElement()).canPlayType(e))&&(!(e=shaka.media.ManifestParser.isSupported(t,e))||(goog.asserts.assert(a&&e,"Both native and MSE playback should be possible!"),b.isApple()&&this.config_.streaming.useNativeHlsOnSafari)))},shaka.Player.prototype.onAttach_=function(a,b){var e=this;return goog.asserts.assert(null==a.mediaElement||a.mediaElement==b.mediaElement,"The routing logic failed. MediaElement requirement failed."),null==a.mediaElement&&(a.mediaElement=b.mediaElement,this.eventManager_.listen(a.mediaElement,"error",(function(a){return e.onVideoError_(a)}))),this.video_=a.mediaElement,Promise.resolve()},shaka.Player.prototype.onDetach_=function(a,b){return a.mediaElement&&(this.eventManager_.unlisten(a.mediaElement,"error"),a.mediaElement=null),this.video_=null,Promise.resolve()},shaka.Player.prototype.onUnload_=function(a,b){var e,t,r,g,n,o,l,h,d,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){switch(b.nextAddress){case 1:return c.loadMode_!=shaka.Player.LoadMode.DESTROYED&&(c.loadMode_=shaka.Player.LoadMode.NOT_LOADED),e=c.cleanupOnUnload_.map((function(a){return a()})),c.cleanupOnUnload_=[],b.yield(Promise.all(e),2);case 2:if(c.dispatchEvent(c.makeEvent_(shaka.Player.EventName.Unloading)),a.mimeType=null,a.startTime=null,a.uri=null,a.mediaElement&&(c.eventManager_.unlisten(a.mediaElement,"loadedmetadata"),c.eventManager_.unlisten(a.mediaElement,"playing"),c.eventManager_.unlisten(a.mediaElement,"pause"),c.eventManager_.unlisten(a.mediaElement,"ended"),c.eventManager_.unlisten(a.mediaElement,"ratechange")),c.playheadObservers_&&(c.playheadObservers_.release(),c.playheadObservers_=null),c.bufferPoller_&&(c.bufferPoller_.stop(),c.bufferPoller_=null),!c.parser_){b.jumpTo(3);break}return b.yield(c.parser_.stop(),4);case 4:c.parser_=null,c.parserFactory_=null;case 3:if(!c.abrManager_){b.jumpTo(5);break}return b.yield(c.abrManager_.stop(),5);case 5:if(!c.streamingEngine_){b.jumpTo(7);break}return b.yield(c.streamingEngine_.destroy(),8);case 8:c.streamingEngine_=null;case 7:if(c.playRateController_&&(c.playRateController_.release(),c.playRateController_=null),c.playhead_&&(c.playhead_.release(),c.playhead_=null),!c.mediaSourceEngine_){b.jumpTo(9);break}return b.yield(c.mediaSourceEngine_.destroy(),10);case 10:c.mediaSourceEngine_=null;case 9:if(c.adManager_&&c.adManager_.onAssetUnload(),!a.mediaElement||!a.mediaElement.src){b.jumpTo(11);break}return b.yield(new Promise((function(a){return new shaka.util.Timer(a).tickAfter(.1)})),12);case 12:a.mediaElement.removeAttribute("src"),a.mediaElement.load();case 11:if(!c.drmEngine_){b.jumpTo(13);break}return b.yield(c.drmEngine_.destroy(),14);case 14:c.drmEngine_=null;case 13:if(c.assetUri_=null,c.bufferObserver_=null,c.manifest_){for(t=$jscomp.makeIterator(c.manifest_.variants),r=t.next();!r.done;r=t.next())for(g=r.value,n=$jscomp.makeIterator([g.audio,g.video]),o=n.next();!o.done;o=n.next())(l=o.value)&&l.segmentIndex&&l.segmentIndex.release();for(h=$jscomp.makeIterator(c.manifest_.textStreams),o=h.next();!o.done;o=h.next())(d=o.value).segmentIndex&&d.segmentIndex.release()}c.manifest_=null,c.stats_=new shaka.util.Stats,c.lastTextFactory_=null,c.updateBufferState_(),b.jumpToEnd()}}))},shaka.Player.prototype.onInitializeMediaSourceEngine_=function(a,b){var e,t,r,g,n=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){if(1==o.nextAddress)return goog.asserts.assert(shaka.util.Platform.supportsMediaSource(),"We should not be initializing media source on a platform that does not support media source."),goog.asserts.assert(a.mediaElement,"We should have a media element when initializing media source."),goog.asserts.assert(a.mediaElement==b.mediaElement,"|has| and |wants| should have the same media element when initializing media source."),goog.asserts.assert(null==n.mediaSourceEngine_,"We should not have a media source engine yet."),e=new shaka.media.ClosedCaptionParser,t=n.config_.textDisplayFactory,r=shaka.util.Functional.callFactory(t),n.lastTextFactory_=t,g=n.createMediaSourceEngine(a.mediaElement,e,r,(function(a,b,e){n.processTimedMetadataMediaSrc_(a,b,e)})),o.yield(g.open(),2);n.mediaSourceEngine_=g,o.jumpToEnd()}))},shaka.Player.prototype.onInitializeParser_=function(a,b){var e,t,r,g,n=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){if(1==o.nextAddress)return goog.asserts.assert(a.mediaElement,"We should have a media element when initializing the parser."),goog.asserts.assert(a.mediaElement==b.mediaElement,"|has| and |wants| should have the same media element when initializing the parser."),goog.asserts.assert(n.networkingEngine_,"Need networking engine when initializing the parser."),goog.asserts.assert(n.config_,"Need player config when initializing the parser."),a.mimeType=b.mimeType,a.uri=b.uri,goog.asserts.assert(a.uri,"We should have an asset uri when initializing the parsing."),e=a.uri,t=n.networkingEngine_,n.assetUri_=e,r=n,o.yield(shaka.media.ManifestParser.getFactory(e,t,n.config_.manifest.retryParameters,a.mimeType),2);r.parserFactory_=o.yieldResult,goog.asserts.assert(n.parserFactory_,"Must have manifest parser"),n.parser_=shaka.util.Functional.callFactory(n.parserFactory_),g=shaka.util.ObjectUtils.cloneObject(n.config_.manifest),b.mediaElement&&"AUDIO"===b.mediaElement.nodeName&&(g.disableVideo=!0),n.parser_.configure(g),o.jumpToEnd()}))},shaka.Player.prototype.onParseManifest_=function(a,b){var e=this;goog.asserts.assert(a.mimeType==b.mimeType,"|has| and |wants| should have the same mime type when parsing."),goog.asserts.assert(a.uri==b.uri,"|has| and |wants| should have the same uri when parsing."),goog.asserts.assert(a.uri,"|has| should have a valid uri when parsing."),goog.asserts.assert(a.uri==this.assetUri_,"|has.uri| should match the cached asset uri."),goog.asserts.assert(this.networkingEngine_,"Need networking engine to parse manifest."),goog.asserts.assert(this.config_,"Need player config to parse manifest."),goog.asserts.assert(this.parser_,"|this.parser_| should have been set in an earlier step.");var t=a.uri,r=this.networkingEngine_;this.regionTimeline_=new shaka.media.RegionTimeline((function(){return e.seekRange()})),this.regionTimeline_.setListeners((function(a){e.onRegionEvent_(shaka.Player.EventName.TimelineRegionAdded,a),e.adManager_&&e.adManager_.onDashTimedMetadata(a)}));var n={networkingEngine:r,filter:function(a){return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return b.return(e.filterManifest_(a))}))},onTimelineRegionAdded:function(a){return e.regionTimeline_.addRegion(a)},onEvent:function(a){return e.dispatchEvent(a)},onError:function(a){return e.onError_(a)}},g=Date.now()/1e3;return new shaka.util.AbortableOperation(function(){var a,b,r,o;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){if(1==l.nextAddress)return a=e,l.yield(e.parser_.start(t,n),2);if(a.manifest_=l.yieldResult,b=e.makeEvent_(shaka.Player.EventName.ManifestParsed),e.dispatchEvent(b),0==e.manifest_.variants.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.NO_VARIANTS);shaka.Player.filterForAVVariants_(e.manifest_),r=Date.now()/1e3,o=r-g,e.stats_.setManifestTime(o),l.jumpToEnd()}))}(),(function(){return shaka.log.info("Aborting parser step..."),e.parser_.stop()}))},shaka.Player.prototype.onInitializeDrm_=function(a,b){var e,t,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){if(1==n.nextAddress)return goog.asserts.assert(a.mimeType==b.mimeType,"The load graph should have ensured the mime types matched."),goog.asserts.assert(a.uri==b.uri,"The load graph should have ensured the uris matched"),goog.asserts.assert(r.networkingEngine_,"|onInitializeDrm_| should never be called after |destroy|"),goog.asserts.assert(r.config_,"|onInitializeDrm_| should never be called after |destroy|"),goog.asserts.assert(r.manifest_,"|this.manifest_| should have been set in an earlier step."),e=Date.now()/1e3,t=!0,r.drmEngine_=r.createDrmEngine({netEngine:r.networkingEngine_,onError:function(a){r.onError_(a)},onKeyStatus:function(a){r.onKeyStatus_(a)},onExpirationUpdated:function(a,b){r.onExpirationUpdated_(a,b)},onEvent:function(a){r.dispatchEvent(a),a.type==shaka.Player.EventName.DrmSessionUpdate&&t&&(t=!1,a=Date.now()/1e3-e,r.stats_.setDrmTime(a))}}),r.drmEngine_.configure(r.config_.drm),n.yield(r.drmEngine_.initForPlayback(r.manifest_.variants,r.manifest_.offlineSessionIds),2);r.filterManifest_(r.manifest_),n.jumpToEnd()}))},shaka.Player.prototype.onLoad_=function(a,b){var e,t,r,g,n,o,l,h,d,p,q,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(m){switch(m.nextAddress){case 1:return goog.asserts.assert(a.mimeType==b.mimeType,"|has| and |wants| should have the same mime type when loading."),goog.asserts.assert(a.uri==b.uri,"|has| and |wants| should have the same uri when loading."),goog.asserts.assert(a.mediaElement,"We should have a media element when loading."),goog.asserts.assert(!isNaN(b.startTimeOfLoad),"|wants| should tell us when the load was originally requested"),a.startTime=b.startTime,e=a.mediaElement,t=a.uri,c.assetUri_=t,c.playRateController_=new shaka.media.PlayRateController({getRate:function(){return a.mediaElement.playbackRate},setRate:function(b){a.mediaElement.playbackRate=b},movePlayhead:function(b){a.mediaElement.currentTime+=b}}),r=function(){return c.updateStateHistory_()},g=function(){return c.onRateChange_()},c.eventManager_.listen(e,"playing",r),c.eventManager_.listen(e,"pause",r),c.eventManager_.listen(e,"ended",r),c.eventManager_.listen(e,"ratechange",g),n=c.config_.abrFactory,c.abrManager_&&c.abrManagerFactory_==n||(c.abrManagerFactory_=n,c.abrManager_=shaka.util.Functional.callFactory(n),"function"!=typeof c.abrManager_.playbackRateChanged&&(shaka.Deprecate.deprecateFeature(4,"AbrManager","Please use an AbrManager with playbackRateChanged function."),c.abrManager_.playbackRateChanged=function(a){}),c.abrManager_.configure(c.config_.abr)),c.createTextStreamsForClosedCaptions_(c.manifest_.variants),c.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(c.config_.preferredAudioLanguage,c.config_.preferredVariantRole,c.config_.preferredAudioChannelCount),c.currentTextLanguage_=c.config_.preferredTextLanguage,shaka.Player.applyPlayRange_(c.manifest_.presentationTimeline,c.config_.playRangeStart,c.config_.playRangeEnd),m.yield(c.drmEngine_.attach(e),2);case 2:if(c.abrManager_.init((function(a,b,e){return c.switch_(a,b,e)})),c.playhead_=c.createPlayhead(a.startTime),c.playheadObservers_=c.createPlayheadObserversForMSE_(),o=Math.max(c.manifest_.minBufferTime,c.config_.streaming.rebufferingGoal),c.startBufferManagement_(o),shaka.util.StreamUtils.chooseCodecsAndFilterManifest(c.manifest_,c.config_.preferredAudioChannelCount),c.streamingEngine_=c.createStreamingEngine(),c.streamingEngine_.configure(c.config_.streaming),c.loadMode_=shaka.Player.LoadMode.MEDIA_SOURCE,c.dispatchEvent(c.makeEvent_(shaka.Player.EventName.Streaming)),l=c.chooseVariant_(),goog.asserts.assert(l,"Must choose an initial variant!"),c.addVariantToSwitchHistory_(l,!0),c.streamingEngine_.switchVariant(l,!1,0),(h=c.chooseTextStream_())&&c.addTextStreamToSwitchHistory_(h,!0),c.setInitialTextState_(l,h),h&&c.shouldStreamText_()&&c.streamingEngine_.switchTextStream(h),!c.config_.streaming.startAtSegmentBoundary){m.jumpTo(3);break}return d=c.playhead_.getTime(),m.yield(c.adjustStartTime_(l,d),4);case 4:p=m.yieldResult,c.playhead_.setStartTime(p);case 3:return m.yield(c.streamingEngine_.start(),5);case 5:c.config_.abr.enabled&&(c.abrManager_.enable(),c.onAbrStatusChanged_()),c.filterManifest_(c.manifest_),c.onTracksChanged_(),c.onAdaptation_(),c.updateAbrManagerVariants_(),q=c.manifest_.variants.some((function(a){return a.primary})),c.config_.preferredAudioLanguage||q||shaka.log.warning("No preferred audio language set.  We have chosen an arbitrary language initially"),c.eventManager_.listenOnce(e,"loadedmetadata",(function(){var a=Date.now()/1e3-b.startTimeOfLoad;c.stats_.setLoadLatency(a)})),m.jumpToEnd()}}))},shaka.Player.prototype.onInitializeSrcEqualsDrm_=function(a,b){var e,t,r,g,n=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return 1==b.nextAddress?(e=shaka.util.ManifestParserUtils.ContentType,goog.asserts.assert(n.networkingEngine_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),goog.asserts.assert(n.config_,"|onInitializeSrcEqualsDrm_| should never be called after |destroy|"),t=Date.now()/1e3,r=!0,n.drmEngine_=n.createDrmEngine({netEngine:n.networkingEngine_,onError:function(a){n.onError_(a)},onKeyStatus:function(a){n.onKeyStatus_(a)},onExpirationUpdated:function(a,b){n.onExpirationUpdated_(a,b)},onEvent:function(a){n.dispatchEvent(a),a.type==shaka.Player.EventName.DrmSessionUpdate&&r&&(r=!1,a=Date.now()/1e3-t,n.stats_.setDrmTime(a))}}),n.drmEngine_.configure(n.config_.drm),g={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:"video/mp4",codecs:"",encrypted:!0,drmInfos:[],keyIds:new Set,language:"und",label:null,type:e.VIDEO,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},bandwidth:100,allowedByApplication:!0,allowedByKeySystem:!0},b.yield(n.drmEngine_.initForPlayback([g],[]),2)):b.yield(n.drmEngine_.attach(a.mediaElement),0)}))},shaka.Player.prototype.onSrcEquals_=function(a,b){var e=this;goog.asserts.assert(a.mediaElement,"We should have a media element when loading."),goog.asserts.assert(b.uri,"|has| should have a valid uri when loading."),goog.asserts.assert(!isNaN(b.startTimeOfLoad),"|wants| should tell us when the load was originally requested"),goog.asserts.assert(this.video_==a.mediaElement,"The video element should match our media element"),a.uri=b.uri,a.startTime=b.startTime,this.assetUri_=a.uri,this.playhead_=new shaka.media.SrcEqualsPlayhead(a.mediaElement),null!=a.startTime&&this.playhead_.setStartTime(a.startTime),this.playRateController_=new shaka.media.PlayRateController({getRate:function(){return a.mediaElement.playbackRate},setRate:function(b){a.mediaElement.playbackRate=b},movePlayhead:function(b){a.mediaElement.currentTime+=b}}),this.startBufferManagement_(this.config_.streaming.rebufferingGoal);var t=function(){return e.updateStateHistory_()};this.eventManager_.listen(a.mediaElement,"playing",t),this.eventManager_.listen(a.mediaElement,"pause",t),this.eventManager_.listen(a.mediaElement,"ended",t),this.eventManager_.listen(a.mediaElement,"ratechange",(function(){return e.onRateChange_()})),"none"!=this.video_.preload&&this.eventManager_.listenOnce(this.video_,"loadedmetadata",(function(){var a=Date.now()/1e3-b.startTimeOfLoad;e.stats_.setLoadLatency(a)})),this.video_.audioTracks&&(this.eventManager_.listen(this.video_.audioTracks,"addtrack",(function(){return e.onTracksChanged_()})),this.eventManager_.listen(this.video_.audioTracks,"removetrack",(function(){return e.onTracksChanged_()})),this.eventManager_.listen(this.video_.audioTracks,"change",(function(){return e.onTracksChanged_()}))),this.video_.textTracks&&(this.eventManager_.listen(this.video_.textTracks,"addtrack",(function(a){e.onTracksChanged_(),e.processTimedMetadataSrcEqls_(a)})),this.eventManager_.listen(this.video_.textTracks,"removetrack",(function(){return e.onTracksChanged_()})),this.eventManager_.listen(this.video_.textTracks,"change",(function(){return e.onTracksChanged_()}))),a.mediaElement.src=a.uri,shaka.util.Platform.isTizen()&&a.mediaElement.load(),this.loadMode_=shaka.Player.LoadMode.SRC_EQUALS,this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Streaming));var r=new shaka.util.PublicPromise;shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){r.resolve()}));var n=!1;return this.cleanupOnUnload_.push((function(){n=!0})),shaka.util.MediaReadyState.waitForReadyState(this.video_,HTMLMediaElement.HAVE_CURRENT_DATA,this.eventManager_,(function(){return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return 1==b.nextAddress?n?b.return():(e.setupPreferredAudioOnSrc_(),e.filterTextTracks_().find((function(a){return"disabled"!=a.mode}))?b.jumpTo(2):b.yield(new Promise((function(a){e.eventManager_.listenOnce(e.video_.textTracks,"change",a),new shaka.util.Timer(a).tickAfter(1)})),2)):n?b.return():(e.setupPreferredTextOnSrc_(),void b.jumpToEnd())}))})),this.video_.error?r.reject(this.videoErrorToShakaError_()):"none"==this.video_.preload&&(shaka.log.alwaysWarn('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),r.resolve()),this.eventManager_.listenOnce(this.video_,"error",(function(){r.reject(e.videoErrorToShakaError_())})),new shaka.util.AbortableOperation(r,(function(){var a=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);return r.reject(a),Promise.resolve()}))},shaka.Player.prototype.setupPreferredAudioOnSrc_=function(){var a=this.config_.preferredAudioLanguage;if(""!=a){this.selectAudioLanguage(a);var b=this.config_.preferredVariantRole;""!=b&&this.selectAudioLanguage(a,b)}},shaka.Player.prototype.setupPreferredTextOnSrc_=function(){var a=this.config_.preferredTextLanguage;if(""!=a){this.selectTextLanguage(a);var b=this.config_.preferredTextRole;""!=b&&this.selectTextLanguage(a,b)}},shaka.Player.prototype.processTimedMetadataSrcEqls_=function(a){var b=this,e=a.track;goog.asserts.assert(e instanceof TextTrack,"Wrong track type!"),"metadata"==e.kind&&(e.mode="hidden",this.eventManager_.listen(e,"cuechange",(function(){if(e.activeCues)for(var a=$jscomp.makeIterator(e.activeCues),t=a.next();!t.done;t=a.next())t=t.value,b.dispatchMetadataEvent_(t.startTime,t.endTime,t.type,t.value),b.adManager_&&b.adManager_.onCueMetadataChange(t.value)})),new shaka.util.Timer((function(){for(var a=b.filterTextTracks_(),e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next())e.value.mode="hidden"})).tickNow().tickAfter(.5))},shaka.Player.prototype.processTimedMetadataMediaSrc_=function(a,b,e){for(var t=(a=$jscomp.makeIterator(a)).next();!t.done;t=a.next())if((t=t.value).data&&t.cueTime&&t.frames){for(var r=t.cueTime+b,n=e,g=$jscomp.makeIterator(t.frames),o=g.next();!o.done;o=g.next())this.dispatchMetadataEvent_(r,n,"ID3",o.value);this.adManager_&&this.adManager_.onHlsTimedMetadata(t,r)}},shaka.Player.prototype.dispatchMetadataEvent_=function(a,b,e,t){goog.asserts.assert(!b||a<=b,"Metadata start time should be less or equal to the end time!"),this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Metadata,{startTime:a,endTime:b,metadataType:e,payload:t}))},shaka.Player.filterForAVVariants_=function(a){var b=function(a){return a.video&&a.audio||a.video&&a.video.codecs.includes(",")};a.variants.some(b)&&(shaka.log.debug("Found variant with audio and video content, so filtering out audio-only content."),a.variants=a.variants.filter(b))},shaka.Player.prototype.createDrmEngine=function(a){return new shaka.media.DrmEngine(a,this.config_.drm.updateExpirationTime)},shaka.Player.prototype.createNetworkingEngine=function(){var a=this;return new shaka.net.NetworkingEngine((function(b,e){a.abrManager_&&a.abrManager_.segmentDownloaded(b,e)}))},shaka.Player.prototype.createPlayhead=function(a){var b=this;return goog.asserts.assert(this.manifest_,"Must have manifest"),goog.asserts.assert(this.video_,"Must have video"),new shaka.media.MediaSourcePlayhead(this.video_,this.manifest_,this.config_.streaming,a,(function(){return b.onSeek_()}),(function(a){return b.dispatchEvent(a)}))},shaka.Player.prototype.createPlayheadObserversForMSE_=function(){var a=this;goog.asserts.assert(this.manifest_,"Must have manifest"),goog.asserts.assert(this.regionTimeline_,"Must have region timeline"),goog.asserts.assert(this.video_,"Must have video element");var b=new shaka.media.RegionObserver(this.regionTimeline_);b.setListeners((function(b,e){a.onRegionEvent_(shaka.Player.EventName.TimelineRegionEnter,b)}),(function(b,e){a.onRegionEvent_(shaka.Player.EventName.TimelineRegionExit,b)}),(function(b,e){e||(a.onRegionEvent_(shaka.Player.EventName.TimelineRegionEnter,b),a.onRegionEvent_(shaka.Player.EventName.TimelineRegionExit,b))}));var e=new shaka.media.PlayheadObserverManager(this.video_);return e.manage(b),e},shaka.Player.prototype.startBufferManagement_=function(a){var b=this;goog.asserts.assert(!this.bufferObserver_,"No buffering observer should exist before initialization."),goog.asserts.assert(!this.bufferPoller_,"No buffer timer should exist before initialization."),this.bufferObserver_=new shaka.media.BufferingObserver(1,2),this.bufferObserver_.setState(shaka.media.BufferingObserver.State.STARVING),this.updateBufferingSettings_(a),this.updateBufferState_(),this.bufferPoller_=new shaka.util.Timer((function(){b.pollBufferState_()})).tickEvery(.25)},shaka.Player.prototype.updateBufferingSettings_=function(a){this.bufferObserver_.setThresholds(a,Math.min(shaka.Player.TYPICAL_BUFFERING_THRESHOLD_,a/2))},shaka.Player.prototype.pollBufferState_=function(){switch(goog.asserts.assert(this.video_,"Need a media element to update the buffering observer"),goog.asserts.assert(this.bufferObserver_,"Need a buffering observer to update"),this.loadMode_){case shaka.Player.LoadMode.SRC_EQUALS:var a=this.isBufferedToEndSrc_();break;case shaka.Player.LoadMode.MEDIA_SOURCE:a=this.isBufferedToEndMS_();break;default:a=!1}var b=shaka.media.TimeRangesUtils.bufferedAheadOf(this.video_.buffered,this.video_.currentTime);this.bufferObserver_.update(b,a)&&this.updateBufferState_()},shaka.Player.prototype.createMediaSourceEngine=function(a,b,e,t){return new shaka.media.MediaSourceEngine(a,b,e,t)},shaka.Player.prototype.createStreamingEngine=function(){var a=this;return goog.asserts.assert(this.playhead_&&this.abrManager_&&this.mediaSourceEngine_&&this.manifest_,"Must not be destroyed"),new shaka.media.StreamingEngine(this.manifest_,{getPresentationTime:function(){return a.playhead_.getTime()},getBandwidthEstimate:function(){return a.abrManager_.getBandwidthEstimate()},mediaSourceEngine:this.mediaSourceEngine_,netEngine:this.networkingEngine_,onError:function(b){return a.onError_(b)},onEvent:function(b){return a.dispatchEvent(b)},onManifestUpdate:function(){return a.onManifestUpdate_()},onSegmentAppended:function(){return a.onSegmentAppended_()}})},shaka.Player.prototype.configure=function(a,b){goog.asserts.assert(this.config_,"Config must not be null!"),goog.asserts.assert("object"==typeof a||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof a&&(a=shaka.util.ConfigUtils.convertToConfigObject(a,b)),goog.asserts.assert("object"==typeof a,"Should be an object!"),a.manifest&&a.manifest.dash&&"defaultPresentationDelay"in a.manifest.dash&&(shaka.Deprecate.deprecateFeature(4,"manifest.dash.defaultPresentationDelay configuration","Please Use manifest.defaultPresentationDelay instead."),a.manifest.defaultPresentationDelay=a.manifest.dash.defaultPresentationDelay,delete a.manifest.dash.defaultPresentationDelay);var e=shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,a,this.defaultConfig_());return this.applyConfig_(),e},shaka.Player.prototype.applyConfig_=function(){if(this.parser_){var a=shaka.util.ObjectUtils.cloneObject(this.config_.manifest);this.video_&&"AUDIO"===this.video_.nodeName&&(a.disableVideo=!0),this.parser_.configure(a)}if(this.drmEngine_&&this.drmEngine_.configure(this.config_.drm),this.streamingEngine_){this.streamingEngine_.configure(this.config_.streaming);try{this.filterManifest_(this.manifest_)}catch(e){this.onError_(e)}this.abrManager_&&this.updateAbrManagerVariants_(),!(a=this.streamingEngine_.getCurrentVariant())||a.allowedByApplication&&a.allowedByKeySystem||(shaka.log.debug("Choosing new variant after changing configuration"),this.chooseVariantAndSwitch_())}if(this.mediaSourceEngine_&&(a=this.config_.textDisplayFactory,this.lastTextFactory_!=a)){var b=shaka.util.Functional.callFactory(a);this.mediaSourceEngine_.setTextDisplayer(b),this.lastTextFactory_=a,this.streamingEngine_&&this.streamingEngine_.reloadTextStream()}this.abrManager_&&(this.abrManager_.configure(this.config_.abr),this.config_.abr.enabled?this.abrManager_.enable():this.abrManager_.disable(),this.onAbrStatusChanged_()),this.bufferObserver_&&(a=this.config_.streaming.rebufferingGoal,this.manifest_&&(a=Math.max(a,this.manifest_.minBufferTime)),this.updateBufferingSettings_(a))},shaka.Player.prototype.getConfiguration=function(){goog.asserts.assert(this.config_,"Config must not be null!");var a=this.defaultConfig_();return shaka.util.PlayerConfiguration.mergeConfigObjects(a,this.config_,this.defaultConfig_()),a},shaka.Player.prototype.getSharedConfiguration=function(){return goog.asserts.assert(this.config_,"Cannot call getSharedConfiguration after call destroy!"),this.config_},shaka.Player.prototype.resetConfiguration=function(){for(var a in goog.asserts.assert(this.config_,"Cannot be destroyed"),this.config_)delete this.config_[a];shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,this.defaultConfig_(),this.defaultConfig_()),this.applyConfig_()},shaka.Player.prototype.getLoadMode=function(){return this.loadMode_},shaka.Player.prototype.getMediaElement=function(){return this.video_},shaka.Player.prototype.getNetworkingEngine=function(){return this.networkingEngine_},shaka.Player.prototype.getAssetUri=function(){return this.assetUri_},shaka.Player.prototype.getAdManager=function(){return shaka.log.warnOnce("getAdManager","Shaka Player's ad features are currently in BETA and are NOT yet covered by semantic versioning compatibility guarantees.  The API may change at any time!"),this.adManager_},shaka.Player.prototype.isLive=function(){return this.manifest_?this.manifest_.presentationTimeline.isLive():!(!this.video_||!this.video_.src)&&1/0==this.video_.duration},shaka.Player.prototype.isInProgress=function(){return!!this.manifest_&&this.manifest_.presentationTimeline.isInProgress()},shaka.Player.prototype.isAudioOnly=function(){if(this.manifest_){var a=this.manifest_.variants;return!!a.length&&!a[0].video}return!(!this.video_||!this.video_.src)&&(this.video_.videoTracks?0==this.video_.videoTracks.length:0==this.video_.videoHeight)},shaka.Player.prototype.seekRange=function(){if(this.manifest_){var a=this.manifest_.presentationTimeline;return{start:a.getSeekRangeStart(),end:a.getSeekRangeEnd()}}return this.video_&&this.video_.src&&(a=this.video_.seekable).length?{start:a.start(0),end:a.end(a.length-1)}:{start:0,end:0}},shaka.Player.prototype.keySystem=function(){return shaka.media.DrmEngine.keySystem(this.drmInfo())},shaka.Player.prototype.drmInfo=function(){return this.drmEngine_?this.drmEngine_.getDrmInfo():null},shaka.Player.prototype.getExpiration=function(){return this.drmEngine_?this.drmEngine_.getExpiration():1/0},shaka.Player.prototype.isBuffering=function(){var a=shaka.media.BufferingObserver.State;return!!this.bufferObserver_&&this.bufferObserver_.getState()==a.STARVING},shaka.Player.prototype.getPlaybackRate=function(){return this.video_?this.playRateController_?this.playRateController_.getRealRate():1:0},shaka.Player.prototype.trickPlay=function(a){goog.asserts.assert(0!=a,"Should never set a trick play rate of 0!"),0==a?shaka.log.alwaysWarn("A trick play rate of 0 is unsupported!"):(this.video_.paused&&this.video_.play(),this.playRateController_.set(a),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&(this.abrManager_.playbackRateChanged(a),this.streamingEngine_.setTrickPlay(1<Math.abs(a))))},shaka.Player.prototype.cancelTrickPlay=function(){this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS&&this.playRateController_.set(1),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&(this.playRateController_.set(1),this.abrManager_.playbackRateChanged(1),this.streamingEngine_.setTrickPlay(!1))},shaka.Player.prototype.getVariantTracks=function(){if(this.manifest_){for(var a=this.streamingEngine_?this.streamingEngine_.getCurrentVariant():null,b=[],e=$jscomp.makeIterator(this.manifest_.variants),t=e.next();!t.done;t=e.next())if(t=t.value,shaka.util.StreamUtils.isPlayable(t)){var r=shaka.util.StreamUtils.variantToTrack(t);r.active=t==a,b.push(r)}return b}return this.video_&&this.video_.audioTracks?Array.from(this.video_.audioTracks).map((function(a){return shaka.util.StreamUtils.html5AudioTrackToTrack(a)})):[]},shaka.Player.prototype.getTextTracks=function(){if(this.manifest_){for(var a=this.streamingEngine_?this.streamingEngine_.getCurrentTextStream():null,b=[],e=$jscomp.makeIterator(this.manifest_.textStreams),t=e.next();!t.done;t=e.next()){t=t.value;var r=shaka.util.StreamUtils.textStreamToTrack(t);r.active=t==a,b.push(r)}return b}if(this.video_&&this.video_.src&&this.video_.textTracks){a=this.filterTextTracks_();var n=shaka.util.StreamUtils;return a.map((function(a){return n.html5TextTrackToTrack(a)}))}return[]},shaka.Player.prototype.selectTextTrack=function(a){if(this.manifest_&&this.streamingEngine_){var b=this.manifest_.textStreams.find((function(b){return b.id==a.id}));b?b==this.streamingEngine_.getCurrentTextStream()?shaka.log.debug("Text track already selected."):(this.addTextStreamToSwitchHistory_(b,!1),this.streamingEngine_.switchTextStream(b),this.onTextChanged_(),this.currentTextLanguage_=b.language):shaka.log.error("No stream with id",a.id)}else if(this.video_&&this.video_.src&&this.video_.textTracks){b=this.filterTextTracks_();for(var e=(b=$jscomp.makeIterator(b)).next();!e.done;e=b.next())e=e.value,shaka.util.StreamUtils.html5TrackId(e)==a.id?e.mode=this.isTextVisible_?"showing":"hidden":e.mode="disabled";this.onTextChanged_()}},shaka.Player.prototype.selectVariantTrack=function(a,b,e){if(b=void 0!==b&&b,e=void 0===e?0:e,this.manifest_&&this.streamingEngine_){this.config_.abr.enabled&&shaka.log.alwaysWarn("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var t=this.manifest_.variants.find((function(b){return b.id==a.id}));t?shaka.util.StreamUtils.isPlayable(t)?t==this.streamingEngine_.getCurrentVariant()?shaka.log.debug("Variant already selected."):(this.addVariantToSwitchHistory_(t,!1),this.streamingEngine_.switchVariant(t,b,e),this.onVariantChanged_(),this.currentAdaptationSetCriteria_=new shaka.media.ExampleBasedCriteria(t),this.updateAbrManagerVariants_()):shaka.log.error("Unable to switch to restricted track",a.id):shaka.log.error("No variant with id",a.id)}else if(this.video_&&this.video_.audioTracks){for(b=Array.from(this.video_.audioTracks),e=(b=$jscomp.makeIterator(b)).next();!e.done;e=b.next())e=e.value,shaka.util.StreamUtils.html5TrackId(e)==a.id&&(e.enabled=!0);this.onVariantChanged_()}},shaka.Player.prototype.getAudioLanguagesAndRoles=function(){return shaka.Player.getLanguageAndRolesFrom_(this.getVariantTracks())},shaka.Player.prototype.getTextLanguagesAndRoles=function(){return shaka.Player.getLanguageAndRolesFrom_(this.getTextTracks())},shaka.Player.prototype.getAudioLanguages=function(){return Array.from(shaka.Player.getLanguagesFrom_(this.getVariantTracks()))},shaka.Player.prototype.getTextLanguages=function(){return Array.from(shaka.Player.getLanguagesFrom_(this.getTextTracks()))},shaka.Player.prototype.selectAudioLanguage=function(a,b){var e=shaka.util.LanguageUtils;if(this.manifest_&&this.playhead_)this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(a,b||"",0,"","audio"),this.chooseVariantAndSwitch_();else if(this.video_&&this.video_.audioTracks){for(var t=Array.from(this.video_.audioTracks),r=e.normalize(a),n=(t=$jscomp.makeIterator(t)).next();!n.done;n=t.next()){n=n.value;var g=shaka.util.StreamUtils.html5AudioTrackToTrack(n);e.normalize(g.language)!=r||b&&!g.roles.includes(b)||(n.enabled=!0)}this.onVariantChanged_()}},shaka.Player.prototype.selectTextLanguage=function(a,b){var e=shaka.util.LanguageUtils;if(this.manifest_&&this.playhead_){this.currentTextLanguage_=a,this.currentTextRole_=b||"";var t=this.chooseTextStream_();t&&(t==this.streamingEngine_.getCurrentTextStream()?shaka.log.debug("Text track already selected."):(this.addTextStreamToSwitchHistory_(t,!1),this.shouldStreamText_()&&(this.streamingEngine_.switchTextStream(t),this.onTextChanged_())))}else{var r=e.normalize(a);(t=this.getTextTracks().find((function(a){return e.normalize(a.language)==r&&(!b||a.roles.includes(b))})))&&this.selectTextTrack(t)}},shaka.Player.prototype.selectVariantsByLabel=function(a){if(this.manifest_&&this.playhead_){for(var b=null,e=$jscomp.makeIterator(this.manifest_.variants),t=e.next();!t.done;t=e.next())if((t=t.value).audio.label==a){b=t;break}null==b?shaka.log.warning("No variants were found with label: "+a+". Ignoring the request to switch."):(this.currentAdaptationSetCriteria_=new shaka.media.PreferenceBasedCriteria(b.language,"",0,a),this.chooseVariantAndSwitch_())}},shaka.Player.prototype.isTextTrackVisible=function(){var a=this.isTextVisible_;if(this.mediaSourceEngine_){var b=this.mediaSourceEngine_.getTextDisplayer().isTextVisible();return goog.asserts.assert(b==a,"text visibility has fallen out of sync"),b}return this.video_&&this.video_.src&&this.video_.textTracks?this.filterTextTracks_().some((function(a){return"showing"==a.mode})):a},shaka.Player.prototype.filterTextTracks_=function(){return goog.asserts.assert(this.video_.textTracks,"TextTracks should be valid."),Array.from(this.video_.textTracks).filter((function(a){return"metadata"!=a.kind&&a.label!=shaka.Player.TextTrackLabel}))},shaka.Player.prototype.setTextTrackVisibility=function(a){if(a=!!a,this.isTextVisible_!=a){if(this.isTextVisible_=a,this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE)this.mediaSourceEngine_.getTextDisplayer().setTextVisibility(a),this.config_.streaming.alwaysStreamText||(a?this.streamingEngine_.getCurrentTextStream()||0<(a=shaka.util.StreamUtils.filterStreamsByLanguageAndRole(this.manifest_.textStreams,this.currentTextLanguage_,this.currentTextRole_)).length&&(this.streamingEngine_.switchTextStream(a[0]),this.onTextChanged_()):this.streamingEngine_.unloadTextStream());else if(this.video_&&this.video_.src&&this.video_.textTracks)for(var b=this.filterTextTracks_(),e=(b=$jscomp.makeIterator(b)).next();!e.done;e=b.next())"disabled"!=(e=e.value).mode&&(e.mode=a?"showing":"hidden");this.onTextTrackVisibility_()}},shaka.Player.prototype.getPlayheadTimeAsDate=function(){if(!this.isLive())return shaka.log.warning("getPlayheadTimeAsDate is for live streams!"),null;var a=this.walker_.getCurrentPayload(),b=0;if(this.playhead_)b=this.playhead_.getTime();else if(a){if(null==a.startTime)return new Date;b=a.startTime}return this.manifest_?(a=this.manifest_.presentationTimeline.getPresentationStartTime(),new Date(1e3*(a+b))):this.video_&&this.video_.getStartDate?(a=this.video_.getStartDate(),isNaN(a.getTime())?(shaka.log.warning("EXT-X-PROGRAM-DATETIME required to get playhead time as Date!"),null):new Date(a.getTime()+1e3*b)):(shaka.log.warning("No way to get playhead time as Date!"),null)},shaka.Player.prototype.getPresentationStartTimeAsDate=function(){if(!this.isLive())return shaka.log.warning("getPresentationStartTimeAsDate is for live streams!"),null;if(this.manifest_){var a=this.manifest_.presentationTimeline.getPresentationStartTime();return goog.asserts.assert(null!=a,"Presentation start time should not be null!"),new Date(1e3*a)}return this.video_&&this.video_.getStartDate?(a=this.video_.getStartDate(),isNaN(a.getTime())?(shaka.log.warning("EXT-X-PROGRAM-DATETIME required to get presentation start time as Date!"),null):a):(shaka.log.warning("No way to get presentation start time as Date!"),null)},shaka.Player.prototype.getBufferedInfo=function(){if(this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE)return this.mediaSourceEngine_.getBufferedInfo();var a={total:[],audio:[],video:[],text:[]};return this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS&&(a.total=shaka.media.TimeRangesUtils.getBufferedInfo(this.video_.buffered)),a},shaka.Player.prototype.getStats=function(){if(this.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE&&this.loadMode_!=shaka.Player.LoadMode.SRC_EQUALS)return shaka.util.Stats.getEmptyBlob();this.updateStateHistory_(),goog.asserts.assert(this.video_,"If we have stats, we should have video_");var a=this.video_;if(a.getVideoPlaybackQuality&&(a=a.getVideoPlaybackQuality(),this.stats_.setDroppedFrames(Number(a.droppedVideoFrames),Number(a.totalVideoFrames)),this.stats_.setCorruptedFrames(Number(a.corruptedVideoFrames))),a=this.drmEngine_?this.drmEngine_.getLicenseTime():NaN,this.stats_.setLicenseTime(a),this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE){if(a=this.streamingEngine_.getCurrentVariant()){var b=(this.playRateController_?this.playRateController_.getRealRate():1)*a.bandwidth;this.stats_.setCurrentStreamBandwidth(b)}a&&a.video&&this.stats_.setResolution(a.video.width||NaN,a.video.height||NaN),this.isLive()&&(a=this.getPresentationStartTimeAsDate().valueOf()+1e3*this.seekRange().end,a=(Date.now()-a)/1e3,this.stats_.setLiveLatency(a)),this.manifest_&&this.manifest_.presentationTimeline&&(a=this.manifest_.presentationTimeline.getMaxSegmentDuration(),this.stats_.setMaxSegmentDuration(a)),a=this.abrManager_.getBandwidthEstimate(),this.stats_.setBandwidthEstimate(a)}return this.stats_.getBlob()},shaka.Player.prototype.addTextTrack=function(a,b,e,t,r,n){if(this.loadMode_==shaka.Player.LoadMode.SRC_EQUALS)throw shaka.log.error("Cannot add text when loaded with src="),Error("State error!");if(this.loadMode_!=shaka.Player.LoadMode.MEDIA_SOURCE)throw shaka.log.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");var g=shaka.util.ManifestParserUtils.ContentType,o=this.manifest_.presentationTimeline.getDuration();if(1/0==o)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM);return a={id:this.nextExternalStreamId_++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:shaka.media.SegmentIndex.forSingleSegment(0,o,[a]),mimeType:t,codecs:r||"",kind:e,encrypted:!1,drmInfos:[],keyIds:new Set,language:b,label:n||null,type:g.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null},this.manifest_.textStreams.push(a),this.onTracksChanged_(),shaka.util.StreamUtils.textStreamToTrack(a)},shaka.Player.prototype.setMaxHardwareResolution=function(a,b){this.maxHwRes_.width=a,this.maxHwRes_.height=b},shaka.Player.prototype.retryStreaming=function(){return this.loadMode_==shaka.Player.LoadMode.MEDIA_SOURCE&&this.streamingEngine_.retry()},shaka.Player.prototype.getManifest=function(){return shaka.log.alwaysWarn("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for."),this.manifest_},shaka.Player.prototype.getManifestParserFactory=function(){return this.parserFactory_},shaka.Player.prototype.addVariantToSwitchHistory_=function(a,b){this.stats_.getSwitchHistory().updateCurrentVariant(a,b)},shaka.Player.prototype.addTextStreamToSwitchHistory_=function(a,b){this.stats_.getSwitchHistory().updateCurrentText(a,b)},shaka.Player.prototype.defaultConfig_=function(){var a=this,b=shaka.util.PlayerConfiguration.createDefault();return b.streaming.failureCallback=function(b){a.defaultStreamingFailureCallback_(b)},b.textDisplayFactory=function(){return a.videoContainer_?new shaka.text.UITextDisplayer(a.video_,a.videoContainer_):new shaka.text.SimpleTextDisplayer(a.video_)},b},shaka.Player.prototype.setVideoContainer=function(a){this.videoContainer_=a},shaka.Player.prototype.defaultStreamingFailureCallback_=function(a){var b=[shaka.util.Error.Code.BAD_HTTP_STATUS,shaka.util.Error.Code.HTTP_ERROR,shaka.util.Error.Code.TIMEOUT];this.isLive()&&b.includes(a.code)&&(a.severity=shaka.util.Error.Severity.RECOVERABLE,shaka.log.warning("Live streaming error.  Retrying automatically..."),this.retryStreaming())},shaka.Player.prototype.createTextStreamsForClosedCaptions_=function(a){a=shaka.util.ManifestParserUtils.ContentType;for(var b=shaka.util.ManifestParserUtils.TextStreamKind,e=new Map,t=$jscomp.makeIterator(this.manifest_.variants),r=t.next();!r.done;r=t.next())if((r=r.value).video&&r.video.closedCaptions){r=r.video;for(var n=$jscomp.makeIterator(r.closedCaptions.keys()),g=n.next();!g.done;g=n.next())if(g=g.value,!e.has(g)){var o={id:this.nextExternalStreamId_++,originalId:g,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:shaka.util.MimeUtils.CLOSED_CAPTION_MIMETYPE,codecs:"",kind:b.CLOSED_CAPTION,encrypted:!1,drmInfos:[],keyIds:new Set,language:r.closedCaptions.get(g),label:null,type:a.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:r.roles,channelsCount:null,audioSamplingRate:null,closedCaptions:null};e.set(g,o)}}for(b=(a=$jscomp.makeIterator(e.values())).next();!b.done;b=a.next())this.manifest_.textStreams.push(b.value)},shaka.Player.prototype.filterManifest_=function(a){goog.asserts.assert(a,"Manifest should exist!"),goog.asserts.assert(this.video_,"Must not be destroyed");var b=shaka.util.StreamUtils,e=this.streamingEngine_?this.streamingEngine_.getCurrentVariant():null;if(b.filterManifest(this.drmEngine_,e,a),!a.variants.some(b.isPlayable))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.CONTENT_UNSUPPORTED_BY_BROWSER);if(shaka.util.StreamUtils.applyRestrictions(a.variants,this.config_.restrictions,this.maxHwRes_)&&this.streamingEngine_&&this.onTracksChanged_(),b=this.drmEngine_?this.drmEngine_.getDrmInfo():null)for(var t=(e=$jscomp.makeIterator(a.variants)).next();!t.done;t=e.next()){t=((t=t.value).video?t.video.drmInfos:[]).concat(t.audio?t.audio.drmInfos:[]);for(var r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())if((r=r.value).keySystem==b.keySystem)for(var n=(r=$jscomp.makeIterator(r.initData||[])).next();!n.done;n=r.next())n=n.value,this.drmEngine_.newInitData(n.initDataType,n.initData)}this.checkRestrictedVariants_(a)},shaka.Player.prototype.adjustStartTime_=function(a,b){var e,t,r,n,g;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){return 1==o.nextAddress?(e=a.audio,t=a.video,r=function(a,b){var e,t;return $jscomp.asyncExecutePromiseGeneratorProgram((function(r){return 1==r.nextAddress?a?r.yield(a.createSegmentIndex(),2):r.return(null):(e=a.segmentIndex[Symbol.iterator]().seek(b))?(t=e.startTime,goog.asserts.assert(t<=b,"Segment should start before target time!"),r.return(t)):r.return(null)}))},o.yield(r(e,b),2)):3!=o.nextAddress?(n=o.yieldResult,o.yield(r(t,b),3)):null!=(g=o.yieldResult)&&null!=n?o.return(Math.max(g,n)):null!=g?o.return(g):null!=n?o.return(n):o.return(b)}))},shaka.Player.prototype.updateBufferState_=function(){var a=this.isBuffering();shaka.log.v2("Player changing buffering state to",a),this.stats_&&this.bufferObserver_&&this.playhead_&&(this.playRateController_.setBuffering(a),this.updateStateHistory_()),this.dispatchEvent(this.makeEvent_(shaka.Player.EventName.Buffering,{buffering:a}))},shaka.Player.prototype.onRateChange_=function(){var a=this.video_.playbackRate;0!=a&&(this.playRateController_&&this.playRateController_.set(a),a=this.makeEvent_(shaka.Player.EventName.RateChange),this.dispatchEvent(a))},shaka.Player.prototype.updateStateHistory_=function(){if(this.stats_&&this.bufferObserver_){var a=shaka.media.BufferingObserver.State,b=this.stats_.getStateHistory();this.bufferObserver_.getState()==a.STARVING?b.update("buffering"):this.video_.paused?b.update("paused"):this.video_.ended?b.update("ended"):b.update("playing")}},shaka.Player.prototype.onSeek_=function(){this.playheadObservers_&&this.playheadObservers_.notifyOfSeek(),this.streamingEngine_&&this.streamingEngine_.seeked(),this.bufferObserver_&&this.pollBufferState_()},shaka.Player.prototype.updateAbrManagerVariants_=function(){try{goog.asserts.assert(this.manifest_,"Manifest should exist by now!"),this.checkRestrictedVariants_(this.manifest_)}catch(e){return this.onError_(e),!1}var a=this.manifest_.variants.filter((function(a){return shaka.util.StreamUtils.isPlayable(a)}));return a=this.currentAdaptationSetCriteria_.create(a),this.abrManager_.setVariants(Array.from(a.values())),!0},shaka.Player.prototype.chooseVariant_=function(){return this.updateAbrManagerVariants_()?this.abrManager_.chooseVariant():null},shaka.Player.prototype.chooseTextStream_=function(){return shaka.util.StreamUtils.filterStreamsByLanguageAndRole(this.manifest_.textStreams,this.currentTextLanguage_,this.currentTextRole_)[0]||null},shaka.Player.prototype.chooseVariantAndSwitch_=function(){goog.asserts.assert(this.config_,"Must not be destroyed");var a=this.chooseVariant_();if(a){if(a==this.streamingEngine_.getCurrentVariant())return void shaka.log.debug("Variant already selected.");this.addVariantToSwitchHistory_(a,!0),this.streamingEngine_.switchVariant(a,!0,0),this.onVariantChanged_()}this.onAdaptation_()},shaka.Player.prototype.setInitialTextState_=function(a,b){b?(a.audio&&this.shouldInitiallyShowText_(a.audio,b)&&(this.isTextVisible_=!0),this.isTextVisible_&&(this.mediaSourceEngine_.getTextDisplayer().setTextVisibility(!0),goog.asserts.assert(this.shouldStreamText_(),"Should be streaming text")),this.onTextTrackVisibility_()):this.isTextVisible_=!1},shaka.Player.prototype.shouldInitiallyShowText_=function(a,b){var e=shaka.util.LanguageUtils,t=e.normalize(this.config_.preferredTextLanguage),r=e.normalize(a.language),n=e.normalize(b.language);return e.areLanguageCompatible(n,t)&&!e.areLanguageCompatible(r,n)},shaka.Player.prototype.onManifestUpdate_=function(){this.parser_&&this.parser_.update&&this.parser_.update()},shaka.Player.prototype.onSegmentAppended_=function(){this.playhead_&&this.playhead_.notifyOfBufferingChange(),this.pollBufferState_()},shaka.Player.prototype.switch_=function(a,b,e){b=void 0!==b&&b,e=void 0===e?0:e,shaka.log.debug("switch_"),goog.asserts.assert(this.config_.abr.enabled,"AbrManager should not call switch while disabled!"),goog.asserts.assert(this.manifest_,"We need a manifest to switch variants."),this.streamingEngine_&&a!=this.streamingEngine_.getCurrentVariant()&&(this.addVariantToSwitchHistory_(a,!0),this.streamingEngine_.switchVariant(a,b,e),this.onAdaptation_())},shaka.Player.prototype.onAdaptation_=function(){var a=this.makeEvent_(shaka.Player.EventName.Adaptation);this.delayDispatchEvent_(a)},shaka.Player.prototype.onTracksChanged_=function(){var a=this.makeEvent_(shaka.Player.EventName.TracksChanged);this.delayDispatchEvent_(a)},shaka.Player.prototype.onVariantChanged_=function(){var a=this.makeEvent_(shaka.Player.EventName.VariantChanged);this.delayDispatchEvent_(a)},shaka.Player.prototype.onTextChanged_=function(){var a=this.makeEvent_(shaka.Player.EventName.TextChanged);this.delayDispatchEvent_(a)},shaka.Player.prototype.onTextTrackVisibility_=function(){var a=this.makeEvent_(shaka.Player.EventName.TextTrackVisibility);this.delayDispatchEvent_(a)},shaka.Player.prototype.onAbrStatusChanged_=function(){var a=this.makeEvent_(shaka.Player.EventName.AbrStatusChanged,{newStatus:this.config_.abr.enabled});this.delayDispatchEvent_(a)},shaka.Player.prototype.onError_=function(a){if(goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type!"),this.loadMode_!=shaka.Player.LoadMode.DESTROYED){var b=this.makeEvent_(shaka.Player.EventName.Error,{detail:a});this.dispatchEvent(b),b.defaultPrevented&&(a.handled=!0)}},shaka.Player.prototype.onRegionEvent_=function(a,b){this.dispatchEvent(this.makeEvent_(a,{detail:{schemeIdUri:b.schemeIdUri,value:b.value,startTime:b.startTime,endTime:b.endTime,id:b.id,eventElement:b.eventElement}}))},shaka.Player.prototype.videoErrorToShakaError_=function(){if(goog.asserts.assert(this.video_.error,"Video error expected, but missing!"),!this.video_.error)return null;var a=this.video_.error.code;if(1==a)return null;var b=this.video_.error.msExtendedCode;return b&&(0>b&&(b+=Math.pow(2,32)),b=b.toString(16)),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.VIDEO_ERROR,a,b,this.video_.error.message)},shaka.Player.prototype.onVideoError_=function(a){(a=this.videoErrorToShakaError_())&&this.onError_(a)},shaka.Player.prototype.onKeyStatus_=function(a){if(this.streamingEngine_){var b=Object.keys(a);0==b.length&&shaka.log.warning("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var e=1==b.length&&"00"==b[0];e&&shaka.log.warning("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var t=shaka.Player.restrictedStatuses_,r=!1;if(b.length)for(var n=(b=$jscomp.makeIterator(this.manifest_.variants)).next();!n.done;n=b.next()){n=n.value;for(var g=shaka.util.StreamUtils.getVariantStreams(n),o=(g=$jscomp.makeIterator(g)).next();!o.done;o=g.next()){var l=o.value;if(o=n.allowedByKeySystem,l.keyIds.size){n.allowedByKeySystem=!0;for(var h=(l=$jscomp.makeIterator(l.keyIds)).next();!h.done;h=l.next())h=h.value,h=a[e?"00":h],n.allowedByKeySystem=n.allowedByKeySystem&&!!h&&!t.includes(h)}o!=n.allowedByKeySystem&&(r=!0)}}r&&this.updateAbrManagerVariants_(),(a=this.streamingEngine_.getCurrentVariant())&&!a.allowedByKeySystem&&(shaka.log.debug("Choosing new streams after key status changed"),this.chooseVariantAndSwitch_()),r&&this.onTracksChanged_()}},shaka.Player.prototype.onExpirationUpdated_=function(a,b){this.parser_&&this.parser_.onExpirationUpdated&&this.parser_.onExpirationUpdated(a,b);var e=this.makeEvent_(shaka.Player.EventName.ExpirationUpdated);this.dispatchEvent(e)},shaka.Player.prototype.shouldStreamText_=function(){return this.config_.streaming.alwaysStreamText||this.isTextTrackVisible()},shaka.Player.applyPlayRange_=function(a,b,e){0<b&&(a.isLive()?shaka.log.warning("|playRangeStart| has been configured for live content. Ignoring the setting."):a.setUserSeekStart(b)),e<(b=a.getDuration())&&(a.isLive()?shaka.log.warning("|playRangeEnd| has been configured for live content. Ignoring the setting."):a.setDuration(e))},shaka.Player.prototype.checkRestrictedVariants_=function(a){var b=shaka.Player.restrictedStatuses_,e=this.drmEngine_?this.drmEngine_.getKeyStatuses():{},t=Object.keys(e);t=t.length&&"00"==t[0];for(var r=!1,n=!1,g=new Set,o=new Set,l=(a=$jscomp.makeIterator(a.variants)).next();!l.done;l=a.next()){var h=[];(l=l.value).audio&&h.push(l.audio),l.video&&h.push(l.video);for(var d=(h=$jscomp.makeIterator(h)).next();!d.done;d=h.next())if((d=d.value).keyIds.size)for(var c=(d=$jscomp.makeIterator(d.keyIds)).next();!c.done;c=d.next()){c=c.value;var p=e[t?"00":c];p?b.includes(p)&&o.add(p):g.add(c)}l.allowedByApplication?l.allowedByKeySystem&&(r=!0):n=!0}if(!r)throw b={hasAppRestrictions:n,missingKeys:Array.from(g),restrictedKeyStatuses:Array.from(o)},new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.RESTRICTIONS_CANNOT_BE_MET,b)},shaka.Player.prototype.delayDispatchEvent_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){if(1==e.nextAddress)return e.yield(Promise.resolve(),2);b.loadMode_!=shaka.Player.LoadMode.DESTROYED&&b.dispatchEvent(a),e.jumpToEnd()}))},shaka.Player.getLanguagesFrom_=function(a){for(var b=new Set,e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next())(e=e.value).language?b.add(shaka.util.LanguageUtils.normalize(e.language)):b.add("und");return b},shaka.Player.getLanguageAndRolesFrom_=function(a){for(var b=new Map,e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next()){var t=e.value;e="und";var r=[];for(t.language&&(e=shaka.util.LanguageUtils.normalize(t.language)),(r="variant"==t.type?t.audioRoles:t.roles)&&r.length||(r=[""]),b.has(e)||b.set(e,new Set),r=(t=$jscomp.makeIterator(r)).next();!r.done;r=t.next())r=r.value,b.get(e).add(r)}var n=[];return b.forEach((function(a,b){for(var e=$jscomp.makeIterator(a),t=e.next();!t.done;t=e.next())n.push({language:b,role:t.value})})),n},shaka.Player.prototype.isBufferedToEndMS_=function(){if(goog.asserts.assert(this.video_,"We need a video element to get buffering information"),goog.asserts.assert(this.mediaSourceEngine_,"We need a media source engine to get buffering information"),goog.asserts.assert(this.manifest_,"We need a manifest to get buffering information"),this.video_.ended||this.mediaSourceEngine_.ended())return!0;if(this.manifest_.presentationTimeline.isLive()){var a=this.manifest_.presentationTimeline.getSegmentAvailabilityEnd(),b=shaka.media.TimeRangesUtils.bufferEnd(this.video_.buffered);if(null!=b&&b>=a)return!0}return!1},shaka.Player.prototype.isBufferedToEndSrc_=function(){if(goog.asserts.assert(this.video_,"We need a video element to get buffering information"),this.video_.ended)return!0;var a=shaka.media.TimeRangesUtils.bufferEnd(this.video_.buffered);return null!=a&&a>=this.video_.duration-1},shaka.Player.prototype.createAbortLoadError_=function(){return new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.LOAD_INTERRUPTED)},shaka.Player.prototype.getNextStep_=function(a,b,e,t){var r=null;return a==this.detachNode_&&(r=e==this.detachNode_?this.detachNode_:this.attachNode_),a==this.attachNode_&&(r=this.getNextAfterAttach_(e,b,t)),a==this.mediaSourceNode_&&(r=this.getNextAfterMediaSource_(e,b,t)),a==this.parserNode_&&(r=this.getNextMatchingAllDependencies_(this.loadNode_,this.manifestNode_,this.unloadNode_,e,b,t)),a==this.manifestNode_&&(r=this.getNextMatchingAllDependencies_(this.loadNode_,this.drmNode_,this.unloadNode_,e,b,t)),a==this.drmNode_&&(r=this.getNextMatchingAllDependencies_(this.loadNode_,this.loadNode_,this.unloadNode_,e,b,t)),a==this.srcEqualsDrmNode_&&(r=e==this.srcEqualsNode_&&b.mediaElement==t.mediaElement?this.srcEqualsNode_:this.unloadNode_),a!=this.loadNode_&&a!=this.srcEqualsNode_||(r=this.unloadNode_),a==this.unloadNode_&&(r=this.getNextAfterUnload_(e,b,t)),goog.asserts.assert(r,"Missing next step!"),r},shaka.Player.prototype.getNextAfterAttach_=function(a,b,e){return a==this.detachNode_||b.mediaElement!=e.mediaElement?this.detachNode_:a==this.attachNode_?this.attachNode_:a==this.mediaSourceNode_||a==this.loadNode_?this.mediaSourceNode_:a==this.srcEqualsNode_?this.srcEqualsDrmNode_:null},shaka.Player.prototype.getNextAfterMediaSource_=function(a,b,e){return a==this.loadNode_&&b.mediaElement==e.mediaElement?this.parserNode_:this.unloadNode_},shaka.Player.prototype.getNextAfterUnload_=function(a,b,e){return e.mediaElement&&b.mediaElement==e.mediaElement?this.attachNode_:this.detachNode_},shaka.Player.prototype.getNextMatchingAllDependencies_=function(a,b,e,t,r,n){return t==a&&r.mediaElement==n.mediaElement&&r.uri==n.uri&&r.mimeType==n.mimeType?b:e},shaka.Player.createEmptyPayload_=function(){return{mediaElement:null,mimeType:null,startTime:null,startTimeOfLoad:NaN,uri:null}},shaka.Player.prototype.wrapWalkerListenersWithPromise_=function(a){var b=this;return new Promise((function(e,t){a.onCancel=function(){return t(b.createAbortLoadError_())},a.onEnd=function(){return e()},a.onError=function(a){return t(a)},a.onSkip=function(){return t(b.createAbortLoadError_())}}))},goog.exportSymbol("shaka.Player",shaka.Player),goog.exportProperty(shaka.Player.prototype,"setVideoContainer",shaka.Player.prototype.setVideoContainer),goog.exportProperty(shaka.Player.prototype,"getManifestParserFactory",shaka.Player.prototype.getManifestParserFactory),goog.exportProperty(shaka.Player.prototype,"getManifest",shaka.Player.prototype.getManifest),goog.exportProperty(shaka.Player.prototype,"retryStreaming",shaka.Player.prototype.retryStreaming),goog.exportProperty(shaka.Player.prototype,"setMaxHardwareResolution",shaka.Player.prototype.setMaxHardwareResolution),goog.exportProperty(shaka.Player.prototype,"addTextTrack",shaka.Player.prototype.addTextTrack),goog.exportProperty(shaka.Player.prototype,"getStats",shaka.Player.prototype.getStats),goog.exportProperty(shaka.Player.prototype,"getBufferedInfo",shaka.Player.prototype.getBufferedInfo),goog.exportProperty(shaka.Player.prototype,"getPresentationStartTimeAsDate",shaka.Player.prototype.getPresentationStartTimeAsDate),goog.exportProperty(shaka.Player.prototype,"getPlayheadTimeAsDate",shaka.Player.prototype.getPlayheadTimeAsDate),goog.exportProperty(shaka.Player.prototype,"setTextTrackVisibility",shaka.Player.prototype.setTextTrackVisibility),goog.exportProperty(shaka.Player.prototype,"isTextTrackVisible",shaka.Player.prototype.isTextTrackVisible),goog.exportProperty(shaka.Player.prototype,"selectVariantsByLabel",shaka.Player.prototype.selectVariantsByLabel),goog.exportProperty(shaka.Player.prototype,"selectTextLanguage",shaka.Player.prototype.selectTextLanguage),goog.exportProperty(shaka.Player.prototype,"selectAudioLanguage",shaka.Player.prototype.selectAudioLanguage),goog.exportProperty(shaka.Player.prototype,"getTextLanguages",shaka.Player.prototype.getTextLanguages),goog.exportProperty(shaka.Player.prototype,"getAudioLanguages",shaka.Player.prototype.getAudioLanguages),goog.exportProperty(shaka.Player.prototype,"getTextLanguagesAndRoles",shaka.Player.prototype.getTextLanguagesAndRoles),goog.exportProperty(shaka.Player.prototype,"getAudioLanguagesAndRoles",shaka.Player.prototype.getAudioLanguagesAndRoles),goog.exportProperty(shaka.Player.prototype,"selectVariantTrack",shaka.Player.prototype.selectVariantTrack),goog.exportProperty(shaka.Player.prototype,"selectTextTrack",shaka.Player.prototype.selectTextTrack),goog.exportProperty(shaka.Player.prototype,"getTextTracks",shaka.Player.prototype.getTextTracks),goog.exportProperty(shaka.Player.prototype,"getVariantTracks",shaka.Player.prototype.getVariantTracks),goog.exportProperty(shaka.Player.prototype,"cancelTrickPlay",shaka.Player.prototype.cancelTrickPlay),goog.exportProperty(shaka.Player.prototype,"trickPlay",shaka.Player.prototype.trickPlay),goog.exportProperty(shaka.Player.prototype,"getPlaybackRate",shaka.Player.prototype.getPlaybackRate),goog.exportProperty(shaka.Player.prototype,"isBuffering",shaka.Player.prototype.isBuffering),goog.exportProperty(shaka.Player.prototype,"getExpiration",shaka.Player.prototype.getExpiration),goog.exportProperty(shaka.Player.prototype,"drmInfo",shaka.Player.prototype.drmInfo),goog.exportProperty(shaka.Player.prototype,"keySystem",shaka.Player.prototype.keySystem),goog.exportProperty(shaka.Player.prototype,"seekRange",shaka.Player.prototype.seekRange),goog.exportProperty(shaka.Player.prototype,"isAudioOnly",shaka.Player.prototype.isAudioOnly),goog.exportProperty(shaka.Player.prototype,"isInProgress",shaka.Player.prototype.isInProgress),goog.exportProperty(shaka.Player.prototype,"isLive",shaka.Player.prototype.isLive),goog.exportProperty(shaka.Player.prototype,"getAdManager",shaka.Player.prototype.getAdManager),goog.exportProperty(shaka.Player.prototype,"getAssetUri",shaka.Player.prototype.getAssetUri),goog.exportProperty(shaka.Player.prototype,"getNetworkingEngine",shaka.Player.prototype.getNetworkingEngine),goog.exportProperty(shaka.Player.prototype,"getMediaElement",shaka.Player.prototype.getMediaElement),goog.exportProperty(shaka.Player.prototype,"getLoadMode",shaka.Player.prototype.getLoadMode),goog.exportProperty(shaka.Player.prototype,"resetConfiguration",shaka.Player.prototype.resetConfiguration),goog.exportProperty(shaka.Player.prototype,"getConfiguration",shaka.Player.prototype.getConfiguration),goog.exportProperty(shaka.Player.prototype,"configure",shaka.Player.prototype.configure),goog.exportProperty(shaka.Player.prototype,"load",shaka.Player.prototype.load),goog.exportProperty(shaka.Player.prototype,"unload",shaka.Player.prototype.unload),goog.exportProperty(shaka.Player.prototype,"detach",shaka.Player.prototype.detach),goog.exportProperty(shaka.Player.prototype,"attach",shaka.Player.prototype.attach),goog.exportProperty(shaka.Player,"probeSupport",shaka.Player.probeSupport),goog.exportProperty(shaka.Player,"isBrowserSupported",shaka.Player.isBrowserSupported),goog.exportProperty(shaka.Player,"setAdManagerFactory",shaka.Player.setAdManagerFactory),goog.exportProperty(shaka.Player,"registerSupportPlugin",shaka.Player.registerSupportPlugin),goog.exportProperty(shaka.Player.prototype,"destroy",shaka.Player.prototype.destroy),shaka.Player.EventName={AbrStatusChanged:"abrstatuschanged",Adaptation:"adaptation",Buffering:"buffering",DrmSessionUpdate:"drmsessionupdate",Emsg:"emsg",Error:"error",ExpirationUpdated:"expirationupdated",LargeGap:"largegap",Loaded:"loaded",Loading:"loading",ManifestParsed:"manifestparsed",Metadata:"metadata",OnStateChange:"onstatechange",OnStateIdle:"onstateidle",RateChange:"ratechange",SessionDataEvent:"sessiondata",Streaming:"streaming",TextChanged:"textchanged",TextTrackVisibility:"texttrackvisibility",TimelineRegionAdded:"timelineregionadded",TimelineRegionEnter:"timelineregionenter",TimelineRegionExit:"timelineregionexit",TracksChanged:"trackschanged",Unloading:"unloading",VariantChanged:"variantchanged"},shaka.Player.LoadMode={DESTROYED:0,NOT_LOADED:1,MEDIA_SOURCE:2,SRC_EQUALS:3},goog.exportProperty(shaka.Player,"LoadMode",shaka.Player.LoadMode),shaka.Player.TYPICAL_BUFFERING_THRESHOLD_=.5,shaka.Player.version="v3.0.2-master-18-gbc85a5f9-dirty-debug",goog.exportProperty(shaka.Player,"version",shaka.Player.version),shaka.Deprecate.init(shaka.Player.version),shaka.Player.restrictedStatuses_=["output-restricted","internal-error"],shaka.Player.supportPlugins_={},shaka.Player.adManagerFactory_=null,shaka.Player.TextTrackLabel="Shaka Player TextTrack",shaka.ads={},shaka.ads.AdsStats=function(){this.loadTimes_=[],this.skipped_=this.playedCompletely_=this.started_=0},shaka.ads.AdsStats.prototype.addLoadTime=function(a){this.loadTimes_.push(a)},shaka.ads.AdsStats.prototype.incrementStarted=function(){this.started_++},shaka.ads.AdsStats.prototype.incrementPlayedCompletely=function(){this.playedCompletely_++},shaka.ads.AdsStats.prototype.incrementSkipped=function(){this.skipped_++},shaka.ads.AdsStats.prototype.getBlob=function(){return{loadTimes:this.loadTimes_,started:this.started_,playedCompletely:this.playedCompletely_,skipped:this.skipped_}},shaka.ads.ClientSideAd=function(a,b){var e=this;this.ad_=a,this.manager_=b,this.isPaused_=!1,this.volume_=this.manager_.getVolume(),this.eventManager_=new shaka.util.EventManager,this.eventManager_.listen(this.manager_,google.ima.AdEvent.Type.PAUSED,(function(){e.isPaused_=!0})),this.eventManager_.listen(this.manager_,google.ima.AdEvent.Type.RESUMED,(function(){e.isPaused_=!1}))},shaka.ads.ClientSideAd.prototype.getDuration=function(){return this.ad_.getDuration()},shaka.ads.ClientSideAd.prototype.getRemainingTime=function(){return this.manager_.getRemainingTime()},shaka.ads.ClientSideAd.prototype.isPaused=function(){return this.isPaused_},shaka.ads.ClientSideAd.prototype.isSkippable=function(){return 0<=this.ad_.getSkipTimeOffset()},shaka.ads.ClientSideAd.prototype.getTimeUntilSkippable=function(){var a=this.ad_.getSkipTimeOffset();return a=this.getRemainingTime()-a,Math.max(a,0)},shaka.ads.ClientSideAd.prototype.canSkipNow=function(){return this.manager_.getAdSkippableState()},shaka.ads.ClientSideAd.prototype.skip=function(){return this.manager_.skip()},shaka.ads.ClientSideAd.prototype.setPaused=function(a){this.isPaused_=a},shaka.ads.ClientSideAd.prototype.pause=function(){return this.manager_.pause()},shaka.ads.ClientSideAd.prototype.play=function(){return this.manager_.resume()},shaka.ads.ClientSideAd.prototype.getVolume=function(){return this.manager_.getVolume()},shaka.ads.ClientSideAd.prototype.setVolume=function(a){return this.manager_.setVolume(a)},shaka.ads.ClientSideAd.prototype.isMuted=function(){return 0==this.manager_.getVolume()},shaka.ads.ClientSideAd.prototype.resize=function(a,b){this.manager_.resize(a,b,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},shaka.ads.ClientSideAd.prototype.setMuted=function(a){a?(this.volume_=this.getVolume(),this.setVolume(0)):this.setVolume(this.volume_)},shaka.ads.ClientSideAd.prototype.getSequenceLength=function(){var a=this.ad_.getAdPodInfo();return null==a?1:a.getTotalAds()},shaka.ads.ClientSideAd.prototype.getPositionInSequence=function(){var a=this.ad_.getAdPodInfo();return null==a?1:a.getAdPosition()},shaka.ads.ClientSideAd.prototype.release=function(){this.manager_=this.ad_=null},goog.exportSymbol("shaka.ads.ClientSideAd",shaka.ads.ClientSideAd),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"release",shaka.ads.ClientSideAd.prototype.release),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getPositionInSequence",shaka.ads.ClientSideAd.prototype.getPositionInSequence),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getSequenceLength",shaka.ads.ClientSideAd.prototype.getSequenceLength),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"setMuted",shaka.ads.ClientSideAd.prototype.setMuted),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"resize",shaka.ads.ClientSideAd.prototype.resize),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isMuted",shaka.ads.ClientSideAd.prototype.isMuted),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"setVolume",shaka.ads.ClientSideAd.prototype.setVolume),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getVolume",shaka.ads.ClientSideAd.prototype.getVolume),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"play",shaka.ads.ClientSideAd.prototype.play),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"pause",shaka.ads.ClientSideAd.prototype.pause),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"skip",shaka.ads.ClientSideAd.prototype.skip),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"canSkipNow",shaka.ads.ClientSideAd.prototype.canSkipNow),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getTimeUntilSkippable",shaka.ads.ClientSideAd.prototype.getTimeUntilSkippable),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isSkippable",shaka.ads.ClientSideAd.prototype.isSkippable),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"isPaused",shaka.ads.ClientSideAd.prototype.isPaused),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getRemainingTime",shaka.ads.ClientSideAd.prototype.getRemainingTime),goog.exportProperty(shaka.ads.ClientSideAd.prototype,"getDuration",shaka.ads.ClientSideAd.prototype.getDuration),shaka.ads.ClientSideAdManager=function(a,b,e,t){var r=this;this.adContainer_=a,this.video_=b,this.requestAdsStartTime_=NaN,this.onEvent_=t,this.ad_=null,this.eventManager_=new shaka.util.EventManager,google.ima.settings.setLocale(e),(a=new google.ima.AdDisplayContainer(this.adContainer_,this.video_)).initialize(),this.adsLoader_=new google.ima.AdsLoader(a),this.adsLoader_.getSettings().setPlayerType("shaka-player"),this.adsLoader_.getSettings().setPlayerVersion(shaka.Player.version),this.imaAdsManager_=null,this.eventManager_.listenOnce(this.adsLoader_,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,(function(a){r.onAdsManagerLoaded_(a)})),this.eventManager_.listen(this.adsLoader_,google.ima.AdEvent.Type.AD_ERROR,(function(a){r.onAdError_(a)})),this.video_.onended=function(){r.adsLoader_.contentComplete()}},shaka.ads.ClientSideAdManager.prototype.requestAds=function(a){goog.asserts.assert(a.adTagUrl.length,"The ad tag needs to be set up before requesting ads."),this.requestAdsStartTime_=Date.now()/1e3,this.adsLoader_.requestAds(a)},shaka.ads.ClientSideAdManager.prototype.stop=function(){this.imaAdsManager_.stop()},shaka.ads.ClientSideAdManager.prototype.onAdError_=function(a){shaka.log.warning("There was an ad error from the IMA SDK: "+a.getError()),shaka.log.warning("Resuming playback."),this.onAdComplete_(null),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,{cuepoints:[]}))},shaka.ads.ClientSideAdManager.prototype.onAdsManagerLoaded_=function(a){var b=this;goog.asserts.assert(null!=this.video_,"Video should not be null!");var e=Date.now()/1e3-this.requestAdsStartTime_;if(this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.ADS_LOADED,{loadTime:e})),this.imaAdsManager_=a.getAdsManager(this.video_),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.IMA_AD_MANAGER_LOADED,{imaAdsManager:this.imaAdsManager_})),(e=this.imaAdsManager_.getCuePoints()).length){a=[];for(var t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next())t=new shaka.ads.CuePoint(t.value),a.push(t);this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,{cuepoints:a}))}this.addImaEventListeners_();try{this.imaAdsManager_.init(this.video_.offsetWidth,this.video_.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),this.eventManager_.listen(this.video_,"loadeddata",(function(){b.imaAdsManager_.resize(b.video_.offsetWidth,b.video_.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)})),this.imaAdsManager_.start()}catch(e){this.onAdComplete_(null)}},shaka.ads.ClientSideAdManager.prototype.addImaEventListeners_=function(){var a=this;this.eventManager_.listen(this.imaAdsManager_,google.ima.AdErrorEvent.Type.AD_ERROR,(function(b){a.onAdError_(b)})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,(function(b){a.onAdStart_(b)})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.STARTED,(function(b){a.onAdStart_(b)})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.FIRST_QUARTILE,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_FIRST_QUARTILE,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.MIDPOINT,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_MIDPOINT,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.THIRD_QUARTILE,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_THIRD_QUARTILE,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.COMPLETE,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_COMPLETE,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,(function(b){a.onAdComplete_(b)})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,(function(b){a.onAdComplete_(b)})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.SKIPPED,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_SKIPPED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.VOLUME_CHANGED,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_VOLUME_CHANGED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.VOLUME_MUTED,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_MUTED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.PAUSED,(function(b){goog.asserts.assert(null!=a.ad_,"Ad should not be null!"),a.ad_.setPaused(!0),a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_PAUSED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.RESUMED,(function(b){goog.asserts.assert(null!=a.ad_,"Ad should not be null!"),a.ad_.setPaused(!1),a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_RESUMED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,(function(b){goog.asserts.assert(null!=a.ad_,"Ad should not be null!"),a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_SKIP_STATE_CHANGED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.CLICK,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_CLICKED))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_PROGRESS,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_PROGRESS,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_BUFFERING,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_BUFFERING,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.IMPRESSION,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_IMPRESSION,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.DURATION_CHANGE,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_DURATION_CHANGED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.USER_CLOSE,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_CLOSED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LOADED,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_LOADED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.ALL_ADS_COMPLETED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LINEAR_CHANGED,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_LINEAR_CHANGED,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_METADATA,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_METADATA,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.LOG,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_RECOVERABLE_ERROR,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.AD_BREAK_READY,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_BREAK_READY,{originalEvent:b}))})),this.eventManager_.listen(this.imaAdsManager_,google.ima.AdEvent.Type.INTERACTION,(function(b){a.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_INTERACTION,{originalEvent:b}))}))},shaka.ads.ClientSideAdManager.prototype.onAdStart_=function(a){goog.asserts.assert(this.imaAdsManager_,"Should have an ads manager at this point!");var b=a.getAd();this.ad_=new shaka.ads.ClientSideAd(b,this.imaAdsManager_),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STARTED,{ad:this.ad_,sdkAdObject:b,originalEvent:a})),this.adContainer_.setAttribute("ad-active","true"),this.video_.pause()},shaka.ads.ClientSideAdManager.prototype.onAdComplete_=function(a){this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED,{originalEvent:a})),this.adContainer_.removeAttribute("ad-active"),this.video_.play()},shaka.ads.ServerSideAd=function(a,b){this.ad_=a,this.adProgressData_=null,this.video_=b},shaka.ads.ServerSideAd.prototype.setProgressData=function(a){this.adProgressData_=a},shaka.ads.ServerSideAd.prototype.getDuration=function(){return this.adProgressData_?this.adProgressData_.duration:-1},shaka.ads.ServerSideAd.prototype.getRemainingTime=function(){return this.adProgressData_?this.adProgressData_.duration-this.adProgressData_.currentTime:-1},shaka.ads.ServerSideAd.prototype.isPaused=function(){return this.video_.paused},shaka.ads.ServerSideAd.prototype.isSkippable=function(){return this.ad_.isSkippable()},shaka.ads.ServerSideAd.prototype.getTimeUntilSkippable=function(){var a=this.ad_.getSkipTimeOffset();return a=this.getRemainingTime()-a,Math.max(a,0)},shaka.ads.ServerSideAd.prototype.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},shaka.ads.ServerSideAd.prototype.skip=function(){this.video_.currentTime+=this.getRemainingTime()},shaka.ads.ServerSideAd.prototype.pause=function(){return this.video_.pause()},shaka.ads.ServerSideAd.prototype.play=function(){return this.video_.play()},shaka.ads.ServerSideAd.prototype.getVolume=function(){return this.video_.volume},shaka.ads.ServerSideAd.prototype.setVolume=function(a){this.video_.volume=a},shaka.ads.ServerSideAd.prototype.isMuted=function(){return this.video_.muted},shaka.ads.ServerSideAd.prototype.resize=function(a,b){},shaka.ads.ServerSideAd.prototype.setMuted=function(a){this.video_.muted=a},shaka.ads.ServerSideAd.prototype.getSequenceLength=function(){var a=this.ad_.getAdPodInfo();return null==a?1:a.getTotalAds()},shaka.ads.ServerSideAd.prototype.getPositionInSequence=function(){var a=this.ad_.getAdPodInfo();return null==a?1:a.getAdPosition()},shaka.ads.ServerSideAd.prototype.release=function(){this.video_=this.adProgressData_=this.ad_=null},goog.exportSymbol("shaka.ads.ServerSideAd",shaka.ads.ServerSideAd),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"release",shaka.ads.ServerSideAd.prototype.release),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getPositionInSequence",shaka.ads.ServerSideAd.prototype.getPositionInSequence),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getSequenceLength",shaka.ads.ServerSideAd.prototype.getSequenceLength),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"setMuted",shaka.ads.ServerSideAd.prototype.setMuted),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"resize",shaka.ads.ServerSideAd.prototype.resize),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isMuted",shaka.ads.ServerSideAd.prototype.isMuted),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"setVolume",shaka.ads.ServerSideAd.prototype.setVolume),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getVolume",shaka.ads.ServerSideAd.prototype.getVolume),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"play",shaka.ads.ServerSideAd.prototype.play),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"pause",shaka.ads.ServerSideAd.prototype.pause),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"skip",shaka.ads.ServerSideAd.prototype.skip),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"canSkipNow",shaka.ads.ServerSideAd.prototype.canSkipNow),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getTimeUntilSkippable",shaka.ads.ServerSideAd.prototype.getTimeUntilSkippable),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isSkippable",shaka.ads.ServerSideAd.prototype.isSkippable),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"isPaused",shaka.ads.ServerSideAd.prototype.isPaused),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getRemainingTime",shaka.ads.ServerSideAd.prototype.getRemainingTime),goog.exportProperty(shaka.ads.ServerSideAd.prototype,"getDuration",shaka.ads.ServerSideAd.prototype.getDuration),shaka.ads.ServerSideAdManager=function(a,b,e,t){var r=this;this.adContainer_=a,this.video_=b,this.streamPromise_=null,this.streamRequestStartTime_=NaN,this.onEvent_=t,this.isLiveContent_=!1,this.adProgressData_=this.ad_=this.snapForwardTime_=null,this.backupUrl_="",this.eventManager_=new shaka.util.EventManager,(a=new google.ima.dai.api.UiSettings).setLocale(e),this.streamManager_=new google.ima.dai.api.StreamManager(this.video_,this.adContainer_,a),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.LOADED,(function(a){shaka.log.info("Ad SS Loaded"),r.onLoaded_(a)})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.ERROR,(function(){shaka.log.info("Ad SS Error"),r.onError_()})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,(function(){shaka.log.info("Ad Break Started")})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.STARTED,(function(a){shaka.log.info("Ad Started"),r.onAdStart_(a)})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,(function(){shaka.log.info("Ad Break Ended"),r.onAdBreakEnded_()})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,(function(a){r.onAdProgress_(a)})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,(function(){shaka.log.info("Ad event: First Quartile"),r.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_FIRST_QUARTILE))})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.MIDPOINT,(function(){shaka.log.info("Ad event: Midpoint"),r.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_MIDPOINT))})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,(function(){shaka.log.info("Ad event: Third Quartile"),r.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_THIRD_QUARTILE))})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.COMPLETE,(function(){shaka.log.info("Ad event: Complete"),r.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_COMPLETE)),r.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED)),r.adContainer_.removeAttribute("ad-active"),r.ad_=null})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.SKIPPED,(function(){shaka.log.info("Ad event: Skipped"),r.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_SKIPPED)),r.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED))})),this.eventManager_.listen(this.streamManager_,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,(function(a){shaka.log.info("Ad event: Cue points changed"),r.onCuePointsChanged_(a)}))},shaka.ads.ServerSideAdManager.prototype.streamRequest=function(a,b){return this.streamPromise_?Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CURRENT_DAI_REQUEST_NOT_FINISHED)):(a instanceof google.ima.dai.api.LiveStreamRequest&&(this.isLiveContent_=!0),this.streamPromise_=new shaka.util.PublicPromise,this.streamManager_.requestStream(a),this.backupUrl_=b||"",this.streamRequestStartTime_=Date.now()/1e3,this.streamPromise_)},shaka.ads.ServerSideAdManager.prototype.replaceAdTagParameters=function(a){this.streamManager_.replaceAdTagParameters(a)},shaka.ads.ServerSideAdManager.prototype.stop=function(){this.streamManager_.reset(),this.backupUrl_="",this.snapForwardTime_=null},shaka.ads.ServerSideAdManager.prototype.onTimedMetadata=function(a,b,e){this.streamManager_.processMetadata(a,b,e)},shaka.ads.ServerSideAdManager.prototype.onCueMetadataChange=function(a){if(a.key&&a.data){var b={};b[a.key]=a.data,this.streamManager_.onTimedMetadata(b)}},shaka.ads.ServerSideAdManager.prototype.checkForSnapback_=function(){var a=this.video_.currentTime;if(0!=a){this.streamManager_.streamTimeForContentTime(a);var b=this.streamManager_.previousCuePointForStreamTime(a);b&&!b.played&&(shaka.log.info("Seeking back to the start of the ad break at "+b.start+" and will return to "+a),this.snapForwardTime_=a,this.video_.currentTime=b.start)}},shaka.ads.ServerSideAdManager.prototype.onAdStart_=function(a){goog.asserts.assert(this.streamManager_,"Should have a stream manager at this point!"),a=a.getAd(),this.ad_=new shaka.ads.ServerSideAd(a,this.video_),this.adProgressData_&&this.ad_.setProgressData(this.adProgressData_),this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STARTED,{ad:this.ad_})),this.adContainer_.setAttribute("ad-active","true")},shaka.ads.ServerSideAdManager.prototype.onAdBreakEnded_=function(){this.adContainer_.removeAttribute("ad-active");var a=this.video_.currentTime;this.snapForwardTime_&&this.snapForwardTime_>a&&(this.video_.currentTime=this.snapForwardTime_,this.snapForwardTime_=null)},shaka.ads.ServerSideAdManager.prototype.onLoaded_=function(a){var b=this,e=Date.now()/1e3-this.streamRequestStartTime_;this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.ADS_LOADED,{loadTime:e})),a=a.getStreamData().url,this.streamPromise_.resolve(a),this.streamPromise_=null,this.isLiveContent_||this.eventManager_.listen(this.video_,"seeked",(function(){b.checkForSnapback_()}))},shaka.ads.ServerSideAdManager.prototype.onError_=function(){this.backupUrl_.length?(shaka.log.warning("IMA stream request returned an error. Falling back to the backup asset uri."),this.streamPromise_.resolve(this.backupUrl_)):this.streamPromise_.reject("IMA Stream request returned an error and there was no backup asset uri provided."),this.streamPromise_=null},shaka.ads.ServerSideAdManager.prototype.onAdProgress_=function(a){this.adProgressData_=a.getStreamData().adProgressData,this.ad_&&this.ad_.setProgressData(this.adProgressData_)},shaka.ads.ServerSideAdManager.prototype.onCuePointsChanged_=function(a){var b=a.getStreamData();a=[];for(var e=(b=$jscomp.makeIterator(b.cuepoints)).next();!e.done;e=b.next())e=e.value,e=new shaka.ads.CuePoint(e.start,e.end),a.push(e);this.onEvent_(new shaka.util.FakeEvent(shaka.ads.AdManager.CUEPOINTS_CHANGED,{cuepoints:a}))},shaka.ads.AdManager=function(){shaka.util.FakeEventTarget.call(this),this.ssAdManager_=this.csAdManager_=null,this.stats_=new shaka.ads.AdsStats,this.locale_=navigator.language},$jscomp.inherits(shaka.ads.AdManager,shaka.util.FakeEventTarget),shaka.ads.AdManager.prototype.setLocale=function(a){this.locale_=a},shaka.ads.AdManager.prototype.initClientSide=function(a,b){var e=this;if(!window.google||!google.ima||!google.ima.AdsLoader)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CS_IMA_SDK_MISSING);this.csAdManager_=new shaka.ads.ClientSideAdManager(a,b,this.locale_,(function(a){if(a&&a.type)switch(a.type){case shaka.ads.AdManager.ADS_LOADED:e.stats_.addLoadTime(a.loadTime);break;case shaka.ads.AdManager.AD_STARTED:e.stats_.incrementStarted();break;case shaka.ads.AdManager.AD_COMPLETE:e.stats_.incrementPlayedCompletely();break;case shaka.ads.AdManager.AD_SKIPPED:e.stats_.incrementSkipped()}e.dispatchEvent(a)}))},shaka.ads.AdManager.prototype.onAssetUnload=function(){this.csAdManager_&&this.csAdManager_.stop(),this.dispatchEvent(new shaka.util.FakeEvent(shaka.ads.AdManager.AD_STOPPED)),this.stats_=new shaka.ads.AdsStats},shaka.ads.AdManager.prototype.requestClientSideAds=function(a){if(!this.csAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.CS_AD_MANAGER_NOT_INITIALIZED);this.csAdManager_.requestAds(a)},shaka.ads.AdManager.prototype.initServerSide=function(a,b){var e=this;if(!window.google||!google.ima||!google.ima.dai)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_IMA_SDK_MISSING);this.ssAdManager_=new shaka.ads.ServerSideAdManager(a,b,this.locale_,(function(a){if(a&&a.type)switch(a.type){case shaka.ads.AdManager.ADS_LOADED:e.stats_.addLoadTime(a.loadTime);break;case shaka.ads.AdManager.AD_STARTED:e.stats_.incrementStarted();break;case shaka.ads.AdManager.AD_COMPLETE:e.stats_.incrementPlayedCompletely();break;case shaka.ads.AdManager.AD_SKIPPED:e.stats_.incrementSkipped()}e.dispatchEvent(a)})),this.replaceServerSideAdTagParameters({mpt:"shaka",mpv:shaka.Player.version})},shaka.ads.AdManager.prototype.requestServerSideStream=function(a,b){if(b=void 0===b?"":b,!this.ssAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_AD_MANAGER_NOT_INITIALIZED);return this.ssAdManager_.streamRequest(a,b)},shaka.ads.AdManager.prototype.replaceServerSideAdTagParameters=function(a){if(!this.ssAdManager_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.ADS,shaka.util.Error.Code.SS_AD_MANAGER_NOT_INITIALIZED);this.ssAdManager_.replaceAdTagParameters(a)},shaka.ads.AdManager.prototype.getStats=function(){return this.stats_.getBlob()},shaka.ads.AdManager.prototype.onDashTimedMetadata=function(a){if(this.ssAdManager_&&"urn:google:dai:2018"==a.schemeIdUri){var b=a.schemeIdUri,e=a.eventElement?a.eventElement.getAttribute("messageData"):null;this.ssAdManager_.onTimedMetadata(b,e,a.startTime)}},shaka.ads.AdManager.prototype.onHlsTimedMetadata=function(a,b){this.ssAdManager_?this.ssAdManager_.onTimedMetadata("ID3",a.data,b):shaka.log.warning("ID3 metadata processing was called without initializing server side ad logic. Ad-related metadata will not take effect")},shaka.ads.AdManager.prototype.onCueMetadataChange=function(a){this.ssAdManager_?this.ssAdManager_.onCueMetadataChange(a):shaka.log.warning("ID3 metadata processing was called without initializing server side ad logic. Ad-related metadata will not take effect")},goog.exportSymbol("shaka.ads.AdManager",shaka.ads.AdManager),goog.exportProperty(shaka.ads.AdManager.prototype,"onCueMetadataChange",shaka.ads.AdManager.prototype.onCueMetadataChange),goog.exportProperty(shaka.ads.AdManager.prototype,"onHlsTimedMetadata",shaka.ads.AdManager.prototype.onHlsTimedMetadata),goog.exportProperty(shaka.ads.AdManager.prototype,"onDashTimedMetadata",shaka.ads.AdManager.prototype.onDashTimedMetadata),goog.exportProperty(shaka.ads.AdManager.prototype,"getStats",shaka.ads.AdManager.prototype.getStats),goog.exportProperty(shaka.ads.AdManager.prototype,"replaceServerSideAdTagParameters",shaka.ads.AdManager.prototype.replaceServerSideAdTagParameters),goog.exportProperty(shaka.ads.AdManager.prototype,"requestServerSideStream",shaka.ads.AdManager.prototype.requestServerSideStream),goog.exportProperty(shaka.ads.AdManager.prototype,"initServerSide",shaka.ads.AdManager.prototype.initServerSide),goog.exportProperty(shaka.ads.AdManager.prototype,"requestClientSideAds",shaka.ads.AdManager.prototype.requestClientSideAds),goog.exportProperty(shaka.ads.AdManager.prototype,"onAssetUnload",shaka.ads.AdManager.prototype.onAssetUnload),goog.exportProperty(shaka.ads.AdManager.prototype,"initClientSide",shaka.ads.AdManager.prototype.initClientSide),goog.exportProperty(shaka.ads.AdManager.prototype,"setLocale",shaka.ads.AdManager.prototype.setLocale),shaka.ads.CuePoint=function(a,b){this.start=a,this.end=void 0===b?null:b},shaka.ads.AdManager.ADS_LOADED="ads-loaded",goog.exportProperty(shaka.ads.AdManager,"ADS_LOADED",shaka.ads.AdManager.ADS_LOADED),shaka.ads.AdManager.AD_STARTED="ad-started",goog.exportProperty(shaka.ads.AdManager,"AD_STARTED",shaka.ads.AdManager.AD_STARTED),shaka.ads.AdManager.AD_FIRST_QUARTILE="ad-first-quartile",goog.exportProperty(shaka.ads.AdManager,"AD_FIRST_QUARTILE",shaka.ads.AdManager.AD_FIRST_QUARTILE),shaka.ads.AdManager.AD_MIDPOINT="ad-midpoint",goog.exportProperty(shaka.ads.AdManager,"AD_MIDPOINT",shaka.ads.AdManager.AD_MIDPOINT),shaka.ads.AdManager.AD_THIRD_QUARTILE="ad-third-quartile",goog.exportProperty(shaka.ads.AdManager,"AD_THIRD_QUARTILE",shaka.ads.AdManager.AD_THIRD_QUARTILE),shaka.ads.AdManager.AD_COMPLETE="ad-complete",goog.exportProperty(shaka.ads.AdManager,"AD_COMPLETE",shaka.ads.AdManager.AD_COMPLETE),shaka.ads.AdManager.AD_STOPPED="ad-stopped",goog.exportProperty(shaka.ads.AdManager,"AD_STOPPED",shaka.ads.AdManager.AD_STOPPED),shaka.ads.AdManager.AD_SKIPPED="ad-skipped",goog.exportProperty(shaka.ads.AdManager,"AD_SKIPPED",shaka.ads.AdManager.AD_SKIPPED),shaka.ads.AdManager.AD_VOLUME_CHANGED="ad-volume-changed",goog.exportProperty(shaka.ads.AdManager,"AD_VOLUME_CHANGED",shaka.ads.AdManager.AD_VOLUME_CHANGED),shaka.ads.AdManager.AD_MUTED="ad-muted",goog.exportProperty(shaka.ads.AdManager,"AD_MUTED",shaka.ads.AdManager.AD_MUTED),shaka.ads.AdManager.AD_PAUSED="ad-paused",goog.exportProperty(shaka.ads.AdManager,"AD_PAUSED",shaka.ads.AdManager.AD_PAUSED),shaka.ads.AdManager.AD_RESUMED="ad-resumed",goog.exportProperty(shaka.ads.AdManager,"AD_RESUMED",shaka.ads.AdManager.AD_RESUMED),shaka.ads.AdManager.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",goog.exportProperty(shaka.ads.AdManager,"AD_SKIP_STATE_CHANGED",shaka.ads.AdManager.AD_SKIP_STATE_CHANGED),shaka.ads.AdManager.CUEPOINTS_CHANGED="ad-cue-points-changed",goog.exportProperty(shaka.ads.AdManager,"CUEPOINTS_CHANGED",shaka.ads.AdManager.CUEPOINTS_CHANGED),shaka.ads.AdManager.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",goog.exportProperty(shaka.ads.AdManager,"IMA_AD_MANAGER_LOADED",shaka.ads.AdManager.IMA_AD_MANAGER_LOADED),shaka.ads.AdManager.AD_CLICKED="ad-clicked",goog.exportProperty(shaka.ads.AdManager,"AD_CLICKED",shaka.ads.AdManager.AD_CLICKED),shaka.ads.AdManager.AD_PROGRESS="ad-progress",goog.exportProperty(shaka.ads.AdManager,"AD_PROGRESS",shaka.ads.AdManager.AD_PROGRESS),shaka.ads.AdManager.AD_BUFFERING="ad-buffering",goog.exportProperty(shaka.ads.AdManager,"AD_BUFFERING",shaka.ads.AdManager.AD_BUFFERING),shaka.ads.AdManager.AD_IMPRESSION="ad-impression",goog.exportProperty(shaka.ads.AdManager,"AD_IMPRESSION",shaka.ads.AdManager.AD_IMPRESSION),shaka.ads.AdManager.AD_DURATION_CHANGED="ad-duration-changed",goog.exportProperty(shaka.ads.AdManager,"AD_DURATION_CHANGED",shaka.ads.AdManager.AD_DURATION_CHANGED),shaka.ads.AdManager.AD_CLOSED="ad-closed",goog.exportProperty(shaka.ads.AdManager,"AD_CLOSED",shaka.ads.AdManager.AD_CLOSED),shaka.ads.AdManager.AD_LOADED="ad-loaded",goog.exportProperty(shaka.ads.AdManager,"AD_LOADED",shaka.ads.AdManager.AD_LOADED),shaka.ads.AdManager.ALL_ADS_COMPLETED="all-ads-completed",goog.exportProperty(shaka.ads.AdManager,"ALL_ADS_COMPLETED",shaka.ads.AdManager.ALL_ADS_COMPLETED),shaka.ads.AdManager.AD_LINEAR_CHANGED="ad-linear-changed",goog.exportProperty(shaka.ads.AdManager,"AD_LINEAR_CHANGED",shaka.ads.AdManager.AD_LINEAR_CHANGED),shaka.ads.AdManager.AD_METADATA="ad-metadata",goog.exportProperty(shaka.ads.AdManager,"AD_METADATA",shaka.ads.AdManager.AD_METADATA),shaka.ads.AdManager.AD_RECOVERABLE_ERROR="ad-recoverable-error",goog.exportProperty(shaka.ads.AdManager,"AD_RECOVERABLE_ERROR",shaka.ads.AdManager.AD_RECOVERABLE_ERROR),shaka.ads.AdManager.AD_BREAK_READY="ad-break-ready",goog.exportProperty(shaka.ads.AdManager,"AD_BREAK_READY",shaka.ads.AdManager.AD_BREAK_READY),shaka.ads.AdManager.AD_INTERACTION="ad-interaction",goog.exportProperty(shaka.ads.AdManager,"AD_INTERACTION",shaka.ads.AdManager.AD_INTERACTION),shaka.Player.setAdManagerFactory((function(){return new shaka.ads.AdManager})),shaka.cast={},shaka.cast.CastUtils=function(){},shaka.cast.CastUtils.serialize=function(a){return JSON.stringify(a,(function(a,e){if("function"!=typeof e){if(e instanceof Event||e instanceof shaka.util.FakeEvent){var t,b={};for(t in e){var r=e[t];r&&"object"==typeof r?"detail"==t&&(b[t]=r):t in Event||(b[t]=r)}return b}return e instanceof Error?shaka.cast.CastUtils.unpackError_(e):e instanceof TimeRanges?shaka.cast.CastUtils.unpackTimeRanges_(e):e instanceof Uint8Array?shaka.cast.CastUtils.unpackUint8Array_(e):"number"==typeof e?isNaN(e)?"NaN":isFinite(e)?e:0>e?"-Infinity":"Infinity":e}}))},shaka.cast.CastUtils.deserialize=function(a){return JSON.parse(a,(function(a,e){return"NaN"==e?NaN:"-Infinity"==e?-1/0:"Infinity"==e?1/0:e&&"object"==typeof e&&"TimeRanges"==e.__type__?shaka.cast.CastUtils.simulateTimeRanges_(e):e&&"object"==typeof e&&"Uint8Array"==e.__type__?shaka.cast.CastUtils.makeUint8Array_(e):e&&"object"==typeof e&&"Error"==e.__type__?shaka.cast.CastUtils.makeError_(e):e}))},shaka.cast.CastUtils.unpackTimeRanges_=function(a){for(var b={__type__:"TimeRanges",length:a.length,start:[],end:[]},e=(a=$jscomp.makeIterator(shaka.media.TimeRangesUtils.getBufferedInfo(a))).next();!e.done;e=a.next()){var t=(e=e.value).end;b.start.push(e.start),b.end.push(t)}return b},shaka.cast.CastUtils.simulateTimeRanges_=function(a){return{length:a.length,start:function(b){return a.start[b]},end:function(b){return a.end[b]}}},shaka.cast.CastUtils.unpackUint8Array_=function(a){return{__type__:"Uint8Array",entries:Array.from(a)}},shaka.cast.CastUtils.makeUint8Array_=function(a){return new Uint8Array(a.entries)},shaka.cast.CastUtils.unpackError_=function(a){var e,b=new Set(["name","message","stack"]);for(e in a)b.add(e);var t=$jscomp.makeIterator(Object.getOwnPropertyNames(a));for(e=t.next();!e.done;e=t.next())b.add(e.value);for(t={},e=(b=$jscomp.makeIterator(b)).next();!e.done;e=b.next())t[e=e.value]=a[e];return{__type__:"Error",contents:t}},shaka.cast.CastUtils.makeError_=function(a){a=a.contents;var e,b=Error(a.message);for(e in a)b[e]=a[e];return b},shaka.cast.CastUtils.VideoEvents="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),shaka.cast.CastUtils.VideoAttributes="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),shaka.cast.CastUtils.VideoInitStateAttributes=["loop","playbackRate"],shaka.cast.CastUtils.VideoVoidMethods=["pause","play"],shaka.cast.CastUtils.PlayerGetterMethods={getAssetUri:2,getAudioLanguages:2,getAudioLanguagesAndRoles:2,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:2,getTextLanguagesAndRoles:2,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,getLoadMode:10},shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},shaka.cast.CastUtils.PlayerInitState=[["getConfiguration","configure"]],shaka.cast.CastUtils.PlayerInitAfterLoadState=[["isTextTrackVisible","setTextTrackVisibility"]],shaka.cast.CastUtils.PlayerVoidMethods="addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay".split(" "),shaka.cast.CastUtils.PlayerPromiseMethods=["attach","detach","load","unload"],shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE="urn:x-cast:com.google.shaka.v2",shaka.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE="urn:x-cast:com.google.cast.media",shaka.cast.CastSender=function(a,b,e,t,r,n){var g=this;this.receiverAppId_=a,this.statusChangeTimer_=new shaka.util.Timer(b),this.onFirstCastStateUpdate_=e,this.hasJoinedExistingSession_=!1,this.onRemoteEvent_=t,this.onResumeLocal_=r,this.onInitStateRequired_=n,this.isCasting_=this.apiReady_=!1,this.receiverName_="",this.appData_=null,this.onConnectionStatusChangedBound_=function(){return g.onConnectionStatusChanged_()},this.onMessageReceivedBound_=function(a,b){return g.onMessageReceived_(a,b)},this.cachedProperties_={video:{},player:{}},this.nextAsyncCallId_=0,this.asyncCallPromises_={},this.castPromise_=null,shaka.cast.CastSender.instances_.add(this)},shaka.cast.CastSender.prototype.destroy=function(){return shaka.cast.CastSender.instances_.delete(this),this.rejectAllPromises_(),shaka.cast.CastSender.session_&&this.removeListeners_(),this.statusChangeTimer_&&(this.statusChangeTimer_.stop(),this.statusChangeTimer_=null),this.onResumeLocal_=this.onRemoteEvent_=null,this.isCasting_=this.apiReady_=!1,this.onMessageReceivedBound_=this.onConnectionStatusChangedBound_=this.castPromise_=this.asyncCallPromises_=this.cachedProperties_=this.appData_=null,Promise.resolve()},shaka.cast.CastSender.prototype.apiReady=function(){return this.apiReady_},shaka.cast.CastSender.prototype.hasReceivers=function(){return shaka.cast.CastSender.hasReceivers_},shaka.cast.CastSender.prototype.isCasting=function(){return this.isCasting_},shaka.cast.CastSender.prototype.receiverName=function(){return this.receiverName_},shaka.cast.CastSender.prototype.hasRemoteProperties=function(){return 0!=Object.keys(this.cachedProperties_.video).length},shaka.cast.CastSender.prototype.init=function(){var a=shaka.cast.CastSender;if(window.chrome&&chrome.cast&&chrome.cast.isAvailable&&this.receiverAppId_.length){this.apiReady_=!0,this.statusChangeTimer_.tickNow();var b=new chrome.cast.SessionRequest(this.receiverAppId_);b=new chrome.cast.ApiConfig(b,(function(b){return a.onExistingSessionJoined_(b)}),(function(b){return a.onReceiverStatusChanged_(b)}),"origin_scoped"),chrome.cast.initialize(b,(function(){shaka.log.debug("CastSender: init")}),(function(a){shaka.log.error("CastSender: init error",a)})),shaka.cast.CastSender.hasReceivers_&&this.statusChangeTimer_.tickAfter(shaka.cast.CastSender.STATUS_DELAY),(b=shaka.cast.CastSender.session_)&&b.status!=chrome.cast.SessionStatus.STOPPED?(shaka.log.debug("CastSender: re-using existing connection"),this.onExistingSessionJoined_(b)):shaka.cast.CastSender.session_=null}},shaka.cast.CastSender.prototype.setAppData=function(a){this.appData_=a,this.isCasting_&&this.sendMessage_({type:"appData",appData:this.appData_})},shaka.cast.CastSender.prototype.cast=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){if(!b.apiReady_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.CAST_API_UNAVAILABLE);if(!shaka.cast.CastSender.hasReceivers_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.NO_CAST_RECEIVERS);if(b.isCasting_)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.CAST,shaka.util.Error.Code.ALREADY_CASTING);return b.castPromise_=new shaka.util.PublicPromise,chrome.cast.requestSession((function(e){return b.onSessionInitiated_(a,e)}),(function(a){return b.onConnectionError_(a)})),e.yield(b.castPromise_,0)}))},shaka.cast.CastSender.prototype.showDisconnectDialog=function(){var a=this;if(this.isCasting_){var b=this.onInitStateRequired_();chrome.cast.requestSession((function(e){return a.onSessionInitiated_(b,e)}),(function(b){return a.onConnectionError_(b)}))}},shaka.cast.CastSender.prototype.forceDisconnect=function(){if(this.isCasting_){if(this.rejectAllPromises_(),shaka.cast.CastSender.session_){this.removeListeners_();try{shaka.cast.CastSender.session_.stop((function(){}),(function(){}))}catch(e){}shaka.cast.CastSender.session_=null}this.onConnectionStatusChanged_()}},shaka.cast.CastSender.prototype.get=function(a,b){var e=this;goog.asserts.assert("video"==a||"player"==a,"Unexpected target name");var t=shaka.cast.CastUtils;if("video"==a){if(t.VideoVoidMethods.includes(b))return function(t){for(var r=[],n=0;n<arguments.length;++n)r[n-0]=arguments[n];return e.remoteCall_.apply(e,[a,b].concat($jscomp.arrayFromIterable(r)))}}else if("player"==a){if(t.PlayerGetterMethodsThatRequireLive[b]){var r=this.get("player","isLive")();if(goog.asserts.assert(r,b+" should be called on a live stream!"),!r)return function(){}}if(t.PlayerVoidMethods.includes(b))return function(t){for(var r=[],n=0;n<arguments.length;++n)r[n-0]=arguments[n];return e.remoteCall_.apply(e,[a,b].concat($jscomp.arrayFromIterable(r)))};if(t.PlayerPromiseMethods.includes(b))return function(t){for(var r=[],n=0;n<arguments.length;++n)r[n-0]=arguments[n];return e.remoteAsyncCall_.apply(e,[a,b].concat($jscomp.arrayFromIterable(r)))};if(t.PlayerGetterMethods[b])return function(){return e.propertyGetter_(a,b)}}return this.propertyGetter_(a,b)},shaka.cast.CastSender.prototype.set=function(a,b,e){goog.asserts.assert("video"==a||"player"==a,"Unexpected target name"),this.cachedProperties_[a][b]=e,this.sendMessage_({type:"set",targetName:a,property:b,value:e})},shaka.cast.CastSender.prototype.onSessionInitiated_=function(a,b){shaka.log.debug("CastSender: onSessionInitiated"),this.onSessionCreated_(b),this.sendMessage_({type:"init",initState:a,appData:this.appData_}),this.castPromise_.resolve()},shaka.cast.CastSender.prototype.onConnectionError_=function(a){var b=shaka.util.Error.Code.UNEXPECTED_CAST_ERROR;switch(a.code){case"cancel":b=shaka.util.Error.Code.CAST_CANCELED_BY_USER;break;case"timeout":b=shaka.util.Error.Code.CAST_CONNECTION_TIMED_OUT;break;case"receiver_unavailable":b=shaka.util.Error.Code.CAST_RECEIVER_APP_UNAVAILABLE}this.castPromise_.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.CAST,b,a))},shaka.cast.CastSender.prototype.propertyGetter_=function(a,b){return goog.asserts.assert("video"==a||"player"==a,"Unexpected target name"),this.cachedProperties_[a][b]},shaka.cast.CastSender.prototype.remoteCall_=function(a,b,e){for(var t=[],r=2;r<arguments.length;++r)t[r-2]=arguments[r];goog.asserts.assert("video"==a||"player"==a,"Unexpected target name"),this.sendMessage_({type:"call",targetName:a,methodName:b,args:t})},shaka.cast.CastSender.prototype.remoteAsyncCall_=function(a,b,e){for(var t=[],r=2;r<arguments.length;++r)t[r-2]=arguments[r];goog.asserts.assert("video"==a||"player"==a,"Unexpected target name"),r=new shaka.util.PublicPromise;var n=this.nextAsyncCallId_.toString();this.nextAsyncCallId_++,this.asyncCallPromises_[n]=r;try{this.sendMessage_({type:"asyncCall",targetName:a,methodName:b,args:t,id:n})}catch(e){r.reject(e)}return r},shaka.cast.CastSender.onExistingSessionJoined_=function(a){for(var b=$jscomp.makeIterator(shaka.cast.CastSender.instances_),e=b.next();!e.done;e=b.next())e.value.onExistingSessionJoined_(a)},shaka.cast.CastSender.prototype.onExistingSessionJoined_=function(a){shaka.log.debug("CastSender: onExistingSessionJoined");var b=this.onInitStateRequired_();this.castPromise_=new shaka.util.PublicPromise,this.hasJoinedExistingSession_=!0,this.onSessionInitiated_(b,a)},shaka.cast.CastSender.onReceiverStatusChanged_=function(a){for(var b=$jscomp.makeIterator(shaka.cast.CastSender.instances_),e=b.next();!e.done;e=b.next())e.value.onReceiverStatusChanged_(a)},shaka.cast.CastSender.prototype.onReceiverStatusChanged_=function(a){shaka.log.debug("CastSender: receiver status",a),shaka.cast.CastSender.hasReceivers_="available"==a,this.statusChangeTimer_.tickNow()},shaka.cast.CastSender.prototype.onSessionCreated_=function(a){shaka.cast.CastSender.session_=a,a.addUpdateListener(this.onConnectionStatusChangedBound_),a.addMessageListener(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_),this.onConnectionStatusChanged_()},shaka.cast.CastSender.prototype.removeListeners_=function(){var a=shaka.cast.CastSender.session_;a.removeUpdateListener(this.onConnectionStatusChangedBound_),a.removeMessageListener(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,this.onMessageReceivedBound_)},shaka.cast.CastSender.prototype.onConnectionStatusChanged_=function(){var a=!!shaka.cast.CastSender.session_&&"connected"==shaka.cast.CastSender.session_.status;if(shaka.log.debug("CastSender: connection status",a),this.isCasting_&&!a){for(var b in this.onResumeLocal_(),this.cachedProperties_)this.cachedProperties_[b]={};this.rejectAllPromises_()}this.receiverName_=(this.isCasting_=a)?shaka.cast.CastSender.session_.receiver.friendlyName:"",this.statusChangeTimer_.tickNow()},shaka.cast.CastSender.prototype.rejectAllPromises_=function(){for(var a in this.asyncCallPromises_){var b=this.asyncCallPromises_[a];delete this.asyncCallPromises_[a],b.reject(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.LOAD_INTERRUPTED))}},shaka.cast.CastSender.prototype.onMessageReceived_=function(a,b){var e=shaka.cast.CastUtils.deserialize(b);switch(shaka.log.v2("CastSender: message",e),e.type){case"event":var t=e.targetName;e=e.event,e=new shaka.util.FakeEvent(e.type,e),this.onRemoteEvent_(t,e);break;case"update":for(var r in t=e.update)for(var n in e=this.cachedProperties_[r]||{},t[r])e[n]=t[r][n];this.hasJoinedExistingSession_&&(this.onFirstCastStateUpdate_(),this.hasJoinedExistingSession_=!1);break;case"asyncComplete":if(r=e.id,e=e.error,n=this.asyncCallPromises_[r],delete this.asyncCallPromises_[r],goog.asserts.assert(n,"Unexpected async id"),n)if(e){for(t in r=new shaka.util.Error(e.severity,e.category,e.code),e)r[t]=e[t];n.reject(r)}else n.resolve()}},shaka.cast.CastSender.prototype.sendMessage_=function(a){a=shaka.cast.CastUtils.serialize(a);var b=shaka.cast.CastSender.session_;try{b.sendMessage(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE,a,(function(){}),shaka.log.error)}catch(e){throw shaka.log.error("Cast session sendMessage threw",e),a=new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.CAST,shaka.util.Error.Code.CAST_CONNECTION_TIMED_OUT,e),b=new shaka.util.FakeEvent("error",{detail:a}),this.onRemoteEvent_("player",b),this.forceDisconnect(),a}},shaka.cast.CastSender.STATUS_DELAY=.02,shaka.cast.CastSender.hasReceivers_=!1,shaka.cast.CastSender.session_=null,shaka.cast.CastSender.instances_=new Set,shaka.cast.CastSender.onSdkLoaded_=function(a){if(a)for(var b=(a=$jscomp.makeIterator(shaka.cast.CastSender.instances_)).next();!b.done;b=a.next())b.value.init()},window.__onGCastApiAvailable=shaka.cast.CastSender.onSdkLoaded_,shaka.cast.CastProxy=function(a,b,e){shaka.util.FakeEventTarget.call(this);var t=this;this.localVideo_=a,this.localPlayer_=b,this.eventManager_=this.playerEventTarget_=this.videoEventTarget_=this.playerProxy_=this.videoProxy_=null,this.receiverAppId_=e,this.compiledToExternNames_=new Map,this.sender_=new shaka.cast.CastSender(e,(function(){return t.onCastStatusChanged_()}),(function(){return t.onFirstCastStateUpdate_()}),(function(a,b){return t.onRemoteEvent_(a,b)}),(function(){return t.onResumeLocal_()}),(function(){return t.getInitState_()})),this.init_()},$jscomp.inherits(shaka.cast.CastProxy,shaka.util.FakeEventTarget),shaka.cast.CastProxy.prototype.destroy=function(a){return a&&this.sender_.forceDisconnect(),this.eventManager_&&(this.eventManager_.release(),this.eventManager_=null),a=[],this.localPlayer_&&(a.push(this.localPlayer_.destroy()),this.localPlayer_=null),this.sender_&&(a.push(this.sender_.destroy()),this.sender_=null),this.playerProxy_=this.videoProxy_=this.localVideo_=null,Promise.all(a)},shaka.cast.CastProxy.prototype.getVideo=function(){return this.videoProxy_},shaka.cast.CastProxy.prototype.getPlayer=function(){return this.playerProxy_},shaka.cast.CastProxy.prototype.canCast=function(){return this.sender_.apiReady()&&this.sender_.hasReceivers()},shaka.cast.CastProxy.prototype.isCasting=function(){return this.sender_.isCasting()},shaka.cast.CastProxy.prototype.receiverName=function(){return this.sender_.receiverName()},shaka.cast.CastProxy.prototype.cast=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?(b=a.getInitState_(),e.yield(a.sender_.cast(b),2)):a.localPlayer_?e.yield(a.localPlayer_.unload(),0):e.return()}))},shaka.cast.CastProxy.prototype.setAppData=function(a){this.sender_.setAppData(a)},shaka.cast.CastProxy.prototype.suggestDisconnect=function(){this.sender_.showDisconnectDialog()},shaka.cast.CastProxy.prototype.forceDisconnect=function(){this.sender_.forceDisconnect()},shaka.cast.CastProxy.prototype.changeReceiverId=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){if(1==e.nextAddress)return a==b.receiverAppId_?e.return():(b.receiverAppId_=a,b.sender_.forceDisconnect(),e.yield(b.sender_.destroy(),2));b.sender_=null,b.sender_=new shaka.cast.CastSender(a,(function(){return b.onCastStatusChanged_()}),(function(){return b.onFirstCastStateUpdate_()}),(function(a,e){return b.onRemoteEvent_(a,e)}),(function(){return b.onResumeLocal_()}),(function(){return b.getInitState_()})),b.sender_.init(),e.jumpToEnd()}))},shaka.cast.CastProxy.prototype.init_=function(){var a=this;this.sender_.init(),this.eventManager_=new shaka.util.EventManager;for(var b=$jscomp.makeIterator(shaka.cast.CastUtils.VideoEvents),e=b.next();!e.done;e=b.next())this.eventManager_.listen(this.localVideo_,e.value,(function(b){return a.videoProxyLocalEvent_(b)}));for(var t in shaka.Player.EventName)this.eventManager_.listen(this.localPlayer_,shaka.Player.EventName[t],(function(b){return a.playerProxyLocalEvent_(b)}));for(var r in this.videoProxy_={},b={},this.localVideo_)b.$jscomp$loop$prop$k$549=r,Object.defineProperty(this.videoProxy_,b.$jscomp$loop$prop$k$549,{configurable:!1,enumerable:!0,get:function(b){return function(){return a.videoProxyGet_(b.$jscomp$loop$prop$k$549)}}(b),set:function(b){return function(e){return a.videoProxySet_(b.$jscomp$loop$prop$k$549,e)}}(b)}),b={$jscomp$loop$prop$k$549:b.$jscomp$loop$prop$k$549};this.playerProxy_={},this.iterateOverPlayerMethods_((function(b,e){goog.asserts.assert(a.playerProxy_,"Must have player proxy!"),Object.defineProperty(a.playerProxy_,b,{configurable:!1,enumerable:!0,get:function(){return a.playerProxyGet_(b)}})})),COMPILED&&this.mapCompiledToUncompiledPlayerMethodNames_(),this.videoEventTarget_=new shaka.util.FakeEventTarget,this.videoEventTarget_.dispatchTarget=this.videoProxy_,this.playerEventTarget_=new shaka.util.FakeEventTarget,this.playerEventTarget_.dispatchTarget=this.playerProxy_},shaka.cast.CastProxy.prototype.mapCompiledToUncompiledPlayerMethodNames_=function(){var a=this,b=new Map;this.iterateOverPlayerMethods_((function(e,t){if(b.has(t)){var r=b.get(t);e.length<r.length?a.compiledToExternNames_.set(e,r):a.compiledToExternNames_.set(r,e)}else b.set(t,e)}))},shaka.cast.CastProxy.prototype.iterateOverPlayerMethods_=function(a){function b(a){return"constructor"!=a&&"function"==typeof e[a]&&!t.has(a)}goog.asserts.assert(this.localPlayer_,"Must have player!");var e=this.localPlayer_,t=new Set;for(r in e)b(r)&&(t.add(r),a(r,e[r]));for(var r=Object.getPrototypeOf(e),n=Object.getPrototypeOf({});r&&r!=n;){for(var g=$jscomp.makeIterator(Object.getOwnPropertyNames(r)),o=g.next();!o.done;o=g.next())b(o=o.value)&&(t.add(o),a(o,e[o]));r=Object.getPrototypeOf(r)}},shaka.cast.CastProxy.prototype.getInitState_=function(){var a={video:{},player:{},playerAfterLoad:{},manifest:this.localPlayer_.getAssetUri(),startTime:null};this.localVideo_.pause();for(var b=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes),e=b.next();!e.done;e=b.next())e=e.value,a.video[e]=this.localVideo_[e];for(this.localVideo_.ended||(a.startTime=this.localVideo_.currentTime),e=(b=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitState)).next();!e.done;e=b.next()){var t=e.value;e=t[1],t=this.localPlayer_[t[0]](),a.player[e]=t}for(e=(b=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitAfterLoadState)).next();!e.done;e=b.next())e=(t=e.value)[1],t=this.localPlayer_[t[0]](),a.playerAfterLoad[e]=t;return a},shaka.cast.CastProxy.prototype.onCastStatusChanged_=function(){var a=new shaka.util.FakeEvent("caststatuschanged");this.dispatchEvent(a)},shaka.cast.CastProxy.prototype.onFirstCastStateUpdate_=function(){var a=new shaka.util.FakeEvent(this.videoProxy_.paused?"pause":"play");this.videoEventTarget_.dispatchEvent(a)},shaka.cast.CastProxy.prototype.onResumeLocal_=function(){for(var a=this,b=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitState),e=b.next();!e.done;e=b.next()){var t=e.value;e=t[1],t=this.sender_.get("player",t[0])(),this.localPlayer_[e](t)}var r=this.sender_.get("player","getAssetUri")();e=this.sender_.get("video","ended"),b=Promise.resolve();var n=this.localVideo_.autoplay;t=null,e||(t=this.sender_.get("video","currentTime")),r&&(this.localVideo_.autoplay=!1,b=this.localPlayer_.load(r,t));var g={};for(t=(e=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes)).next();!t.done;t=e.next())t=t.value,g[t]=this.sender_.get("video",t);b.then((function(){if(a.localVideo_){for(var b=$jscomp.makeIterator(shaka.cast.CastUtils.VideoInitStateAttributes),e=b.next();!e.done;e=b.next())e=e.value,a.localVideo_[e]=g[e];for(e=(b=$jscomp.makeIterator(shaka.cast.CastUtils.PlayerInitAfterLoadState)).next();!e.done;e=b.next()){var t=e.value;e=t[1],t=a.sender_.get("player",t[0])(),a.localPlayer_[e](t)}a.localVideo_.autoplay=n,r&&a.localVideo_.play()}}),(function(b){goog.asserts.assert(b instanceof shaka.util.Error,"Wrong error type!"),b=new shaka.util.FakeEvent(shaka.Player.EventName.Error,{detail:b}),a.localPlayer_.dispatchEvent(b)}))},shaka.cast.CastProxy.prototype.videoProxyGet_=function(a){var b=this;if("addEventListener"==a)return function(a,e,t){return b.videoEventTarget_.addEventListener(a,e,t)};if("removeEventListener"==a)return function(a,e,t){return b.videoEventTarget_.removeEventListener(a,e,t)};if(this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()){var e=this.localVideo_[a];if("function"!=typeof e)return e}return this.sender_.isCasting()?this.sender_.get("video",a):("function"==typeof(a=this.localVideo_[a])&&(a=a.bind(this.localVideo_)),a)},shaka.cast.CastProxy.prototype.videoProxySet_=function(a,b){this.sender_.isCasting()?this.sender_.set("video",a,b):this.localVideo_[a]=b},shaka.cast.CastProxy.prototype.videoProxyLocalEvent_=function(a){this.sender_.isCasting()||(a=new shaka.util.FakeEvent(a.type,a),this.videoEventTarget_.dispatchEvent(a))},shaka.cast.CastProxy.prototype.playerProxyGet_=function(a){var b=this;if(this.compiledToExternNames_.has(a)&&(a=this.compiledToExternNames_.get(a)),"addEventListener"==a)return function(a,e,t){return b.playerEventTarget_.addEventListener(a,e,t)};if("removeEventListener"==a)return function(a,e,t){return b.playerEventTarget_.removeEventListener(a,e,t)};if("getMediaElement"==a)return function(){return b.videoProxy_};if("getSharedConfiguration"==a)return shaka.log.warning("Can't share configuration across a network. Returning copy."),this.sender_.get("player","getConfiguration");if("getNetworkingEngine"==a)return this.sender_.isCasting()&&shaka.log.warning("NOTE: getNetworkingEngine() is always local!"),function(){return b.localPlayer_.getNetworkingEngine()};if("getAdManager"==a)return this.sender_.isCasting()&&shaka.log.warning("NOTE: getAdManager() is always local!"),function(){return b.localPlayer_.getAdManager()};if("setVideoContainer"==a)return this.sender_.isCasting()&&shaka.log.warning("NOTE: setVideoContainer() is always local!"),function(a){return b.localPlayer_.setVideoContainer(a)};if(this.sender_.isCasting()){if("getManifest"==a||"drmInfo"==a)return function(){return shaka.log.alwaysWarn(a+"() does not work while casting!"),null};if("attach"==a||"detach"==a)return function(){return shaka.log.alwaysWarn(a+"() does not work while casting!"),Promise.resolve()}}if(this.sender_.isCasting()&&!this.sender_.hasRemoteProperties()&&shaka.cast.CastUtils.PlayerGetterMethods[a]){var e=this.localPlayer_[a];return goog.asserts.assert("function"==typeof e,"only methods on Player"),e.bind(this.localPlayer_)}return this.sender_.isCasting()?this.sender_.get("player",a):(e=this.localPlayer_[a],goog.asserts.assert("function"==typeof e,"only methods on Player"),e.bind(this.localPlayer_))},shaka.cast.CastProxy.prototype.playerProxyLocalEvent_=function(a){this.sender_.isCasting()||this.playerEventTarget_.dispatchEvent(a)},shaka.cast.CastProxy.prototype.onRemoteEvent_=function(a,b){goog.asserts.assert(this.sender_.isCasting(),"Should only receive remote events while casting"),this.sender_.isCasting()&&("video"==a?this.videoEventTarget_.dispatchEvent(b):"player"==a&&this.playerEventTarget_.dispatchEvent(b))},goog.exportSymbol("shaka.cast.CastProxy",shaka.cast.CastProxy),goog.exportProperty(shaka.cast.CastProxy.prototype,"changeReceiverId",shaka.cast.CastProxy.prototype.changeReceiverId),goog.exportProperty(shaka.cast.CastProxy.prototype,"forceDisconnect",shaka.cast.CastProxy.prototype.forceDisconnect),goog.exportProperty(shaka.cast.CastProxy.prototype,"suggestDisconnect",shaka.cast.CastProxy.prototype.suggestDisconnect),goog.exportProperty(shaka.cast.CastProxy.prototype,"setAppData",shaka.cast.CastProxy.prototype.setAppData),goog.exportProperty(shaka.cast.CastProxy.prototype,"cast",shaka.cast.CastProxy.prototype.cast),goog.exportProperty(shaka.cast.CastProxy.prototype,"receiverName",shaka.cast.CastProxy.prototype.receiverName),goog.exportProperty(shaka.cast.CastProxy.prototype,"isCasting",shaka.cast.CastProxy.prototype.isCasting),goog.exportProperty(shaka.cast.CastProxy.prototype,"canCast",shaka.cast.CastProxy.prototype.canCast),goog.exportProperty(shaka.cast.CastProxy.prototype,"getPlayer",shaka.cast.CastProxy.prototype.getPlayer),goog.exportProperty(shaka.cast.CastProxy.prototype,"getVideo",shaka.cast.CastProxy.prototype.getVideo),goog.exportProperty(shaka.cast.CastProxy.prototype,"destroy",shaka.cast.CastProxy.prototype.destroy),shaka.cast.CastReceiver=function(a,b,e,t){shaka.util.FakeEventTarget.call(this);var r=this;this.video_=a,this.player_=b,this.eventManager_=new shaka.util.EventManager,this.targets_={video:a,player:b},this.appDataCallback_=e||function(){},this.contentIdCallback_=t||function(a){return a},this.metadata_=null,this.isConnected_=!1,this.isIdle_=!0,this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.genericBus_=this.shakaBus_=null,this.pollTimer_=new shaka.util.Timer((function(){r.pollAttributes_()})),this.init_()},$jscomp.inherits(shaka.cast.CastReceiver,shaka.util.FakeEventTarget),shaka.cast.CastReceiver.prototype.isConnected=function(){return this.isConnected_},shaka.cast.CastReceiver.prototype.isIdle=function(){return this.isIdle_},shaka.cast.CastReceiver.prototype.setContentMetadata=function(a){this.metadata_=a},shaka.cast.CastReceiver.prototype.clearContentMetadata=function(){this.metadata_=null},shaka.cast.CastReceiver.prototype.setContentTitle=function(a){this.metadata_||(this.metadata_={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.metadata_.title=a},shaka.cast.CastReceiver.prototype.setContentImage=function(a){this.metadata_||(this.metadata_={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.metadata_.images=[{url:a}]},shaka.cast.CastReceiver.prototype.setContentArtist=function(a){this.metadata_||(this.metadata_={}),this.metadata_.artist=a,this.metadata_.metadataType=cast.receiver.media.MetadataType.MUSIC_TRACK},shaka.cast.CastReceiver.prototype.destroy=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){if(1==e.nextAddress)return a.eventManager_&&(a.eventManager_.release(),a.eventManager_=null),b=[],a.player_&&(b.push(a.player_.destroy()),a.player_=null),a.pollTimer_&&(a.pollTimer_.stop(),a.pollTimer_=null),a.video_=null,a.targets_=null,a.appDataCallback_=null,a.isConnected_=!1,a.isIdle_=!0,a.shakaBus_=null,a.genericBus_=null,e.yield(Promise.all(b),2);cast.receiver.CastReceiverManager.getInstance().stop(),e.jumpToEnd()}))},shaka.cast.CastReceiver.prototype.init_=function(){var a=this,b=cast.receiver.CastReceiverManager.getInstance();b.onSenderConnected=function(){return a.onSendersChanged_()},b.onSenderDisconnected=function(){return a.onSendersChanged_()},b.onSystemVolumeChanged=function(){return a.fakeVolumeChangeEvent_()},this.genericBus_=b.getCastMessageBus(shaka.cast.CastUtils.GENERIC_MESSAGE_NAMESPACE),this.genericBus_.onMessage=function(b){return a.onGenericMessage_(b)},this.shakaBus_=b.getCastMessageBus(shaka.cast.CastUtils.SHAKA_MESSAGE_NAMESPACE),this.shakaBus_.onMessage=function(b){return a.onShakaMessage_(b)},goog.DEBUG?shaka.util.Platform.isChromecast()&&b.start():b.start();for(var e=(b=$jscomp.makeIterator(shaka.cast.CastUtils.VideoEvents)).next();!e.done;e=b.next())this.eventManager_.listen(this.video_,e.value,(function(b){return a.proxyEvent_("video",b)}));for(var t in shaka.Player.EventName)this.eventManager_.listen(this.player_,shaka.Player.EventName[t],(function(b){return a.proxyEvent_("player",b)}));cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?this.player_.setMaxHardwareResolution(3840,2160):this.player_.setMaxHardwareResolution(1920,1080),this.eventManager_.listen(this.video_,"loadeddata",(function(){a.startUpdatingUpdateNumber_=!0})),this.eventManager_.listen(this.player_,"loading",(function(){a.isIdle_=!1,a.onCastStatusChanged_()})),this.eventManager_.listen(this.video_,"playing",(function(){a.isIdle_=!1,a.onCastStatusChanged_()})),this.eventManager_.listen(this.video_,"pause",(function(){a.onCastStatusChanged_()})),this.eventManager_.listen(this.player_,"unloading",(function(){a.isIdle_=!0,a.onCastStatusChanged_()})),this.eventManager_.listen(this.video_,"ended",(function(){new shaka.util.Timer((function(){a.video_&&a.video_.ended&&(a.isIdle_=!0,a.onCastStatusChanged_())})).tickAfter(shaka.cast.CastReceiver.IDLE_INTERVAL)}))},shaka.cast.CastReceiver.prototype.onSendersChanged_=function(){this.updateNumber_=0,this.initialStatusUpdatePending_=!0,this.isConnected_=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,this.onCastStatusChanged_()},shaka.cast.CastReceiver.prototype.onCastStatusChanged_=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?e.yield(Promise.resolve(),2):a.player_?(b=new shaka.util.FakeEvent("caststatuschanged"),a.dispatchEvent(b),a.maybeSendMediaInfoMessage_()||a.sendMediaStatus_(),void e.jumpToEnd()):e.return()}))},shaka.cast.CastReceiver.prototype.initState_=function(a,b){var e,t,r,g,n,o,l,h,d,p,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(q){switch(q.nextAddress){case 1:for(e in a.player)t=a.player[e],c.player_[e](t);return c.appDataCallback_(b),r=c.video_.autoplay,a.manifest?(c.video_.autoplay=!1,q.setCatchFinallyBlocks(5),q.yield(c.player_.load(a.manifest,a.startTime),7)):q.yield(Promise.resolve(),3);case 7:q.leaveTryBlock(3);break;case 5:return g=q.enterCatchBlock(),goog.asserts.assert(g instanceof shaka.util.Error,"Wrong error type!"),n=shaka.Player.EventName.Error,o=new shaka.util.FakeEvent(n,{detail:g}),c.player_.dispatchEvent(o),q.return();case 3:if(!c.player_)return q.return();for(l in a.video)h=a.video[l],c.video_[l]=h;for(d in a.playerAfterLoad)p=a.playerAfterLoad[d],c.player_[d](p);c.video_.autoplay=r,a.manifest&&(c.video_.play(),c.sendMediaStatus_()),q.jumpToEnd()}}))},shaka.cast.CastReceiver.prototype.proxyEvent_=function(a,b){this.player_&&(this.pollAttributes_(),this.sendMessage_({type:"event",targetName:a,event:b},this.shakaBus_))},shaka.cast.CastReceiver.prototype.pollAttributes_=function(){this.pollTimer_.tickAfter(shaka.cast.CastReceiver.POLL_INTERVAL);for(var a={video:{},player:{}},b=$jscomp.makeIterator(shaka.cast.CastUtils.VideoAttributes),e=b.next();!e.done;e=b.next())e=e.value,a.video[e]=this.video_[e];if(this.player_.isLive())for(var t in b=shaka.cast.CastUtils.PlayerGetterMethodsThatRequireLive)0==this.updateNumber_%b[t]&&(a.player[t]=this.player_[t]());for(var r in shaka.cast.CastUtils.PlayerGetterMethods)0==this.updateNumber_%shaka.cast.CastUtils.PlayerGetterMethods[r]&&(a.player[r]=this.player_[r]());(t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(a.video.volume=t.level,a.video.muted=t.muted),this.startUpdatingUpdateNumber_&&(this.updateNumber_+=1),this.sendMessage_({type:"update",update:a},this.shakaBus_),this.maybeSendMediaInfoMessage_()},shaka.cast.CastReceiver.prototype.maybeSendMediaInfoMessage_=function(){return!(!this.initialStatusUpdatePending_||!this.video_.duration&&!this.player_.isLive())&&(this.sendMediaInfoMessage_(),this.initialStatusUpdatePending_=!1,!0)},shaka.cast.CastReceiver.prototype.sendMediaInfoMessage_=function(a){a=void 0===a?0:a;var b={contentId:this.player_.getAssetUri(),streamType:this.player_.isLive()?"LIVE":"BUFFERED",contentType:""};this.player_.isLive()||(b.duration=this.video_.duration),this.metadata_&&(b.metadata=this.metadata_),this.sendMediaStatus_(a,b)},shaka.cast.CastReceiver.prototype.fakeVolumeChangeEvent_=function(){var a=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();goog.asserts.assert(a,"System volume should not be null!"),a&&this.sendMessage_({type:"update",update:{video:{volume:a.level,muted:a.muted}}},this.shakaBus_),this.sendMessage_({type:"event",targetName:"video",event:{type:"volumechange"}},this.shakaBus_)},shaka.cast.CastReceiver.prototype.onShakaMessage_=function(a){var b=this,e=shaka.cast.CastUtils.deserialize(a.data);switch(shaka.log.debug("CastReceiver: message",e),e.type){case"init":this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1,this.initialStatusUpdatePending_=!0,this.initState_(e.initState,e.appData),this.pollAttributes_();break;case"appData":this.appDataCallback_(e.appData);break;case"set":var t=e.targetName,r=e.property;if(e=e.value,"video"==t){if(a=cast.receiver.CastReceiverManager.getInstance(),"volume"==r){a.setSystemVolumeLevel(e);break}if("muted"==r){a.setSystemVolumeMuted(e);break}}this.targets_[t][r]=e;break;case"call":(t=this.targets_[e.targetName])[e.methodName].apply(t,e.args);break;case"asyncCall":t=e.targetName,r=e.methodName,"player"==t&&"load"==r&&(this.updateNumber_=0,this.startUpdatingUpdateNumber_=!1);var n=e.id,g=a.senderId;e=(a=this.targets_[t])[r].apply(a,e.args),"player"==t&&"load"==r&&(e=e.then((function(){b.initialStatusUpdatePending_=!0}))),e.then((function(){return b.sendAsyncComplete_(g,n,null)}),(function(a){return b.sendAsyncComplete_(g,n,a)}))}},shaka.cast.CastReceiver.prototype.onGenericMessage_=function(a){var b=this,e=shaka.cast.CastUtils.deserialize(a.data);switch(shaka.log.debug("CastReceiver: message",e),e.type){case"PLAY":this.video_.play(),this.sendMediaStatus_();break;case"PAUSE":this.video_.pause(),this.sendMediaStatus_();break;case"SEEK":a=e.currentTime;var t=e.resumeState;null!=a&&(this.video_.currentTime=Number(a)),t&&"PLAYBACK_START"==t?(this.video_.play(),this.sendMediaStatus_()):t&&"PLAYBACK_PAUSE"==t&&(this.video_.pause(),this.sendMediaStatus_());break;case"STOP":this.player_.unload().then((function(){b.player_&&b.sendMediaStatus_()}));break;case"GET_STATUS":this.sendMediaInfoMessage_(Number(e.requestId));break;case"VOLUME":a=(t=e.volume).level,t=t.muted;var r=this.video_.volume,n=this.video_.muted;null!=a&&(this.video_.volume=Number(a)),null!=t&&(this.video_.muted=t),r==this.video_.volume&&n==this.video_.muted||this.sendMediaStatus_();break;case"LOAD":this.updateNumber_=0,this.initialStatusUpdatePending_=this.startUpdatingUpdateNumber_=!1,a=e.media,t=e.currentTime,r=this.contentIdCallback_(a.contentId),n=e.autoplay||!0,this.appDataCallback_(a.customData),n&&(this.video_.autoplay=!0),this.player_.load(r,t).then((function(){b.player_&&b.sendMediaInfoMessage_()})).catch((function(a){goog.asserts.assert(a instanceof shaka.util.Error,"Wrong error type!");var t="LOAD_FAILED";a.category==shaka.util.Error.Category.PLAYER&&a.code==shaka.util.Error.Code.LOAD_INTERRUPTED&&(t="LOAD_CANCELLED"),b.sendMessage_({requestId:Number(e.requestId),type:t},b.genericBus_)}));break;default:shaka.log.warning("Unrecognized message type from the generic Chromecast controller!",e.type),this.sendMessage_({requestId:Number(e.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},this.genericBus_)}},shaka.cast.CastReceiver.prototype.sendAsyncComplete_=function(a,b,e){this.player_&&this.sendMessage_({type:"asyncComplete",id:b,error:e},this.shakaBus_,a)},shaka.cast.CastReceiver.prototype.sendMessage_=function(a,b,e){this.isConnected_&&(a=shaka.cast.CastUtils.serialize(a),e?b.getCastChannel(e).send(a):b.broadcast(a))},shaka.cast.CastReceiver.prototype.getPlayState_=function(){var a=shaka.cast.CastReceiver.PLAY_STATE;return this.isIdle_?a.IDLE:this.player_.isBuffering()?a.BUFFERING:this.video_.paused?a.PAUSED:a.PLAYING},shaka.cast.CastReceiver.prototype.sendMediaStatus_=function(a,b){a=void 0===a?0:a,b=void 0===b?null:b;var e={mediaSessionId:0,playbackRate:this.video_.playbackRate,playerState:this.getPlayState_(),currentTime:this.video_.currentTime,supportedMediaCommands:63,volume:{level:this.video_.volume,muted:this.video_.muted}};b&&(e.media=b),this.sendMessage_({requestId:a,type:"MEDIA_STATUS",status:[e]},this.genericBus_)},goog.exportSymbol("shaka.cast.CastReceiver",shaka.cast.CastReceiver),goog.exportProperty(shaka.cast.CastReceiver.prototype,"destroy",shaka.cast.CastReceiver.prototype.destroy),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentArtist",shaka.cast.CastReceiver.prototype.setContentArtist),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentImage",shaka.cast.CastReceiver.prototype.setContentImage),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentTitle",shaka.cast.CastReceiver.prototype.setContentTitle),goog.exportProperty(shaka.cast.CastReceiver.prototype,"clearContentMetadata",shaka.cast.CastReceiver.prototype.clearContentMetadata),goog.exportProperty(shaka.cast.CastReceiver.prototype,"setContentMetadata",shaka.cast.CastReceiver.prototype.setContentMetadata),goog.exportProperty(shaka.cast.CastReceiver.prototype,"isIdle",shaka.cast.CastReceiver.prototype.isIdle),goog.exportProperty(shaka.cast.CastReceiver.prototype,"isConnected",shaka.cast.CastReceiver.prototype.isConnected),shaka.cast.CastReceiver.POLL_INTERVAL=.5,shaka.cast.CastReceiver.IDLE_INTERVAL=5,shaka.cast.CastReceiver.PLAY_STATE={IDLE:"IDLE",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED"},shaka.cea={},shaka.cea.Cea608Memory=function(a,b){this.rows_=[],this.row_=1,this.scrollRows_=0,this.fieldNum_=a,this.channelNum_=b,this.italics_=this.underline_=!1,this.textColor_=shaka.cea.Cea608Memory.DEFAULT_TXT_COLOR,this.backgroundColor_=shaka.cea.Cea608Memory.DEFAULT_BG_COLOR,this.reset()},shaka.cea.Cea608Memory.prototype.forceEmit=function(a,b){for(var e="CC"+(this.fieldNum_<<1|this.channelNum_+1),t=-1,r=-1,n=0;n<this.rows_.length;n++)if(this.rows_[n].length){t=n;break}for(n=this.rows_.length-1;0<=n;n--)if(this.rows_[n].length){r=n;break}if(-1===t||-1===r)return null;for(var g=n=!1,o=shaka.cea.Cea608Memory.DEFAULT_TXT_COLOR,l=shaka.cea.Cea608Memory.DEFAULT_BG_COLOR,h=this.createStyledCue_(a,b,n,g,o,l),d=new shaka.text.Cue(a,b,"");t<=r;t++){for(var c=$jscomp.makeIterator(this.rows_[t]),p=c.next();!p.done;p=c.next()){var q=(p=p.value).isUnderlined(),m=p.isItalicized(),u=p.getTextColor(),f=p.getBackgroundColor();q==n&&m==g&&u==o&&f==l||(h.payload&&d.nestedCues.push(h),h=this.createStyledCue_(a,b,q,m,u,f),n=q,g=m,o=u,l=f),h.payload+=p.getChar()}h.payload&&d.nestedCues.push(h),t!==r&&((h=new shaka.text.Cue(a,b,"")).spacer=!0,d.nestedCues.push(h)),h=this.createStyledCue_(a,b,n,g,o,l)}return d.nestedCues.length?{cue:d,stream:e}:null},shaka.cea.Cea608Memory.prototype.createStyledCue_=function(a,b,e,t,r,n){return a=new shaka.text.Cue(a,b,""),e&&a.textDecoration.push(shaka.text.Cue.textDecoration.UNDERLINE),t&&(a.fontStyle=shaka.text.Cue.fontStyle.ITALIC),a.color=r,a.backgroundColor=n,a},shaka.cea.Cea608Memory.prototype.reset=function(){this.resetAllRows(),this.row_=1},shaka.cea.Cea608Memory.prototype.getRow=function(){return this.row_},shaka.cea.Cea608Memory.prototype.setRow=function(a){this.row_=a},shaka.cea.Cea608Memory.prototype.getScrollSize=function(){return this.scrollRows_},shaka.cea.Cea608Memory.prototype.setScrollSize=function(a){this.scrollRows_=a},shaka.cea.Cea608Memory.prototype.addChar=function(a,b){if(!(32>b||127<b)){var e="";switch(a){case shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN:e=shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars.has(b)?shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars.get(b):String.fromCharCode(b);break;case shaka.cea.Cea608Memory.CharSet.SPECIAL_NORTH_AMERICAN:e=shaka.cea.Cea608Memory.CharSet.SpecialNorthAmericanChars.get(b);break;case shaka.cea.Cea608Memory.CharSet.SPANISH_FRENCH:this.eraseChar(),e=shaka.cea.Cea608Memory.CharSet.ExtendedSpanishFrench.get(b);break;case shaka.cea.Cea608Memory.CharSet.PORTUGUESE_GERMAN:this.eraseChar(),e=shaka.cea.Cea608Memory.CharSet.ExtendedPortugueseGerman.get(b)}e&&(e=new shaka.cea.Cea608Char(e,this.underline_,this.italics_,this.backgroundColor_,this.textColor_),this.rows_[this.row_].push(e))}},shaka.cea.Cea608Memory.prototype.eraseChar=function(){this.rows_[this.row_].pop()},shaka.cea.Cea608Memory.prototype.moveRows=function(a,b,e){if(a>=b)for(--e;0<=e;e--)this.rows_[a+e]=this.rows_[b+e].map((function(a){return a}));else for(var t=0;t<e;t++)this.rows_[a+t]=this.rows_[b+t].map((function(a){return a}))},shaka.cea.Cea608Memory.prototype.resetRows=function(a,b){for(var e=0;e<=b;e++)this.rows_[a+e]=[]},shaka.cea.Cea608Memory.prototype.resetAllRows=function(){this.resetRows(0,shaka.cea.Cea608Memory.CC_ROWS)},shaka.cea.Cea608Memory.prototype.eraseBuffer=function(){this.row_=0<this.scrollRows_?this.scrollRows_:0,this.resetAllRows()},shaka.cea.Cea608Memory.prototype.setUnderline=function(a){this.underline_=a},shaka.cea.Cea608Memory.prototype.setItalics=function(a){this.italics_=a},shaka.cea.Cea608Memory.prototype.setTextColor=function(a){this.textColor_=a},shaka.cea.Cea608Memory.prototype.setBackgroundColor=function(a){this.backgroundColor_=a},shaka.cea.Cea608Char=function(a,b,e,t,r){this.character_=a,this.underline_=b,this.italics_=e,this.backgroundColor_=t,this.textColor_=r},shaka.cea.Cea608Char.prototype.getChar=function(){return this.character_},shaka.cea.Cea608Char.prototype.isUnderlined=function(){return this.underline_},shaka.cea.Cea608Char.prototype.isItalicized=function(){return this.italics_},shaka.cea.Cea608Char.prototype.getBackgroundColor=function(){return this.backgroundColor_},shaka.cea.Cea608Char.prototype.getTextColor=function(){return this.textColor_},shaka.cea.Cea608Memory.CC_ROWS=15,shaka.cea.Cea608Memory.DEFAULT_BG_COLOR="black",shaka.cea.Cea608Memory.DEFAULT_TXT_COLOR="white",shaka.cea.Cea608Memory.CharSet={BASIC_NORTH_AMERICAN:0,SPECIAL_NORTH_AMERICAN:1,SPANISH_FRENCH:2,PORTUGUESE_GERMAN:3},shaka.cea.Cea608Memory.CharSet.BasicNorthAmericanChars=new Map([[42,""],[92,""],[92,""],[94,""],[95,""],[96,""],[123,""],[124,""],[125,""],[126,""],[127,""]]),shaka.cea.Cea608Memory.CharSet.SpecialNorthAmericanChars=new Map([[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57,""],[58,""],[59,""],[60,""],[61,""],[62,""],[63,""]]),shaka.cea.Cea608Memory.CharSet.ExtendedSpanishFrench=new Map([[32,""],[33,""],[34,""],[35,""],[36,""],[37,""],[38,""],[39,""],[40,"*"],[41,"'"],[42,"-"],[43,""],[44,""],[45,""],[46,'"'],[47,'"'],[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57,""],[58,""],[59,""],[60,""],[61,""],[62,""],[63,""]]),shaka.cea.Cea608Memory.CharSet.ExtendedPortugueseGerman=new Map([[32,""],[33,""],[34,""],[35,""],[36,""],[37,""],[38,""],[39,""],[40,""],[41,"{"],[42,"}"],[43,"\\"],[44,"^"],[45,"_"],[46,"|"],[47,"~"],[48,""],[49,""],[50,""],[51,""],[52,""],[53,""],[54,""],[55,""],[56,""],[57,""],[58,""],[59,""],[60,"+"],[61,"+"],[62,"+"],[63,"+"]]),shaka.cea.Cea608DataChannel=function(a,b){this.type_=shaka.cea.Cea608DataChannel.CaptionType.NONE,this.text_=new shaka.cea.Cea608Memory(a,b),this.displayedMemory_=new shaka.cea.Cea608Memory(a,b),this.nonDisplayedMemory_=new shaka.cea.Cea608Memory(a,b),this.curbuf_=this.displayedMemory_,this.prevEndTime_=0,this.lastcp_=null},shaka.cea.Cea608DataChannel.prototype.reset=function(){this.type_=shaka.cea.Cea608DataChannel.CaptionType.PAINTON,this.curbuf_=this.displayedMemory_,this.lastcp_=null,this.displayedMemory_.reset(),this.nonDisplayedMemory_.reset(),this.text_.reset()},shaka.cea.Cea608DataChannel.prototype.pacToRow_=function(a,b){return[11,11,1,2,3,4,12,13,14,15,5,6,7,8,9,10][(7&a)<<1|b>>5&1]};shaka.cea.Cea608DataChannel.prototype.controlPac_=function(a,b){var e=this.pacToRow_(a,b),t=(30&b)>>1,r=shaka.cea.Cea608Memory.DEFAULT_TXT_COLOR,n=!1;if(7>t?r=shaka.cea.Cea608DataChannel.TEXT_COLORS[t]:7===t&&(n=!0),t=1==(1&b),this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT){var g=this.curbuf_;if(this.type_===shaka.cea.Cea608DataChannel.CaptionType.ROLLUP&&e!==g.getRow()){var o=1+g.getRow()-g.getScrollSize(),l=1+e-g.getScrollSize();g.moveRows(l,o,g.getScrollSize()),g.resetRows(0,l-1),g.resetRows(e+1,shaka.cea.Cea608Memory.CC_ROWS-e)}g.setRow(e),this.curbuf_.setUnderline(t),this.curbuf_.setItalics(n),this.curbuf_.setTextColor(r),this.curbuf_.setBackgroundColor(shaka.cea.Cea608Memory.DEFAULT_BG_COLOR)}},shaka.cea.Cea608DataChannel.prototype.controlMidrow_=function(a){this.curbuf_.setUnderline(!1),this.curbuf_.setItalics(!1),this.curbuf_.setTextColor(shaka.cea.Cea608Memory.DEFAULT_TXT_COLOR),this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,32);var b=!1,e=shaka.cea.Cea608DataChannel.TEXT_COLORS[(14&a)>>1];"white_italics"===e&&(e="white",b=!0),this.curbuf_.setUnderline(1==(1&a)),this.curbuf_.setItalics(b),this.curbuf_.setTextColor(e)},shaka.cea.Cea608DataChannel.prototype.controlBackgroundAttribute_=function(a,b){var e=shaka.cea.Cea608Memory.DEFAULT_BG_COLOR;0==(7&a)&&(e=shaka.cea.Cea608DataChannel.BG_COLORS[(14&b)>>1]),this.curbuf_.setBackgroundColor(e)},shaka.cea.Cea608DataChannel.prototype.controlMiscellaneous_=function(a){var b=shaka.cea.Cea608DataChannel.MiscCmd_,e=a.pts,t=null;switch(a.ccData2){case b.RCL:this.controlRcl_();break;case b.BS:this.controlBs_();break;case b.RU2:t=this.controlRu_(2,e);break;case b.RU3:t=this.controlRu_(3,e);break;case b.RU4:t=this.controlRu_(4,e);break;case b.FON:this.controlFon_();break;case b.RDC:this.controlRdc_(e);break;case b.TR:this.controlTr_();break;case b.RTD:this.controlRtd_();break;case b.EDM:t=this.controlEdm_(e);break;case b.CR:t=this.controlCr_(e);break;case b.ENM:this.controlEnm_();break;case b.EOC:t=this.controlEoc_(e)}return t},shaka.cea.Cea608DataChannel.prototype.controlCr_=function(a){var b=this.curbuf_;if(this.type_!==shaka.cea.Cea608DataChannel.CaptionType.ROLLUP)return null;var e=b.forceEmit(this.prevEndTime_,a),t=b.getRow()-b.getScrollSize()+1;return b.moveRows(t-1,t,b.getScrollSize()),b.resetRows(0,t-1),b.resetRows(b.getRow(),shaka.cea.Cea608Memory.CC_ROWS-b.getRow()),this.prevEndTime_=a,e},shaka.cea.Cea608DataChannel.prototype.controlRu_=function(a,b){var e=this.curbuf_=this.displayedMemory_,t=null;return this.type_!==shaka.cea.Cea608DataChannel.CaptionType.ROLLUP&&this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(t=e.forceEmit(this.prevEndTime_,b),this.displayedMemory_.eraseBuffer(),this.nonDisplayedMemory_.eraseBuffer(),e.setRow(shaka.cea.Cea608Memory.CC_ROWS)),this.type_=shaka.cea.Cea608DataChannel.CaptionType.ROLLUP,e.setScrollSize(a),t},shaka.cea.Cea608DataChannel.prototype.controlFon_=function(){this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,32)},shaka.cea.Cea608DataChannel.prototype.controlEdm_=function(a){var b=this.displayedMemory_,e=null;return this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(e=b.forceEmit(this.prevEndTime_,a)),b.resetAllRows(),e},shaka.cea.Cea608DataChannel.prototype.controlRdc_=function(a){this.type_=shaka.cea.Cea608DataChannel.CaptionType.PAINTON,this.curbuf_=this.displayedMemory_,this.curbuf_.setScrollSize(0),this.prevEndTime_=a},shaka.cea.Cea608DataChannel.prototype.controlEnm_=function(){this.nonDisplayedMemory_.resetAllRows()},shaka.cea.Cea608DataChannel.prototype.controlEoc_=function(a){var b=null;this.type_!==shaka.cea.Cea608DataChannel.CaptionType.TEXT&&(b=this.displayedMemory_.forceEmit(this.prevEndTime_,a));var e=this.nonDisplayedMemory_;return this.nonDisplayedMemory_=this.displayedMemory_,this.displayedMemory_=e,this.controlRcl_(),this.prevEndTime_=a,b},shaka.cea.Cea608DataChannel.prototype.controlRcl_=function(){this.type_=shaka.cea.Cea608DataChannel.CaptionType.POPON,this.curbuf_=this.nonDisplayedMemory_,this.curbuf_.setScrollSize(0)},shaka.cea.Cea608DataChannel.prototype.controlBs_=function(){this.curbuf_.eraseChar()},shaka.cea.Cea608DataChannel.prototype.controlTr_=function(){this.text_.reset(),this.controlRtd_()},shaka.cea.Cea608DataChannel.prototype.controlRtd_=function(){shaka.log.warnOnce("Cea608DataChannel","CEA-608 text mode entered, but is unsupported"),this.curbuf_=this.text_,this.type_=shaka.cea.Cea608DataChannel.CaptionType.TEXT},shaka.cea.Cea608DataChannel.prototype.handleBasicNorthAmericanChar=function(a,b){this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,a),this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.BASIC_NORTH_AMERICAN,b)},shaka.cea.Cea608DataChannel.prototype.handleExtendedWesternEuropeanChar_=function(a,b){this.curbuf_.addChar(1&a?shaka.cea.Cea608Memory.CharSet.PORTUGUESE_GERMAN:shaka.cea.Cea608Memory.CharSet.SPANISH_FRENCH,b)},shaka.cea.Cea608DataChannel.prototype.handleControlCode=function(a){var b=a.ccData1,e=a.ccData2;if(this.lastcp_===(b<<8|e))return this.lastcp_=null;if(this.lastcp_=b<<8|e,this.isPAC_(b,e))this.controlPac_(b,e);else if(this.isMidrowStyleChange_(b,e))this.controlMidrow_(e);else if(this.isBackgroundAttribute_(b,e))this.controlBackgroundAttribute_(b,e);else if(this.isSpecialNorthAmericanChar_(b,e))this.curbuf_.addChar(shaka.cea.Cea608Memory.CharSet.SPECIAL_NORTH_AMERICAN,e);else if(this.isExtendedWesternEuropeanChar_(b,e))this.handleExtendedWesternEuropeanChar_(b,e);else if(this.isMiscellaneous_(b,e))return this.controlMiscellaneous_(a);return null},shaka.cea.Cea608DataChannel.prototype.isMiscellaneous_=function(a,b){return 20==(246&a)&&32==(240&b)},shaka.cea.Cea608DataChannel.prototype.isPAC_=function(a,b){return 16==(240&a)&&64==(192&b)},shaka.cea.Cea608DataChannel.prototype.isMidrowStyleChange_=function(a,b){return 17==(247&a)&&32==(240&b)},shaka.cea.Cea608DataChannel.prototype.isBackgroundAttribute_=function(a,b){return 16==(247&a)&&32==(240&b)||23==(247&a)&&45==(255&b)},shaka.cea.Cea608DataChannel.prototype.isSpecialNorthAmericanChar_=function(a,b){return 17==(247&a)&&48==(240&b)},shaka.cea.Cea608DataChannel.prototype.isExtendedWesternEuropeanChar_=function(a,b){return 18==(246&a)&&32==(224&b)},shaka.cea.Cea608DataChannel.isControlCode=function(a){return 16==(112&a)},shaka.cea.Cea608DataChannel.MiscCmd_={RCL:32,BS:33,AOD:34,AON:35,DER:36,RU2:37,RU3:38,RU4:39,FON:40,RDC:41,TR:42,RTD:43,EDM:44,CR:45,ENM:46,EOC:47},shaka.cea.Cea608DataChannel.CaptionType={NONE:0,POPON:1,PAINTON:2,ROLLUP:3,TEXT:4},shaka.cea.Cea608DataChannel.BG_COLORS="black green blue cyan red yellow magenta black".split(" "),shaka.cea.Cea608DataChannel.TEXT_COLORS="white green blue cyan red yellow magenta white_italics".split(" "),shaka.cea.CeaDecoder=function(){this.ccPacketArray_=[],this.badFrames_=0,this.cea608ModeToStream_=new Map([["CC1",new shaka.cea.Cea608DataChannel(0,0)],["CC2",new shaka.cea.Cea608DataChannel(0,1)],["CC3",new shaka.cea.Cea608DataChannel(1,0)],["CC4",new shaka.cea.Cea608DataChannel(1,1)]]),this.currentField2Channel_=this.currentField1Channel_=0,this.reset()},shaka.cea.CeaDecoder.prototype.clear=function(){this.badFrames_=0,this.clearExtractedPackets_(),this.reset()},shaka.cea.CeaDecoder.prototype.clearExtractedPackets_=function(){this.ccPacketArray_=[]},shaka.cea.CeaDecoder.prototype.reset=function(){this.currentField2Channel_=this.currentField1Channel_=0;for(var a=$jscomp.makeIterator(this.cea608ModeToStream_.values()),b=a.next();!b.done;b=a.next())b.value.reset()},shaka.cea.CeaDecoder.prototype.extract=function(a,b){var e=new shaka.util.DataViewReader(a,shaka.util.DataViewReader.Endianness.BIG_ENDIAN);if(e.readUint8()===shaka.cea.CeaDecoder.USA_COUNTRY_CODE&&e.readUint16()===shaka.cea.CeaDecoder.ATSC_PROVIDER_CODE&&e.readUint32()===shaka.cea.CeaDecoder.ATSC1_USER_IDENTIFIER&&3===e.readUint8()){var t=e.readUint8();if(0!=(64&t)){t&=31,e.skip(1);for(var r=0;r<t;r++){var n=e.readUint8(),g=(4&n)>>2,o=e.readUint8(),l=e.readUint8();g&&this.ccPacketArray_.push({pts:b,type:3&n,ccData1:o,ccData2:l,order:this.ccPacketArray_.length})}}}},shaka.cea.CeaDecoder.prototype.decode=function(){var a=[];this.ccPacketArray_.sort((function(a,b){var e=a.pts-b.pts;return 0===e?a.order-b.order:e}));for(var b=$jscomp.makeIterator(this.ccPacketArray_),e=b.next();!e.done;e=b.next())((e=e.value).type===shaka.cea.CeaDecoder.NTSC_CC_FIELD_1||e.type===shaka.cea.CeaDecoder.NTSC_CC_FIELD_2)&&(e=this.decodeCea608_(e))&&a.push(e);return this.clearExtractedPackets_(),a},shaka.cea.CeaDecoder.prototype.decodeCea608_=function(a){var b=a.type;if(shaka.cea.Cea608DataChannel.isControlCode(a.ccData1)){var e=a.ccData1>>3&1;0===b?this.currentField1Channel_=e:this.currentField2Channel_=e}return b=this.cea608ModeToStream_.get("CC"+(b<<1|(b?this.currentField2Channel_:this.currentField1Channel_)+1)),255===a.ccData1&&255===a.ccData2||!a.ccData1&&!a.ccData2||!this.isOddParity_(a.ccData1)||!this.isOddParity_(a.ccData2)?(45<=++this.badFrames_&&this.reset(),null):(this.badFrames_=0,a.ccData1&=127,a.ccData2&=127,a.ccData1||a.ccData2?(e=null,shaka.cea.Cea608DataChannel.isControlCode(a.ccData1)?e=b.handleControlCode(a):b.handleBasicNorthAmericanChar(a.ccData1,a.ccData2),e):null)},shaka.cea.CeaDecoder.prototype.isOddParity_=function(a){for(var b=0;a;)b^=1&a,a>>=1;return 1===b},shaka.cea.CeaDecoder.ATSC_PROVIDER_CODE=49,shaka.cea.CeaDecoder.ATSC1_USER_IDENTIFIER=1195456820,shaka.cea.CeaDecoder.NTSC_CC_FIELD_1=0,shaka.cea.CeaDecoder.NTSC_CC_FIELD_2=1,shaka.cea.CeaDecoder.USA_COUNTRY_CODE=181,shaka.cea.ICaptionDecoder=function(){},shaka.cea.ICaptionDecoder.prototype.extract=function(a,b){},shaka.cea.ICaptionDecoder.prototype.decode=function(){},shaka.cea.ICaptionDecoder.prototype.clear=function(){},shaka.cea.ICeaParser=function(){},shaka.cea.ICeaParser.prototype.init=function(a){},shaka.cea.ICeaParser.prototype.parse=function(a){},shaka.cea.ICeaParser.NALU_TYPE_SEI=6,shaka.cea.ICeaParser.DEFAULT_TIMESCALE_VALUE=9e4,shaka.cea.SeiProcessor=function(){},shaka.cea.SeiProcessor.prototype.process=function e(a){var t,r,n,g,o=this;return $jscomp.generator.createGenerator(e,(function(e){if(1==e.nextAddress&&(t=o.removeEmu_(a),r=0),4!=e.nextAddress){if(!(r+t<a.length))return e.jumpTo(0);for(n=0;255==a[r];)n+=255,r++;for(n+=a[r++],g=0;255==a[r];)g+=255,r++;return g+=a[r++],4!=n?e.jumpTo(4):e.yield(a.subarray(r,r+g),4)}return r+=g,e.jumpTo(2)}))},shaka.cea.SeiProcessor.prototype.removeEmu_=function(a){for(var b=0,e=0,t=0;e<a.length;)2==b&&3==a[e]?b=0:(0==a[e]?b++:b=0,a[t]=a[e],t++),e++;return e-t},shaka.util.Mp4BoxParsers=function(){},shaka.util.Mp4BoxParsers.parseTFHD=function(a,b){var e=null,t=null,r=a.readUint32();return 1&b&&a.skip(8),2&b&&a.skip(4),8&b&&(e=a.readUint32()),16&b&&(t=a.readUint32()),{trackId:r,defaultSampleDuration:e,defaultSampleSize:t}},shaka.util.Mp4BoxParsers.parseTFDT=function(a,b){return{baseMediaDecodeTime:1==b?a.readUint64():a.readUint32()}},shaka.util.Mp4BoxParsers.parseMDHD=function(a,b){return 1==b?(a.skip(8),a.skip(8)):(a.skip(4),a.skip(4)),{timescale:a.readUint32()}},shaka.util.Mp4BoxParsers.parseTREX=function(a){return a.skip(4),a.skip(4),{defaultSampleDuration:a.readUint32(),defaultSampleSize:a=a.readUint32()}},shaka.util.Mp4BoxParsers.parseTRUN=function(a,b,e){var t=a.readUint32(),r=[];1&e&&a.skip(4),4&e&&a.skip(4);for(var n=$jscomp.makeIterator(shaka.util.Iterables.range(t)),g=n.next();!g.done;g=n.next())shaka.util.Functional.ignored(g.value),g={sampleDuration:null,sampleSize:null,sampleCompositionTimeOffset:null},256&e&&(g.sampleDuration=a.readUint32()),512&e&&(g.sampleSize=a.readUint32()),1024&e&&a.skip(4),2048&e&&(g.sampleCompositionTimeOffset=0==b?a.readUint32():a.readInt32()),r.push(g);return{sampleCount:t,sampleData:r}},shaka.util.Mp4BoxParsers.parseTKHD=function(a,b){if(1==b){a.skip(8),a.skip(8);var e=a.readUint64()}else a.skip(4),a.skip(4),e=a.readUint32();return{trackId:e}},shaka.cea.Mp4CeaParser=function(){this.seiProcessor_=new shaka.cea.SeiProcessor,this.trackIdToTimescale_=new Map,this.defaultSampleSize_=this.defaultSampleDuration_=0},shaka.cea.Mp4CeaParser.prototype.init=function(a){var b=this,e=shaka.util.Mp4Parser,t=[],r=[];if((new e).box("moov",e.children).box("mvex",e.children).fullBox("trex",(function(a){a=shaka.util.Mp4BoxParsers.parseTREX(a.reader),b.defaultSampleDuration_=a.defaultSampleDuration,b.defaultSampleSize_=a.defaultSampleSize})).box("trak",e.children).fullBox("tkhd",(function(a){goog.asserts.assert(null!=a.version,"TKHD is a full box and should have a valid version."),a=shaka.util.Mp4BoxParsers.parseTKHD(a.reader,a.version),t.push(a.trackId)})).box("mdia",e.children).fullBox("mdhd",(function(a){goog.asserts.assert(null!=a.version,"MDHD is a full box and should have a valid version."),a=shaka.util.Mp4BoxParsers.parseMDHD(a.reader,a.version),r.push(a.timescale)})).parse(a,!0),!t.length||!r.length||t.length!=r.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_CEA);t.forEach((function(a,e){b.trackIdToTimescale_.set(a,r[e])}))},shaka.cea.Mp4CeaParser.prototype.parse=function(a){var b=this,e=shaka.util.Mp4Parser,t=[],r=this.defaultSampleDuration_,n=this.defaultSampleSize_,g=[],o=null,l=shaka.cea.ICeaParser.DEFAULT_TIMESCALE_VALUE;return(new e).box("moof",e.children).box("traf",e.children).fullBox("trun",(function(a){goog.asserts.assert(null!=a.version&&null!=a.flags,"TRUN is a full box and should have a valid version & flags."),g=shaka.util.Mp4BoxParsers.parseTRUN(a.reader,a.version,a.flags).sampleData})).fullBox("tfhd",(function(a){goog.asserts.assert(null!=a.flags,"TFHD is a full box and should have valid flags."),a=shaka.util.Mp4BoxParsers.parseTFHD(a.reader,a.flags),r=a.defaultSampleDuration||b.defaultSampleDuration_,n=a.defaultSampleSize||b.defaultSampleSize_,a=a.trackId,b.trackIdToTimescale_.has(a)&&(l=b.trackIdToTimescale_.get(a))})).fullBox("tfdt",(function(a){goog.asserts.assert(null!=a.version,"TFDT is a full box and should have a valid version."),o=shaka.util.Mp4BoxParsers.parseTFDT(a.reader,a.version).baseMediaDecodeTime})).box("mdat",(function(a){if(null===o)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_CEA);b.parseMdat_(a.reader,o,l,r,n,g,t)})).parse(a,!1),t},shaka.cea.Mp4CeaParser.prototype.parseMdat_=function(a,b,e,t,r,n,g){var o=0,l=r;for(n.length&&(l=n[0].sampleSize||r);a.hasMoreData();){var h=a.readUint32();if((31&a.readUint8())==shaka.cea.ICeaParser.NALU_TYPE_SEI){var d=0;n.length>o&&(d=n[o].sampleCompositionTimeOffset||0),d=(b+d)/e;for(var c=$jscomp.makeIterator(this.seiProcessor_.process(a.readBytes(h-1))),p=c.next();!p.done;p=c.next())g.push({packet:p.value,pts:d})}else a.skip(h-1);0==(l-=h+4)&&(b=n.length>o?b+(n[o].sampleDuration||t):b+t,o++,l=n.length>o&&n[o].sampleSize||r)}},shaka.util.Pssh=function(a){var b=this;this.systemIds=[],this.cencKeyIds=[],this.data=[],(new shaka.util.Mp4Parser).box("moov",shaka.util.Mp4Parser.children).fullBox("pssh",(function(a){return b.parsePsshBox_(a)})).parse(a),0==this.data.length&&shaka.log.warning("No pssh box found!")},shaka.util.Pssh.prototype.parsePsshBox_=function(a){if(goog.asserts.assert(null!=a.version,"PSSH boxes are full boxes and must have a valid version"),goog.asserts.assert(null!=a.flags,"PSSH boxes are full boxes and must have a valid flag"),1<a.version)shaka.log.warning("Unrecognized PSSH version found!");else{var b=a.reader.getDataView();if(goog.asserts.assert(12<=b.byteOffset,"DataView at incorrect position"),b=shaka.util.BufferUtils.toUint8(b,-12,a.size),this.data.push(b),this.systemIds.push(shaka.util.Uint8ArrayUtils.toHex(a.reader.readBytes(16))),0<a.version){b=a.reader.readUint32();for(var e=(b=$jscomp.makeIterator(shaka.util.Iterables.range(b))).next();!e.done;e=b.next())shaka.util.Functional.ignored(e.value),e=shaka.util.Uint8ArrayUtils.toHex(a.reader.readBytes(16)),this.cencKeyIds.push(e)}}},shaka.util.Pssh.createPssh=function(a,b){goog.asserts.assert(16==b.byteLength,"Invalid system ID length");var e=a.length,t=12+b.length+4+e,r=new Uint8Array(t),n=shaka.util.BufferUtils.toDataView(r),g=0;return n.setUint32(g,t),g+=4,n.setUint32(g,1886614376),g+=4,n.setUint32(g,0),g+=4,r.set(b,g),g+=b.length,n.setUint32(g,e),g+=4,r.set(a,g),goog.asserts.assert(g+e===t,"PSSH invalid length."),r},shaka.util.Pssh.normaliseInitData=function(a){if(!a)return a;var b=new shaka.util.Pssh(a);if(1>=b.data.length)return a;a=[];for(var e={},t=(b=$jscomp.makeIterator(b.data)).next();!t.done;e={$jscomp$loop$prop$initData$464$551:e.$jscomp$loop$prop$initData$464$551},t=b.next())e.$jscomp$loop$prop$initData$464$551=t.value,a.some(function(a){return function(b){return shaka.util.BufferUtils.equal(b,a.$jscomp$loop$prop$initData$464$551)}}(e))||a.push(e.$jscomp$loop$prop$initData$464$551);return shaka.util.Uint8ArrayUtils.concat.apply(shaka.util.Uint8ArrayUtils,$jscomp.arrayFromIterable(a))},shaka.util.XmlUtils=function(){},shaka.util.XmlUtils.findChild=function(a,b){var e=shaka.util.XmlUtils.findChildren(a,b);return 1!=e.length?null:e[0]},shaka.util.XmlUtils.findChildNS=function(a,b,e){return 1!=(a=shaka.util.XmlUtils.findChildrenNS(a,b,e)).length?null:a[0]},shaka.util.XmlUtils.findChildren=function(a,b){return Array.from(a.childNodes).filter((function(a){return a instanceof Element&&a.tagName==b}))},shaka.util.XmlUtils.findChildrenNS=function(a,b,e){return Array.from(a.childNodes).filter((function(a){return a instanceof Element&&a.localName==e&&a.namespaceURI==b}))},shaka.util.XmlUtils.getAttributeNS=function(a,b,e){return a.hasAttributeNS(b,e)?a.getAttributeNS(b,e):null},shaka.util.XmlUtils.getContents=function(a){return Array.from(a.childNodes).every((function(a){return a.nodeType==Node.TEXT_NODE||a.nodeType==Node.CDATA_SECTION_NODE}))?a.textContent.trim():null},shaka.util.XmlUtils.parseAttr=function(a,b,e,t){t=void 0===t?null:t;var r=null;return null!=(a=a.getAttribute(b))&&(r=e(a)),null==r?t:r},shaka.util.XmlUtils.parseDate=function(a){return a?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(a)&&(a+="Z"),a=Date.parse(a),isNaN(a)?null:Math.floor(a/1e3)):null},shaka.util.XmlUtils.parseDuration=function(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);return b?(a=31536e3*Number(b[1]||null)+2592e3*Number(b[2]||null)+86400*Number(b[3]||null)+3600*Number(b[4]||null)+60*Number(b[5]||null)+Number(b[6]||null),isFinite(a)?a:null):(shaka.log.warning("Invalid duration string:",a),null)},shaka.util.XmlUtils.parseRange=function(a){var b=/([0-9]+)-([0-9]+)/.exec(a);return b?(a=Number(b[1]),isFinite(a)?(b=Number(b[2]),isFinite(b)?{start:a,end:b}:null):null):null},shaka.util.XmlUtils.parseInt=function(a){return 0==(a=Number(a))%1?a:null},shaka.util.XmlUtils.parsePositiveInt=function(a){return 0==(a=Number(a))%1&&0<a?a:null},shaka.util.XmlUtils.parseNonNegativeInt=function(a){return 0==(a=Number(a))%1&&0<=a?a:null},shaka.util.XmlUtils.parseFloat=function(a){return a=Number(a),isNaN(a)?null:a},shaka.util.XmlUtils.evalDivision=function(a){var b;return a=(b=a.match(/^(\d+)\/(\d+)$/))?Number(b[1])/Number(b[2]):Number(a),isNaN(a)?null:a},shaka.util.XmlUtils.parseXmlString=function(a,b){var e=new DOMParser,t=null,r=null;try{r=e.parseFromString(a,"text/xml")}catch(e){}return r&&r.documentElement.tagName==b&&(t=r.documentElement),t&&0<t.getElementsByTagName("parsererror").length?null:t},shaka.util.XmlUtils.parseXml=function(a,b){try{var e=shaka.util.StringUtils.fromUTF8(a);return shaka.util.XmlUtils.parseXmlString(e,b)}catch(e){return null}},shaka.dash={},shaka.dash.ContentProtection=function(){},shaka.dash.ContentProtection.parseFromAdaptationSet=function(a,b){var e=shaka.dash.ContentProtection,t=shaka.util.ManifestParserUtils,r=e.parseElements_(a),n=null,g=[],o=[],l=new Set(r.map((function(a){return a.keyId})));if(l.delete(null),1<l.size)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_CONFLICTING_KEY_IDS);if(b||(o=r.filter((function(a){return a.schemeUri!=e.MP4Protection_||(goog.asserts.assert(!a.init||a.init.length,"Init data must be null or non-empty."),n=a.init||n,!1)}))).length&&(0==(g=e.convertElements_(n,o)).length&&(g=[t.createDrmInfo("",n)])),r.length&&(b||!o.length))for(g=[],o=(r=$jscomp.makeIterator(e.defaultKeySystems_.values())).next();!o.done;o=r.next())"org.w3.clearkey"!=(o=o.value)&&(o=t.createDrmInfo(o,n),g.push(o));if(t=Array.from(l)[0]||null)for(r=(l=$jscomp.makeIterator(g)).next();!r.done;r=l.next())for(o=(r=$jscomp.makeIterator(r.value.initData)).next();!o.done;o=r.next())o.value.keyId=t;return{defaultKeyId:t,defaultInit:n,drmInfos:g,firstRepresentation:!0}},shaka.dash.ContentProtection.parseFromRepresentation=function(a,b,e){var t=shaka.dash.ContentProtection.parseFromAdaptationSet(a,e);if(b.firstRepresentation)a=1==b.drmInfos.length&&!b.drmInfos[0].keySystem,e=0==t.drmInfos.length,(0==b.drmInfos.length||a&&!e)&&(b.drmInfos=t.drmInfos),b.firstRepresentation=!1;else if(0<t.drmInfos.length&&(b.drmInfos=b.drmInfos.filter((function(a){return t.drmInfos.some((function(b){return b.keySystem==a.keySystem}))})),0==b.drmInfos.length))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_COMMON_KEY_SYSTEM);return t.defaultKeyId||b.defaultKeyId},shaka.dash.ContentProtection.getWidevineLicenseUrl=function(a){return(a=shaka.util.XmlUtils.findChildNS(a.node,"urn:microsoft","laurl"))&&a.getAttribute("licenseUrl")||""},shaka.dash.ContentProtection.parseMsProRecords_=function(a,b){for(var e=[];b<a.byteLength-1;){var t=a.getUint16(b,!0);b+=2;var r=a.getUint16(b,!0);if(b+=2,0!=(1&r)||r+b>a.byteLength)return shaka.log.warning("Malformed MS PRO object"),[];var n=shaka.util.BufferUtils.toUint8(a,b,r);e.push({type:t,value:n}),b+=r}return e},shaka.dash.ContentProtection.parseMsPro_=function(a){var b=0,e=shaka.util.BufferUtils.toDataView(a),t=e.getUint32(b,!0);return b+=4,t!=a.byteLength?(shaka.log.warning("PlayReady Object with invalid length encountered."),[]):shaka.dash.ContentProtection.parseMsProRecords_(e,b+2)},shaka.dash.ContentProtection.getLaurl_=function(a){for(var b=(a=$jscomp.makeIterator(a.getElementsByTagName("DATA"))).next();!b.done;b=a.next())for(var e=(b=$jscomp.makeIterator(b.value.childNodes)).next();!e.done;e=b.next())if((e=e.value)instanceof Element&&"LA_URL"==e.tagName)return e.textContent;return""},shaka.dash.ContentProtection.getPlayReadyLicenseUrl=function(a){var b=shaka.util.XmlUtils.findChildNS(a.node,"urn:microsoft:playready","pro");if(!b)return"";var e=(a=shaka.dash.ContentProtection).PLAYREADY_RECORD_TYPES;return b=shaka.util.Uint8ArrayUtils.fromBase64(b.textContent),(b=a.parseMsPro_(b).filter((function(a){return a.type===e.RIGHTS_MANAGEMENT}))[0])?(b=shaka.util.StringUtils.fromUTF16(b.value,!0),(b=shaka.util.XmlUtils.parseXmlString(b,"WRMHEADER"))?a.getLaurl_(b):""):""},shaka.dash.ContentProtection.getInitDataFromPro_=function(a){var b=shaka.util.XmlUtils.findChildNS(a.node,"urn:microsoft:playready","pro");if(!b)return null;b=shaka.util.Uint8ArrayUtils.fromBase64(b.textContent);var e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);return[{initData:shaka.util.Pssh.createPssh(b,e),initDataType:"cenc",keyId:a.keyId}]},shaka.dash.ContentProtection.convertElements_=function(a,b){for(var e=shaka.dash.ContentProtection,t=shaka.util.ManifestParserUtils,r=e.defaultKeySystems_,n=e.licenseUrlParsers_,g=[],o=$jscomp.makeIterator(b),l=o.next();!l.done;l=o.next()){l=l.value;var h=r.get(l.schemeUri);if(h){goog.asserts.assert(!l.init||l.init.length,"Init data must be null or non-empty.");var d=e.getInitDataFromPro_(l);d=t.createDrmInfo(h,l.init||a||d),(h=n.get(h))&&(d.licenseServerUri=h(l)),g.push(d)}}return g},shaka.dash.ContentProtection.parseElements_=function(a){for(var b=[],e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next())(e=shaka.dash.ContentProtection.parseElement_(e.value))&&b.push(e);return b},shaka.dash.ContentProtection.parseElement_=function(a){var b=shaka.dash.ContentProtection.CencNamespaceUri_,e=a.getAttribute("schemeIdUri"),t=shaka.util.XmlUtils.getAttributeNS(a,b,"default_KID");if(b=shaka.util.XmlUtils.findChildrenNS(a,b,"pssh").map(shaka.util.XmlUtils.getContents),!e)return shaka.log.error("Missing required schemeIdUri attribute on","ContentProtection element",a),null;if(e=e.toLowerCase(),t&&(t=t.replace(/-/g,"").toLowerCase()).includes(" "))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED);var r=[];try{r=b.map((function(a){return{initDataType:"cenc",initData:shaka.util.Uint8ArrayUtils.fromBase64(a),keyId:null}}))}catch(e){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_PSSH_BAD_ENCODING)}return{node:a,schemeUri:e,keyId:t,init:0<r.length?r:null}},shaka.dash.ContentProtection.PLAYREADY_RECORD_TYPES={RIGHTS_MANAGEMENT:1,RESERVED:2,EMBEDDED_LICENSE:3},shaka.dash.ContentProtection.defaultKeySystems_=(new Map).set("urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b","org.w3.clearkey").set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine.alpha").set("urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95","com.microsoft.playready").set("urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb","com.adobe.primetime"),shaka.dash.ContentProtection.licenseUrlParsers_=(new Map).set("com.widevine.alpha",shaka.dash.ContentProtection.getWidevineLicenseUrl).set("com.microsoft.playready",shaka.dash.ContentProtection.getPlayReadyLicenseUrl),shaka.dash.ContentProtection.MP4Protection_="urn:mpeg:dash:mp4protection:2011",shaka.dash.ContentProtection.CencNamespaceUri_="urn:mpeg:cenc:2013",shaka.dash.MpdUtils=function(){},shaka.dash.MpdUtils.fillUriTemplate=function(a,b,e,t,r){var n={RepresentationID:b,Number:e,Bandwidth:t,Time:r};return a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,(function(b,e,t,r){if("$$"==b)return"$";var g=n[e];if(goog.asserts.assert(void 0!==g,"Unrecognized identifier"),null==g)return shaka.log.warning("URL template does not have an available substitution for ",'identifier "'+e+'":',a),b;switch("RepresentationID"==e&&t&&(shaka.log.warning("URL template should not contain a width specifier for identifier",'"RepresentationID":',a),t=void 0),"Time"==e&&(goog.asserts.assert("number"==typeof g,"Time value should be a number!"),goog.asserts.assert(.2>Math.abs(g-Math.round(g)),"Calculated $Time$ values must be close to integers"),g=Math.round(g)),r){case void 0:case"d":case"i":case"u":b=g.toString();break;case"o":b=g.toString(8);break;case"x":b=g.toString(16);break;case"X":b=g.toString(16).toUpperCase();break;default:goog.asserts.assert(!1,"Unhandled format specifier"),b=g.toString()}return t=window.parseInt(t,10)||1,Array(Math.max(0,t-b.length)+1).join("0")+b}))},shaka.dash.MpdUtils.createTimeline=function(a,b,e,t){goog.asserts.assert(0<b&&1/0>b,"timescale must be a positive, finite integer"),goog.asserts.assert(0<t,"period duration must be a positive integer");var r=shaka.util.XmlUtils,n=r.findChildren(a,"S");a=[];for(var g=-e,o=(n=$jscomp.makeIterator(shaka.util.Iterables.enumerate(n))).next();!o.done;o=n.next()){var l=(o=o.value).item,h=o.next,d=r.parseAttr(l,"t",r.parseNonNegativeInt);o=r.parseAttr(l,"d",r.parseNonNegativeInt);var c=r.parseAttr(l,"r",r.parseInt);if(null!=d&&(d-=e),!o){shaka.log.warning('"S" element must have a duration:','ignoring the remaining "S" elements.',l);break}if(d=null!=d?d:g,0>(c=c||0))if(h){if(null==(h=r.parseAttr(h,"t",r.parseNonNegativeInt))){shaka.log.warning('An "S" element cannot have a negative repeat','if the next "S" element does not have a valid start time:','ignoring the remaining "S" elements.',l);break}if(d>=h){shaka.log.warning('An "S" element cannot have a negative repeatif its start ','time exceeds the next "S" element\'s start time:','ignoring the remaining "S" elements.',l);break}c=Math.ceil((h-d)/o)-1}else{if(1/0==t){shaka.log.warning('The last "S" element cannot have a negative repeat',"if the Period has an infinite duration:",'ignoring the last "S" element.',l);break}if(d/b>=t){shaka.log.warning('The last "S" element cannot have a negative repeat',"if its start time exceeds the Period's duration:",'igoring the last "S" element.',l);break}c=Math.ceil((t*b-d)/o)-1}for(0<a.length&&d!=g&&(Math.abs((d-g)/b)>=shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS&&shaka.log.warning("SegmentTimeline contains a large gap/overlap:","the content may have errors in it.",l),a[a.length-1].end=d/b),h=(l=$jscomp.makeIterator(shaka.util.Iterables.range(c+1))).next();!h.done;h=l.next())shaka.util.Functional.ignored(h.value),g=d+o,a.push({start:d/b,end:g/b,unscaledStart:d}),d=g}return a},shaka.dash.MpdUtils.parseSegmentInfo=function(a,b){goog.asserts.assert(b(a.representation),"There must be at least one element of the given type.");var e=shaka.dash.MpdUtils,t=shaka.util.XmlUtils,r=e.inheritAttribute(a,b,"timescale"),n=1;r&&(n=t.parsePositiveInt(r)||1),r=e.inheritAttribute(a,b,"duration"),(r=t.parsePositiveInt(r||""))&&(r/=n);var g=e.inheritAttribute(a,b,"startNumber"),o=Number(e.inheritAttribute(a,b,"presentationTimeOffset"))||0;t=t.parseNonNegativeInt(g||""),null!=g&&null!=t||(t=1);var l=null;return(g=e.inheritChild(a,b,"SegmentTimeline"))&&(l=e.createTimeline(g,n,o,a.periodInfo.duration||1/0)),{timescale:n,segmentDuration:r,startNumber:t,scaledPresentationTimeOffset:o/n||0,unscaledPresentationTimeOffset:o,timeline:l}},shaka.dash.MpdUtils.inheritAttribute=function(a,b,e){var t=shaka.util.Functional;return goog.asserts.assert(b(a.representation),"There must be at least one element of the given type"),[b(a.representation),b(a.adaptationSet),b(a.period)].filter(t.isNotNull).map((function(a){return a.getAttribute(e)})).reduce((function(a,b){return a||b}))},shaka.dash.MpdUtils.inheritChild=function(a,b,e){var t=shaka.util.Functional;goog.asserts.assert(b(a.representation),"There must be at least one element of the given type"),a=[b(a.representation),b(a.adaptationSet),b(a.period)].filter(t.isNotNull);var r=shaka.util.XmlUtils;return a.map((function(a){return r.findChild(a,e)})).reduce((function(a,b){return a||b}))},shaka.dash.MpdUtils.handleXlinkInElement_=function(a,b,e,t,r,n){var g=shaka.util.XmlUtils,o=shaka.util.Error,l=shaka.util.ManifestParserUtils,h=shaka.dash.MpdUtils.XlinkNamespaceUri_,d=g.getAttributeNS(a,h,"href");g=g.getAttributeNS(a,h,"actuate")||"onRequest";for(var c=$jscomp.makeIterator(Array.from(a.attributes)),p=c.next();!p.done;p=c.next())(p=p.value).namespaceURI==h&&a.removeAttributeNS(p.namespaceURI,p.localName);if(5<=n)return shaka.util.AbortableOperation.failed(new o(o.Severity.CRITICAL,o.Category.MANIFEST,o.Code.DASH_XLINK_DEPTH_LIMIT));if("onLoad"!=g)return shaka.util.AbortableOperation.failed(new o(o.Severity.CRITICAL,o.Category.MANIFEST,o.Code.DASH_UNSUPPORTED_XLINK_ACTUATE));var q=l.resolveUris([t],[d]);return t=shaka.net.NetworkingEngine.RequestType.MANIFEST,l=shaka.net.NetworkingEngine.makeRequest(q,b),t=r.request(t,l),goog.asserts.assert(t instanceof shaka.util.AbortableOperation,"Unexpected implementation of IAbortableOperation!"),t.chain((function(t){if(!(t=shaka.util.XmlUtils.parseXml(t.data,a.tagName)))return shaka.util.AbortableOperation.failed(new o(o.Severity.CRITICAL,o.Category.MANIFEST,o.Code.DASH_INVALID_XML,d));for(;a.childNodes.length;)a.removeChild(a.childNodes[0]);for(;t.childNodes.length;){var g=t.childNodes[0];t.removeChild(g),a.appendChild(g)}for(g=(t=$jscomp.makeIterator(Array.from(t.attributes))).next();!g.done;g=t.next())a.setAttributeNode(g.value.cloneNode(!1));return shaka.dash.MpdUtils.processXlinks(a,b,e,q[0],r,n+1)}))},shaka.dash.MpdUtils.processXlinks=function(a,b,e,t,r,n){n=void 0===n?0:n;var g=shaka.dash.MpdUtils,o=shaka.util.XmlUtils,l=g.XlinkNamespaceUri_;if(o.getAttributeNS(a,l,"href"))return o=g.handleXlinkInElement_(a,b,e,t,r,n),e&&(o=o.chain(void 0,(function(o){return g.processXlinks(a,b,e,t,r,n)}))),o;for(var h=[],d=$jscomp.makeIterator(Array.from(a.childNodes)),c=d.next();!c.done;c=d.next())(c=c.value)instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==o.getAttributeNS(c,l,"href")?a.removeChild(c):"SegmentTimeline"!=c.tagName&&h.push(shaka.dash.MpdUtils.processXlinks(c,b,e,t,r,n)));return shaka.util.AbortableOperation.all(h).chain((function(){return a}))},shaka.dash.MpdUtils.XlinkNamespaceUri_="http://www.w3.org/1999/xlink",shaka.media.Mp4SegmentIndexParser=function(){},shaka.media.Mp4SegmentIndexParser.parse=function(a,b,e,t,r,n,g){var o,l=shaka.media.Mp4SegmentIndexParser,h=(new shaka.util.Mp4Parser).fullBox("sidx",(function(a){o=l.parseSIDX_(b,t,r,n,g,e,a)}));if(a&&h.parse(a),o)return o;throw shaka.log.error('Invalid box type, expected "sidx".'),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_WRONG_BOX_TYPE)},shaka.media.Mp4SegmentIndexParser.parseSIDX_=function(a,b,e,t,r,n,g){goog.asserts.assert(null!=g.version,"SIDX is a full box and should have a valid version.");var o=[];g.reader.skip(4);var l=g.reader.readUint32();if(0==l)throw shaka.log.error("Invalid timescale."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_INVALID_TIMESCALE);if(0==g.version)var h=g.reader.readUint32(),d=g.reader.readUint32();else h=g.reader.readUint64(),d=g.reader.readUint64();g.reader.skip(2);var c=g.reader.readUint16();for(a=a+g.size+d,d=(c=$jscomp.makeIterator(shaka.util.Iterables.range(c))).next();!d.done;d=c.next()){shaka.util.Functional.ignored(d.value);var p=g.reader.readUint32();d=(2147483648&p)>>>31,p&=2147483647;var q=g.reader.readUint32();if(g.reader.skip(4),1==d)throw shaka.log.error("Heirarchical SIDXs are not supported."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.MP4_SIDX_TYPE_NOT_SUPPORTED);o.push(new shaka.media.SegmentReference(h/l+e,(h+q)/l+e,(function(){return n}),a,a+p-1,b,e,t,r)),h+=q,a+=p}return g.parser.stop(),o},shaka.util.EbmlParser=function(a){this.dataView_=shaka.util.BufferUtils.toDataView(a),this.reader_=new shaka.util.DataViewReader(this.dataView_,shaka.util.DataViewReader.Endianness.BIG_ENDIAN)},shaka.util.EbmlParser.prototype.hasMoreData=function(){return this.reader_.hasMoreData()},shaka.util.EbmlParser.prototype.parseElement=function(){var a=this.parseId_(),b=this.parseVint_();b=shaka.util.EbmlParser.isDynamicSizeValue_(b)?this.dataView_.byteLength-this.reader_.getPosition():shaka.util.EbmlParser.getVintValue_(b),b=this.reader_.getPosition()+b<=this.dataView_.byteLength?b:this.dataView_.byteLength-this.reader_.getPosition();var e=shaka.util.BufferUtils.toDataView(this.dataView_,this.reader_.getPosition(),b);return this.reader_.skip(b),new shaka.util.EbmlElement(a,e)},shaka.util.EbmlParser.prototype.parseId_=function(){var a=this.parseVint_();if(7<a.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);for(var b=0,e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next())b=256*b+e.value;return b},shaka.util.EbmlParser.prototype.parseVint_=function(){var a=this.reader_.getPosition(),b=this.reader_.readUint8();if(0==b)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);return b=8-Math.floor(Math.log2(b)),goog.asserts.assert(8>=b&&1<=b,"Incorrect log2 value"),this.reader_.skip(b-1),shaka.util.BufferUtils.toUint8(this.dataView_,a,b)},shaka.util.EbmlParser.getVintValue_=function(a){if(8==a.length&&224&a[1])throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);for(var b=0,e=$jscomp.makeIterator(shaka.util.Iterables.enumerate(a)),t=e.next();!t.done;t=e.next()){var r=(t=t.value).item;b=0==t.i?r&(1<<8-a.length)-1:256*b+r}return b},shaka.util.EbmlParser.isDynamicSizeValue_=function(a){for(var b=shaka.util.BufferUtils,e=$jscomp.makeIterator(shaka.util.EbmlParser.DYNAMIC_SIZES),t=e.next();!t.done;t=e.next())if(b.equal(a,new Uint8Array(t.value)))return!0;return!1},shaka.util.EbmlParser.DYNAMIC_SIZES=[[255],[127,255],[63,255,255],[31,255,255,255],[15,255,255,255,255],[7,255,255,255,255,255],[3,255,255,255,255,255,255],[1,255,255,255,255,255,255,255]],shaka.util.EbmlElement=function(a,b){this.id=a,this.dataView_=b},shaka.util.EbmlElement.prototype.getOffset=function(){return this.dataView_.byteOffset},shaka.util.EbmlElement.prototype.createParser=function(){return new shaka.util.EbmlParser(this.dataView_)},shaka.util.EbmlElement.prototype.getUint=function(){if(8<this.dataView_.byteLength)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_OVERFLOW);if(8==this.dataView_.byteLength&&224&this.dataView_.getUint8(0))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.JS_INTEGER_OVERFLOW);for(var a=0,b=$jscomp.makeIterator(shaka.util.Iterables.range(this.dataView_.byteLength)),e=b.next();!e.done;e=b.next())a=256*a+(e=this.dataView_.getUint8(e.value));return a},shaka.util.EbmlElement.prototype.getFloat=function(){if(4==this.dataView_.byteLength)return this.dataView_.getFloat32(0);if(8==this.dataView_.byteLength)return this.dataView_.getFloat64(0);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.EBML_BAD_FLOATING_POINT_SIZE)},shaka.media.WebmSegmentIndexParser=function(){},shaka.media.WebmSegmentIndexParser.parse=function(a,b,e,t,r,n,g){if(b=shaka.media.WebmSegmentIndexParser.parseWebmContainer_(b),(a=new shaka.util.EbmlParser(a).parseElement()).id!=shaka.media.WebmSegmentIndexParser.CUES_ID)throw shaka.log.error("Not a Cues element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUES_ELEMENT_MISSING);return shaka.media.WebmSegmentIndexParser.parseCues_(a,b.segmentOffset,b.timecodeScale,b.duration,e,t,r,n,g)},shaka.media.WebmSegmentIndexParser.parseWebmContainer_=function(a){if((a=new shaka.util.EbmlParser(a)).parseElement().id!=shaka.media.WebmSegmentIndexParser.EBML_ID)throw shaka.log.error("Not an EBML element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_EBML_HEADER_ELEMENT_MISSING);var b=a.parseElement();if(b.id!=shaka.media.WebmSegmentIndexParser.SEGMENT_ID)throw shaka.log.error("Not a Segment element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_SEGMENT_ELEMENT_MISSING);return{segmentOffset:a=b.getOffset(),timecodeScale:(b=shaka.media.WebmSegmentIndexParser.parseSegment_(b)).timecodeScale,duration:b.duration}},shaka.media.WebmSegmentIndexParser.parseSegment_=function(a){a=a.createParser();for(var b=null;a.hasMoreData();){var e=a.parseElement();if(e.id==shaka.media.WebmSegmentIndexParser.INFO_ID){b=e;break}}if(!b)throw shaka.log.error("Not an Info element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_INFO_ELEMENT_MISSING);return shaka.media.WebmSegmentIndexParser.parseInfo_(b)},shaka.media.WebmSegmentIndexParser.parseInfo_=function(a){var b=a.createParser(),e=1e6;for(a=null;b.hasMoreData();){var t=b.parseElement();t.id==shaka.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID?e=t.getUint():t.id==shaka.media.WebmSegmentIndexParser.DURATION_ID&&(a=t.getFloat())}if(null==a)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_DURATION_ELEMENT_MISSING);return{timecodeScale:b=e/1e9,duration:a*b}},shaka.media.WebmSegmentIndexParser.parseCues_=function(a,b,e,t,r,n,g,o,l){var h=[],d=function(){return r};a=a.createParser();for(var c=null,p=null;a.hasMoreData();){var q=a.parseElement();if(q.id==shaka.media.WebmSegmentIndexParser.CUE_POINT_ID){var m=shaka.media.WebmSegmentIndexParser.parseCuePoint_(q);m&&(q=e*m.unscaledTime,m=b+m.relativeOffset,null!=c&&(goog.asserts.assert(null!=p,"last offset cannot be null"),h.push(new shaka.media.SegmentReference(c+g,q+g,d,p,m-1,n,g,o,l))),c=q,p=m)}}return null!=c&&(goog.asserts.assert(null!=p,"last offset cannot be null"),h.push(new shaka.media.SegmentReference(c+g,t+g,d,p,null,n,g,o,l))),h},shaka.media.WebmSegmentIndexParser.parseCuePoint_=function(a){var b=a.createParser();if((a=b.parseElement()).id!=shaka.media.WebmSegmentIndexParser.CUE_TIME_ID)throw shaka.log.warning("Not a CueTime element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUE_TIME_ELEMENT_MISSING);if(a=a.getUint(),(b=b.parseElement()).id!=shaka.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID)throw shaka.log.warning("Not a CueTrackPositions element."),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MEDIA,shaka.util.Error.Code.WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING);b=b.createParser();for(var e=0;b.hasMoreData();){var t=b.parseElement();if(t.id==shaka.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION){e=t.getUint();break}}return{unscaledTime:a,relativeOffset:e}},shaka.media.WebmSegmentIndexParser.EBML_ID=440786851,shaka.media.WebmSegmentIndexParser.SEGMENT_ID=408125543,shaka.media.WebmSegmentIndexParser.INFO_ID=357149030,shaka.media.WebmSegmentIndexParser.TIMECODE_SCALE_ID=2807729,shaka.media.WebmSegmentIndexParser.DURATION_ID=17545,shaka.media.WebmSegmentIndexParser.CUES_ID=475249515,shaka.media.WebmSegmentIndexParser.CUE_POINT_ID=187,shaka.media.WebmSegmentIndexParser.CUE_TIME_ID=179,shaka.media.WebmSegmentIndexParser.CUE_TRACK_POSITIONS_ID=183,shaka.media.WebmSegmentIndexParser.CUE_CLUSTER_POSITION=241,shaka.dash.SegmentBase=function(){},shaka.dash.SegmentBase.createInitSegment=function(a,b){var e=shaka.util.XmlUtils,t=shaka.util.ManifestParserUtils,r=shaka.dash.MpdUtils.inheritChild(a,b,"Initialization");if(!r)return null;var n=a.representation.baseUris,g=r.getAttribute("sourceURL");return g&&(n=t.resolveUris(a.representation.baseUris,[g])),t=0,g=null,(e=e.parseAttr(r,"range",e.parseRange))&&(t=e.start,g=e.end),new shaka.media.InitSegmentReference((function(){return n}),t,g)},shaka.dash.SegmentBase.createStreamInfo=function(a,b){goog.asserts.assert(a.representation.segmentBase,"Should only be called with SegmentBase");var e=shaka.dash.MpdUtils,t=shaka.dash.SegmentBase,r=shaka.util.XmlUtils,n=Number(e.inheritAttribute(a,t.fromInheritance_,"presentationTimeOffset"))||0,g=1;(e=e.inheritAttribute(a,t.fromInheritance_,"timescale"))&&(g=r.parsePositiveInt(e)||1);var o=n/g||0,l=t.createInitSegment(a,t.fromInheritance_);t.checkSegmentIndexRangeSupport_(a,l);var h=shaka.util.ObjectUtils.shallowCloneObject(a);return{generateSegmentIndex:function(){return t.generateSegmentIndex_(h,b,l,o)}}},shaka.dash.SegmentBase.generateSegmentIndexFromUris=function(a,b,e,t,r,n,g){var o,l,h,d,c,p,q,m,u,f,_,y,k,E,S;return $jscomp.asyncExecutePromiseGeneratorProgram((function(v){return 1==v.nextAddress?(o=a.presentationTimeline,l=!a.dynamic||!a.periodInfo.isLastPeriod,h=a.periodInfo.start,d=a.periodInfo.duration,c=a.representation.mimeType.split("/")[1],q=null,m=[(p=b)(t,r,n),"webm"==c?p(e.getUris(),e.startByte,e.endByte):null],p=null,v.yield(Promise.all(m),2)):(u=v.yieldResult,f=u[0],_=u[1]||null,y=null,k=h-g,E=h,S=d?h+d:1/0,"mp4"==c?y=shaka.media.Mp4SegmentIndexParser.parse(f,r,t,e,k,E,S):(goog.asserts.assert(_,"WebM requires init data"),y=shaka.media.WebmSegmentIndexParser.parse(f,_,t,e,k,E,S)),o.notifySegments(y),goog.asserts.assert(!q,"Should not call generateSegmentIndex twice"),q=new shaka.media.SegmentIndex(y),l&&q.fit(E,S),v.return(q))}))},shaka.dash.SegmentBase.fromInheritance_=function(a){return a.segmentBase},shaka.dash.SegmentBase.computeIndexRange_=function(a){var b=shaka.dash.MpdUtils,e=shaka.dash.SegmentBase,t=shaka.util.XmlUtils,r=b.inheritChild(a,e.fromInheritance_,"RepresentationIndex");return a=b.inheritAttribute(a,e.fromInheritance_,"indexRange"),a=t.parseRange(a||""),r&&(a=t.parseAttr(r,"range",t.parseRange,a)),a},shaka.dash.SegmentBase.computeIndexUris_=function(a){var b=shaka.util.ManifestParserUtils,e=shaka.dash.MpdUtils.inheritChild(a,shaka.dash.SegmentBase.fromInheritance_,"RepresentationIndex"),t=a.representation.baseUris;return e&&(e=e.getAttribute("sourceURL"))&&(t=b.resolveUris(a.representation.baseUris,[e])),t},shaka.dash.SegmentBase.checkSegmentIndexRangeSupport_=function(a,b){var e=shaka.dash.SegmentBase;if(e.checkSegmentIndexSupport(a,b),!e.computeIndexRange_(a))throw shaka.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase does not contain @indexRange","or a RepresentationIndex element.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentBase.checkSegmentIndexSupport=function(a,b){var e=shaka.util.ManifestParserUtils.ContentType,t=a.representation.contentType,r=a.representation.mimeType.split("/")[1];if(t!=e.TEXT&&"mp4"!=r&&"webm"!=r)throw shaka.log.error("SegmentBase specifies an unsupported container type.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_UNSUPPORTED_CONTAINER);if("webm"==r&&!b)throw shaka.log.error("SegmentBase does not contain sufficient segment information:","the SegmentBase uses a WebM container,","but does not contain an Initialization element.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_WEBM_MISSING_INIT)},shaka.dash.SegmentBase.generateSegmentIndex_=function(a,b,e,t){var r=shaka.dash.SegmentBase,n=r.computeIndexUris_(a);return r=r.computeIndexRange_(a),goog.asserts.assert(r,"Index range should not be null!"),shaka.dash.SegmentBase.generateSegmentIndexFromUris(a,b,e,n,r.start,r.end,t)},shaka.dash.SegmentList=function(){},shaka.dash.SegmentList.createStreamInfo=function(a,b){goog.asserts.assert(a.representation.segmentList,"Should only be called with SegmentList");var e=shaka.dash.SegmentList,t=shaka.dash.SegmentBase.createInitSegment(a,e.fromInheritance_),r=e.parseSegmentListInfo_(a);e.checkSegmentListInfo_(a,r);var n=null,g=null;return a.period.id&&a.representation.id&&(g=a.period.id+","+a.representation.id,n=b[g]),e=e.createSegmentReferences_(a.periodInfo.start,a.periodInfo.duration,r.startNumber,a.representation.baseUris,r,t),n?(n.merge(e),g=a.presentationTimeline.getSegmentAvailabilityStart(),n.evict(g)):(a.presentationTimeline.notifySegments(e),n=new shaka.media.SegmentIndex(e),g&&a.dynamic&&(b[g]=n)),a.dynamic&&a.periodInfo.isLastPeriod||n.fit(a.periodInfo.start,a.periodInfo.duration?a.periodInfo.start+a.periodInfo.duration:1/0),{generateSegmentIndex:function(){return Promise.resolve(n)}}},shaka.dash.SegmentList.fromInheritance_=function(a){return a.segmentList},shaka.dash.SegmentList.parseSegmentListInfo_=function(a){var b=shaka.dash.SegmentList,e=shaka.dash.MpdUtils,t=b.parseMediaSegments_(a);return 0==(b=(a=e.parseSegmentInfo(a,b.fromInheritance_)).startNumber)&&(shaka.log.warning("SegmentList@startNumber must be > 0"),b=1),e=0,a.segmentDuration?e=a.segmentDuration*(b-1):a.timeline&&0<a.timeline.length&&(e=a.timeline[0].start),{segmentDuration:a.segmentDuration,startTime:e,startNumber:b,scaledPresentationTimeOffset:a.scaledPresentationTimeOffset,timeline:a.timeline,mediaSegments:t}},shaka.dash.SegmentList.checkSegmentListInfo_=function(a,b){if(!b.segmentDuration&&!b.timeline&&1<b.mediaSegments.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies multiple segments,","but does not specify a segment duration or timeline.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(!b.segmentDuration&&!a.periodInfo.duration&&!b.timeline&&1==b.mediaSegments.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList specifies one segment,","but does not specify a segment duration, period duration,","or timeline.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(b.timeline&&0==b.timeline.length)throw shaka.log.warning("SegmentList does not contain sufficient segment information:","the SegmentList has an empty timeline.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentList.createSegmentReferences_=function(a,b,e,t,r,n){e=shaka.util.ManifestParserUtils;var g=r.mediaSegments.length;r.timeline&&r.timeline.length!=r.mediaSegments.length&&(g=Math.min(r.timeline.length,r.mediaSegments.length),shaka.log.warning("The number of items in the segment timeline and the number of ","segment URLs do not match, truncating",r.mediaSegments.length,"to",g));for(var o=a-r.scaledPresentationTimeOffset,l=b?a+b:1/0,h=[],d=r.startTime,c={},p=(g=$jscomp.makeIterator(shaka.util.Iterables.range(g))).next();!p.done;c={$jscomp$loop$prop$mediaUri$553:c.$jscomp$loop$prop$mediaUri$553},p=g.next()){var q=p.value;p=r.mediaSegments[q],c.$jscomp$loop$prop$mediaUri$553=e.resolveUris(t,[p.mediaUri]);var m=void 0;null!=r.segmentDuration?m=d+r.segmentDuration:r.timeline?m=r.timeline[q].end:(goog.asserts.assert(1==r.mediaSegments.length&&b,"There should be exactly one segment with a Period duration."),m=d+b),q=function(a){return function(){return a.$jscomp$loop$prop$mediaUri$553}}(c),h.push(new shaka.media.SegmentReference(a+d,a+m,q,p.start,p.end,n,o,a,l)),d=m}return h},shaka.dash.SegmentList.parseMediaSegments_=function(a){var b=[a.representation.segmentList,a.adaptationSet.segmentList,a.period.segmentList].filter(shaka.util.Functional.isNotNull),e=shaka.util.XmlUtils;return b.map((function(a){return e.findChildren(a,"SegmentURL")})).reduce((function(a,b){return 0<a.length?a:b})).map((function(b){return b.getAttribute("indexRange")&&!a.indexRangeWarningGiven&&(a.indexRangeWarningGiven=!0,shaka.log.warning("We do not support the SegmentURL@indexRange attribute on SegmentList.  We only use the SegmentList@duration attribute or SegmentTimeline, which must be accurate.")),{mediaUri:b.getAttribute("media"),start:(b=e.parseAttr(b,"mediaRange",e.parseRange,{start:0,end:null})).start,end:b.end}}))},shaka.dash.SegmentTemplate=function(){},shaka.dash.SegmentTemplate.createStreamInfo=function(a,b,e,t,r){goog.asserts.assert(a.representation.segmentTemplate,"Should only be called with SegmentTemplate");var n=shaka.dash.SegmentTemplate,g=n.createInitSegment_(a),o=n.parseSegmentTemplateInfo_(a);n.checkSegmentTemplateInfo_(a,o);var l=shaka.util.ObjectUtils.shallowCloneObject(a);if(o.indexTemplate)return shaka.dash.SegmentBase.checkSegmentIndexSupport(a,g),{generateSegmentIndex:function(){return n.generateSegmentIndexFromIndexTemplate_(l,b,g,o)}};if(o.segmentDuration)return t||(a.presentationTimeline.notifyMaxSegmentDuration(o.segmentDuration),a.presentationTimeline.notifyMinSegmentStartTime(a.periodInfo.start)),{generateSegmentIndex:function(){return n.generateSegmentIndexFromDuration_(l,o,r,g)}};var h=null;t=null,a.period.id&&a.representation.id&&(t=a.period.id+","+a.representation.id,h=e[t]);var d=n.createFromTimeline_(l,o,g),c=a.periodInfo.start,p=a.periodInfo.duration?a.periodInfo.start+a.periodInfo.duration:1/0,q=1/0!=p;return h?(q&&new shaka.media.SegmentIndex(d).fit(c,p),h.merge(d),h.evict(a.presentationTimeline.getSegmentAvailabilityStart())):(a.presentationTimeline.notifySegments(d),h=new shaka.media.SegmentIndex(d),t&&a.dynamic&&(e[t]=h)),q&&h.fit(c,p),{generateSegmentIndex:function(){return Promise.resolve(h)}}},shaka.dash.SegmentTemplate.fromInheritance_=function(a){return a.segmentTemplate},shaka.dash.SegmentTemplate.parseSegmentTemplateInfo_=function(a){var b=shaka.dash.SegmentTemplate,e=shaka.dash.MpdUtils,t=e.parseSegmentInfo(a,b.fromInheritance_),r=e.inheritAttribute(a,b.fromInheritance_,"media");return a=e.inheritAttribute(a,b.fromInheritance_,"index"),{segmentDuration:t.segmentDuration,timescale:t.timescale,startNumber:t.startNumber,scaledPresentationTimeOffset:t.scaledPresentationTimeOffset,unscaledPresentationTimeOffset:t.unscaledPresentationTimeOffset,timeline:t.timeline,mediaTemplate:r,indexTemplate:a}},shaka.dash.SegmentTemplate.checkSegmentTemplateInfo_=function(a,b){var e=b.indexTemplate?1:0;if(e+=b.timeline?1:0,0==(e+=b.segmentDuration?1:0))throw shaka.log.error("SegmentTemplate does not contain any segment information:","the SegmentTemplate must contain either an index URL template","a SegmentTimeline, or a segment duration.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO);if(1!=e&&(shaka.log.warning("SegmentTemplate containes multiple segment information sources:","the SegmentTemplate should only contain an index URL template,","a SegmentTimeline or a segment duration.",a.representation),b.indexTemplate?(shaka.log.info("Using the index URL template by default."),b.timeline=null):(goog.asserts.assert(b.timeline,"There should be a timeline"),shaka.log.info("Using the SegmentTimeline by default.")),b.segmentDuration=null),!b.indexTemplate&&!b.mediaTemplate)throw shaka.log.error("SegmentTemplate does not contain sufficient segment information:","the SegmentTemplate's media URL template is missing.",a.representation),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)},shaka.dash.SegmentTemplate.generateSegmentIndexFromIndexTemplate_=function(a,b,e,t){var r=shaka.dash.MpdUtils,n=shaka.util.ManifestParserUtils;return goog.asserts.assert(t.indexTemplate,"must be using index template"),r=r.fillUriTemplate(t.indexTemplate,a.representation.id,null,a.bandwidth||null,null),n=n.resolveUris(a.representation.baseUris,[r]),shaka.dash.SegmentBase.generateSegmentIndexFromUris(a,b,e,n,0,null,t.scaledPresentationTimeOffset)},shaka.dash.SegmentTemplate.generateSegmentIndexFromDuration_=function(a,b,e,t){goog.asserts.assert(b.mediaTemplate,"There should be a media template with duration");var r=shaka.dash.MpdUtils,n=shaka.util.ManifestParserUtils,g=a.presentationTimeline,o=a.periodInfo.start,l=a.periodInfo.duration,h=l?o+l:1/0,d=b.segmentDuration;goog.asserts.assert(null!=d,"Segment duration must not be null!");var c=b.startNumber,p=b.timescale,q=b.mediaTemplate,m=a.bandwidth||null,u=a.representation.id,f=a.representation.baseUris,_=o-b.scaledPresentationTimeOffset,y=function(){var a=[Math.max(g.getSegmentAvailabilityStart(),o),Math.min(g.getSegmentAvailabilityEnd(),h)];return goog.asserts.assert(a.every(isFinite),"Available presentation times must be finite!"),goog.asserts.assert(a.every((function(a){return 0<=a})),"Available presentation times must be positive!"),goog.asserts.assert(null!=d,"Segment duration must not be null!"),a=a.map((function(a){return a-o})),[Math.ceil(a[0]/d),Math.ceil(a[1]/d)-1].map((function(a){return a+c}))},k=y();l=k[1];var E=[],S=function(a){goog.asserts.assert(null!=d,"Segment duration must not be null!");var e=(a-c)*d,g=e+b.scaledPresentationTimeOffset;e+=o;var l=Math.min(e+d,h);return goog.asserts.assert(e<l,"Generated a segment outside of the period!"),new shaka.media.SegmentReference(e,l,(function(){var b=r.fillUriTemplate(q,u,a,m,g*p);return n.resolveUris(f,[b])}),0,null,t,_,o,h)};for(a=a.dynamic?Math.max(k[0],k[1]-e+1):k[0];a<=l;++a)e=S(a),E.push(e);var v=new shaka.media.SegmentIndex(E);if(g.getSegmentAvailabilityEnd()<h){var T=l+1;v.updateEvery(d,(function(){v.evict(g.getSegmentAvailabilityStart());var a=$jscomp.makeIterator(y());a.next(),a=a.next().value;for(var b=[];T<=a;){var e=S(T);b.push(e),T++}return b}))}return Promise.resolve(v)},shaka.dash.SegmentTemplate.createFromTimeline_=function(a,b,e){var t=shaka.dash.MpdUtils,r=shaka.util.ManifestParserUtils,n=a.periodInfo.start,g=a.periodInfo.duration,o=n-b.scaledPresentationTimeOffset;g=g?n+g:1/0;for(var l=[],h={},d=$jscomp.makeIterator(shaka.util.Iterables.enumerate(b.timeline)),c=d.next();!c.done;h={$jscomp$loop$prop$repId$555:h.$jscomp$loop$prop$repId$555,$jscomp$loop$prop$segmentReplacement$556:h.$jscomp$loop$prop$segmentReplacement$556,$jscomp$loop$prop$bandwidth$557:h.$jscomp$loop$prop$bandwidth$557,$jscomp$loop$prop$timeReplacement$558:h.$jscomp$loop$prop$timeReplacement$558},c=d.next()){var p=c.value,q=p.item;c=q.start;var m=q.unscaledStart;q=q.end,h.$jscomp$loop$prop$segmentReplacement$556=p.i+b.startNumber,h.$jscomp$loop$prop$timeReplacement$558=m+b.unscaledPresentationTimeOffset,h.$jscomp$loop$prop$repId$555=a.representation.id,h.$jscomp$loop$prop$bandwidth$557=a.bandwidth||null,p=function(e){return function(){goog.asserts.assert(b.mediaTemplate,"There should be a media template with a timeline");var n=t.fillUriTemplate(b.mediaTemplate,e.$jscomp$loop$prop$repId$555,e.$jscomp$loop$prop$segmentReplacement$556,e.$jscomp$loop$prop$bandwidth$557||null,e.$jscomp$loop$prop$timeReplacement$558);return r.resolveUris(a.representation.baseUris,[n]).map((function(a){return a.toString()}))}}(h),l.push(new shaka.media.SegmentReference(n+c,n+q,p,0,null,e,o,n,g))}return l},shaka.dash.SegmentTemplate.createInitSegment_=function(a){var b=shaka.dash.MpdUtils,e=shaka.util.ManifestParserUtils,t=b.inheritAttribute(a,shaka.dash.SegmentTemplate.fromInheritance_,"initialization");if(!t)return null;var r=a.representation.id,n=a.bandwidth||null,g=a.representation.baseUris;return new shaka.media.InitSegmentReference((function(){goog.asserts.assert(t,"Should have returned earler");var a=b.fillUriTemplate(t,r,null,n,null);return e.resolveUris(g,[a])}),0,null)},shaka.util.PeriodCombiner=function(){this.variants_=[],this.audioStreams_=[],this.videoStreams_=[],this.textStreams_=[],this.usedPeriodIds_=new Set},shaka.util.PeriodCombiner.prototype.release=function(){for(var a=this.audioStreams_.concat(this.videoStreams_,this.textStreams_),b=(a=$jscomp.makeIterator(a)).next();!b.done;b=a.next())(b=b.value).segmentIndex&&b.segmentIndex.release();this.audioStreams_=[],this.videoStreams_=[],this.textStreams_=[],this.variants_=[]},shaka.util.PeriodCombiner.prototype.getVariants=function(){return this.variants_},shaka.util.PeriodCombiner.prototype.getTextStreams=function(){return this.textStreams_},shaka.util.PeriodCombiner.prototype.combinePeriods=function(a,b){var e,t,r,g,n,o,l,h,p,q,d,u,c,m,f,_,y,k,E,S,v,T,P,A,C,M,I,x,R,D=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(N){switch(N.nextAddress){case 1:if(e=shaka.util.ManifestParserUtils.ContentType,t=shaka.util.Iterables,shaka.util.PeriodCombiner.filterOutAudioStreamDuplicates_(a),shaka.util.PeriodCombiner.filterOutVideoStreamDuplicates_(a),!b&&1==a.length){r=a[0],D.audioStreams_=r.audioStreams,D.videoStreams_=r.videoStreams,D.textStreams_=r.textStreams,N.jumpTo(2);break}for(g=-1,n=$jscomp.makeIterator(t.enumerate(a)),o=n.next();!o.done;o=n.next())l=o.value,h=l.i,p=l.item,D.usedPeriodIds_.has(p.id)||(D.usedPeriodIds_.add(p.id),-1==g&&(g=h));if(-1==g)return N.return();for(q=a.map((function(a){return a.audioStreams})),d=a.map((function(a){return a.videoStreams})),u=a.map((function(a){return a.textStreams})),c=$jscomp.makeIterator(u),m=c.next();!m.done;m=c.next())m.value.push(shaka.util.PeriodCombiner.dummyTextStream_());return N.yield(shaka.util.PeriodCombiner.combine_(D.audioStreams_,q,g,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),3);case 3:return N.yield(shaka.util.PeriodCombiner.combine_(D.videoStreams_,d,g,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),4);case 4:return N.yield(shaka.util.PeriodCombiner.combine_(D.textStreams_,u,g,shaka.util.PeriodCombiner.cloneStream_,shaka.util.PeriodCombiner.concatenateStreams_),2);case 2:if(f=0,_=[],D.videoStreams_.length&&D.audioStreams_.length)for(T=$jscomp.makeIterator(D.audioStreams_),P=T.next();!P.done;P=T.next())for(A=P.value,C=$jscomp.makeIterator(D.videoStreams_),M=C.next();!M.done;M=C.next())I=M.value,x=shaka.media.DrmEngine.getCommonDrmInfos(A.drmInfos,I.drmInfos),A.drmInfos.length&&I.drmInfos.length&&!x.length?shaka.log.warning("Incompatible DRM in audio & video, skipping variant creation.",A,I):(R=f++,_.push({id:R,language:A.language,primary:A.primary,audio:A,video:I,bandwidth:(A.bandwidth||0)+(I.bandwidth||0),drmInfos:x,allowedByApplication:!0,allowedByKeySystem:!0}));else for(y=D.videoStreams_.concat(D.audioStreams_),k=$jscomp.makeIterator(y),E=k.next();!E.done;E=k.next())S=E.value,v=f++,_.push({id:v,language:S.language,primary:S.primary,audio:S.type==e.AUDIO?S:null,video:S.type==e.VIDEO?S:null,bandwidth:S.bandwidth||0,drmInfos:S.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0});D.variants_=_,N.jumpToEnd()}}))},shaka.util.PeriodCombiner.filterOutAudioStreamDuplicates_=function(a){for(var b=shaka.util.ArrayUtils,e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next()){e=e.value;for(var t=[],r=$jscomp.makeIterator(e.audioStreams),n=r.next();!n.done;n=r.next()){n=n.value;for(var g=!1,o=$jscomp.makeIterator(t),l=o.next();!l.done;l=o.next())l=l.value,n.id!=l.id&&n.channelsCount==l.channelsCount&&n.language==l.language&&n.bandwidth==l.bandwidth&&b.hasSameElements(n.roles,l.roles)&&n.audioSamplingRate==l.audioSamplingRate&&n.primary==l.primary&&(g=!0);g||t.push(n)}e.audioStreams=t}},shaka.util.PeriodCombiner.filterOutVideoStreamDuplicates_=function(a){for(var b=shaka.util.ArrayUtils,e=shaka.util.MapUtils,t=(a=$jscomp.makeIterator(a)).next();!t.done;t=a.next()){t=t.value;for(var r=[],n=$jscomp.makeIterator(t.videoStreams),g=n.next();!g.done;g=n.next()){g=g.value;for(var o=!1,l=$jscomp.makeIterator(r),h=l.next();!h.done;h=l.next())h=h.value,g.id!=h.id&&g.width==h.width&&g.frameRate==h.frameRate&&b.hasSameElements(g.roles,h.roles)&&e.hasSameElements(g.closedCaptions,h.closedCaptions)&&g.bandwidth==h.bandwidth&&(o=!0);o||r.push(g)}t.videoStreams=r}},shaka.util.PeriodCombiner.combineDbStreams=function(a){var b,e,t,r,n,g,o,l,h,d,p,q,c,m,f,_,y,k,E,S;return $jscomp.asyncExecutePromiseGeneratorProgram((function(v){switch(v.nextAddress){case 1:if(b=shaka.util.ManifestParserUtils.ContentType,1==a.length)return v.return(a[0]);for(e=a.map((function(a){return a.filter((function(a){return a.type==b.AUDIO}))})),t=a.map((function(a){return a.filter((function(a){return a.type==b.VIDEO}))})),r=a.map((function(a){return a.filter((function(a){return a.type==b.TEXT}))})),n=$jscomp.makeIterator(r),g=n.next();!g.done;g=n.next())g.value.push(shaka.util.PeriodCombiner.dummyTextStreamDB_());return v.yield(shaka.util.PeriodCombiner.combine_([],e,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),2);case 2:return o=v.yieldResult,v.yield(shaka.util.PeriodCombiner.combine_([],t,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),3);case 3:return l=v.yieldResult,v.yield(shaka.util.PeriodCombiner.combine_([],r,0,shaka.util.PeriodCombiner.cloneStreamDB_,shaka.util.PeriodCombiner.concatenateStreamDBs_),4);case 4:if(h=v.yieldResult,d=0,l.length&&o.length)for(m=$jscomp.makeIterator(o),f=m.next();!f.done;f=m.next())for(_=f.value,y=$jscomp.makeIterator(l),k=y.next();!k.done;k=y.next())E=k.value,S=d++,E.variantIds.push(S),_.variantIds.push(S);else for(p=l.concat(o),q=$jscomp.makeIterator(p),c=q.next();!c.done;c=q.next())c.value.variantIds=[d++];return v.return(l.concat(o).concat(h))}}))},shaka.util.PeriodCombiner.combine_=function(a,b,e,t,r){var n,g,o,l,h,d,p,q,c,u,m,f,_,y,k,E,S,v,T,P,A,C;return $jscomp.asyncExecutePromiseGeneratorProgram((function(M){switch(M.nextAddress){case 1:for(n=shaka.util.ManifestParserUtils.ContentType,g=shaka.util.Iterables,o=[],l=$jscomp.makeIterator(g.enumerate(b)),h=l.next();!h.done;h=l.next())d=h.value,p=d.i,q=d.item,p>=e?o.push(new Set(q)):o.push(new Set);c=$jscomp.makeIterator(a),u=c.next();case 2:if(u.done){M.jumpTo(4);break}return m=u.value,M.yield(shaka.util.PeriodCombiner.extendExistingOutputStream_(m,b,e,r,o),5);case 5:if(!M.yieldResult)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.PERIOD_FLATTENING_FAILED);u=c.next(),M.jumpTo(2);break;case 4:f=$jscomp.makeIterator(o),_=f.next();case 6:if(_.done){M.jumpTo(8);break}y=_.value,k=$jscomp.makeIterator(y),E=k.next();case 9:if(E.done){_=f.next(),M.jumpTo(6);break}return S=E.value,M.yield(shaka.util.PeriodCombiner.createNewOutputStream_(S,b,t,r,o),12);case 12:(v=M.yieldResult)&&a.push(v),E=k.next(),M.jumpTo(9);break;case 8:for(T=$jscomp.makeIterator(o),_=T.next();!_.done;_=T.next())for(P=_.value,A=$jscomp.makeIterator(P),E=A.next();!E.done;E=A.next())if((C=E.value).type!=n.TEXT||C.language)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.PERIOD_FLATTENING_FAILED);return M.return(a)}}))},shaka.util.PeriodCombiner.extendExistingOutputStream_=function(a,b,e,t,r){var n;return $jscomp.asyncExecutePromiseGeneratorProgram((function(g){return 1==g.nextAddress?(n=shaka.util.PeriodCombiner.findMatchesInAllPeriods_(b,a))?(goog.asserts.assert(a.createSegmentIndex,"outputStream should be a Stream type!"),g.yield(Promise.all(n.map((function(a){return a.createSegmentIndex()}))),2)):g.return(!1):(goog.asserts.assert(n,"Matches should be non-null"),shaka.util.PeriodCombiner.extendOutputStream_(a,n,e,t,r),g.return(!0))}))},shaka.util.PeriodCombiner.createNewOutputStream_=function(a,b,e,t,r){var n,g;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){return 1==o.nextAddress?(n=e(a),(g=shaka.util.PeriodCombiner.findMatchesInAllPeriods_(b,n))?n.createSegmentIndex?o.yield(Promise.all(g.map((function(a){return a.createSegmentIndex()}))),2):o.jumpTo(2):o.return(null)):(goog.asserts.assert(g,"Matches should be non-null"),shaka.util.PeriodCombiner.extendOutputStream_(n,g,0,t,r),o.return(n))}))},shaka.util.PeriodCombiner.extendOutputStream_=function(a,b,e,t,r){for(var n=shaka.util.ManifestParserUtils.ContentType,g=shaka.util.LanguageUtils,o=(b=$jscomp.makeIterator(shaka.util.Iterables.enumerate(b))).next();!o.done;o=b.next()){var l=o.value;if(o=l.i,l=l.item,o>=e){t(a,l);var h=!0;a.type==n.AUDIO&&0==g.relatedness(a.language,l.language)&&(h=!1),h&&r[o].delete(l)}}},shaka.util.PeriodCombiner.cloneStream_=function(a){return(a=Object.assign({},a)).originalId=null,a.createSegmentIndex=function(){return Promise.resolve()},a.segmentIndex=new shaka.media.MetaSegmentIndex,a.emsgSchemeIdUris=[],a.keyIds=new Set,a.closedCaptions=null,a.trickModeVideo=null,a},shaka.util.PeriodCombiner.cloneStreamDB_=function(a){return(a=Object.assign({},a)).keyIds=new Set,a.segments=[],a.variantIds=[],a.closedCaptions=null,a},shaka.util.PeriodCombiner.concatenateStreams_=function(a,b){a.roles=Array.from(new Set(a.roles.concat(b.roles))),b.emsgSchemeIdUris&&(a.emsgSchemeIdUris=Array.from(new Set(a.emsgSchemeIdUris.concat(b.emsgSchemeIdUris))));var e=b.keyIds;if(e=new Set([].concat($jscomp.arrayFromIterable(a.keyIds),$jscomp.arrayFromIterable(e))),a.keyIds=e,a.originalId=null==a.originalId?b.originalId:a.originalId+","+(b.originalId||""),e=shaka.media.DrmEngine.getCommonDrmInfos(a.drmInfos,b.drmInfos),b.drmInfos.length&&a.drmInfos.length&&!e.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.INCONSISTENT_DRM_ACROSS_PERIODS);if(a.drmInfos=e,a.encrypted=a.encrypted||b.encrypted,a.bandwidth=Math.max(a.bandwidth||0,b.bandwidth||0),a.width&&(a.width=Math.max(a.width,b.width||0)),a.height&&(a.height=Math.max(a.height,b.height||0)),a.frameRate&&(a.frameRate=Math.max(a.frameRate,b.frameRate||0)),a.audioSamplingRate&&(a.audioSamplingRate=Math.max(a.audioSamplingRate,b.audioSamplingRate||0)),a.channelsCount&&(a.channelsCount=Math.max(a.channelsCount,b.channelsCount||0)),b.closedCaptions){a.closedCaptions||(a.closedCaptions=new Map);for(var t=(e=$jscomp.makeIterator(b.closedCaptions)).next();!t.done;t=e.next()){var r=$jscomp.makeIterator(t.value);t=r.next().value,r=r.next().value,a.closedCaptions.set(t,r)}}goog.asserts.assert(a.segmentIndex instanceof shaka.media.MetaSegmentIndex,"Output streams should have a MetaSegmentIndex!"),goog.asserts.assert(b.segmentIndex,"Input segment index should have been created by now!"),a.segmentIndex.appendSegmentIndex(b.segmentIndex),b.trickModeVideo?(a.trickModeVideo||(a.trickModeVideo=shaka.util.PeriodCombiner.cloneStream_(b.trickModeVideo),a.trickModeVideo.segmentIndex=a.segmentIndex.clone()),shaka.util.PeriodCombiner.concatenateStreams_(a.trickModeVideo,b.trickModeVideo)):a.trickModeVideo&&shaka.util.PeriodCombiner.concatenateStreams_(a.trickModeVideo,b)},shaka.util.PeriodCombiner.concatenateStreamDBs_=function(a,b){a.roles=Array.from(new Set(a.roles.concat(b.roles)));var e=b.keyIds;if(e=new Set([].concat($jscomp.arrayFromIterable(a.keyIds),$jscomp.arrayFromIterable(e))),a.keyIds=e,a.encrypted=a.encrypted&&b.encrypted,a.segments.push.apply(a.segments,$jscomp.arrayFromIterable(b.segments)),b.closedCaptions){a.closedCaptions||(a.closedCaptions=new Map);for(var t=(e=$jscomp.makeIterator(b.closedCaptions)).next();!t.done;t=e.next()){var r=$jscomp.makeIterator(t.value);t=r.next().value,r=r.next().value,a.closedCaptions.set(t,r)}}},shaka.util.PeriodCombiner.findMatchesInAllPeriods_=function(a,b){for(var e=[],t=$jscomp.makeIterator(a),r=t.next();!r.done;r=t.next()){if(!(r=shaka.util.PeriodCombiner.findBestMatchInPeriod_(r.value,b)))return null;e.push(r)}return e},shaka.util.PeriodCombiner.findBestMatchInPeriod_=function(a,b){for(var e={audio:shaka.util.PeriodCombiner.areAVStreamsCompatible_,video:shaka.util.PeriodCombiner.areAVStreamsCompatible_,text:shaka.util.PeriodCombiner.areTextStreamsCompatible_}[b.type],t={audio:shaka.util.PeriodCombiner.isAudioStreamBetterMatch_,video:shaka.util.PeriodCombiner.isVideoStreamBetterMatch_,text:shaka.util.PeriodCombiner.isTextStreamBetterMatch_}[b.type],r=null,n=$jscomp.makeIterator(a),g=n.next();!g.done;g=n.next())!e(b,g=g.value)||r&&!t(b,r,g)||(r=g);return r},shaka.util.PeriodCombiner.areAVStreamsCompatible_=function(a,b){return!(b.mimeType!=a.mimeType||shaka.util.MimeUtils.getCodecBase(b.codecs)!=shaka.util.MimeUtils.getCodecBase(a.codecs)||a.drmInfos&&!shaka.media.DrmEngine.areDrmCompatible(a.drmInfos,b.drmInfos))},shaka.util.PeriodCombiner.areTextStreamsCompatible_=function(a,b){return!!a.language&&(!b.language||0!=shaka.util.LanguageUtils.relatedness(a.language,b.language)&&b.kind==a.kind)},shaka.util.PeriodCombiner.isAudioStreamBetterMatch_=function(a,b,e){var t=shaka.util.LanguageUtils,r=shaka.util.PeriodCombiner.BetterOrWorse,n=r.BETTER;if(r=r.WORSE,a.id==e.id)return!0;var g=t.relatedness(a.language,b.language);return(t=t.relatedness(a.language,e.language))>g||!(t<g)&&(!(b.primary||!e.primary)||!(b.primary&&!e.primary)&&(a.roles.length?(n=b.roles.filter((function(b){return a.roles.includes(b)})),(r=e.roles.filter((function(b){return a.roles.includes(b)}))).length>n.length||!(r.length<n.length)&&e.roles.length<b.roles.length):(t=shaka.util.PeriodCombiner.compareClosestPreferLower(a.channelsCount,b.channelsCount,e.channelsCount))==n||t!=r&&((t=shaka.util.PeriodCombiner.compareClosestPreferLower(a.audioSamplingRate,b.audioSamplingRate,e.audioSamplingRate))==n||t!=r&&!(!a.bandwidth||shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_(a.bandwidth,b.bandwidth,e.bandwidth)!=n))))},shaka.util.PeriodCombiner.isVideoStreamBetterMatch_=function(a,b,e){var t=shaka.util.PeriodCombiner.BetterOrWorse,r=t.BETTER;if(t=t.WORSE,a.id==e.id)return!0;var n=shaka.util.PeriodCombiner.compareClosestPreferLower(a.width*a.height,b.width*b.height,e.width*e.height);if(n==r)return!0;if(n==t)return!1;if(a.frameRate){if((n=shaka.util.PeriodCombiner.compareClosestPreferLower(a.frameRate,b.frameRate,e.frameRate))==r)return!0;if(n==t)return!1}return!(!a.bandwidth||shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_(a.bandwidth,b.bandwidth,e.bandwidth)!=r)},shaka.util.PeriodCombiner.isTextStreamBetterMatch_=function(a,b,e){var t=shaka.util.LanguageUtils;if(a.id==e.id)return!0;var r=t.relatedness(a.language,b.language);if((t=t.relatedness(a.language,e.language))>r)return!0;if(t<r)return!1;if(!b.primary&&e.primary)return!0;if(b.primary&&!e.primary)return!1;if(a.roles.length){if(r=b.roles.filter((function(b){return a.roles.includes(b)})),(t=e.roles.filter((function(b){return a.roles.includes(b)}))).length>r.length)return!0;if(t.length<r.length)return!1}return e.mimeType==a.mimeType&&e.codecs==a.codecs&&(b.mimeType!=a.mimeType||b.codecs!=a.codecs)},shaka.util.PeriodCombiner.dummyTextStreamDB_=function(){return{id:0,originalId:"",primary:!1,type:shaka.util.ManifestParserUtils.ContentType.TEXT,mimeType:"",codecs:"",language:"",label:null,width:null,height:null,encrypted:!1,keyIds:new Set,segments:[],variantIds:[],roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null}},shaka.util.PeriodCombiner.dummyTextStream_=function(){var a=shaka.util.ManifestParserUtils.ContentType;return{id:0,originalId:"",createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new shaka.media.SegmentIndex([]),mimeType:"",codecs:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"",label:null,type:a.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,audioSamplingRate:null,closedCaptions:null}},shaka.util.PeriodCombiner.compareClosestPreferLower=function(a,b,e){var t=shaka.util.PeriodCombiner.BetterOrWorse,r=t.BETTER,n=t.WORSE;if(b==a&&a!=e)return n;if(e==a&&a!=b)return r;if(b>a){if(e<=a||e-a<b-a)return r;if(e-a>b-a)return n}else{if(e>a)return n;if(a-e<a-b)return r;if(a-e>a-b)return n}return t.EQUAL},shaka.util.PeriodCombiner.compareClosestPreferMinimalAbsDiff_=function(a,b,e){var t=shaka.util.PeriodCombiner.BetterOrWorse,r=t.BETTER,n=t.WORSE;return b=Math.abs(a-b),(a=Math.abs(a-e))<b?r:b<a?n:t.EQUAL},shaka.util.PeriodCombiner.BetterOrWorse={BETTER:1,EQUAL:0,WORSE:-1},shaka.dash.DashParser=function(){var a=this;this.playerInterface_=this.config_=null,this.manifestUris_=[],this.manifest_=null,this.globalId_=1,this.segmentIndexMap_={},this.periodCombiner_=new shaka.util.PeriodCombiner,this.updatePeriod_=0,this.averageUpdateDuration_=new shaka.abr.Ewma(5),this.updateTimer_=new shaka.util.Timer((function(){a.onUpdate_()})),this.operationManager_=new shaka.util.OperationManager},shaka.dash.DashParser.prototype.configure=function(a){goog.asserts.assert(null!=a.dash,"DashManifestConfiguration should not be null!"),this.config_=a},shaka.dash.DashParser.prototype.start=function(a,b){var e,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(r){if(1==r.nextAddress)return goog.asserts.assert(t.config_,"Must call configure() before start()!"),t.manifestUris_=[a],t.playerInterface_=b,r.yield(t.requestManifest_(),2);if(e=r.yieldResult,t.playerInterface_&&t.setUpdateTimer_(e),!t.playerInterface_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);return goog.asserts.assert(t.manifest_,"Manifest should be non-null!"),r.return(t.manifest_)}))},shaka.dash.DashParser.prototype.stop=function(){for(var a=$jscomp.makeIterator(Object.values(this.segmentIndexMap_)),b=a.next();!b.done;b=a.next())b.value.release();return this.periodCombiner_&&this.periodCombiner_.release(),this.config_=this.playerInterface_=null,this.manifestUris_=[],this.manifest_=null,this.segmentIndexMap_={},this.periodCombiner_=null,null!=this.updateTimer_&&(this.updateTimer_.stop(),this.updateTimer_=null),this.operationManager_.destroy()},shaka.dash.DashParser.prototype.update=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?(e.setCatchFinallyBlocks(2),e.yield(a.requestManifest_(),4)):2!=e.nextAddress?e.leaveTryBlock(0):(b=e.enterCatchBlock(),a.playerInterface_&&b?(goog.asserts.assert(b instanceof shaka.util.Error,"Bad error type"),a.playerInterface_.onError(b),void e.jumpToEnd()):e.return())}))},shaka.dash.DashParser.prototype.onExpirationUpdated=function(a,b){},shaka.dash.DashParser.prototype.requestManifest_=function(){var b,e,t,r,n,g,o,l,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(h){return 1==h.nextAddress?(b=shaka.net.NetworkingEngine.RequestType.MANIFEST,e=shaka.net.NetworkingEngine.makeRequest(a.manifestUris_,a.config_.retryParameters),t=a.playerInterface_.networkingEngine,r=Date.now(),n=t.request(b,e),a.operationManager_.manage(n),h.yield(n.promise,2)):3!=h.nextAddress?(g=h.yieldResult,a.playerInterface_?(g.uri&&!a.manifestUris_.includes(g.uri)&&a.manifestUris_.unshift(g.uri),h.yield(a.parseManifest_(g.data,g.uri),3)):h.return(0)):(o=Date.now(),l=(o-r)/1e3,a.averageUpdateDuration_.sample(1,l),h.return(l))}))},shaka.dash.DashParser.prototype.parseManifest_=function(a,b){var e,t,r,g,n,o,l=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(h){if(1==h.nextAddress){if(e=shaka.util.Error,t=shaka.dash.MpdUtils,!(r=shaka.util.XmlUtils.parseXml(a,"MPD")))throw new e(e.Severity.CRITICAL,e.Category.MANIFEST,e.Code.DASH_INVALID_XML,b);return g=l.config_.dash.xlinkFailGracefully,n=t.processXlinks(r,l.config_.retryParameters,g,b,l.playerInterface_.networkingEngine),l.operationManager_.manage(n),h.yield(n.promise,2)}return o=h.yieldResult,h.return(l.processManifest_(o,b))}))},shaka.dash.DashParser.prototype.processManifest_=function(a,b){var e,t,r,g,n,o,l,h,d,p,q,c,u,m,f,_,y,k,E,S,v,T,P,A,C,M=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(I){switch(I.nextAddress){case 1:return e=shaka.util.Functional,t=shaka.util.XmlUtils,r=[b],0<(g=t.findChildren(a,"Location").map(t.getContents).filter(e.isNotNull)).length&&(n=shaka.util.ManifestParserUtils.resolveUris(r,g),r=M.manifestUris_=n),o=t.findChildren(a,"BaseURL").map(t.getContents),l=shaka.util.ManifestParserUtils.resolveUris(r,o),h=M.config_.dash.ignoreMinBufferTime,d=0,h||(d=t.parseAttr(a,"minBufferTime",t.parseDuration)||0),M.updatePeriod_=t.parseAttr(a,"minimumUpdatePeriod",t.parseDuration,-1),p=t.parseAttr(a,"availabilityStartTime",t.parseDate),q=t.parseAttr(a,"timeShiftBufferDepth",t.parseDuration),c=M.config_.dash.ignoreSuggestedPresentationDelay,u=null,c||(u=t.parseAttr(a,"suggestedPresentationDelay",t.parseDuration)),m=t.parseAttr(a,"maxSegmentDuration",t.parseDuration),f=a.getAttribute("type")||"static",M.manifest_?_=M.manifest_.presentationTimeline:(y=M.config_.defaultPresentationDelay||1.5*d,k=null!=u?u:y,_=new shaka.media.PresentationTimeline(p,k,M.config_.dash.autoCorrectDrift)),E={dynamic:"static"!=f,presentationTimeline:_,period:null,periodInfo:null,adaptationSet:null,representation:null,bandwidth:0,indexRangeWarningGiven:!1},S=M.parsePeriods_(E,l,a),v=S.duration,T=S.periods,_.setStatic("static"==f),"static"!=f&&S.durationDerivedFromPeriods||_.setDuration(v||1/0),_.isLive()&&!isNaN(M.config_.availabilityWindowOverride)&&(q=M.config_.availabilityWindowOverride),null==q&&(q=1/0),_.setSegmentAvailabilityDuration(q),_.notifyMaxSegmentDuration(m||1),goog.DEBUG&&_.assertIsValid(),I.yield(M.periodCombiner_.combinePeriods(T,E.dynamic),2);case 2:if(M.manifest_){M.manifest_.variants=M.periodCombiner_.getVariants(),M.manifest_.textStreams=M.periodCombiner_.getTextStreams(),I.jumpTo(3);break}if(M.manifest_={presentationTimeline:_,variants:M.periodCombiner_.getVariants(),textStreams:M.periodCombiner_.getTextStreams(),offlineSessionIds:[],minBufferTime:d||0},!_.usingPresentationStartTime()){I.jumpTo(3);break}return P=shaka.util.XmlUtils,A=P.findChildren(a,"UTCTiming"),I.yield(M.parseUtcTiming_(l,A),5);case 5:if(C=I.yieldResult,!M.playerInterface_)return I.return();_.setClockOffset(C);case 3:return goog.asserts.assert(M.manifest_,"Manifest should exist by now!"),I.yield(M.playerInterface_.filter(M.manifest_),0)}}))},shaka.dash.DashParser.prototype.parsePeriods_=function(a,b,e){var t=shaka.util.XmlUtils,r=t.parseAttr(e,"mediaPresentationDuration",t.parseDuration),n=[],g=0;e=t.findChildren(e,"Period");for(var o=(e=$jscomp.makeIterator(shaka.util.Iterables.enumerate(e))).next();!o.done;o=e.next()){var l=o.value;o=l.i;var h=l.item;l=l.next,g=t.parseAttr(h,"start",t.parseDuration,g);var d=t.parseAttr(h,"duration",t.parseDuration),c=null;if(l){var p=t.parseAttr(l,"start",t.parseDuration);null!=p&&(c=p-g)}else null!=r&&(c=r-g);if(p=shaka.util.ManifestParserUtils.GAP_OVERLAP_TOLERANCE_SECONDS,c&&d&&Math.abs(c-d)>p&&shaka.log.warning("There is a gap/overlap between Periods",h),null==c&&(c=d),h=this.parsePeriod_(a,b,{start:g,duration:c,node:h,isLastPeriod:null==c||!l}),n.push(h),null==c){l&&shaka.log.warning("Skipping Period",o+1,"and any subsequent Periods:","Period",o+1,"does not have a valid start time.",l),g=null;break}g+=c}return null!=r?(g!=r&&shaka.log.warning("@mediaPresentationDuration does not match the total duration of ","all Periods."),{periods:n,duration:r,durationDerivedFromPeriods:!1}):{periods:n,duration:g,durationDerivedFromPeriods:!0}},shaka.dash.DashParser.prototype.parsePeriod_=function(a,b,e){var t=this,r=shaka.util.Functional,n=shaka.util.XmlUtils,g=shaka.util.ManifestParserUtils.ContentType;a.period=this.createFrame_(e.node,null,b),a.periodInfo=e,a.period.id||(shaka.log.info("No Period ID given for Period with start time "+e.start+",  Assigning a default"),a.period.id="__shaka_period_"+e.start),b=n.findChildren(e.node,"EventStream");for(var o=(b=$jscomp.makeIterator(b)).next();!o.done;o=b.next())this.parseEventStream_(e.start,e.duration,o.value);if(r=n.findChildren(e.node,"AdaptationSet").map((function(b){return t.parseAdaptationSet_(a,b)})).filter(r.isNotNull),a.dynamic){for(e=[],b=(n=$jscomp.makeIterator(r)).next();!b.done;b=n.next())for(o=(b=$jscomp.makeIterator(b.value.representationIds)).next();!o.done;o=b.next())e.push(o.value);if(n=new Set(e),e.length!=n.size)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_DUPLICATE_REPRESENTATION_ID)}for(e=r.filter((function(a){return!a.trickModeFor})),r=r.filter((function(a){return a.trickModeFor})),n=(r=$jscomp.makeIterator(r)).next();!n.done;n=r.next()){n=(b=n.value).streams[0],b=b.trickModeFor;for(var l=(o=$jscomp.makeIterator(e)).next();!l.done;l=o.next())if((l=l.value).id==b)for(var h=(l=$jscomp.makeIterator(l.streams)).next();!h.done;h=l.next())h.value.trickModeVideo=n}if(n=this.config_.disableAudio?[]:this.getSetsOfType_(e,g.AUDIO),r=this.config_.disableVideo?[]:this.getSetsOfType_(e,g.VIDEO),e=this.config_.disableText?[]:this.getSetsOfType_(e,g.TEXT),!r.length&&!n.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_EMPTY_PERIOD);for(g=[],b=(n=$jscomp.makeIterator(n)).next();!b.done;b=n.next())g.push.apply(g,$jscomp.arrayFromIterable(b.value.streams));for(n=[],b=(r=$jscomp.makeIterator(r)).next();!b.done;b=r.next())n.push.apply(n,$jscomp.arrayFromIterable(b.value.streams));for(r=[],b=(e=$jscomp.makeIterator(e)).next();!b.done;b=e.next())r.push.apply(r,$jscomp.arrayFromIterable(b.value.streams));return{id:a.period.id,audioStreams:g,videoStreams:n,textStreams:r}},shaka.dash.DashParser.prototype.getSetsOfType_=function(a,b){return a.filter((function(a){return a.contentType==b}))},shaka.dash.DashParser.prototype.parseAdaptationSet_=function(a,b){var e=this,t=shaka.util.XmlUtils,r=shaka.util.Functional,n=shaka.util.ManifestParserUtils,g=n.ContentType,o=shaka.dash.ContentProtection;if(a.adaptationSet=this.createFrame_(b,a.period,null),a.adaptationSet.contentType==g.IMAGE)return shaka.log.warning("Skipping Image AdaptationSet",a.adaptationSet),null;var l=!1,h=t.findChildren(b,"Role"),d=h.map((function(a){return a.getAttribute("value")})).filter(r.isNotNull),c=void 0;(r=a.adaptationSet.contentType==g.TEXT)&&(c=n.TextStreamKind.SUBTITLE);for(var p=(h=$jscomp.makeIterator(h)).next();!p.done;p=h.next()){var q=(p=p.value).getAttribute("schemeIdUri");if(null==q||"urn:mpeg:dash:role:2011"==q)switch(p=p.getAttribute("value"),p){case"main":l=!0;break;case"caption":case"subtitle":c=p}}q=t.findChildren(b,"EssentialProperty"),h=null,p=!1;for(var m=(q=$jscomp.makeIterator(q)).next();!m.done;m=q.next()){var u=m.value;"http://dashif.org/guidelines/trickmode"==u.getAttribute("schemeIdUri")?h=u.getAttribute("value"):p=!0}u=t.findChildren(b,"Accessibility"),q=shaka.util.LanguageUtils;var f=new Map;for(m=(u=$jscomp.makeIterator(u)).next();!m.done;m=u.next()){var _=m.value;if(m=_.getAttribute("schemeIdUri"),_=_.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==m||"urn:scte:dash:cc:cea-708:2015"==m)if(m=1,null!=_)for(var y=(_=$jscomp.makeIterator(_.split(";"))).next();!y.done;y=_.next()){var k=y.value,E=y=void 0;k.includes("=")?(y=(k=k.split("="))[0].startsWith("CC")?k[0]:"CC"+k[0],E=k[1].split(",")[0].split(":").pop()):(y="CC"+m,m+=2,E=k),f.set(y,q.normalize(E))}else f.set("CC1","und");else"urn:mpeg:dash:role:2011"==m&&null!=_&&(d.push(_),"captions"==_&&(c=n.TextStreamKind.CLOSED_CAPTION))}if(p)return null;n=t.findChildren(b,"ContentProtection");var S=o.parseFromAdaptationSet(n,this.config_.dash.ignoreDrmInfo),v=shaka.util.LanguageUtils.normalize(b.getAttribute("lang")||"und"),T=b.getAttribute("label");if((o=t.findChildren(b,"Label"))&&o.length&&((o=o[0]).textContent&&(T=o.textContent)),o=t.findChildren(b,"Representation"),0==(t=o.map((function(b){return e.parseRepresentation_(a,S,c,v,T,l,d,f,b)})).filter((function(a){return!!a}))).length){if(this.config_.dash.ignoreEmptyAdaptationSet||r)return null;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.DASH_EMPTY_ADAPTATION_SET)}if(!a.adaptationSet.contentType||a.adaptationSet.contentType==g.APPLICATION)for(a.adaptationSet.contentType=shaka.dash.DashParser.guessContentType_(t[0].mimeType,t[0].codecs),r=(g=$jscomp.makeIterator(t)).next();!r.done;r=g.next())r.value.type=a.adaptationSet.contentType;for(r=(g=$jscomp.makeIterator(t)).next();!r.done;r=g.next())for(r=r.value,p=(n=$jscomp.makeIterator(S.drmInfos)).next();!p.done;p=n.next())(p=p.value).keyIds=p.keyIds&&r.keyIds?new Set([].concat($jscomp.arrayFromIterable(p.keyIds),$jscomp.arrayFromIterable(r.keyIds))):p.keyIds||r.keyIds;return g=o.map((function(a){return a.getAttribute("id")})).filter(shaka.util.Functional.isNotNull),{id:a.adaptationSet.id||"__fake__"+this.globalId_++,contentType:a.adaptationSet.contentType,language:v,main:l,streams:t,drmInfos:S.drmInfos,trickModeFor:h,representationIds:g}},shaka.dash.DashParser.prototype.parseRepresentation_=function(a,b,e,t,r,n,g,o,l){var h=this,d=shaka.util.XmlUtils,c=shaka.util.ManifestParserUtils.ContentType;if(a.representation=this.createFrame_(l,a.adaptationSet,null),!this.verifyRepresentation_(a.representation))return shaka.log.warning("Skipping Representation",a.representation),null;var p=a.periodInfo.start;a.bandwidth=d.parseAttr(l,"bandwidth",d.parsePositiveInt)||0;var q=a.representation.contentType;c=q==c.TEXT||q==c.APPLICATION;try{if(q=function(a,b,e){return h.requestInitSegment_(a,b,e)},a.representation.segmentBase)var m=shaka.dash.SegmentBase.createStreamInfo(a,q);else if(a.representation.segmentList)m=shaka.dash.SegmentList.createStreamInfo(a,this.segmentIndexMap_);else if(a.representation.segmentTemplate)m=shaka.dash.SegmentTemplate.createStreamInfo(a,q,this.segmentIndexMap_,!!this.manifest_,this.config_.dash.initialSegmentLimit);else{goog.asserts.assert(c,"Must have Segment* with non-text streams.");var u=a.representation.baseUris,f=a.periodInfo.duration||0;m={generateSegmentIndex:function(){return Promise.resolve(shaka.media.SegmentIndex.forSingleSegment(p,f,u))}}}}catch(e){if(c&&e.code==shaka.util.Error.Code.DASH_NO_SEGMENT_INFO)return null;throw e}c=d.findChildren(l,"ContentProtection"),c=shaka.dash.ContentProtection.parseFromRepresentation(c,b,this.config_.dash.ignoreDrmInfo),c=new Set(c?[c]:[]),d.findChildren(l,"SupplementalProperty").some((function(a){return"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"==a.getAttribute("schemeIdUri")&&"JOC"==a.getAttribute("value")}))&&(a.representation.mimeType="audio/eac3-joc");var _={id:this.globalId_++,originalId:a.representation.id,createSegmentIndex:function(){var a;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){if(1==b.nextAddress)return _.segmentIndex?b.jumpTo(0):(a=_,b.yield(m.generateSegmentIndex(),3));a.segmentIndex=b.yieldResult,b.jumpToEnd()}))},segmentIndex:null,mimeType:a.representation.mimeType,codecs:a.representation.codecs,frameRate:a.representation.frameRate,pixelAspectRatio:a.representation.pixelAspectRatio,bandwidth:a.bandwidth,width:a.representation.width,height:a.representation.height,kind:e,encrypted:0<b.drmInfos.length,drmInfos:b.drmInfos,keyIds:c,language:t,label:r,type:a.adaptationSet.contentType,primary:n,trickModeVideo:null,emsgSchemeIdUris:a.representation.emsgSchemeIdUris,roles:g,channelsCount:a.representation.numChannels,audioSamplingRate:a.representation.audioSamplingRate,closedCaptions:o};return _},shaka.dash.DashParser.prototype.onUpdate_=function(){var b,e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){switch(t.nextAddress){case 1:return goog.asserts.assert(0<=a.updatePeriod_,"There should be an update period"),shaka.log.info("Updating manifest..."),b=0,t.setCatchFinallyBlocks(2),t.yield(a.requestManifest_(),4);case 4:b=t.yieldResult,t.leaveTryBlock(3);break;case 2:e=t.enterCatchBlock(),goog.asserts.assert(e instanceof shaka.util.Error,"Should only receive a Shaka error"),a.playerInterface_&&(e.severity=shaka.util.Error.Severity.RECOVERABLE,a.playerInterface_.onError(e));case 3:if(!a.playerInterface_)return t.return();a.setUpdateTimer_(b),t.jumpToEnd()}}))},shaka.dash.DashParser.prototype.setUpdateTimer_=function(a){0>this.updatePeriod_||(a=Math.max(shaka.dash.DashParser.MIN_UPDATE_PERIOD_,this.updatePeriod_-a,this.averageUpdateDuration_.getEstimate()),this.updateTimer_.tickAfter(a))},shaka.dash.DashParser.prototype.createFrame_=function(a,b,e){goog.asserts.assert(b||e,"Must provide either parent or baseUris");var t=shaka.util.ManifestParserUtils,r=shaka.util.XmlUtils;b=b||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,pixelAspectRatio:void 0,numChannels:null,audioSamplingRate:null},e=e||b.baseUris;var n=r.parseNonNegativeInt,g=r.evalDivision,o=r.findChildren(a,"BaseURL").map(r.getContents),l=a.getAttribute("contentType")||b.contentType,h=a.getAttribute("mimeType")||b.mimeType,d=a.getAttribute("codecs")||b.codecs;g=r.parseAttr(a,"frameRate",g)||b.frameRate;var c=a.getAttribute("sar")||b.pixelAspectRatio,p=this.emsgSchemeIdUris_(r.findChildren(a,"InbandEventStream"),b.emsgSchemeIdUris),q=r.findChildren(a,"AudioChannelConfiguration");q=this.parseAudioChannels_(q)||b.numChannels;var m=r.parseAttr(a,"audioSamplingRate",n)||b.audioSamplingRate;return l||(l=shaka.dash.DashParser.guessContentType_(h,d)),{baseUris:t.resolveUris(e,o),segmentBase:r.findChild(a,"SegmentBase")||b.segmentBase,segmentList:r.findChild(a,"SegmentList")||b.segmentList,segmentTemplate:r.findChild(a,"SegmentTemplate")||b.segmentTemplate,width:r.parseAttr(a,"width",n)||b.width,height:r.parseAttr(a,"height",n)||b.height,contentType:l,mimeType:h,codecs:d,frameRate:g,pixelAspectRatio:c,emsgSchemeIdUris:p,id:a.getAttribute("id"),numChannels:q,audioSamplingRate:m}},shaka.dash.DashParser.prototype.emsgSchemeIdUris_=function(a,b){for(var e=b.slice(),t=$jscomp.makeIterator(a),r=t.next();!r.done;r=t.next())r=r.value.getAttribute("schemeIdUri"),e.includes(r)||e.push(r);return e},shaka.dash.DashParser.prototype.parseAudioChannels_=function(a){for(var b=(a=$jscomp.makeIterator(a)).next();!b.done;b=a.next()){var e=b.value;if((b=e.getAttribute("schemeIdUri"))&&(e=e.getAttribute("value")))switch(b){case"urn:mpeg:dash:outputChannelPositionList:2012":return e.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":var t=parseInt(e,10);if(!t){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",b,e);continue}return t;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(!(t=parseInt(e,16))){shaka.log.warning("Channel parsing failure! Ignoring scheme and value",b,e);continue}for(a=0;t;)1&t&&++a,t>>=1;return a;default:shaka.log.warning("Unrecognized audio channel scheme:",b,e)}}return null},shaka.dash.DashParser.prototype.verifyRepresentation_=function(a){var b=shaka.util.ManifestParserUtils.ContentType,e=a.segmentBase?1:0;return e+=a.segmentList?1:0,0==(e+=a.segmentTemplate?1:0)?a.contentType==b.TEXT||a.contentType==b.APPLICATION||(shaka.log.warning("Representation does not contain a segment information source:","the Representation must contain one of SegmentBase, SegmentList,",'SegmentTemplate, or explicitly indicate that it is "text".',a),!1):(1!=e&&(shaka.log.warning("Representation contains multiple segment information sources:","the Representation should only contain one of SegmentBase,","SegmentList, or SegmentTemplate.",a),a.segmentBase?(shaka.log.info("Using SegmentBase by default."),a.segmentList=null):(goog.asserts.assert(a.segmentList,"There should be a SegmentList"),shaka.log.info("Using SegmentList by default.")),a.segmentTemplate=null),!0)},shaka.dash.DashParser.prototype.requestForTiming_=function(a,b,e){var t,r,g,n,o,l,h,d=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(c){if(1==c.nextAddress)return t=shaka.util.ManifestParserUtils.resolveUris(a,[b]),(r=shaka.net.NetworkingEngine.makeRequest(t,d.config_.retryParameters)).method=e,g=shaka.net.NetworkingEngine.RequestType.TIMING,n=d.playerInterface_.networkingEngine.request(g,r),d.operationManager_.manage(n),c.yield(n.promise,2);if(o=c.yieldResult,"HEAD"==e){if(!o.headers||!o.headers.date)return shaka.log.warning("UTC timing response is missing","expected date header"),c.return(0);l=o.headers.date}else l=shaka.util.StringUtils.fromUTF8(o.data);return h=Date.parse(l),isNaN(h)?(shaka.log.warning("Unable to parse date from UTC timing response"),c.return(0)):c.return(h-Date.now())}))},shaka.dash.DashParser.prototype.parseUtcTiming_=function(a,b){var e,t,r,g,n,o,l,h,d,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(p){switch(p.nextAddress){case 1:e=b.map((function(a){return{scheme:a.getAttribute("schemeIdUri"),value:a.getAttribute("value")}})),t=c.config_.dash.clockSyncUri,!e.length&&t&&e.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:t}),r=$jscomp.makeIterator(e),g=r.next();case 2:if(g.done){p.jumpTo(4);break}switch(n=g.value,p.setCatchFinallyBlocks(5),o=n.scheme,l=n.value,o){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return p.jumpTo(7);case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return p.jumpTo(8);case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return h=Date.parse(l),p.return(isNaN(h)?0:h-Date.now());case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":shaka.log.alwaysWarn("NTP UTCTiming scheme is not supported");break;default:shaka.log.alwaysWarn("Unrecognized scheme in UTCTiming element",o)}p.jumpTo(9);break;case 7:return p.yield(c.requestForTiming_(a,l,"HEAD"),10);case 10:return p.return(p.yieldResult);case 8:return p.yield(c.requestForTiming_(a,l,"GET"),11);case 11:return p.return(p.yieldResult);case 9:p.leaveTryBlock(3);break;case 5:d=p.enterCatchBlock(),shaka.log.warning("Error fetching time from UTCTiming elem",d.message);case 3:g=r.next(),p.jumpTo(2);break;case 4:return shaka.log.alwaysWarn("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),p.return(0)}}))},shaka.dash.DashParser.prototype.parseEventStream_=function(a,b,e){for(var t=shaka.util.XmlUtils,r=t.parseNonNegativeInt,n=e.getAttribute("schemeIdUri")||"",g=e.getAttribute("value")||"",o=t.parseAttr(e,"timescale",r)||1,l=(e=$jscomp.makeIterator(t.findChildren(e,"Event"))).next();!l.done;l=e.next()){l=l.value;var h=t.parseAttr(l,"presentationTime",r)||0,d=t.parseAttr(l,"duration",r)||0;d=(h=h/o+a)+d/o,null!=b&&(h=Math.min(h,a+b),d=Math.min(d,a+b)),l={schemeIdUri:n,value:g,startTime:h,endTime:d,id:l.getAttribute("id")||"",eventElement:l},this.playerInterface_.onTimelineRegionAdded(l)}},shaka.dash.DashParser.prototype.requestInitSegment_=function(a,b,e){var t,r,g,n,o,l=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(h){return 1==h.nextAddress?(t=shaka.net.NetworkingEngine.RequestType.SEGMENT,r=shaka.util.Networking.createSegmentRequest(a,b,e,l.config_.retryParameters),g=l.playerInterface_.networkingEngine,n=g.request(t,r),l.operationManager_.manage(n),h.yield(n.promise,2)):(o=h.yieldResult,h.return(o.data))}))},shaka.dash.DashParser.guessContentType_=function(a,b){var e=shaka.util.MimeUtils.getFullType(a,b);return shaka.text.TextEngine.isTypeSupported(e)?shaka.util.ManifestParserUtils.ContentType.TEXT:a.split("/")[0]},goog.exportSymbol("shaka.dash.DashParser",shaka.dash.DashParser),shaka.dash.DashParser.MIN_UPDATE_PERIOD_=3,shaka.media.ManifestParser.registerParserByExtension("mpd",(function(){return new shaka.dash.DashParser})),shaka.media.ManifestParser.registerParserByMime("application/dash+xml",(function(){return new shaka.dash.DashParser})),shaka.media.ManifestParser.registerParserByMime("video/vnd.mpeg.dash.mpd",(function(){return new shaka.dash.DashParser})),shaka.hls={},shaka.hls.Playlist=function(a,b,e,t){this.absoluteUri=a,this.type=b,this.tags=e,this.segments=t||null},shaka.hls.PlaylistType={MASTER:0,MEDIA:1},shaka.hls.Tag=function(a,b,e,t){this.id=a,this.name=b,this.attributes=e,this.value=void 0===t?null:t},shaka.hls.Tag.prototype.toString=function(){var a=function(a){var b=isNaN(Number(a.value))?'"'+a.value+'"':a.value;return a.name+"="+b},b="#"+this.name;return a=this.attributes?this.attributes.map(a):[],this.value&&a.unshift(this.value),0<a.length&&(b+=":"+a.join(",")),b},shaka.hls.Tag.prototype.addAttribute=function(a){this.attributes.push(a)},shaka.hls.Tag.prototype.getAttribute=function(a){var b=this.attributes.filter((function(b){return b.name==a}));return goog.asserts.assert(2>b.length,"A tag should not have multiple attributes with the same name!"),b.length?b[0]:null},shaka.hls.Tag.prototype.getAttributeValue=function(a,b){var e=this.getAttribute(a);return e?e.value:b||null},shaka.hls.Tag.prototype.getRequiredAttrValue=function(a){var b=this.getAttribute(a);if(!b)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_ATTRIBUTE_MISSING,a);return b.value},shaka.hls.Tag.prototype.setName=function(a){this.name=a},shaka.hls.Segment=function(a,b,e){e=void 0===e?[]:e,this.tags=b,this.absoluteUri=a,this.partialSegments=e},shaka.hls.Attribute=function(a,b){this.name=a,this.value=b},shaka.hls.Utils=function(){},shaka.hls.Utils.filterTagsByName=function(a,b){return a.filter((function(a){return a.name==b}))},shaka.hls.Utils.filterTagsByType=function(a,b){return a.filter((function(a){return a.getRequiredAttrValue("TYPE")==b}))},shaka.hls.Utils.getFirstTagWithName=function(a,b){var e=shaka.hls.Utils.filterTagsByName(a,b);return e.length?e[0]:null},shaka.hls.Utils.getFirstTagWithNameAsNumber=function(a,b,e){return e=void 0===e?0:e,(a=shaka.hls.Utils.getFirstTagWithName(a,b))?Number(a.value):e},shaka.hls.Utils.constructAbsoluteUri=function(a,b){return shaka.util.ManifestParserUtils.resolveUris([a],[b])[0]},shaka.hls.Utils.isComment=function(a){return/^#(?!EXT)/m.test(a)},shaka.util.TextParser=function(a){this.data_=a,this.position_=0},shaka.util.TextParser.prototype.atEnd=function(){return this.position_==this.data_.length},shaka.util.TextParser.prototype.readLine=function(){return this.readRegexReturnCapture_(/(.*?)(\n|$)/gm,1)},shaka.util.TextParser.prototype.readWord=function(){return this.readRegexReturnCapture_(/[^ \t\n]*/gm,0)},shaka.util.TextParser.prototype.skipWhitespace=function(){this.readRegex(/[ \t]+/gm)},shaka.util.TextParser.prototype.readRegex=function(a){return a=this.indexOf_(a),this.atEnd()||null==a||a.position!=this.position_?null:(this.position_+=a.length,a.results)},shaka.util.TextParser.prototype.readRegexReturnCapture_=function(a,b){if(this.atEnd())return null;var e=this.readRegex(a);return e?e[b]:null},shaka.util.TextParser.prototype.indexOf_=function(a){return goog.asserts.assert(a.global,"global flag should be set"),a.lastIndex=this.position_,null==(a=a.exec(this.data_))?null:{position:a.index,length:a[0].length,results:a}},shaka.hls.ManifestTextParser=function(){this.globalId_=0},shaka.hls.ManifestTextParser.prototype.parsePlaylist=function(a,b){var e=shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS,t=shaka.hls.ManifestTextParser.SEGMENT_TAGS,r=shaka.util.StringUtils.fromUTF8(a),n=(r=r.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(n[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_PLAYLIST_HEADER_MISSING);r=shaka.hls.PlaylistType.MASTER;for(var g=!0,o=$jscomp.makeIterator(n),l=o.next();!l.done;l=o.next())if(l=l.value,shaka.hls.Utils.isComment(l)||g)g=!1;else{if(l=this.parseTag_(l),--this.globalId_,e.includes(l.name)){r=shaka.hls.PlaylistType.MEDIA;break}"EXT-X-STREAM-INF"==l.name&&(g=!0)}for(e=[],g=!0,l=(o=$jscomp.makeIterator(shaka.util.Iterables.enumerate(n))).next();!l.done;l=o.next()){var h=l.value;l=h.i;var d=h.item;if(h=h.next,shaka.hls.Utils.isComment(d)||g)g=!1;else{if(d=this.parseTag_(d),t.includes(d.name)){if(r!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return t=n.splice(l,n.length-l),t=this.parseSegments_(b,t,e),new shaka.hls.Playlist(b,r,e,t)}e.push(d),"EXT-X-STREAM-INF"==d.name&&(g=new shaka.hls.Attribute("URI",h),d.addAttribute(g),g=!0)}}return new shaka.hls.Playlist(b,r,e)},shaka.hls.ManifestTextParser.prototype.parseSegments_=function(a,b,e){for(var t=[],r=[],n=[],g=null,o=(b=$jscomp.makeIterator(b)).next();!o.done;o=b.next())o=o.value,/^(#EXT)/.test(o)?(o=this.parseTag_(o),shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS.includes(o.name)?e.push(o):"EXT-X-MAP"==o.name?g=o:"EXT-X-PART"==o.name?n.push(o):"EXT-X-PRELOAD-HINT"==o.name?"PART"==o.getAttributeValue("TYPE")?n.push(o):"MAP"==o.getAttributeValue("TYPE")&&(o.setName("EXT-X-MAP"),g=o):r.push(o)):shaka.hls.Utils.isComment(o)||(o=o.trim(),o=shaka.hls.Utils.constructAbsoluteUri(a,o),g&&r.push(g),r=new shaka.hls.Segment(o,r,n),t.push(r),r=[],n=[]);return n.length&&(g&&r.push(g),a=new shaka.hls.Segment("",r,n),t.push(a)),t},shaka.hls.ManifestTextParser.prototype.parseTag_=function(a){return shaka.hls.ManifestTextParser.parseTag(this.globalId_++,a)},shaka.hls.ManifestTextParser.parseTag=function(a,b){var e=b.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!e)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.INVALID_HLS_TAG,b);var t,r=e[1],n=e[2];if(e=[],n){var g,o=(n=new shaka.util.TextParser(n)).readRegex(/^([^,=]+)(?:,|$)/g);for(o&&(t=o[1]),o=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;g=n.readRegex(o);)g=new shaka.hls.Attribute(g[1],g[2]||g[3]),e.push(g)}return new shaka.hls.Tag(a,r,e,t)},shaka.hls.ManifestTextParser.MEDIA_PLAYLIST_TAGS="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP".split(" "),shaka.hls.ManifestTextParser.SEGMENT_TAGS="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP".split(" "),shaka.net.DataUriPlugin=function(){},shaka.net.DataUriPlugin.parse=function(a,b,e,t){try{var r=shaka.net.DataUriPlugin.parseRaw(a);return shaka.util.AbortableOperation.completed({uri:a,originalUri:a,data:r.data,headers:{"content-type":r.contentType}})}catch(e){return shaka.util.AbortableOperation.failed(e)}},shaka.net.DataUriPlugin.parseRaw=function(a){var b=a.split(":");if(2>b.length||"data"!=b[0])throw shaka.log.error("Bad data URI, failed to parse scheme"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_DATA_URI,a);if(2>(b=b.slice(1).join(":").split(",")).length)throw shaka.log.error("Bad data URI, failed to extract encoding and MIME type"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_DATA_URI,a);var e=b[0];a=window.decodeURIComponent(b.slice(1).join(",")),b=e.split(";"),e=b[0];var t=!1;return 1<b.length&&"base64"==b[b.length-1]&&(t=!0,b.pop()),{data:t?shaka.util.Uint8ArrayUtils.fromBase64(a):shaka.util.StringUtils.toUTF8(a),contentType:e}},goog.exportSymbol("shaka.net.DataUriPlugin",shaka.net.DataUriPlugin),goog.exportProperty(shaka.net.DataUriPlugin,"parse",shaka.net.DataUriPlugin.parse),shaka.net.NetworkingEngine.registerScheme("data",shaka.net.DataUriPlugin.parse),shaka.hls.HlsParser=function(){var a=this;this.config_=this.playerInterface_=null,this.globalId_=1,this.globalVariables_=new Map,this.groupIdToStreamInfosMap_=new Map,this.variantUriSet_=new Set,this.uriToStreamInfosMap_=new Map,this.presentationTimeline_=null,this.masterPlaylistUri_="",this.manifestTextParser_=new shaka.hls.ManifestTextParser,this.updatePlaylistDelay_=0,this.updatePlaylistTimer_=new shaka.util.Timer((function(){a.onUpdate_()})),this.presentationType_=shaka.hls.HlsParser.PresentationType_.VOD,this.manifest_=null,this.maxTargetDuration_=0,this.minTargetDuration_=1/0,this.lowLatencyPresentationDelay_=this.partialTargetDuration_=0,this.operationManager_=new shaka.util.OperationManager,this.segmentsToNotifyByStream_=[],this.groupIdToClosedCaptionsMap_=new Map,this.aesEncrypted_=!1,this.groupIdToCodecsMap_=new Map,this.playlistStartTime_=null,this.mapTagToInitSegmentRefMap_=new Map,this.discontinuityToTso_=new Map},shaka.hls.HlsParser.prototype.configure=function(a){this.config_=a},shaka.hls.HlsParser.prototype.start=function(a,b){var e,t,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){return 1==n.nextAddress?(goog.asserts.assert(r.config_,"Must call configure() before start()!"),r.playerInterface_=b,n.yield(r.requestManifest_(a),2)):3!=n.nextAddress?(e=n.yieldResult,r.masterPlaylistUri_=e.uri,goog.asserts.assert(e.data,"Response data should be non-null!"),n.yield(r.parseManifest_(e.data),3)):(0<(t=r.updatePlaylistDelay_)&&r.updatePlaylistTimer_.tickAfter(t),goog.asserts.assert(r.manifest_,"Manifest should be non-null"),n.return(r.manifest_))}))},shaka.hls.HlsParser.prototype.stop=function(){this.updatePlaylistTimer_&&(this.updatePlaylistTimer_.stop(),this.updatePlaylistTimer_=null);var a=[];return this.operationManager_&&(a.push(this.operationManager_.destroy()),this.operationManager_=null),this.config_=this.playerInterface_=null,this.variantUriSet_.clear(),this.manifest_=null,this.uriToStreamInfosMap_.clear(),this.groupIdToStreamInfosMap_.clear(),this.groupIdToCodecsMap_.clear(),this.globalVariables_.clear(),Promise.all(a)},shaka.hls.HlsParser.prototype.update=function(){var b,e,t,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(r){if(1==r.nextAddress)return a.isLive_()?(b=[],a.playlistStartTime_=null,(e=Array.from(a.uriToStreamInfosMap_.values())).length?r.yield(a.updateStream_(e[0]),2):r.jumpTo(2)):r.return();for(t=1;t<e.length;t++)b.push(a.updateStream_(e[t]));return r.yield(Promise.all(b),0)}))},shaka.hls.HlsParser.prototype.updateStream_=function(a){var e,t,r,n,g,o,l,h,d,c,p,q,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(u){if(1==u.nextAddress)return e=shaka.hls.HlsParser.PresentationType_,t=a.absoluteMediaPlaylistUri,r=new goog.Uri(t),b.config_.lowLatencyMode&&r.setQueryData(new goog.Uri.QueryData("_HLS_skip=YES")),u.yield(b.requestManifest_(r.toString()),2);if(3!=u.nextAddress){if(n=u.yieldResult,(g=b.manifestTextParser_.parsePlaylist(n.data,n.uri)).type!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);return o=shaka.hls.Utils.filterTagsByName(g.tags,"EXT-X-DEFINE"),l=b.parseMediaVariables_(o),h=a.stream,u.yield(b.createSegments_(a.verbatimMediaPlaylistUri,g,h.type,h.mimeType,a.mediaSequenceToStartTime,l),3)}d=u.yieldResult,h.segmentIndex.merge(d),d.length&&(c=shaka.hls.Utils.getFirstTagWithNameAsNumber(g.tags,"EXT-X-MEDIA-SEQUENCE",0),p=a.mediaSequenceToStartTime.get(c),h.segmentIndex.evict(p)),q=d[d.length-1],goog.asserts.assert(q,"Should have segments!"),shaka.hls.Utils.getFirstTagWithName(g.tags,"EXT-X-ENDLIST")&&(b.setPresentationType_(e.VOD),b.presentationTimeline_.setDuration(q.endTime)),u.jumpToEnd()}))},shaka.hls.HlsParser.prototype.onExpirationUpdated=function(a,b){},shaka.hls.HlsParser.prototype.parseManifest_=function(a){var e,t,r,n,g,o,l,h,d,c,p,q,m,u,f,_,y,k,E,S,v,T,P,A,C,M,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(I){switch(I.nextAddress){case 1:if(e=shaka.hls.Utils,goog.asserts.assert(b.masterPlaylistUri_,"Master playlist URI must be set before calling parseManifest_!"),(t=b.manifestTextParser_.parsePlaylist(a,b.masterPlaylistUri_)).type!=shaka.hls.PlaylistType.MASTER)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_MASTER_PLAYLIST_NOT_PROVIDED);for(r=e.filterTagsByName(t.tags,"EXT-X-DEFINE"),b.parseMasterVariables_(r),n=e.filterTagsByName(t.tags,"EXT-X-MEDIA"),g=e.filterTagsByName(t.tags,"EXT-X-STREAM-INF"),b.parseCodecs_(g),o=e.filterTagsByName(t.tags,"EXT-X-SESSION-DATA"),l=$jscomp.makeIterator(o),h=l.next();!h.done;h=l.next())d=h.value,c=d.getAttributeValue("DATA-ID"),p=d.getAttributeValue("URI"),q=d.getAttributeValue("LANGUAGE"),m=d.getAttributeValue("VALUE"),u={id:c},p&&(u.uri=shaka.hls.Utils.constructAbsoluteUri(b.masterPlaylistUri_,p)),q&&(u.language=q),m&&(u.value=m),f=new shaka.util.FakeEvent("sessiondata",u),b.playerInterface_&&b.playerInterface_.onEvent(f);return I.yield(b.createStreamInfosFromMediaTags_(n),2);case 2:return b.parseClosedCaptions_(n),I.yield(b.createVariantsForTags_(g),3);case 3:return _=I.yieldResult,I.yield(b.parseTexts_(n),4);case 4:if(y=I.yieldResult,!b.playerInterface_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);if(b.aesEncrypted_&&0==_.length)throw shaka.log.info("No stream is created, because we don't support AES-128","encryption yet"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_AES_128_ENCRYPTION_NOT_SUPPORTED);for(E=k=1/0,S=$jscomp.makeIterator(b.uriToStreamInfosMap_.values()),v=S.next();!v.done;v=S.next())T=v.value,k=Math.min(k,T.minTimestamp),"text"!=T.stream.type&&(E=Math.min(E,T.maxTimestamp-T.minTimestamp));if(goog.asserts.assert(null==b.presentationTimeline_,"Presentation timeline created early!"),b.createPresentationTimeline_(),goog.asserts.assert(b.presentationTimeline_,"Presentation timeline not created!"),b.isLive_())b.updatePlaylistDelay_=b.minTargetDuration_,P=shaka.hls.HlsParser.PresentationType_,b.presentationType_==P.LIVE&&(A=b.presentationTimeline_.getDelay()+b.partialTargetDuration_,isNaN(b.config_.availabilityWindowOverride)||(A=b.config_.availabilityWindowOverride),b.presentationTimeline_.setSegmentAvailabilityDuration(A));else for(b.presentationTimeline_.setDuration(E),b.presentationTimeline_.offset(-k),C=$jscomp.makeIterator(b.uriToStreamInfosMap_.values()),v=C.next();!v.done;v=C.next())(M=v.value).stream.segmentIndex.offset(-k),M.stream.segmentIndex.fit(0,E);return b.manifest_={presentationTimeline:b.presentationTimeline_,variants:_,textStreams:y,offlineSessionIds:[],minBufferTime:0},I.yield(b.playerInterface_.filter(b.manifest_),0)}}))},shaka.hls.HlsParser.prototype.parseMasterVariables_=function(a){for(var b=(a=$jscomp.makeIterator(a)).next();!b.done;b=a.next()){var e=b.value;b=e.getAttributeValue("NAME"),e=e.getAttributeValue("VALUE"),b&&e&&(this.globalVariables_.has(b)||this.globalVariables_.set(b,e))}},shaka.hls.HlsParser.prototype.parseMediaVariables_=function(a){for(var b=new Map,e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next()){var t=e.value;e=t.getAttributeValue("NAME");var r=t.getAttributeValue("VALUE");t=t.getAttributeValue("IMPORT"),e&&r&&b.set(e,r),t&&(e=this.globalVariables_.get(t))&&b.set(t,e)}return b},shaka.hls.HlsParser.prototype.parseCodecs_=function(a){for(var b=shaka.util.ManifestParserUtils.ContentType,e=(a=$jscomp.makeIterator(a)).next();!e.done;e=a.next()){var t=e.value,r=t.getAttributeValue("AUDIO");e=t.getAttributeValue("VIDEO");var n=t.getAttributeValue("SUBTITLES");if(t=this.getCodecsForVariantTag_(t),n){var g=this.guessCodecsSafe_(b.TEXT,t);goog.asserts.assert(null!=g,"Text codecs should be valid."),this.groupIdToCodecsMap_.set(n,g),shaka.util.ArrayUtils.remove(t,g)}r&&(n=this.guessCodecs_(b.AUDIO,t),this.groupIdToCodecsMap_.set(r,n)),e&&(r=this.guessCodecs_(b.VIDEO,t),this.groupIdToCodecsMap_.set(e,r))}},shaka.hls.HlsParser.prototype.parseTexts_=function(a){var e,t,r,n,g,o,l,h,d,c,p,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(m){if(1==m.nextAddress)return e=shaka.hls.Utils.filterTagsByType(a,"SUBTITLES"),t=e.map((function(a){var e,t;return $jscomp.asyncExecutePromiseGeneratorProgram((function(r){if(1==r.nextAddress)return b.config_.disableText?r.return(null):(r.setCatchFinallyBlocks(2),r.yield(b.createStreamInfoFromMediaTag_(a),4));if(2!=r.nextAddress)return e=r.yieldResult,goog.asserts.assert(e,"Should always have a streamInfo for text"),r.return(e.stream);if(t=r.enterCatchBlock(),b.config_.hls.ignoreTextStreamFailures)return r.return(null);throw t}))})),m.yield(Promise.all(t),2);for(r=m.yieldResult,n=$jscomp.makeIterator(e),g=n.next();!g.done;g=n.next())if(o=g.value,l=o.getRequiredAttrValue("GROUP-ID"),(h=b.groupIdToCodecsMap_.get(l))&&(d=b.groupIdToStreamInfosMap_.get(l)))for(c=$jscomp.makeIterator(d),p=c.next();!p.done;p=c.next())p.value.stream.codecs=h;return m.return(r.filter((function(a){return a})))}))},shaka.hls.HlsParser.prototype.createStreamInfosFromMediaTags_=function(a){var e,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(a=a.filter((function(a){var b=a.getAttributeValue("URI")||"";return"SUBTITLES"!=a.getAttributeValue("TYPE")&&""!=b}))).length?t.yield(b.createStreamInfoFromMediaTag_(a[0]),2):t.jumpTo(2):(e=a.slice(1).map((function(a){return b.createStreamInfoFromMediaTag_(a)})),t.yield(Promise.all(e),0))}))},shaka.hls.HlsParser.prototype.createVariantsForTags_=function(a){var e,t,r,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){return 1==n.nextAddress?(e=a.map((function(a){var e,t,r,n,g,p,q;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){return 1==o.nextAddress?(e=a.getAttributeValue("FRAME-RATE"),t=Number(a.getRequiredAttrValue("BANDWIDTH")),r=a.getAttributeValue("RESOLUTION"),n=$jscomp.makeIterator(r?r.split("x"):[null,null]),g=n.next().value,p=n.next().value,o.yield(b.createStreamInfosForVariantTag_(a,r,e),2)):(q=o.yieldResult)?(goog.asserts.assert(q.audio.length||q.video.length,"We should have created a stream!"),o.return(b.createVariants_(q.audio,q.video,t,g,p,e))):o.return([])}))})),n.yield(Promise.all(e),2)):(t=n.yieldResult,r=(r=t.reduce(shaka.util.Functional.collapseArrays,[])).filter((function(a){return null!=a})),n.return(r))}))},shaka.hls.HlsParser.prototype.createStreamInfosForVariantTag_=function(a,b,e){var t,r,g,n,o,l,h,d,p,q,c,u,m,f,_=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(y){if(1==y.nextAddress)return t=shaka.util.ManifestParserUtils.ContentType,r=_.getCodecsForVariantTag_(a),g=a.getAttributeValue("AUDIO"),n=a.getAttributeValue("VIDEO"),goog.asserts.assert(null==g||null==n,"Unexpected: both video and audio described by media tags!"),l=(o=g||n)&&_.groupIdToStreamInfosMap_.has(o)?_.groupIdToStreamInfosMap_.get(o):[],h={audio:g?l:[],video:n?l:[]},shaka.log.debug("Guessing stream type for",a.toString()),p=!1,q=a.getRequiredAttrValue("URI"),c=h.audio.find((function(a){return a&&a.verbatimMediaPlaylistUri==q})),u=_.guessCodecsSafe_(t.VIDEO,r),m=b||e||u,1!=r.length||m?!l.length&&1<r.length?(shaka.log.debug("Guessing multiplexed audio+video."),d=t.VIDEO,r=[r.join(",")]):h.audio.length&&c?(shaka.log.debug("Guessing audio-only."),d=t.AUDIO,p=!0):h.video.length?(shaka.log.debug("Guessing audio-only."),d=t.AUDIO):(shaka.log.debug("Guessing video-only."),d=t.VIDEO):(d=t.AUDIO,shaka.log.debug("Guessing audio-only.")),p?y.jumpTo(2):y.yield(_.createStreamInfoFromVariantTag_(a,r,d),3);if(2!=y.nextAddress&&(f=y.yieldResult),f)h[f.stream.type]=[f];else if(null===f)return shaka.log.debug("streamInfo is null"),y.return(null);return _.filterLegacyCodecs_(h),y.return(h)}))},shaka.hls.HlsParser.prototype.getCodecsForVariantTag_=function(a){var b=a.getAttributeValue("CODECS","avc1.42E01E,mp4a.40.2").split(/\s*,\s*/);a=new Set;for(var e=[],t=(b=$jscomp.makeIterator(b)).next();!t.done;t=b.next()){t=t.value;var r=shaka.util.MimeUtils.getCodecBase(t);a.has(r)?shaka.log.debug("Ignoring duplicate codec"):(e.push(t),a.add(r))}return e},shaka.hls.HlsParser.prototype.getChannelsCount_=function(a){return(a=a.getAttributeValue("CHANNELS"))?(a=a.split("/")[0],parseInt(a,10)):null},shaka.hls.HlsParser.prototype.getClosedCaptions_=function(a,b){var e=shaka.util.ManifestParserUtils.ContentType,t=a.getAttributeValue("CLOSED-CAPTIONS");return b==e.VIDEO&&t&&"NONE"!=t?this.groupIdToClosedCaptionsMap_.get(t):null},shaka.hls.HlsParser.prototype.getLanguage_=function(a){var b=shaka.util.LanguageUtils;return a=a.getAttributeValue("LANGUAGE")||"und",b.normalize(a)},shaka.hls.HlsParser.prototype.getType_=function(a){return"subtitles"==(a=a.getRequiredAttrValue("TYPE").toLowerCase())&&(a=shaka.util.ManifestParserUtils.ContentType.TEXT),a},shaka.hls.HlsParser.prototype.filterLegacyCodecs_=function(a){for(var b=(a=$jscomp.makeIterator(a.audio.concat(a.video))).next();!b.done;b=a.next())if(b=b.value){var e=b.stream.codecs.split(",");e=e.filter((function(a){return"mp4a.40.34"!=a})),b.stream.codecs=e.join(",")}},shaka.hls.HlsParser.prototype.createVariants_=function(a,b,e,t,r,n){for(var g=shaka.util.ManifestParserUtils.ContentType,o=shaka.media.DrmEngine,l=$jscomp.makeIterator(b),h=l.next();!h.done;h=l.next())this.addVideoAttributes_(h.value.stream,t,r,n);for(t=this.config_.disableAudio,a.length&&!t||(a=[null]),t=this.config_.disableVideo,b.length&&!t||(b=[null]),t=[],r=(a=$jscomp.makeIterator(a)).next();!r.done;r=a.next())for(r=r.value,l=(n=$jscomp.makeIterator(b)).next();!l.done;l=n.next()){var d=l.value;l=r?r.stream:null,h=d?d.stream:null;var c=r?r.stream.drmInfos:null,p=d?d.stream.drmInfos:null;d=(d?d.verbatimMediaPlaylistUri:"")+" - "+(r?r.verbatimMediaPlaylistUri:""),l&&h&&!o.areDrmCompatible(c,p)?shaka.log.warning("Incompatible DRM info in HLS variant.  Skipping."):this.variantUriSet_.has(d)?shaka.log.debug("Skipping variant which only differs in text streams."):(goog.asserts.assert(!l||l.type==g.AUDIO,"Audio parameter mismatch!"),goog.asserts.assert(!h||h.type==g.VIDEO,"Video parameter mismatch!"),l={id:this.globalId_++,language:l?l.language:"und",primary:!!l&&l.primary||!!h&&h.primary,audio:l,video:h,bandwidth:e,allowedByApplication:!0,allowedByKeySystem:!0},t.push(l),this.variantUriSet_.add(d))}return t},shaka.hls.HlsParser.prototype.parseClosedCaptions_=function(a){a=shaka.hls.Utils.filterTagsByType(a,"CLOSED-CAPTIONS");for(var b=(a=$jscomp.makeIterator(a)).next();!b.done;b=a.next()){var e=b.value;goog.asserts.assert("EXT-X-MEDIA"==e.name,"Should only be called on media tags!"),b=this.getLanguage_(e);var t=e.getRequiredAttrValue("GROUP-ID");e=e.getRequiredAttrValue("INSTREAM-ID"),this.groupIdToClosedCaptionsMap_.get(t)||this.groupIdToClosedCaptionsMap_.set(t,new Map),this.groupIdToClosedCaptionsMap_.get(t).set(e,b)}},shaka.hls.HlsParser.prototype.createStreamInfoFromMediaTag_=function(a){var e,t,r,n,g,o,l,h,d,c,p,q,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(m){return 1==m.nextAddress?(goog.asserts.assert("EXT-X-MEDIA"==a.name,"Should only be called on media tags!"),e=a.getRequiredAttrValue("GROUP-ID"),t="",(r=b.getType_(a))!=shaka.util.ManifestParserUtils.ContentType.TEXT&&e&&b.groupIdToCodecsMap_.has(e)&&(t=b.groupIdToCodecsMap_.get(e)),n=b.variableSubstitution_(a.getRequiredAttrValue("URI"),b.globalVariables_),b.uriToStreamInfosMap_.has(n)?m.return(b.uriToStreamInfosMap_.get(n)):(g=b.getLanguage_(a),o=a.getAttributeValue("NAME"),l=a.getAttribute("DEFAULT"),h=a.getAttribute("AUTOSELECT"),d=!!l||!!h,c="audio"==r?b.getChannelsCount_(a):null,p=a.getAttributeValue("CHARACTERISTICS"),m.yield(b.createStreamInfo_(n,t,r,g,d,o,c,null,p),2))):(q=m.yieldResult,b.groupIdToStreamInfosMap_.has(e)?b.groupIdToStreamInfosMap_.get(e).push(q):b.groupIdToStreamInfosMap_.set(e,[q]),null==q?m.return(null):b.uriToStreamInfosMap_.has(n)?m.return(b.uriToStreamInfosMap_.get(n)):(b.uriToStreamInfosMap_.set(n,q),m.return(q)))}))},shaka.hls.HlsParser.prototype.createStreamInfoFromVariantTag_=function(a,b,e){var t,r,g,n,o=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){return 1==l.nextAddress?(goog.asserts.assert("EXT-X-STREAM-INF"==a.name,"Should only be called on variant tags!"),t=o.variableSubstitution_(a.getRequiredAttrValue("URI"),o.globalVariables_),o.uriToStreamInfosMap_.has(t)?l.return(o.uriToStreamInfosMap_.get(t)):(r=o.getClosedCaptions_(a,e),g=o.guessCodecs_(e,b),l.yield(o.createStreamInfo_(t,g,e,"und",!1,null,null,r,null),2))):null==(n=l.yieldResult)?l.return(null):o.uriToStreamInfosMap_.has(t)?l.return(o.uriToStreamInfosMap_.get(t)):(o.uriToStreamInfosMap_.set(t,n),l.return(n))}))},shaka.hls.HlsParser.prototype.createStreamInfo_=function(a,b,e,t,r,n,g,o,l){var h,d,p,q,c,u,m,f,_,y,k,E,S,v,T,P,A,C,M,I,x,R,D,N,w,L,U,O,B,$,j,F,V,K=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(G){switch(G.nextAddress){case 1:return h=shaka.hls.Utils.constructAbsoluteUri(K.masterPlaylistUri_,a),G.yield(K.requestManifest_(h),2);case 2:if(d=G.yieldResult,h=d.uri,(p=K.manifestTextParser_.parsePlaylist(d.data,h)).type!=shaka.hls.PlaylistType.MEDIA)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INVALID_PLAYLIST_HIERARCHY);if(q=[],p.segments)for(c=$jscomp.makeIterator(p.segments),u=c.next();!u.done;u=c.next())m=u.value,f=shaka.hls.Utils.filterTagsByName(m.tags,"EXT-X-KEY"),q.push.apply(q,$jscomp.arrayFromIterable(f));for(_=!1,y=[],k=new Set,E=$jscomp.makeIterator(q),S=E.next();!S.done;S=E.next())if(v=S.value,"NONE"!=(T=v.getRequiredAttrValue("METHOD"))){if(_=!0,"AES-128"==T)return shaka.log.warning("Unsupported HLS Encryption",T),K.aesEncrypted_=!0,G.return(null);if(P=v.getRequiredAttrValue("KEYFORMAT"),C=(A=shaka.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_[P])?A(v):null){if(C.keyIds)for(M=$jscomp.makeIterator(C.keyIds),I=M.next();!I.done;I=M.next())x=I.value,k.add(x);y.push(C)}else shaka.log.warning("Unsupported HLS KEYFORMAT",P)}if(_&&!y.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_KEYFORMATS_NOT_SUPPORTED);return R=shaka.hls.Utils.filterTagsByName(p.tags,"EXT-X-DEFINE"),D=K.parseMediaVariables_(R),goog.asserts.assert(null!=p.segments,"Media playlist should have segments!"),K.determinePresentationType_(p),G.yield(K.guessMimeType_(e,b,p,D),3);case 3:return N=G.yieldResult,shaka.hls.HlsParser.RAW_FORMATS_.includes(N)&&(b=""),w=new Map,G.setCatchFinallyBlocks(4),G.yield(K.createSegments_(a,p,e,N,w,D),6);case 6:L=G.yieldResult,G.leaveTryBlock(5);break;case 4:if((U=G.enterCatchBlock()).code==shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM)return shaka.log.alwaysWarn("Skipping unsupported HLS stream",N,a),G.return(null);throw U;case 5:return O=L[0].startTime,B=L[L.length-1].endTime,$=new shaka.media.SegmentIndex(L),j=e==shaka.util.ManifestParserUtils.ContentType.TEXT?shaka.util.ManifestParserUtils.TextStreamKind.SUBTITLE:void 0,F=[],l&&F.push(l),V={id:K.globalId_++,originalId:n,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:$,mimeType:N,codecs:b,kind:j,encrypted:_,drmInfos:y,keyIds:k,language:t,label:n,type:e,primary:r,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:F,channelsCount:g,audioSamplingRate:null,closedCaptions:o},G.return({stream:V,verbatimMediaPlaylistUri:a,absoluteMediaPlaylistUri:h,minTimestamp:O,maxTimestamp:B,mediaSequenceToStartTime:w})}}))},shaka.hls.HlsParser.prototype.determinePresentationType_=function(a){var b=shaka.hls.HlsParser.PresentationType_,e=shaka.hls.Utils.getFirstTagWithName(a.tags,"EXT-X-PLAYLIST-TYPE"),t=shaka.hls.Utils.getFirstTagWithName(a.tags,"EXT-X-ENDLIST");t=e&&"VOD"==e.value||t,e=e&&"EVENT"==e.value&&!t,e=!t&&!e,t?this.setPresentationType_(b.VOD):(e?this.setPresentationType_(b.LIVE):this.setPresentationType_(b.EVENT),b=this.getRequiredTag_(a.tags,"EXT-X-TARGETDURATION"),b=Number(b.value),t=shaka.hls.Utils.getFirstTagWithName(a.tags,"EXT-X-PART-INF"),this.config_.lowLatencyMode&&t?(this.partialTargetDuration_=Number(t.getRequiredAttrValue("PART-TARGET")),this.minTargetDuration_=Math.min(this.partialTargetDuration_,this.minTargetDuration_)):this.minTargetDuration_=Math.min(b,this.minTargetDuration_),this.maxTargetDuration_=Math.max(b,this.maxTargetDuration_),this.config_.lowLatencyMode&&(this.lowLatencyPresentationDelay_=(a=shaka.hls.Utils.getFirstTagWithName(a.tags,"EXT-X-SERVER-CONTROL"))?Number(a.getRequiredAttrValue("PART-HOLD-BACK")):0))},shaka.hls.HlsParser.prototype.createPresentationTimeline_=function(){this.isLive_()?(this.presentationTimeline_=new shaka.media.PresentationTimeline(0,this.config_.defaultPresentationDelay?this.config_.defaultPresentationDelay:this.lowLatencyPresentationDelay_?this.lowLatencyPresentationDelay_:3*this.maxTargetDuration_),this.presentationTimeline_.setStatic(!1)):(this.presentationTimeline_=new shaka.media.PresentationTimeline(null,0),this.presentationTimeline_.setStatic(!0)),this.notifySegments_(),goog.asserts.assert(!this.presentationTimeline_.usingPresentationStartTime(),"We should not be using the presentation start time in HLS!")},shaka.hls.HlsParser.prototype.getInitSegmentReference_=function(a,b,e){if(!(b=shaka.hls.Utils.getFirstTagWithName(b,"EXT-X-MAP")))return null;var t=b.getRequiredAttrValue("URI");return a=[e=this.variableSubstitution_(shaka.hls.Utils.constructAbsoluteUri(a,t),e),b.getAttributeValue("BYTERANGE","")].join("-"),this.mapTagToInitSegmentRefMap_.has(a)||(b=this.createInitSegmentReference_(e,b),this.mapTagToInitSegmentRefMap_.set(a,b)),this.mapTagToInitSegmentRefMap_.get(a)},shaka.hls.HlsParser.prototype.createInitSegmentReference_=function(a,b){var e=0,t=null,r=b.getAttributeValue("BYTERANGE");return r&&(e=r.split("@"),t=Number(e[0]),t=(e=Number(e[1]))+t-1),new shaka.media.InitSegmentReference((function(){return[a]}),e,t)},shaka.hls.HlsParser.prototype.createSegmentReference_=function(a,b,e,t,r,n,g){var o=e.tags,l=this.variableSubstitution_(e.absoluteUri,n),h=shaka.hls.Utils.getFirstTagWithName(o,"EXTINF");if(n=[],this.config_.lowLatencyMode&&e.partialSegments.length)for(var d={},c=(e=$jscomp.makeIterator(shaka.util.Iterables.enumerate(e.partialSegments))).next();!c.done;d={$jscomp$loop$prop$pAbsoluteUri$560:d.$jscomp$loop$prop$pAbsoluteUri$560},c=e.next()){var p=(c=c.value).i;c=c.item;var q=0==p?b:n[n.length-1];p=0==p?t:q.endTime;var m=Number(c.getAttributeValue("DURATION"));m=p+m;var u=c.getAttributeValue("BYTERANGE");q=(u=$jscomp.makeIterator(this.parseByteRange_(q,u))).next().value,u=u.next().value,c=c.getAttributeValue("URI"),d.$jscomp$loop$prop$pAbsoluteUri$560=shaka.hls.Utils.constructAbsoluteUri(g,c),c=new shaka.media.SegmentReference(p,m,function(a){return function(){return[a.$jscomp$loop$prop$pAbsoluteUri$560]}}(d),q,u,a,r,0,1/0),n.push(c)}else if(!h)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_TAG_MISSING,"EXTINF");return d=g=0,e=null,h?(h=h.value.split(","),g=t+Number(h[0]),o=shaka.hls.Utils.getFirstTagWithName(o,"EXT-X-BYTERANGE"),d=(b=$jscomp.makeIterator(this.parseByteRange_(b,o?o.value:null))).next().value,e=b.next().value):g=n[n.length-1].endTime,new shaka.media.SegmentReference(t,g,(function(){return l.length?[l]:[]}),d,e,a,r,0,1/0,n)},shaka.hls.HlsParser.prototype.parseByteRange_=function(a,b){var e=0,t=null;return b&&(e=b.split("@"),t=Number(e[0]),e[1]?e=Number(e[1]):(goog.asserts.assert(a,"Cannot refer back to previous HLS segment!"),e=a.endByte+1),t=e+t-1),[e,t]},shaka.hls.HlsParser.prototype.notifySegments_=function(){if(this.presentationTimeline_){for(var a=$jscomp.makeIterator(this.segmentsToNotifyByStream_),b=a.next();!b.done;b=a.next())this.presentationTimeline_.notifySegments(b.value);this.segmentsToNotifyByStream_=[]}},shaka.hls.HlsParser.prototype.createSegments_=function(a,b,e,t,r,n){var o,l,h,d,c,p,q,m,u,f,_,y,k,E,S,v,T,P,A,C,M,I,g=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(x){switch(x.nextAddress){case 1:if(o=b.segments,goog.asserts.assert(o.length,"Playlist should have segments!"),h=shaka.hls.Utils.getFirstTagWithNameAsNumber(b.tags,"EXT-X-MEDIA-SEQUENCE",0),c=(d=shaka.hls.Utils.getFirstTagWithName(b.tags,"EXT-X-SKIP"))?Number(d.getAttributeValue("SKIPPED-SEGMENTS")):0,p=h+c,g.isLive_()&&r.has(p)){q=r.get(p),x.jumpTo(2);break}if(null!=g.playlistStartTime_){x.jumpTo(3);break}return l=g.getInitSegmentReference_(b.absoluteUri,o[0].tags,n),goog.asserts.assert(e!=shaka.util.ManifestParserUtils.ContentType.TEXT,"Should only get start time from audio or video streams"),m=g,x.yield(g.getStartTime_(a,l,t,p,!1,o[0],n),4);case 4:m.playlistStartTime_=x.yieldResult;case 3:q=g.playlistStartTime_;case 2:u=o[0].absoluteUri,shaka.log.debug("First segment",u.split("/").pop(),"starts at",q),f=shaka.hls.Utils.getFirstTagWithNameAsNumber(b.tags,"EXT-X-DISCONTINUITY-SEQUENCE"),_=g.discontinuityToTso_.get(f)||0,y=[],k=function(a){return shaka.util.Iterables.enumerate(a)},E=$jscomp.makeIterator(k(o)),S=E.next();case 5:if(S.done){x.jumpTo(7);break}if(v=S.value,T=v.i,P=v.item,A=y[y.length-1],C=0==T?q:A.endTime,p=h+c+T,r.set(p,C),l=g.getInitSegmentReference_(b.absoluteUri,P.tags,n),!shaka.hls.Utils.getFirstTagWithName(P.tags,"EXT-X-DISCONTINUITY")){x.jumpTo(8);break}return f++,x.yield(g.getTimestampOffset_(f,a,l,t,p,P,n,C),9);case 9:_=x.yieldResult;case 8:M=shaka.hls.Utils.getFirstTagWithName(P.tags,"EXTINF"),(g.config_.lowLatencyMode||M)&&(I=g.createSegmentReference_(l,A,P,C,_,n,b.absoluteUri),y.push(I)),S=E.next(),x.jumpTo(5);break;case 7:return g.segmentsToNotifyByStream_.push(y),g.notifySegments_(),x.return(y)}}))},shaka.hls.HlsParser.prototype.getTimestampOffset_=function(a,b,e,t,r,n,g,o){var l,h,d=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(c){return 1==c.nextAddress?(l=0,d.discontinuityToTso_.has(a)?(l=d.discontinuityToTso_.get(a),c.jumpTo(2)):c.yield(d.getStartTime_(b,e,t,r,!0,n,g),3)):(2!=c.nextAddress&&(h=c.yieldResult,l=o-h,shaka.log.v1("Segment timestampOffset =",l),d.discontinuityToTso_.set(a,l)),c.return(l))}))},shaka.hls.HlsParser.prototype.fetchStartOfSegment_=function(a){var e,t,r,n,g,o,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){switch(l.nextAddress){case 1:return e=shaka.net.NetworkingEngine.RequestType.SEGMENT,t=shaka.util.Networking.createSegmentRequest(a.getUris(),a.startByte,a.endByte,b.config_.retryParameters),b.config_.hls.useFullSegmentsForStartTime?l.return(b.makeNetworkRequest_(t,e)):(r=shaka.util.Networking.createSegmentRequest(a.getUris(),a.startByte,a.startByte+shaka.hls.HlsParser.START_OF_SEGMENT_SIZE_-1,b.config_.retryParameters),l.setCatchFinallyBlocks(2),l.yield(b.makeNetworkRequest_(r,e),4));case 4:return n=l.yieldResult,l.return(n);case 2:if((g=l.enterCatchBlock()).code==shaka.util.Error.Code.OPERATION_ABORTED)throw g;return shaka.log.alwaysWarn("Unable to fetch the starting part of HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",r.uris[0]),l.yield(b.makeNetworkRequest_(t,e),5);case 5:return o=l.yieldResult,l.return(o)}}))},shaka.hls.HlsParser.prototype.getStartTime_=function(a,b,e,t,r,n,g){var o,l,h,d,p,q,c,u,m=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(f){switch(f.nextAddress){case 1:if(o=m.createSegmentReference_(b,null,n,0,0,g,""),m.manifest_&&!r){if(l=m.uriToStreamInfosMap_.get(a),null!=(h=l.mediaSequenceToStartTime.get(t)))return shaka.log.v1("Found segment start time in previous manifest",h),f.return(h);shaka.log.debug("Unable to find segment start time in previous manifest!")}if(shaka.log.v1("Fetching segment to find start time"),e=e.toLowerCase(),shaka.hls.HlsParser.RAW_FORMATS_.includes(e))throw shaka.log.alwaysWarn("Raw formats are not yet supported.  Skipping "+e),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM);if("video/webm"==e)throw shaka.log.alwaysWarn("WebM in HLS is not yet supported.  Skipping."),new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_INTERNAL_SKIP_STREAM);if("video/mp4"!=e&&"audio/mp4"!=e){f.jumpTo(2);break}return d=[m.fetchStartOfSegment_(o)],b&&d.push(m.fetchStartOfSegment_(b)),f.yield(Promise.all(d),3);case 3:return p=f.yieldResult,q=p[0],c=p[1]||p[0],f.return(m.getStartTimeFromMp4Segment_(a,q.uri,q.data,c.data));case 2:if("video/mp2t"!=e){f.jumpTo(4);break}return f.yield(m.fetchStartOfSegment_(o),5);case 5:return u=f.yieldResult,goog.asserts.assert(u.data,"Should have a response body!"),f.return(m.getStartTimeFromTsSegment_(a,u.uri,u.data));case 4:throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,a)}}))},shaka.hls.HlsParser.prototype.getStartTimeFromMp4Segment_=function(a,b,e,t){var r=shaka.util.Mp4Parser,n=0;if((new r).box("moov",r.children).box("trak",r.children).box("mdia",r.children).fullBox("mdhd",(function(a){goog.asserts.assert(0==a.version||1==a.version,"MDHD version can only be 0 or 1"),n=shaka.util.Mp4BoxParsers.parseMDHD(a.reader,a.version).timescale,a.parser.stop()})).parse(t,!0),!n)throw shaka.log.error("Unable to find timescale in init segment!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,a,b);var g=0,o=!1;if((new r).box("moof",r.children).box("traf",r.children).fullBox("tfdt",(function(a){goog.asserts.assert(0==a.version||1==a.version,"TFDT version can only be 0 or 1"),g=shaka.util.Mp4BoxParsers.parseTFDT(a.reader,a.version).baseMediaDecodeTime/n,o=!0,a.parser.stop()})).parse(e,!0),!o)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,a,b);return g},shaka.hls.HlsParser.prototype.getStartTimeFromTsSegment_=function(a,b,e){var t=new shaka.util.DataViewReader(e,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),r=function(){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_PARSE_SEGMENT_START_TIME,a,b)},n=0,g=0;for(e=function(){t.seek(n+188),71!=(g=t.readUint8())&&(t.seek(n+192),g=t.readUint8()),71!=g&&(t.seek(n+204),g=t.readUint8()),71!=g&&r(),t.rewind(1)};;){n=t.getPosition(),71!=(g=t.readUint8())&&r();var o=t.readUint16();if(8191==(8191&o))e();else if(16384&o){if(0!=(o=(48&t.readUint8())>>4)&&2!=o||r(),3==o&&(o=t.readUint8(),t.skip(o)),1==t.readUint32()>>8)return t.skip(3),0!=(e=t.readUint8()>>6)&&1!=e||r(),0==(o=t.readUint8())&&r(),2==e?goog.asserts.assert(5==o,"Bad PES header?"):3==e&&goog.asserts.assert(10==o,"Bad PES header?"),(1073741824*((14&(e=t.readUint8()))>>1)+((65534&(o=t.readUint16()))<<14|(65534&t.readUint16())>>1))/shaka.hls.HlsParser.TS_TIMESCALE_;e()}else e()}},shaka.hls.HlsParser.prototype.guessCodecs_=function(a,b){if(1==b.length)return b[0];var e=this.guessCodecsSafe_(a,b);if(null!=e)return e;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_GUESS_CODECS,b)},shaka.hls.HlsParser.prototype.guessCodecsSafe_=function(a,b){for(var e=$jscomp.makeIterator(shaka.hls.HlsParser.CODEC_REGEXPS_BY_CONTENT_TYPE_[a]),t=e.next();!t.done;t=e.next()){t=t.value;for(var r=$jscomp.makeIterator(b),n=r.next();!n.done;n=r.next())if(n=n.value,t.test(n.trim()))return n.trim()}return a==shaka.util.ManifestParserUtils.ContentType.TEXT?"":null},shaka.hls.HlsParser.prototype.variableSubstitution_=function(a,b){var e=String(a).replace(/%7B/g,"{").replace(/%7D/g,"}"),t=e.match(/{\$\w*}/g);if(t)for(var r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next()){var n=(r=r.value).slice(2,r.length-1),g=b.get(n);if(!g)throw shaka.log.error("A variable has been found that is not declared",n),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_VARIABLE_NOT_FOUND,n);e=e.replace(r,g)}return e},shaka.hls.HlsParser.prototype.guessMimeType_=function(a,b,e,t){var r,g,n,o,l,h,d,p,q,c,u,m=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(f){if(1==f.nextAddress)return r=shaka.hls.HlsParser,g=shaka.util.ManifestParserUtils.ContentType,n=shaka.net.NetworkingEngine.RequestType.SEGMENT,goog.asserts.assert(e.segments.length,"Playlist should have segments!"),o=m.variableSubstitution_(e.segments[0].absoluteUri,t),l=new goog.Uri(o),h=l.getPath().split(".").pop(),d=r.EXTENSION_MAP_BY_CONTENT_TYPE_[a],(p=d[h])?f.return(p):a==g.TEXT?b&&"vtt"!=b?f.return("application/mp4"):f.return("text/vtt"):((q=shaka.net.NetworkingEngine.makeRequest([o],m.config_.retryParameters)).method="HEAD",f.yield(m.makeNetworkRequest_(q,n),2));if(c=f.yieldResult,!(u=c.headers["content-type"]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_COULD_NOT_GUESS_MIME_TYPE,h);return f.return(u.split(";")[0])}))},shaka.hls.HlsParser.prototype.getRequiredTag_=function(a,b){var e=shaka.hls.Utils.getFirstTagWithName(a,b);if(!e)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.MANIFEST,shaka.util.Error.Code.HLS_REQUIRED_TAG_MISSING,b);return e},shaka.hls.HlsParser.prototype.addVideoAttributes_=function(a,b,e,t){a&&(a.width=Number(b)||void 0,a.height=Number(e)||void 0,a.frameRate=Number(t)||void 0)},shaka.hls.HlsParser.prototype.requestManifest_=function(a){var b=shaka.net.NetworkingEngine.RequestType.MANIFEST;return a=shaka.net.NetworkingEngine.makeRequest([a],this.config_.retryParameters),this.makeNetworkRequest_(a,b)},shaka.hls.HlsParser.prototype.onUpdate_=function(){var b,e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(shaka.log.info("Updating manifest..."),goog.asserts.assert(0<a.updatePlaylistDelay_,"We should only call |onUpdate_| when we are suppose to be updating."),a.playerInterface_?(t.setCatchFinallyBlocks(2),t.yield(a.update(),4)):t.return()):2!=t.nextAddress?(b=a.updatePlaylistDelay_,a.updatePlaylistTimer_.tickAfter(b),t.leaveTryBlock(0)):(e=t.enterCatchBlock(),a.playerInterface_?(goog.asserts.assert(e instanceof shaka.util.Error,"Should only receive a Shaka error"),e.severity=shaka.util.Error.Severity.RECOVERABLE,a.playerInterface_.onError(e),a.updatePlaylistTimer_.tickAfter(.1),void t.jumpToEnd()):t.return())}))},shaka.hls.HlsParser.prototype.isLive_=function(){return this.presentationType_!=shaka.hls.HlsParser.PresentationType_.VOD},shaka.hls.HlsParser.prototype.setPresentationType_=function(a){this.presentationType_=a,this.presentationTimeline_&&this.presentationTimeline_.setStatic(!this.isLive_()),this.isLive_()||this.updatePlaylistTimer_.stop()},shaka.hls.HlsParser.prototype.makeNetworkRequest_=function(a,b){if(!this.operationManager_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.PLAYER,shaka.util.Error.Code.OPERATION_ABORTED);var e=this.playerInterface_.networkingEngine.request(b,a);return this.operationManager_.manage(e),e.promise},shaka.hls.HlsParser.widevineDrmParser_=function(a){var b=a.getRequiredAttrValue("METHOD"),e=["SAMPLE-AES","SAMPLE-AES-CTR"];return e.includes(b)?(b=a.getRequiredAttrValue("URI"),b=shaka.net.DataUriPlugin.parseRaw(b),b=shaka.util.BufferUtils.toUint8(b.data),b=shaka.util.ManifestParserUtils.createDrmInfo("com.widevine.alpha",[{initDataType:"cenc",initData:b}]),(a=a.getAttributeValue("KEYID"))&&(goog.asserts.assert(a.startsWith("0x"),"Incorrect KEYID format!"),b.keyIds=new Set([a.substr(2).toLowerCase()])),b):(shaka.log.error("Widevine in HLS is only supported with [",e.join(", "),"], not",b),null)},shaka.hls.HlsParser.playreadyDrmParser_=function(a){var b=a.getRequiredAttrValue("METHOD"),e=["SAMPLE-AES","SAMPLE-AES-CTR"];return e.includes(b)?(a=a.getRequiredAttrValue("URI"),a=shaka.net.DataUriPlugin.parseRaw(a),a=shaka.util.BufferUtils.toUint8(a.data),b=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),a=shaka.util.Pssh.createPssh(a,b),shaka.util.ManifestParserUtils.createDrmInfo("com.microsoft.playready",[{initDataType:"cenc",initData:a}])):(shaka.log.error("PlayReady in HLS is only supported with [",e.join(", "),"], not",b),null)},goog.exportSymbol("shaka.hls.HlsParser",shaka.hls.HlsParser),shaka.hls.HlsParser.VIDEO_CODEC_REGEXPS_=[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],shaka.hls.HlsParser.AUDIO_CODEC_REGEXPS_=[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],shaka.hls.HlsParser.TEXT_CODEC_REGEXPS_=[/^vtt$/,/^wvtt/,/^stpp/],shaka.hls.HlsParser.CODEC_REGEXPS_BY_CONTENT_TYPE_={audio:shaka.hls.HlsParser.AUDIO_CODEC_REGEXPS_,video:shaka.hls.HlsParser.VIDEO_CODEC_REGEXPS_,text:shaka.hls.HlsParser.TEXT_CODEC_REGEXPS_},shaka.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_={mp4:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},shaka.hls.HlsParser.RAW_FORMATS_=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"],shaka.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_={mp4:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t"},shaka.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_={mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"},shaka.hls.HlsParser.EXTENSION_MAP_BY_CONTENT_TYPE_={audio:shaka.hls.HlsParser.AUDIO_EXTENSIONS_TO_MIME_TYPES_,video:shaka.hls.HlsParser.VIDEO_EXTENSIONS_TO_MIME_TYPES_,text:shaka.hls.HlsParser.TEXT_EXTENSIONS_TO_MIME_TYPES_},shaka.hls.HlsParser.KEYFORMATS_TO_DRM_PARSERS_={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":shaka.hls.HlsParser.widevineDrmParser_,"com.microsoft.playready":shaka.hls.HlsParser.playreadyDrmParser_},shaka.hls.HlsParser.PresentationType_={VOD:"VOD",EVENT:"EVENT",LIVE:"LIVE"},shaka.hls.HlsParser.TS_TIMESCALE_=9e4,shaka.hls.HlsParser.START_OF_SEGMENT_SIZE_=2048,shaka.media.ManifestParser.registerParserByExtension("m3u8",(function(){return new shaka.hls.HlsParser})),shaka.media.ManifestParser.registerParserByMime("application/x-mpegurl",(function(){return new shaka.hls.HlsParser})),shaka.media.ManifestParser.registerParserByMime("application/vnd.apple.mpegurl",(function(){return new shaka.hls.HlsParser})),shaka.net.HttpPluginUtils=function(){},shaka.net.HttpPluginUtils.makeResponse=function(a,b,e,t,r,n){if(200<=e&&299>=e&&202!=e)return{uri:r||t,originalUri:t,data:b,headers:a,fromCache:!!a["x-shaka-from-cache"]};r=null;try{r=shaka.util.StringUtils.fromBytesAutoDetect(b)}catch(e){}throw shaka.log.debug("HTTP error text:",r),new shaka.util.Error(401==e||403==e?shaka.util.Error.Severity.CRITICAL:shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.BAD_HTTP_STATUS,t,e,r,a,n)},shaka.net.HttpFetchPlugin=function(){},shaka.net.HttpFetchPlugin.parse=function(a,b,e,t){var r=new shaka.net.HttpFetchPlugin.Headers_;shaka.util.MapUtils.asMap(b.headers).forEach((function(a,b){r.append(b,a)}));var n=new shaka.net.HttpFetchPlugin.AbortController_,g={canceled:!1,timedOut:!1};if(a=shaka.net.HttpFetchPlugin.request_(a,e,{body:b.body||void 0,headers:r,method:b.method,signal:n.signal,credentials:b.allowCrossSiteCredentials?"include":void 0},g,t),a=new shaka.util.AbortableOperation(a,(function(){return g.canceled=!0,n.abort(),Promise.resolve()})),b=b.retryParameters.timeout){var o=new shaka.util.Timer((function(){g.timedOut=!0,n.abort()}));o.tickAfter(b/1e3),a.finally((function(){o.stop()}))}return a},shaka.net.HttpFetchPlugin.request_=function(a,b,e,t,r){var n,g,o,l,h,d,c,p,q,m,u,f,_;return $jscomp.asyncExecutePromiseGeneratorProgram((function(y){switch(y.nextAddress){case 1:return n=shaka.net.HttpFetchPlugin.fetch_,g=shaka.net.HttpFetchPlugin.ReadableStream_,d=h=0,c=Date.now(),y.setCatchFinallyBlocks(2),y.yield(n(a,e),4);case 4:return o=y.yieldResult,p=o.clone().body.getReader(),m=(q=o.headers.get("Content-Length"))?parseInt(q,10):0,u=function(a){var b=function(){var e,t,n;return $jscomp.asyncExecutePromiseGeneratorProgram((function(g){switch(g.nextAddress){case 1:return g.setCatchFinallyBlocks(2),g.yield(p.read(),4);case 4:e=g.yieldResult,g.leaveTryBlock(3);break;case 2:return t=g.enterCatchBlock(),shaka.log.v1("error reading from stream",t.message),g.return();case 3:e.done||(h+=e.value.byteLength),(100<(n=Date.now())-c||e.done)&&(r(n-c,h-d,m-h),d=h,c=n),e.done?(goog.asserts.assert(!e.value,'readObj should be unset when "done" is true.'),a.close()):(a.enqueue(e.value),b()),g.jumpToEnd()}}))};b()},new g({start:u}),y.yield(o.arrayBuffer(),5);case 5:l=y.yieldResult,y.leaveTryBlock(3);break;case 2:if(f=y.enterCatchBlock(),t.canceled)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.OPERATION_ABORTED,a,b);if(t.timedOut)throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,a,b);throw new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.HTTP_ERROR,a,f,b);case 3:return _={},o.headers.forEach((function(a,b){_[b.trim()]=a})),y.return(shaka.net.HttpPluginUtils.makeResponse(_,l,o.status,a,o.url,b))}}))},shaka.net.HttpFetchPlugin.isSupported=function(){if(!window.ReadableStream)return!1;try{new ReadableStream({})}catch(e){return!1}return!(!window.fetch||!window.AbortController)},goog.exportSymbol("shaka.net.HttpFetchPlugin",shaka.net.HttpFetchPlugin),goog.exportProperty(shaka.net.HttpFetchPlugin,"isSupported",shaka.net.HttpFetchPlugin.isSupported),goog.exportProperty(shaka.net.HttpFetchPlugin,"parse",shaka.net.HttpFetchPlugin.parse),shaka.net.HttpFetchPlugin.fetch_=window.fetch,shaka.net.HttpFetchPlugin.AbortController_=window.AbortController,shaka.net.HttpFetchPlugin.ReadableStream_=window.ReadableStream,shaka.net.HttpFetchPlugin.Headers_=window.Headers,shaka.net.HttpFetchPlugin.isSupported()&&(shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpFetchPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.PREFERRED),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpFetchPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.PREFERRED)),shaka.net.HttpXHRPlugin=function(){},shaka.net.HttpXHRPlugin.parse=function(a,b,e,t){var r=new shaka.net.HttpXHRPlugin.Xhr_,n=Date.now(),g=0,o=new Promise((function(o,l){for(var h in r.open(b.method,a,!0),r.responseType="arraybuffer",r.timeout=b.retryParameters.timeout,r.withCredentials=b.allowCrossSiteCredentials,r.onabort=function(){l(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.OPERATION_ABORTED,a,e))},r.onload=function(b){b=b.target,goog.asserts.assert(b,"XHR onload has no target!");for(var t=b.getAllResponseHeaders().trim().split("\r\n"),r={},n=(t=$jscomp.makeIterator(t)).next();!n.done;n=t.next())r[(n=n.value.split(": "))[0].toLowerCase()]=n.slice(1).join(": ");try{var g=shaka.net.HttpPluginUtils.makeResponse(r,b.response,b.status,a,b.responseURL,e);o(g)}catch(e){goog.asserts.assert(e instanceof shaka.util.Error,"Wrong error type!"),l(e)}},r.onerror=function(b){l(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.HTTP_ERROR,a,b,e))},r.ontimeout=function(b){l(new shaka.util.Error(shaka.util.Error.Severity.RECOVERABLE,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.TIMEOUT,a,e))},r.onprogress=function(a){var b=Date.now();(100<b-n||a.lengthComputable&&a.loaded==a.total)&&(t(b-n,a.loaded-g,a.total-a.loaded),g=a.loaded,n=b)},b.headers){var d=h.toLowerCase();r.setRequestHeader(d,b.headers[h])}r.send(b.body)}));return new shaka.util.AbortableOperation(o,(function(){return r.abort(),Promise.resolve()}))},goog.exportSymbol("shaka.net.HttpXHRPlugin",shaka.net.HttpXHRPlugin),goog.exportProperty(shaka.net.HttpXHRPlugin,"parse",shaka.net.HttpXHRPlugin.parse),shaka.net.HttpXHRPlugin.Xhr_=window.XMLHttpRequest,shaka.net.NetworkingEngine.registerScheme("http",shaka.net.HttpXHRPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.FALLBACK),shaka.net.NetworkingEngine.registerScheme("https",shaka.net.HttpXHRPlugin.parse,shaka.net.NetworkingEngine.PluginPriority.FALLBACK),shaka.offline={},shaka.offline.DownloadProgressEstimator=function(){this.actualDownloaded_=this.estimatedDownloaded_=this.estimatedTotal_=0,this.pending_=new Map,this.nextId_=0},shaka.offline.DownloadProgressEstimator.prototype.open=function(a){this.estimatedTotal_+=a;var b=this.nextId_;return this.nextId_++,this.pending_.set(b,a),b},shaka.offline.DownloadProgressEstimator.prototype.close=function(a,b){if(this.pending_.has(a)){var e=this.pending_.get(a);this.pending_.delete(a),this.estimatedDownloaded_+=e,this.actualDownloaded_+=b}},shaka.offline.DownloadProgressEstimator.prototype.getEstimatedProgress=function(){return 0==this.estimatedTotal_?0:this.estimatedDownloaded_/this.estimatedTotal_},shaka.offline.DownloadProgressEstimator.prototype.getTotalDownloaded=function(){return this.actualDownloaded_},shaka.offline.DownloadManager=function(a){var b=this;this.networkingEngine_=a,this.groups_=new Map,this.destroyer_=new shaka.util.Destroyer((function(){var a=Array.from(b.groups_.values());return Promise.all(a.map((function(a){return a.catch((function(){}))})))})),this.abortCallbacks_=[],this.onProgress_=function(a,b){},this.onInitData_=function(a,b){},this.estimator_=new shaka.offline.DownloadProgressEstimator},shaka.offline.DownloadManager.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.offline.DownloadManager.prototype.setCallbacks=function(a,b){this.onProgress_=a,this.onInitData_=b},shaka.offline.DownloadManager.prototype.abortAll=function(){var a=this.abortCallbacks_.map((function(a){return a()}));return this.abortCallbacks_=[],Promise.all(a)},shaka.offline.DownloadManager.prototype.queue=function(a,b,e,t,r){var n=this;this.destroyer_.ensureNotDestroyed();var g=this.estimator_.open(e);return e=(this.groups_.get(a)||Promise.resolve()).then((function(){var a,e,o,l,h,p,q;return $jscomp.asyncExecutePromiseGeneratorProgram((function(d){if(1==d.nextAddress)return d.yield(n.fetchSegment_(b),2);if(a=d.yieldResult,n.destroyer_.destroyed())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.OPERATION_ABORTED);if(t)for(l in e=shaka.util.BufferUtils.toUint8(a),(o=new shaka.util.Pssh(e)).data)h=Number(l),p=o.data[h],q=o.systemIds[h],n.onInitData_(p,q);return n.estimator_.close(g,a.byteLength),n.onProgress_(n.estimator_.getEstimatedProgress(),n.estimator_.getTotalDownloaded()),d.return(r(a))}))})),this.groups_.set(a,e),e},shaka.offline.DownloadManager.prototype.queueWork=function(a,b){this.destroyer_.ensureNotDestroyed();var e=(this.groups_.get(a)||Promise.resolve()).then((function(){return $jscomp.asyncExecutePromiseGeneratorProgram((function(a){return a.yield(b(),0)}))}));return this.groups_.set(a,e),e},shaka.offline.DownloadManager.prototype.waitToFinish=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return 1==b.nextAddress?b.yield(Promise.all(a.groups_.values()),2):b.return(a.estimator_.getTotalDownloaded())}))},shaka.offline.DownloadManager.prototype.fetchSegment_=function(a){var e,t,r,n,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(g){return 1==g.nextAddress?(e=shaka.net.NetworkingEngine.RequestType.SEGMENT,t=b.networkingEngine_.request(e,a),r=function(){return t.abort()},b.abortCallbacks_.push(r),g.yield(t.promise,2)):(n=g.yieldResult,shaka.util.ArrayUtils.remove(b.abortCallbacks_,r),g.return(n.data))}))},shaka.offline.indexeddb={},shaka.offline.indexeddb.DBOperation=function(a,b){var e=this;this.transaction_=a,this.store_=a.objectStore(b),this.promise_=new shaka.util.PublicPromise,a.onabort=function(a){a.preventDefault(),e.promise_.reject()},a.onerror=function(a){a.preventDefault(),e.promise_.reject()},a.oncomplete=function(a){e.promise_.resolve()}},shaka.offline.indexeddb.DBOperation.prototype.abort=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){if(1==b.nextAddress){try{a.transaction_.abort()}catch(e){}return b.setCatchFinallyBlocks(2),b.yield(a.promise_,4)}if(2!=b.nextAddress)return b.leaveTryBlock(0);b.enterCatchBlock(),b.jumpToEnd()}))},shaka.offline.indexeddb.DBOperation.prototype.forEachEntry=function(a){var b=this;return new Promise((function(e,t){var r=b.store_.openCursor();r.onerror=t,r.onsuccess=function(b){var t;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){if(1==b.nextAddress)return null==r.result?(e(),b.return()):(t=r.result,b.yield(a(t.key,t.value,t),2));t.continue(),b.jumpToEnd()}))}}))},shaka.offline.indexeddb.DBOperation.prototype.store=function(){return this.store_},shaka.offline.indexeddb.DBOperation.prototype.promise=function(){return this.promise_},shaka.offline.indexeddb.DBConnection=function(a){this.connection_=a,this.pending_=[]},shaka.offline.indexeddb.DBConnection.prototype.destroy=function(){return Promise.all(this.pending_.map((function(a){return a.abort()})))},shaka.offline.indexeddb.DBConnection.prototype.startReadOnlyOperation=function(a){return this.startOperation_(a,"readonly")},shaka.offline.indexeddb.DBConnection.prototype.startReadWriteOperation=function(a){return this.startOperation_(a,"readwrite")},shaka.offline.indexeddb.DBConnection.prototype.startOperation_=function(a,b){var e=this,t=this.connection_.transaction([a],b),r=new shaka.offline.indexeddb.DBOperation(t,a);return this.pending_.push(r),r.promise().then((function(){return e.stopTracking_(r)}),(function(){return e.stopTracking_(r)})),r},shaka.offline.indexeddb.DBConnection.prototype.stopTracking_=function(a){shaka.util.ArrayUtils.remove(this.pending_,a)},shaka.offline.indexeddb.BaseStorageCell=function(a,b,e){this.connection_=new shaka.offline.indexeddb.DBConnection(a),this.segmentStore_=b,this.manifestStore_=e},shaka.offline.indexeddb.BaseStorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.BaseStorageCell.prototype.hasFixedKeySpace=function(){return!0},shaka.offline.indexeddb.BaseStorageCell.prototype.addSegments=function(a){return this.rejectAdd(this.segmentStore_)},shaka.offline.indexeddb.BaseStorageCell.prototype.removeSegments=function(a,b){return this.remove_(this.segmentStore_,a,b)},shaka.offline.indexeddb.BaseStorageCell.prototype.getSegments=function(a){var e,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?t.yield(b.get_(b.segmentStore_,a),2):(e=t.yieldResult,t.return(e.map((function(a){return b.convertSegmentData(a)}))))}))},shaka.offline.indexeddb.BaseStorageCell.prototype.addManifests=function(a){return this.rejectAdd(this.manifestStore_)},shaka.offline.indexeddb.BaseStorageCell.prototype.updateManifestExpiration=function(a,b){var e=this.connection_.startReadWriteOperation(this.manifestStore_),t=e.store();return t.get(a).onsuccess=function(e){(e=e.target.result)&&(e.expiration=b,t.put(e,a))},e.promise()},shaka.offline.indexeddb.BaseStorageCell.prototype.removeManifests=function(a,b){return this.remove_(this.manifestStore_,a,b)},shaka.offline.indexeddb.BaseStorageCell.prototype.getManifests=function(a){var e,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?t.yield(b.get_(b.manifestStore_,a),2):(e=t.yieldResult,t.return(Promise.all(e.map((function(a){return b.convertManifest(a)})))))}))},shaka.offline.indexeddb.BaseStorageCell.prototype.getAllManifests=function(){var b,e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(b=a.connection_.startReadOnlyOperation(a.manifestStore_),e=new Map,t.yield(b.forEachEntry((function(b,t){var r;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){if(1==n.nextAddress)return n.yield(a.convertManifest(t),2);r=n.yieldResult,e.set(b,r),n.jumpToEnd()}))})),2)):3!=t.nextAddress?t.yield(b.promise(),3):t.return(e)}))},shaka.offline.indexeddb.BaseStorageCell.prototype.convertSegmentData=function(a){return a},shaka.offline.indexeddb.BaseStorageCell.prototype.convertManifest=function(a){return Promise.resolve(a)},shaka.offline.indexeddb.BaseStorageCell.prototype.rejectAdd=function(a){return Promise.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NEW_KEY_OPERATION_NOT_SUPPORTED,"Cannot add new value to "+a))},shaka.offline.indexeddb.BaseStorageCell.prototype.add=function(a,b){var e,t,r,g,n,o,l,h=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(d){if(1==d.nextAddress){for(e=h.connection_.startReadWriteOperation(a),t=e.store(),r=[],g={},n=$jscomp.makeIterator(b),o=n.next();!o.done;g={$jscomp$loop$prop$request$562:g.$jscomp$loop$prop$request$562},o=n.next())l=o.value,g.$jscomp$loop$prop$request$562=t.add(l),g.$jscomp$loop$prop$request$562.onsuccess=function(a){return function(b){r.push(a.$jscomp$loop$prop$request$562.result)}}(g);return d.yield(e.promise(),2)}return d.return(r)}))},shaka.offline.indexeddb.BaseStorageCell.prototype.remove_=function(a,b,e){for(var t=(a=this.connection_.startReadWriteOperation(a)).store(),r={},n=(b=$jscomp.makeIterator(b)).next();!n.done;r={$jscomp$loop$prop$key$564:r.$jscomp$loop$prop$key$564},n=b.next())r.$jscomp$loop$prop$key$564=n.value,t.delete(r.$jscomp$loop$prop$key$564).onsuccess=function(a){return function(){return e(a.$jscomp$loop$prop$key$564)}}(r);return a.promise()},shaka.offline.indexeddb.BaseStorageCell.prototype.get_=function(a,b){var e,t,r,g,n,o,l,h=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(d){if(1==d.nextAddress){for(e=h.connection_.startReadOnlyOperation(a),t=e.store(),r={},g=[],n={},o=$jscomp.makeIterator(b),l=o.next();!l.done;n={$jscomp$loop$prop$request$566:n.$jscomp$loop$prop$request$566,$jscomp$loop$prop$key$567:n.$jscomp$loop$prop$key$567},l=o.next())n.$jscomp$loop$prop$key$567=l.value,n.$jscomp$loop$prop$request$566=t.get(n.$jscomp$loop$prop$key$567),n.$jscomp$loop$prop$request$566.onsuccess=function(a){return function(){null==a.$jscomp$loop$prop$request$566.result&&g.push(a.$jscomp$loop$prop$key$567),r[a.$jscomp$loop$prop$key$567]=a.$jscomp$loop$prop$request$566.result}}(n);return d.yield(e.promise(),2)}if(g.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+g);return d.return(b.map((function(a){return r[a]})))}))},shaka.offline.indexeddb.EmeSessionStorageCell=function(a,b){this.connection_=new shaka.offline.indexeddb.DBConnection(a),this.store_=b},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.destroy=function(){return this.connection_.destroy()},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.getAll=function(){var b,e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(b=a.connection_.startReadOnlyOperation(a.store_),e=[],t.yield(b.forEachEntry((function(a,b){e.push(b)})),2)):3!=t.nextAddress?t.yield(b.promise(),3):t.return(e)}))},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.add=function(a){for(var b=this.connection_.startReadWriteOperation(this.store_),e=b.store(),t=(a=$jscomp.makeIterator(a)).next();!t.done;t=a.next())e.add(t.value);return b.promise()},shaka.offline.indexeddb.EmeSessionStorageCell.prototype.remove=function(a){var e,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(e=b.connection_.startReadWriteOperation(b.store_),t.yield(e.forEachEntry((function(b,e,t){a.includes(e.sessionId)&&t.delete()})),2)):t.yield(e.promise(),0)}))},shaka.offline.StorageMuxer=function(){this.mechanisms_=new Map},shaka.offline.StorageMuxer.prototype.destroy=function(){for(var a=[],b=$jscomp.makeIterator(this.mechanisms_.values()),e=b.next();!e.done;e=b.next())a.push(e.value.destroy());return this.mechanisms_.clear(),Promise.all(a)},shaka.offline.StorageMuxer.prototype.init=function(){var a=this;shaka.offline.StorageMuxer.getRegistry_().forEach((function(b,e){var t=b();t?a.mechanisms_.set(e,t):shaka.log.info("Skipping "+e+" as it is not supported on this platform")}));for(var b=[],e=$jscomp.makeIterator(this.mechanisms_.values()),t=e.next();!t.done;t=e.next())b.push(t.value.init());return Promise.all(b)},shaka.offline.StorageMuxer.prototype.getActive=function(){var a=null;if(this.mechanisms_.forEach((function(b,e){b.getCells().forEach((function(b,t){b.hasFixedKeySpace()||a||(a={path:{mechanism:e,cell:t},cell:b})}))})),a)return a;throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find a cell that supports add-operations")},shaka.offline.StorageMuxer.prototype.forEachCell=function(a){this.mechanisms_.forEach((function(b,e){b.getCells().forEach((function(b,t){a({mechanism:e,cell:t},b)}))}))},shaka.offline.StorageMuxer.prototype.getCell=function(a,b){var e=this.mechanisms_.get(a);if(!e)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find mechanism with name "+a);if(!(e=e.getCells().get(b)))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MISSING_STORAGE_CELL,"Could not find cell with name "+b);return e},shaka.offline.StorageMuxer.prototype.forEachEmeSessionCell=function(a){this.mechanisms_.forEach((function(b,e){a(b.getEmeSessionCell())}))},shaka.offline.StorageMuxer.prototype.getEmeSessionCell=function(){var a=Array.from(this.mechanisms_.keys());if(!a.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_NOT_SUPPORTED,"No supported storage mechanisms found");return this.mechanisms_.get(a[0]).getEmeSessionCell()},shaka.offline.StorageMuxer.prototype.resolvePath=function(a){var b=this.mechanisms_.get(a.mechanism);return b?b.getCells().get(a.cell):null},shaka.offline.StorageMuxer.prototype.erase=function(){var b,e,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(b=Array.from(a.mechanisms_.values()),(e=0<b.length)||shaka.offline.StorageMuxer.getRegistry_().forEach((function(a,e){var t=a();t&&b.push(t)})),t.yield(Promise.all(b.map((function(a){return a.erase()}))),2)):e?t.jumpTo(0):t.yield(Promise.all(b.map((function(a){return a.destroy()}))),0)}))},shaka.offline.StorageMuxer.register=function(a,b){shaka.offline.StorageMuxer.registry_.set(a,b)},shaka.offline.StorageMuxer.unregister=function(a){shaka.offline.StorageMuxer.registry_.delete(a)},shaka.offline.StorageMuxer.support=function(){for(var a=shaka.offline.StorageMuxer.getRegistry_(),b=(a=$jscomp.makeIterator(a.values())).next();!b.done;b=a.next())if(b=(b=b.value)())return b.destroy(),!0;return!1},shaka.offline.StorageMuxer.overrideSupport=function(a){shaka.offline.StorageMuxer.override_=a},shaka.offline.StorageMuxer.clearOverride=function(){shaka.offline.StorageMuxer.override_=null},shaka.offline.StorageMuxer.getRegistry_=function(){var a=shaka.offline.StorageMuxer.override_,b=shaka.offline.StorageMuxer.registry_;return COMPILED?b:a||b},goog.exportSymbol("shaka.offline.StorageMuxer",shaka.offline.StorageMuxer),goog.exportProperty(shaka.offline.StorageMuxer,"unregister",shaka.offline.StorageMuxer.unregister),goog.exportProperty(shaka.offline.StorageMuxer,"register",shaka.offline.StorageMuxer.register),goog.exportProperty(shaka.offline.StorageMuxer.prototype,"destroy",shaka.offline.StorageMuxer.prototype.destroy),shaka.offline.StorageMuxer.override_=null,shaka.offline.StorageMuxer.registry_=new Map,shaka.offline.indexeddb.V1StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V1StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V1StorageCell.prototype.updateManifestExpiration=function(a,b){var e,t,r,n=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(g){return e=n.connection_.startReadWriteOperation(n.manifestStore_),t=e.store(),r=new shaka.util.PublicPromise,t.get(a).onsuccess=function(e){(e=e.target.result)?(goog.asserts.assert(e.key==a,"With in-line keys, the keys should match"),e.expiration=b,t.put(e),r.resolve()):r.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.KEY_NOT_FOUND,"Could not find values for "+a))},g.yield(Promise.all([e.promise(),r]),0)}))},shaka.offline.indexeddb.V1StorageCell.prototype.convertManifest=function(a){var b,e,t,r,n,g,o;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){if(1==l.nextAddress){for(b=shaka.offline.indexeddb.V1StorageCell,e=[],t=0;t<a.periods.length;++t)r=t==a.periods.length-1?a.duration:a.periods[t+1].startTime,n=r-a.periods[t].startTime,g=b.convertPeriod_(a.periods[t],n),e.push(g);return l.yield(shaka.util.PeriodCombiner.combineDbStreams(e),2)}return o=l.yieldResult,l.return({creationTime:0,originalManifestUri:a.originalManifestUri,duration:a.duration,size:a.size,expiration:null==a.expiration?1/0:a.expiration,streams:o,sessionIds:a.sessionIds,drmInfo:a.drmInfo,appMetadata:a.appMetadata})}))},shaka.offline.indexeddb.V1StorageCell.convertPeriod_=function(a,b){var e=shaka.offline.indexeddb.V1StorageCell;e.fillMissingVariants_(a);for(var t=$jscomp.makeIterator(a.streams),r=t.next();!r.done;r=t.next())goog.asserts.assert(r.value.variantIds,"After filling in missing variants, each stream should have variant ids");return a.streams.map((function(t){return e.convertStream_(t,a.startTime,b)}))},shaka.offline.indexeddb.V1StorageCell.convertStream_=function(a,b,e){var t=shaka.offline.indexeddb.V1StorageCell,r=a.initSegmentUri?t.getKeyFromSegmentUri_(a.initSegmentUri):null,n=b+a.presentationTimeOffset,g=b+e;return{id:a.id,originalId:null,primary:a.primary,type:a.contentType,mimeType:a.mimeType,codecs:a.codecs,frameRate:a.frameRate,pixelAspectRatio:void 0,kind:a.kind,language:a.language,label:a.label,width:a.width,height:a.height,initSegmentKey:r,encrypted:a.encrypted,keyIds:new Set([a.keyId]),segments:a.segments.map((function(a){return t.convertSegment_(a,r,b,g,n)})),variantIds:a.variantIds,roles:[],audioSamplingRate:null,channelsCount:null,closedCaptions:null}},shaka.offline.indexeddb.V1StorageCell.convertSegment_=function(a,b,e,t,r){var n=shaka.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_(a.uri);return{startTime:e+a.startTime,endTime:e+a.endTime,dataKey:n,initSegmentKey:b,appendWindowStart:e,appendWindowEnd:t,timestampOffset:r}},shaka.offline.indexeddb.V1StorageCell.prototype.convertSegmentData=function(a){return{data:a.data}},shaka.offline.indexeddb.V1StorageCell.getKeyFromSegmentUri_=function(a){var b;if((b=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(a))||(b=/^offline:segment\/([0-9]+)$/.exec(a)))return Number(b[1]);throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,"Could not parse uri "+a)},shaka.offline.indexeddb.V1StorageCell.fillMissingVariants_=function(a){var b=shaka.util.ManifestParserUtils.ContentType.AUDIO,e=shaka.util.ManifestParserUtils.ContentType.VIDEO,t=a.streams.filter((function(a){return a.contentType==b}));if(a=a.streams.filter((function(a){return a.contentType==e})),!t.every((function(a){return a.variantIds}))||!a.every((function(a){return a.variantIds}))){goog.asserts.assert(t.every((function(a){return!a.variantIds})),"Some audio streams have variant ids and some do not."),goog.asserts.assert(a.every((function(a){return!a.variantIds})),"Some video streams have variant ids and some do not.");for(var r=$jscomp.makeIterator(t),n=r.next();!n.done;n=r.next())n.value.variantIds=[];for(n=(r=$jscomp.makeIterator(a)).next();!n.done;n=r.next())n.value.variantIds=[];if(r=0,a.length&&!t.length){shaka.log.debug("Found video-only content. Creating variants for video.");var g=r++,o=$jscomp.makeIterator(a);for(n=o.next();!n.done;n=o.next())n.value.variantIds.push(g)}if(!a.length&&t.length)for(shaka.log.debug("Found audio-only content. Creating variants for audio."),g=r++,n=(o=$jscomp.makeIterator(t)).next();!n.done;n=o.next())n.value.variantIds.push(g);if(a.length&&t.length)for(shaka.log.debug("Found audio-video content. Creating variants."),n=(t=$jscomp.makeIterator(t)).next();!n.done;n=t.next())for(n=n.value,o=(g=$jscomp.makeIterator(a)).next();!o.done;o=g.next()){o=o.value;var l=r++;n.variantIds.push(l),o.variantIds.push(l)}}},shaka.offline.indexeddb.V2StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V2StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V2StorageCell.prototype.convertManifest=function(a){var e,t,r,n,g,o,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){if(1==l.nextAddress){for(e=[],t=0;t<a.periods.length;++t)r=t==a.periods.length-1?a.duration:a.periods[t+1].startTime,n=r-a.periods[t].startTime,g=b.convertPeriod_(a.periods[t],n),e.push(g);return l.yield(shaka.util.PeriodCombiner.combineDbStreams(e),2)}return o=l.yieldResult,l.return({appMetadata:a.appMetadata,creationTime:0,drmInfo:a.drmInfo,duration:a.duration,expiration:null==a.expiration?1/0:a.expiration,originalManifestUri:a.originalManifestUri,sessionIds:a.sessionIds,size:a.size,streams:o})}))},shaka.offline.indexeddb.V2StorageCell.prototype.convertPeriod_=function(a,b){for(var e=[],t=$jscomp.makeIterator(a.streams),r=t.next();!r.done;r=t.next())0!=(r=r.value).variantIds.length&&e.push(this.convertStream_(r,a.startTime,a.startTime+b));return e},shaka.offline.indexeddb.V2StorageCell.prototype.convertStream_=function(a,b,e){var t=this;return{id:a.id,originalId:a.originalId,primary:a.primary,type:a.contentType,mimeType:a.mimeType,codecs:a.codecs,frameRate:a.frameRate,pixelAspectRatio:a.pixelAspectRatio,kind:a.kind,language:a.language,label:a.label,width:a.width,height:a.height,encrypted:a.encrypted,keyIds:new Set([a.keyId]),segments:a.segments.map((function(r){return t.convertSegment_(r,a.initSegmentKey,b,e,a.presentationTimeOffset)})),variantIds:a.variantIds,roles:[],audioSamplingRate:null,channelsCount:null,closedCaptions:null}},shaka.offline.indexeddb.V2StorageCell.prototype.convertSegment_=function(a,b,e,t,r){return{startTime:e+a.startTime,endTime:e+a.endTime,initSegmentKey:b,appendWindowStart:e,appendWindowEnd:t,timestampOffset:e-r,dataKey:a.dataKey}},shaka.offline.indexeddb.V5StorageCell=function(){shaka.offline.indexeddb.BaseStorageCell.apply(this,arguments)},$jscomp.inherits(shaka.offline.indexeddb.V5StorageCell,shaka.offline.indexeddb.BaseStorageCell),shaka.offline.indexeddb.V5StorageCell.prototype.hasFixedKeySpace=function(){return!1},shaka.offline.indexeddb.V5StorageCell.prototype.addSegments=function(a){return this.add(this.segmentStore_,a)},shaka.offline.indexeddb.V5StorageCell.prototype.addManifests=function(a){return this.add(this.manifestStore_,a)},shaka.offline.indexeddb.V5StorageCell.prototype.convertManifest=function(a){return null==a.expiration&&(a.expiration=1/0),Promise.resolve(a)},shaka.offline.indexeddb.StorageMechanism=function(){this.sessions_=this.v5_=this.v3_=this.v2_=this.v1_=this.db_=null},shaka.offline.indexeddb.StorageMechanism.prototype.init=function(){var a=this,b=shaka.offline.indexeddb.StorageMechanism.DB_NAME,e=shaka.offline.indexeddb.StorageMechanism.VERSION,t=new shaka.util.PublicPromise,r=window.indexedDB.open(b,e);return r.onsuccess=function(b){b=r.result,a.db_=b,a.v1_=shaka.offline.indexeddb.StorageMechanism.createV1_(b),a.v2_=shaka.offline.indexeddb.StorageMechanism.createV2_(b),a.v3_=shaka.offline.indexeddb.StorageMechanism.createV3_(b),a.v5_=shaka.offline.indexeddb.StorageMechanism.createV5_(b),a.sessions_=shaka.offline.indexeddb.StorageMechanism.createEmeSessionCell_(b),t.resolve()},r.onupgradeneeded=function(b){a.createStores_(r.result)},r.onerror=function(a){t.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.INDEXED_DB_ERROR,r.error)),a.preventDefault()},t},shaka.offline.indexeddb.StorageMechanism.prototype.destroy=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){switch(b.nextAddress){case 1:if(!a.v1_){b.jumpTo(2);break}return b.yield(a.v1_.destroy(),2);case 2:if(!a.v2_){b.jumpTo(4);break}return b.yield(a.v2_.destroy(),4);case 4:if(!a.v3_){b.jumpTo(6);break}return b.yield(a.v3_.destroy(),6);case 6:if(!a.v5_){b.jumpTo(8);break}return b.yield(a.v5_.destroy(),8);case 8:if(!a.sessions_){b.jumpTo(10);break}return b.yield(a.sessions_.destroy(),10);case 10:a.db_&&a.db_.close(),b.jumpToEnd()}}))},shaka.offline.indexeddb.StorageMechanism.prototype.getCells=function(){var a=new Map;return this.v1_&&a.set("v1",this.v1_),this.v2_&&a.set("v2",this.v2_),this.v3_&&a.set("v3",this.v3_),this.v5_&&a.set("v5",this.v5_),a},shaka.offline.indexeddb.StorageMechanism.prototype.getEmeSessionCell=function(){return goog.asserts.assert(this.sessions_,"Cannot be destroyed."),this.sessions_},shaka.offline.indexeddb.StorageMechanism.prototype.erase=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){switch(b.nextAddress){case 1:if(!a.v1_){b.jumpTo(2);break}return b.yield(a.v1_.destroy(),2);case 2:if(!a.v2_){b.jumpTo(4);break}return b.yield(a.v2_.destroy(),4);case 4:if(!a.v3_){b.jumpTo(6);break}return b.yield(a.v3_.destroy(),6);case 6:if(!a.v5_){b.jumpTo(8);break}return b.yield(a.v5_.destroy(),8);case 8:return a.db_&&a.db_.close(),b.yield(shaka.offline.indexeddb.StorageMechanism.deleteAll_(),10);case 10:return a.db_=null,a.v1_=null,a.v2_=null,a.v3_=null,a.v5_=null,b.yield(a.init(),0)}}))},shaka.offline.indexeddb.StorageMechanism.createV1_=function(a){var b=shaka.offline.indexeddb.StorageMechanism,e=b.V1_SEGMENT_STORE;b=b.V1_MANIFEST_STORE;var t=a.objectStoreNames;return t.contains(b)&&t.contains(e)?(shaka.log.debug("Mounting v1 idb storage cell"),new shaka.offline.indexeddb.V1StorageCell(a,e,b)):null},shaka.offline.indexeddb.StorageMechanism.createV2_=function(a){var b=shaka.offline.indexeddb.StorageMechanism,e=b.V2_SEGMENT_STORE;b=b.V2_MANIFEST_STORE;var t=a.objectStoreNames;return t.contains(b)&&t.contains(e)?(shaka.log.debug("Mounting v2 idb storage cell"),new shaka.offline.indexeddb.V2StorageCell(a,e,b)):null},shaka.offline.indexeddb.StorageMechanism.createV3_=function(a){var b=shaka.offline.indexeddb.StorageMechanism,e=b.V3_SEGMENT_STORE;b=b.V3_MANIFEST_STORE;var t=a.objectStoreNames;return t.contains(b)&&t.contains(e)?(shaka.log.debug("Mounting v3 idb storage cell"),new shaka.offline.indexeddb.V2StorageCell(a,e,b)):null},shaka.offline.indexeddb.StorageMechanism.createV5_=function(a){var b=shaka.offline.indexeddb.StorageMechanism,e=b.V5_SEGMENT_STORE;b=b.V5_MANIFEST_STORE;var t=a.objectStoreNames;return t.contains(b)&&t.contains(e)?(shaka.log.debug("Mounting v5 idb storage cell"),new shaka.offline.indexeddb.V5StorageCell(a,e,b)):null},shaka.offline.indexeddb.StorageMechanism.createEmeSessionCell_=function(a){var b=shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE;return a.objectStoreNames.contains(b)?(shaka.log.debug("Mounting session ID idb storage cell"),new shaka.offline.indexeddb.EmeSessionStorageCell(a,b)):null},shaka.offline.indexeddb.StorageMechanism.prototype.createStores_=function(a){for(var b=$jscomp.makeIterator([shaka.offline.indexeddb.StorageMechanism.V5_SEGMENT_STORE,shaka.offline.indexeddb.StorageMechanism.V5_MANIFEST_STORE,shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE]),e=b.next();!e.done;e=b.next())e=e.value,a.objectStoreNames.contains(e)||a.createObjectStore(e,{autoIncrement:!0})},shaka.offline.indexeddb.StorageMechanism.deleteAll_=function(){var a=shaka.offline.indexeddb.StorageMechanism.DB_NAME,b=new shaka.util.PublicPromise,e=window.indexedDB.deleteDatabase(a);return e.onblocked=function(b){shaka.log.warning("Deleting",a,"is being blocked")},e.onsuccess=function(a){b.resolve()},e.onerror=function(a){b.reject(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.INDEXED_DB_ERROR,e.error)),a.preventDefault()},b},shaka.offline.indexeddb.StorageMechanism.DB_NAME="shaka_offline_db",shaka.offline.indexeddb.StorageMechanism.VERSION=5,shaka.offline.indexeddb.StorageMechanism.V1_SEGMENT_STORE="segment",shaka.offline.indexeddb.StorageMechanism.V2_SEGMENT_STORE="segment-v2",shaka.offline.indexeddb.StorageMechanism.V3_SEGMENT_STORE="segment-v3",shaka.offline.indexeddb.StorageMechanism.V5_SEGMENT_STORE="segment-v5",shaka.offline.indexeddb.StorageMechanism.V1_MANIFEST_STORE="manifest",shaka.offline.indexeddb.StorageMechanism.V2_MANIFEST_STORE="manifest-v2",shaka.offline.indexeddb.StorageMechanism.V3_MANIFEST_STORE="manifest-v3",shaka.offline.indexeddb.StorageMechanism.V5_MANIFEST_STORE="manifest-v5",shaka.offline.indexeddb.StorageMechanism.SESSION_ID_STORE="session-ids",shaka.offline.StorageMuxer.register("idb",(function(){return window.indexedDB?new shaka.offline.indexeddb.StorageMechanism:null})),shaka.offline.OfflineUri=function(a,b,e,t){this.type_=a,this.mechanism_=b,this.cell_=e,this.key_=t,this.asString_=["offline:",a,"/",b,"/",e,"/",t].join("")},shaka.offline.OfflineUri.prototype.isManifest=function(){return"manifest"==this.type_},shaka.offline.OfflineUri.prototype.isSegment=function(){return"segment"==this.type_},shaka.offline.OfflineUri.prototype.mechanism=function(){return this.mechanism_},shaka.offline.OfflineUri.prototype.cell=function(){return this.cell_},shaka.offline.OfflineUri.prototype.key=function(){return this.key_},shaka.offline.OfflineUri.prototype.toString=function(){return this.asString_},shaka.offline.OfflineUri.parse=function(a){if(null==(a=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(a)))return null;var b=a[1];if("manifest"!=b&&"segment"!=b)return null;var e=a[2];if(!e)return null;var t=a[3];return t&&null!=b?new shaka.offline.OfflineUri(b,e,t,Number(a[4])):null},shaka.offline.OfflineUri.manifest=function(a,b,e){return new shaka.offline.OfflineUri("manifest",a,b,e)},shaka.offline.OfflineUri.segment=function(a,b,e){return new shaka.offline.OfflineUri("segment",a,b,e)},shaka.offline.ManifestConverter=function(a,b){this.mechanism_=a,this.cell_=b},shaka.offline.ManifestConverter.prototype.fromManifestDB=function(a){var b=this,e=new shaka.media.PresentationTimeline(null,0);e.setDuration(a.duration);var t=a.streams.filter((function(a){return b.isAudio_(a)})),r=a.streams.filter((function(a){return b.isVideo_(a)}));t=this.createVariants(t,r,e),r=a.streams.filter((function(a){return b.isText_(a)})).map((function(a){return b.fromStreamDB_(a,e)}));var n=a.drmInfo?[a.drmInfo]:[];if(a.drmInfo)for(var g=$jscomp.makeIterator(t.values()),o=g.next();!o.done;o=g.next())(o=o.value).audio&&o.audio.encrypted&&(o.audio.drmInfos=n),o.video&&o.video.encrypted&&(o.video.drmInfos=n);return{presentationTimeline:e,minBufferTime:2,offlineSessionIds:a.sessionIds,variants:Array.from(t.values()),textStreams:r}},shaka.offline.ManifestConverter.prototype.createVariants=function(a,b,e){for(var t=new Set,r=$jscomp.makeIterator(a),n=r.next();!n.done;n=r.next()){var g=$jscomp.makeIterator(n.value.variantIds);for(n=g.next();!n.done;n=g.next())t.add(n.value)}for(n=(r=$jscomp.makeIterator(b)).next();!n.done;n=r.next())for(n=(g=$jscomp.makeIterator(n.value.variantIds)).next();!n.done;n=g.next())t.add(n.value);for(r=new Map,n=(t=$jscomp.makeIterator(t)).next();!n.done;n=t.next())n=n.value,r.set(n,this.createEmptyVariant_(n));for(t=(a=$jscomp.makeIterator(a)).next();!t.done;t=a.next())for(t=t.value,n=this.fromStreamDB_(t,e),t=(g=$jscomp.makeIterator(t.variantIds)).next();!t.done;t=g.next())t=r.get(t.value),goog.asserts.assert(!t.audio,"A variant should only have one audio stream"),t.language=n.language,t.primary=t.primary||n.primary,t.audio=n;for(a=(b=$jscomp.makeIterator(b)).next();!a.done;a=b.next())for(t=a.value,a=this.fromStreamDB_(t,e),t=(n=$jscomp.makeIterator(t.variantIds)).next();!t.done;t=n.next())t=r.get(t.value),goog.asserts.assert(!t.video,"A variant should only have one video stream"),t.primary=t.primary||a.primary,t.video=a;return r},shaka.offline.ManifestConverter.prototype.fromStreamDB_=function(a,b){var e=this,t=a.segments.map((function(a,b){return e.fromSegmentDB_(b,a)}));return b.notifySegments(t),t=new shaka.media.SegmentIndex(t),{id:a.id,originalId:a.originalId,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:t,mimeType:a.mimeType,codecs:a.codecs,width:a.width||void 0,height:a.height||void 0,frameRate:a.frameRate,pixelAspectRatio:a.pixelAspectRatio,kind:a.kind,encrypted:a.encrypted,drmInfos:[],keyIds:a.keyIds,language:a.language,label:a.label,type:a.type,primary:a.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:a.roles,channelsCount:a.channelsCount,audioSamplingRate:a.audioSamplingRate,closedCaptions:a.closedCaptions}},shaka.offline.ManifestConverter.prototype.fromSegmentDB_=function(a,b){var e=shaka.offline.OfflineUri.segment(this.mechanism_,this.cell_,b.dataKey),t=null!=b.initSegmentKey?this.fromInitSegmentDB_(b.initSegmentKey):null;return new shaka.media.SegmentReference(b.startTime,b.endTime,(function(){return[e.toString()]}),0,null,t,b.timestampOffset,b.appendWindowStart,b.appendWindowEnd)},shaka.offline.ManifestConverter.prototype.fromInitSegmentDB_=function(a){var b=shaka.offline.OfflineUri.segment(this.mechanism_,this.cell_,a);return new shaka.media.InitSegmentReference((function(){return[b.toString()]}),0,null)},shaka.offline.ManifestConverter.prototype.isAudio_=function(a){return a.type==shaka.util.ManifestParserUtils.ContentType.AUDIO},shaka.offline.ManifestConverter.prototype.isVideo_=function(a){return a.type==shaka.util.ManifestParserUtils.ContentType.VIDEO},shaka.offline.ManifestConverter.prototype.isText_=function(a){return a.type==shaka.util.ManifestParserUtils.ContentType.TEXT},shaka.offline.ManifestConverter.prototype.createEmptyVariant_=function(a){return{id:a,language:"",primary:!1,audio:null,video:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0}},shaka.offline.OfflineManifestParser=function(){this.uri_=null},shaka.offline.OfflineManifestParser.prototype.configure=function(a){},shaka.offline.OfflineManifestParser.prototype.start=function(a,b){var e,t,r,g,n,o,l=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){switch(b.nextAddress){case 1:if(e=shaka.offline.OfflineUri.parse(a),l.uri_=e,null==e||!e.isManifest())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,a);return t=new shaka.offline.StorageMuxer,b.setFinallyBlock(2),b.yield(t.init(),4);case 4:return b.yield(t.getCell(e.mechanism(),e.cell()),5);case 5:return r=b.yieldResult,b.yield(r.getManifests([e.key()]),6);case 6:return g=b.yieldResult,n=g[0],o=new shaka.offline.ManifestConverter(e.mechanism(),e.cell()),b.return(o.fromManifestDB(n));case 2:return b.enterFinallyBlock(),b.yield(t.destroy(),7);case 7:b.leaveFinallyBlock(0)}}))},shaka.offline.OfflineManifestParser.prototype.stop=function(){return Promise.resolve()},shaka.offline.OfflineManifestParser.prototype.update=function(){},shaka.offline.OfflineManifestParser.prototype.onExpirationUpdated=function(a,b){var e,t,r,g,n,o,l,h,d=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(c){switch(c.nextAddress){case 1:return goog.asserts.assert(d.uri_,"Should not get update event before start has been called"),e=d.uri_,t=new shaka.offline.StorageMuxer,c.setCatchFinallyBlocks(2,3),c.yield(t.init(),5);case 5:return c.yield(t.getCell(e.mechanism(),e.cell()),6);case 6:return r=c.yieldResult,c.yield(r.getManifests([e.key()]),7);case 7:if(g=c.yieldResult,n=g[0],o=n.sessionIds.includes(a),l=null==n.expiration||n.expiration>b,!o||!l){c.jumpTo(3);break}return shaka.log.debug("Updating expiration for stored content"),c.yield(r.updateManifestExpiration(e.key(),b),3);case 3:return c.enterFinallyBlock(),c.yield(t.destroy(),10);case 10:c.leaveFinallyBlock(0);break;case 2:h=c.enterCatchBlock(),shaka.log.error("There was an error updating",e,h),c.jumpTo(3)}}))},shaka.media.ManifestParser.registerParserByMime("application/x-offline-manifest",(function(){return new shaka.offline.OfflineManifestParser})),shaka.offline.OfflineScheme=function(){},shaka.offline.OfflineScheme.plugin=function(a,b,e,t){return(b=shaka.offline.OfflineUri.parse(a))&&b.isManifest()?shaka.offline.OfflineScheme.getManifest_(a):b&&b.isSegment()?shaka.offline.OfflineScheme.getSegment_(b.key(),b):shaka.util.AbortableOperation.failed(new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.NETWORK,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,a))},shaka.offline.OfflineScheme.getManifest_=function(a){return a={uri:a,originalUri:a,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}},shaka.util.AbortableOperation.completed(a)},shaka.offline.OfflineScheme.getSegment_=function(a,b){goog.asserts.assert(b.isSegment(),"Only segment uri's should be given to getSegment");var e=new shaka.offline.StorageMuxer;return shaka.util.AbortableOperation.completed(void 0).chain((function(){return e.init()})).chain((function(){return e.getCell(b.mechanism(),b.cell())})).chain((function(a){return a.getSegments([b.key()])})).chain((function(a){return{uri:b,data:a[0].data,headers:{}}})).finally((function(){return e.destroy()}))},goog.exportSymbol("shaka.offline.OfflineScheme",shaka.offline.OfflineScheme),goog.exportProperty(shaka.offline.OfflineScheme,"plugin",shaka.offline.OfflineScheme.plugin),shaka.net.NetworkingEngine.registerScheme("offline",shaka.offline.OfflineScheme.plugin),shaka.offline.SessionDeleter=function(){},shaka.offline.SessionDeleter.prototype.delete=function(a,b,e){var t,r,g,n,o,l,h,d=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(c){switch(c.nextAddress){case 1:t=shaka.offline.SessionDeleter,r=[],g=$jscomp.makeIterator(t.createBuckets_(e)),n=g.next();case 2:if(n.done){c.jumpTo(4);break}return o=n.value,l=d.doDelete_(a,b,o),c.yield(l,5);case 5:h=c.yieldResult,r=r.concat(h),n=g.next(),c.jumpTo(2);break;case 4:return c.return(r)}}))},shaka.offline.SessionDeleter.prototype.doDelete_=function(a,b,e){var t,r,n,g;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){switch(o.nextAddress){case 1:return t=new shaka.media.DrmEngine({netEngine:b,onError:function(){},onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),o.setCatchFinallyBlocks(2),t.configure(a),o.yield(t.initForRemoval(e.info.keySystem,e.info.licenseUri,e.info.serverCertificate,e.info.audioCapabilities,e.info.videoCapabilities),4);case 4:o.leaveTryBlock(3);break;case 2:return r=o.enterCatchBlock(),shaka.log.warning("Error initializing EME",r),o.yield(t.destroy(),5);case 5:return o.return([]);case 3:return o.setCatchFinallyBlocks(6),o.yield(t.setServerCertificate(),8);case 8:o.leaveTryBlock(7);break;case 6:return n=o.enterCatchBlock(),shaka.log.warning("Error setting server certificate",n),o.yield(t.destroy(),9);case 9:return o.return([]);case 7:return g=[],o.yield(Promise.all(e.sessionIds.map((function(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?(e.setCatchFinallyBlocks(2),e.yield(t.removeSession(a),4)):2!=e.nextAddress?(g.push(a),e.leaveTryBlock(0)):(b=e.enterCatchBlock(),shaka.log.warning("Error deleting offline session",b),void e.jumpToEnd())}))}))),10);case 10:return o.yield(t.destroy(),11);case 11:return o.return(g)}}))},shaka.offline.SessionDeleter.createBuckets_=function(a){for(var b=shaka.offline.SessionDeleter,e=[],t=(a=$jscomp.makeIterator(a)).next();!t.done;t=a.next()){t=t.value;for(var r=!1,n=$jscomp.makeIterator(e),g=n.next();!g.done;g=n.next())if(g=g.value,b.isCompatible_(g.info,t)){g.sessionIds.push(t.sessionId),r=!0;break}r||e.push({info:t,sessionIds:[t.sessionId]})}return e},shaka.offline.SessionDeleter.isCompatible_=function(a,b){var e=shaka.util.ArrayUtils,t=function(a,b){return a.robustness==b.robustness&&a.contentType==b.contentType};return a.keySystem==b.keySystem&&a.licenseUri==b.licenseUri&&e.hasSameElements(a.audioCapabilities,b.audioCapabilities,t)&&e.hasSameElements(a.videoCapabilities,b.videoCapabilities,t)},shaka.offline.StoredContentUtils=function(){},shaka.offline.StoredContentUtils.fromManifest=function(a,b,e,t){return goog.asserts.assert(b.variants.length,"Cannot create stored content from manifest with no variants."),{offlineUri:null,originalManifestUri:a,duration:b.presentationTimeline.getDuration(),size:e,expiration:1/0,tracks:b=shaka.offline.StoredContentUtils.getTracks_(b),appMetadata:t}},shaka.offline.StoredContentUtils.fromManifestDB=function(a,b){goog.asserts.assert(b.streams.length,"Cannot create stored content from manifestDB with no streams.");var e=new shaka.offline.ManifestConverter(a.mechanism(),a.cell()).fromManifestDB(b),t=b.appMetadata||{};return e=shaka.offline.StoredContentUtils.getTracks_(e),goog.asserts.assert(null!=b.expiration,"Manifest expiration must be set by now!"),{offlineUri:a.toString(),originalManifestUri:b.originalManifestUri,duration:b.duration,size:b.size,expiration:b.expiration,tracks:e,appMetadata:t}},shaka.offline.StoredContentUtils.getTracks_=function(a){for(var b=shaka.util.StreamUtils,e=[],t=b.getPlayableVariants(a.variants),r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())e.push(b.variantToTrack(r.value));for(t=(a=$jscomp.makeIterator(a.textStreams)).next();!t.done;t=a.next())e.push(b.textStreamToTrack(t.value));return e},shaka.offline.StreamBandwidthEstimator=function(){this.estimateByStreamId_={}},shaka.offline.StreamBandwidthEstimator.prototype.addVariant=function(a){var b=a.audio,e=a.video;if(b&&!e&&this.setBitrate_(b.id,b.bandwidth||a.bandwidth),!b&&e&&this.setBitrate_(e.id,e.bandwidth||a.bandwidth),b&&e){var t=b.bandwidth||shaka.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_,r=e.bandwidth||a.bandwidth-t;0>=r&&(shaka.log.warning("Audio bit rate consumes variants bandwidth. Setting video bandwidth to match variant's bandwidth."),r=a.bandwidth),this.setBitrate_(b.id,t),this.setBitrate_(e.id,r)}},shaka.offline.StreamBandwidthEstimator.prototype.setBitrate_=function(a,b){this.estimateByStreamId_[a]=b},shaka.offline.StreamBandwidthEstimator.prototype.addText=function(a){this.estimateByStreamId_[a.id]=shaka.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_},shaka.offline.StreamBandwidthEstimator.prototype.getSegmentEstimate=function(a,b){var e=b.endTime-b.startTime;return this.getEstimate_(a)*e},shaka.offline.StreamBandwidthEstimator.prototype.getInitSegmentEstimate=function(a){return.5*this.getEstimate_(a)},shaka.offline.StreamBandwidthEstimator.prototype.getEstimate_=function(a){return null==(a=this.estimateByStreamId_[a])&&(a=0,shaka.log.error("Asking for bitrate of stream not given to the estimator")),0==a&&shaka.log.warning("Using bitrate of 0, this stream won't affect progress"),a},shaka.offline.StreamBandwidthEstimator.DEFAULT_AUDIO_BITRATE_=393216,shaka.offline.StreamBandwidthEstimator.DEFAULT_TEXT_BITRATE_=52,shaka.util.ManifestFilter=function(){},shaka.util.ManifestFilter.filterByRestrictions=function(a,b,e){a.variants=a.variants.filter((function(a){return shaka.util.StreamUtils.meetsRestrictions(a,b,e)}))},shaka.util.ManifestFilter.filterByMediaSourceSupport=function(a){var b=shaka.media.MediaSourceEngine;a.variants=a.variants.filter((function(a){var e=!0;return a.audio&&(e=e&&b.isStreamSupported(a.audio)),a.video&&(e=e&&b.isStreamSupported(a.video)),e}))},shaka.util.ManifestFilter.filterByDrmSupport=function(a,b){a.variants=a.variants.filter((function(a){return b.supportsVariant(a)}))},shaka.offline.Storage=function(a){var b=this;if(a&&a.constructor!=shaka.Player)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.LOCAL_PLAYER_INSTANCE_REQUIRED);this.networkingEngine_=this.config_=null,a?(this.config_=a.getSharedConfiguration(),this.networkingEngine_=a.getNetworkingEngine(),goog.asserts.assert(this.networkingEngine_,"Storage should not be initialized with a player that had |destroy| called on it.")):(this.config_=shaka.util.PlayerConfiguration.createDefault(),this.networkingEngine_=new shaka.net.NetworkingEngine),this.segmentsFromStore_=[],this.openOperations_=[],this.openDownloadManagers_=[],this.initSegmentDbKeyCache_=new Map,this.initSegmentDbKeyCache_.set(null,Promise.resolve(null)),this.segmentDbKeyCache_=new Map;var e=!a;this.destroyer_=new shaka.util.Destroyer((function(){var a,t,r,g,n;return $jscomp.asyncExecutePromiseGeneratorProgram((function(o){switch(o.nextAddress){case 1:return o.yield(Promise.all(b.openDownloadManagers_.map((function(a){return a.abortAll()}))),2);case 2:for(a=function(){},t=[],r=$jscomp.makeIterator(b.openOperations_),g=r.next();!g.done;g=r.next())n=g.value,t.push(n.then(a,a));return o.yield(Promise.all(t),3);case 3:if(!e){o.jumpTo(4);break}return o.yield(b.networkingEngine_.destroy(),4);case 4:b.config_=null,b.networkingEngine_=null,o.jumpToEnd()}}))}))},shaka.offline.Storage.support=function(){return!!shaka.util.Platform.supportsMediaSource()&&shaka.offline.StorageMuxer.support()},shaka.offline.Storage.prototype.destroy=function(){return this.destroyer_.destroy()},shaka.offline.Storage.prototype.configure=function(a,b){return goog.asserts.assert("object"==typeof a||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof a&&(a=shaka.util.ConfigUtils.convertToConfigObject(a,b)),goog.asserts.assert("object"==typeof a,"Should be an object!"),a.manifest&&a.manifest.dash&&"defaultPresentationDelay"in a.manifest.dash&&(shaka.Deprecate.deprecateFeature(4,"manifest.dash.defaultPresentationDelay configuration","Please Use manifest.defaultPresentationDelay instead."),a.manifest.defaultPresentationDelay=a.manifest.dash.defaultPresentationDelay,delete a.manifest.dash.defaultPresentationDelay),goog.asserts.assert(this.config_,"Cannot reconfigure stroage after calling destroy."),shaka.util.PlayerConfiguration.mergeConfigObjects(this.config_,a)},shaka.offline.Storage.prototype.getConfiguration=function(){goog.asserts.assert(this.config_,"Config must not be null!");var a=shaka.util.PlayerConfiguration.createDefault();return shaka.util.PlayerConfiguration.mergeConfigObjects(a,this.config_,shaka.util.PlayerConfiguration.createDefault()),a},shaka.offline.Storage.prototype.getNetworkingEngine=function(){return this.networkingEngine_},shaka.offline.Storage.prototype.store=function(a,b,e){var t=this;goog.asserts.assert(this.networkingEngine_,"Cannot call |downloadManifest_| after calling |destroy|.");var r=this.getConfiguration(),n=new shaka.offline.DownloadManager(this.networkingEngine_);this.openDownloadManagers_.push(n),b=this.store_(a,b||{},(function(){var b;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){return 1==n.nextAddress?(goog.asserts.assert(t.networkingEngine_,"Should not call |store| after |destroy|"),n.yield(shaka.media.ManifestParser.getFactory(a,t.networkingEngine_,r.manifest.retryParameters,e||null),2)):(b=n.yieldResult,n.return(shaka.util.Functional.callFactory(b)))}))}),r,n);var g=new shaka.util.AbortableOperation(b,(function(){return n.abortAll()}));return g.finally((function(){shaka.util.ArrayUtils.remove(t.openDownloadManagers_,n)})),g.then=function(a){return shaka.Deprecate.deprecateFeature(4,"shaka.offline.Storage.store.then","Storage operations now return a shaka.util.AbortableOperation, rather than a promise.  Please update to conform to this new API; you can use the |chain| method instead."),g.promise.then(a)},this.startAbortableOperation_(g)},shaka.offline.Storage.prototype.getStoreInProgress=function(){return shaka.Deprecate.deprecateFeature(4,"shaka.offline.Storage.getStoreInProgress","Multiple concurrent downloads are now supported."),!1},shaka.offline.Storage.prototype.store_=function(a,b,e,t,r){var g,n,o,l,h,d,q,c,u,m,f=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(_){switch(_.nextAddress){case 1:return f.requireSupport_(),n=g=null,o=new shaka.offline.StorageMuxer,h=l=null,_.setCatchFinallyBlocks(2,3),_.yield(e(),5);case 5:return g=_.yieldResult,_.yield(f.parseManifest(a,g,t),6);case 6:if(d=_.yieldResult,f.ensureNotDestroyed_(),!(!d.presentationTimeline.isLive()&&!d.presentationTimeline.isInProgress()))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.CANNOT_STORE_LIVE_OFFLINE,a);return _.yield(f.createDrmEngine(d,(function(a){h=h||a}),t),7);case 7:if(n=_.yieldResult,f.ensureNotDestroyed_(),h)throw h;return _.yield(f.filterManifest_(d,n,t),8);case 8:return _.yield(o.init(),9);case 9:return f.ensureNotDestroyed_(),_.yield(o.getActive(),10);case 10:return l=_.yieldResult,f.ensureNotDestroyed_(),goog.asserts.assert(n,"drmEngine should be non-null here."),_.yield(f.downloadManifest_(l.cell,n,d,a,b,t,r),11);case 11:if(q=_.yieldResult,f.ensureNotDestroyed_(),h)throw h;return _.yield(l.cell.addManifests([q]),12);case 12:return c=_.yieldResult,f.ensureNotDestroyed_(),u=shaka.offline.OfflineUri.manifest(l.path.mechanism,l.path.cell,c[0]),_.return(shaka.offline.StoredContentUtils.fromManifestDB(u,q));case 3:return _.enterFinallyBlock(),f.segmentsFromStore_=[],_.yield(o.destroy(),13);case 13:if(!g){_.jumpTo(14);break}return _.yield(g.stop(),14);case 14:if(!n){_.jumpTo(16);break}return _.yield(n.destroy(),16);case 16:_.leaveFinallyBlock(0);break;case 2:if(m=_.enterCatchBlock(),!l){_.jumpTo(18);break}return _.yield(l.cell.removeSegments(f.segmentsFromStore_,(function(){})),18);case 18:throw h||m}}))},shaka.offline.Storage.prototype.filterManifest_=function(a,b,e){var t,r,n,g,o,l,h,d,c,p,q,m,u,f,_,y;return $jscomp.asyncExecutePromiseGeneratorProgram((function(k){if(1==k.nextAddress){for(t=shaka.util.StreamUtils,r={width:1/0,height:1/0},shaka.util.ManifestFilter.filterByRestrictions(a,e.restrictions,r),shaka.util.ManifestFilter.filterByMediaSourceSupport(a),shaka.util.ManifestFilter.filterByDrmSupport(a,b),n=[],g=e.preferredAudioChannelCount,shaka.util.StreamUtils.chooseCodecsAndFilterManifest(a,g),o=$jscomp.makeIterator(a.variants),l=o.next();!l.done;l=o.next())h=l.value,goog.asserts.assert(t.isPlayable(h),'We should have already filtered by "is playable"'),n.push(t.variantToTrack(h));for(d=$jscomp.makeIterator(a.textStreams),c=d.next();!c.done;c=d.next())p=c.value,n.push(t.textStreamToTrack(p));return k.yield(e.offline.trackSelectionCallback(n),2)}for(q=k.yieldResult,m=new Set,u=new Set,f=$jscomp.makeIterator(q),_=f.next();!_.done;_=f.next())"variant"==(y=_.value).type&&m.add(y.id),"text"==y.type&&u.add(y.id);a.variants=a.variants.filter((function(a){return m.has(a.id)})),a.textStreams=a.textStreams.filter((function(a){return u.has(a.id)})),shaka.offline.Storage.validateManifest_(a),k.jumpToEnd()}))},shaka.offline.Storage.prototype.downloadManifest_=function(a,b,e,t,r,n,g){var o,l,h,d,p,q,c,u,m,f,_,y,k=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(E){switch(E.nextAddress){case 1:return o=shaka.offline.StoredContentUtils.fromManifest(t,e,0,r),l=n.offline.progressCallback,h=function(a,b){o.size=b,l(o,a)},d=function(a,e){c&&n.offline.usePersistentLicense&&u==e&&b.newInitData("cenc",a)},g.setCallbacks(h,d),p=e.variants.some((function(a){var b=a.audio&&a.audio.encrypted;return a.video&&a.video.encrypted||b})),q=e.variants.some((function(a){return(a.video?a.video.drmInfos:[]).concat(a.audio?a.audio.drmInfos:[]).some((function(a){return a.initData&&a.initData.length}))})),u=null,(c=p&&!q)&&(m=b.getDrmInfo(),u=shaka.offline.Storage.defaultSystemIds_.get(m.keySystem)),E.setFinallyBlock(2),_=f=k.createOfflineManifest_(g,a,b,e,t,r,n),E.yield(g.waitToFinish(),4);case 4:if(_.size=E.yieldResult,f.expiration=b.getExpiration(),y=b.getSessionIds(),f.sessionIds=n.offline.usePersistentLicense?y:[],p&&n.offline.usePersistentLicense&&!y.length)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.NO_INIT_DATA_FOR_OFFLINE);return E.return(f);case 2:return E.enterFinallyBlock(),E.yield(g.destroy(),5);case 5:E.leaveFinallyBlock(0)}}))},shaka.offline.Storage.prototype.remove=function(a){return this.startOperation_(this.remove_(a))},shaka.offline.Storage.prototype.remove_=function(a){var e,t,r,n,g,o,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){switch(l.nextAddress){case 1:if(b.requireSupport_(),null==(e=shaka.offline.OfflineUri.parse(a))||!e.isManifest())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.MALFORMED_OFFLINE_URI,a);return t=e,r=new shaka.offline.StorageMuxer,l.setFinallyBlock(2),l.yield(r.init(),4);case 4:return l.yield(r.getCell(t.mechanism(),t.cell()),5);case 5:return n=l.yieldResult,l.yield(n.getManifests([t.key()]),6);case 6:return g=l.yieldResult,o=g[0],l.yield(Promise.all([b.removeFromDRM_(t,o,r),b.removeFromStorage_(n,t,o)]),2);case 2:return l.enterFinallyBlock(),l.yield(r.destroy(),8);case 8:l.leaveFinallyBlock(0)}}))},shaka.offline.Storage.getCapabilities_=function(a,b){for(var e=shaka.util.MimeUtils,t=[],r=$jscomp.makeIterator(a.streams),n=r.next();!n.done;n=r.next())n=n.value,b&&"video"==n.type?t.push({contentType:e.getFullType(n.mimeType,n.codecs),robustness:a.drmInfo.videoRobustness}):b||"audio"!=n.type||t.push({contentType:e.getFullType(n.mimeType,n.codecs),robustness:a.drmInfo.audioRobustness});return t},shaka.offline.Storage.prototype.removeFromDRM_=function(a,b,e){var t=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(a){return goog.asserts.assert(t.networkingEngine_,"Cannot be destroyed"),a.yield(shaka.offline.Storage.deleteLicenseFor_(t.networkingEngine_,t.config_.drm,e,b),0)}))},shaka.offline.Storage.prototype.removeFromStorage_=function(a,b,e){var t=this,r=shaka.offline.Storage.getAllSegmentIds_(e),n=r.length+1,g=0,o=shaka.offline.StoredContentUtils.fromManifestDB(b,e);return e=function(a){g+=1,t.config_.offline.progressCallback(o,g/n)},Promise.all([a.removeSegments(r,e),a.removeManifests([b.key()],e)])},shaka.offline.Storage.prototype.removeEmeSessions=function(){return this.startOperation_(this.removeEmeSessions_())},shaka.offline.Storage.prototype.removeEmeSessions_=function(){var b,e,t,r,n,g,o,l,h,d,c,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(p){switch(p.nextAddress){case 1:return a.requireSupport_(),goog.asserts.assert(a.networkingEngine_,"Cannot be destroyed"),b=a.networkingEngine_,e=a.config_.drm,t=new shaka.offline.StorageMuxer,r=new shaka.offline.SessionDeleter,n=!1,p.setFinallyBlock(2),p.yield(t.init(),4);case 4:g=[],t.forEachEmeSessionCell((function(a){return g.push(a)})),o=$jscomp.makeIterator(g),l=o.next();case 5:if(l.done){p.jumpTo(2);break}return h=l.value,p.yield(h.getAll(),8);case 8:return d=p.yieldResult,p.yield(r.delete(e,b,d),9);case 9:return c=p.yieldResult,p.yield(h.remove(c),10);case 10:c.length!=d.length&&(n=!0),l=o.next(),p.jumpTo(5);break;case 2:return p.enterFinallyBlock(),p.yield(t.destroy(),11);case 11:p.leaveFinallyBlock(3);break;case 3:return p.return(!n)}}))},shaka.offline.Storage.prototype.list=function(){return this.startOperation_(this.list_())},shaka.offline.Storage.prototype.list_=function(){var b,e,t,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(r){switch(r.nextAddress){case 1:return a.requireSupport_(),b=[],e=new shaka.offline.StorageMuxer,r.setFinallyBlock(2),r.yield(e.init(),4);case 4:return t=Promise.resolve(),e.forEachCell((function(a,e){t=t.then((function(){return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){if(1==t.nextAddress)return t.yield(e.getAllManifests(),2);t.yieldResult.forEach((function(e,t){var r=shaka.offline.OfflineUri.manifest(a.mechanism,a.cell,t);r=shaka.offline.StoredContentUtils.fromManifestDB(r,e),b.push(r)})),t.jumpToEnd()}))}))})),r.yield(t,2);case 2:return r.enterFinallyBlock(),r.yield(e.destroy(),6);case 6:r.leaveFinallyBlock(3);break;case 3:return r.return(b)}}))},shaka.offline.Storage.prototype.parseManifest=function(a,b,e){var t,r,g,n,o,l=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(h){if(1==h.nextAddress)return t=null,r=l.networkingEngine_,goog.asserts.assert(r,"Should be initialized!"),g={networkingEngine:r,filter:function(){return Promise.resolve()},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(a){t=a}},b.configure(e.manifest),l.ensureNotDestroyed_(),h.yield(b.start(a,g),2);if(3!=h.nextAddress)return n=h.yieldResult,l.ensureNotDestroyed_(),o=shaka.offline.Storage.getAllStreamsFromManifest_(n),h.yield(Promise.all(shaka.util.Iterables.map(o,(function(a){return a.createSegmentIndex()}))),3);if(l.ensureNotDestroyed_(),t)throw t;return h.return(n)}))},shaka.offline.Storage.prototype.createDrmEngine=function(a,b,e){var t,r=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(n){switch(n.nextAddress){case 1:return goog.asserts.assert(r.networkingEngine_,"Cannot call |createDrmEngine| after |destroy|"),(t=new shaka.media.DrmEngine({netEngine:r.networkingEngine_,onError:b,onKeyStatus:function(){},onExpirationUpdated:function(){},onEvent:function(){}})).configure(e.drm),n.yield(t.initForStorage(a.variants,e.offline.usePersistentLicense),2);case 2:return n.yield(t.setServerCertificate(),3);case 3:return n.yield(t.createOrLoad(),4);case 4:return n.return(t)}}))},shaka.offline.Storage.prototype.createOfflineManifest_=function(a,b,e,t,r,n,g){var o=new shaka.offline.StreamBandwidthEstimator;return a=this.createStreams_(a,b,o,e,t,g),g=g.offline.usePersistentLicense,(b=e.getDrmInfo())&&g&&(b.initData=[]),{creationTime:Date.now(),originalManifestUri:r,duration:t.presentationTimeline.getDuration(),size:0,expiration:e.getExpiration(),streams:a,sessionIds:g?e.getSessionIds():[],drmInfo:b,appMetadata:n}},shaka.offline.Storage.prototype.createStreams_=function(a,b,e,t,r,n){for(var g=(t=$jscomp.makeIterator(r.variants)).next();!g.done;g=t.next())e.addVariant(g.value);for(g=(t=$jscomp.makeIterator(r.textStreams)).next();!g.done;g=t.next())e.addText(g.value);g=shaka.offline.Storage.getAllStreamsFromManifest_(r),t=new Map;for(var o=(g=$jscomp.makeIterator(g)).next();!o.done;o=g.next()){o=o.value;var l=this.createStream_(a,b,e,r,o,n);t.set(o.id,l)}for(g=(a=$jscomp.makeIterator(r.variants)).next();!g.done;g=a.next())(b=g.value).audio&&t.get(b.audio.id).variantIds.push(b.id),b.video&&t.get(b.video.id).variantIds.push(b.id);return Array.from(t.values())},shaka.offline.Storage.prototype.createStream_=function(a,b,e,t,r,n){var g=this,o={id:r.id,originalId:r.originalId,primary:r.primary,type:r.type,mimeType:r.mimeType,codecs:r.codecs,frameRate:r.frameRate,pixelAspectRatio:r.pixelAspectRatio,kind:r.kind,language:r.language,label:r.label,width:r.width||null,height:r.height||null,encrypted:r.encrypted,keyIds:r.keyIds,segments:[],variantIds:[],roles:r.roles,channelsCount:r.channelsCount,audioSamplingRate:r.audioSamplingRate,closedCaptions:r.closedCaptions},l=r.id;return t=t.presentationTimeline.getSegmentAvailabilityStart(),shaka.offline.Storage.forEachSegment_(r,t,(function(t){var h=g.getInitSegmentDbKey_(a,l,r.id,b,e,t.initSegmentReference,n),d=g.getSegmentDbKey_(a,l,r.id,b,e,t,n);a.queueWork(l,(function(){var a,b;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?e.yield(h,2):3!=e.nextAddress?(a=e.yieldResult,e.yield(d,3)):(b=e.yieldResult,o.segments.push({initSegmentKey:a,startTime:t.startTime,endTime:t.endTime,appendWindowStart:t.appendWindowStart,appendWindowEnd:t.appendWindowEnd,timestampOffset:t.timestampOffset,dataKey:b}),void e.jumpToEnd())}))}))})),o},shaka.offline.Storage.prototype.getInitSegmentDbKey_=function(a,b,e,t,r,n,g){var o=this;return this.initSegmentDbKeyCache_.has(n)?this.initSegmentDbKeyCache_.get(n):(g=shaka.util.Networking.createSegmentRequest(n.getUris(),n.startByte,n.endByte,g.streaming.retryParameters),a=a.queue(b,g,r.getInitSegmentEstimate(e),!0,(function(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?e.yield(t.addSegments([{data:a}]),2):(b=e.yieldResult,o.segmentsFromStore_.push(b[0]),e.return(b[0]))}))})),this.initSegmentDbKeyCache_.set(n,a),a)},shaka.offline.Storage.prototype.getSegmentDbKey_=function(a,b,e,t,r,n,g){var o=this,l=[n.getUris()[0],n.startByte,n.endByte].join("-");return this.segmentDbKeyCache_.has(l)?this.segmentDbKeyCache_.get(l):(g=shaka.util.Networking.createSegmentRequest(n.getUris(),n.startByte,n.endByte,g.streaming.retryParameters),a=a.queue(b,g,r.getSegmentEstimate(e,n),!1,(function(a){var b;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?e.yield(t.addSegments([{data:a}]),2):(b=e.yieldResult,o.segmentsFromStore_.push(b[0]),e.return(b[0]))}))})),this.segmentDbKeyCache_.set(l,a),a)},shaka.offline.Storage.forEachSegment_=function(a,b,e){if(null!=(b=a.segmentIndex.find(b)))for(var t=a.segmentIndex.get(b);t;)e(t),t=a.segmentIndex.get(++b)},shaka.offline.Storage.prototype.ensureNotDestroyed_=function(){if(this.destroyer_.destroyed())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.OPERATION_ABORTED)},shaka.offline.Storage.prototype.requireSupport_=function(){if(!shaka.offline.Storage.support())throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.STORAGE,shaka.util.Error.Code.STORAGE_NOT_SUPPORTED)},shaka.offline.Storage.prototype.startOperation_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?(b.openOperations_.push(a),e.setFinallyBlock(2),e.yield(a,4)):2!=e.nextAddress?e.return(e.yieldResult):(e.enterFinallyBlock(),shaka.util.ArrayUtils.remove(b.openOperations_,a),e.leaveFinallyBlock(0))}))},shaka.offline.Storage.prototype.startAbortableOperation_=function(a){var b=this,e=a.promise;return this.openOperations_.push(e),a.finally((function(){shaka.util.ArrayUtils.remove(b.openOperations_,e)}))},shaka.offline.Storage.getAllSegmentIds_=function(a){for(var b=[],e=(a=$jscomp.makeIterator(a.streams)).next();!e.done;e=a.next())for(var t=(e=$jscomp.makeIterator(e.value.segments)).next();!t.done;t=e.next())null!=(t=t.value).initSegmentKey&&b.push(t.initSegmentKey),b.push(t.dataKey);return b},shaka.offline.Storage.deleteAll=function(){var a;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return 1==b.nextAddress?(a=new shaka.offline.StorageMuxer,b.setFinallyBlock(2),b.yield(a.erase(),2)):5!=b.nextAddress?(b.enterFinallyBlock(),b.yield(a.destroy(),5)):b.leaveFinallyBlock(0)}))},shaka.offline.Storage.deleteLicenseFor_=function(a,b,e,t){var r,n,g,o;return $jscomp.asyncExecutePromiseGeneratorProgram((function(l){return 1==l.nextAddress?t.drmInfo?(r=e.getEmeSessionCell(),n=t.sessionIds.map((function(a){return{sessionId:a,keySystem:t.drmInfo.keySystem,licenseUri:t.drmInfo.licenseServerUri,serverCertificate:t.drmInfo.serverCertificate,audioCapabilities:shaka.offline.Storage.getCapabilities_(t,!1),videoCapabilities:shaka.offline.Storage.getCapabilities_(t,!0)}})),g=new shaka.offline.SessionDeleter,l.yield(g.delete(b,a,n),2)):l.return():3!=l.nextAddress?(o=l.yieldResult,l.yield(r.remove(o),3)):l.yield(r.add(n.filter((function(a){return!o.includes(a.sessionId)}))),0)}))},shaka.offline.Storage.getAllStreamsFromManifest_=function(a){for(var b=new Set,e=$jscomp.makeIterator(a.textStreams),t=e.next();!t.done;t=e.next())b.add(t.value);for(e=(a=$jscomp.makeIterator(a.variants)).next();!e.done;e=a.next())(e=e.value).audio&&b.add(e.audio),e.video&&b.add(e.video);return b},shaka.offline.Storage.validateManifest_=function(a){var b=new Set(a.variants.map((function(a){return a.video}))),e=new Set(a.variants.map((function(a){return a.audio})));a=a.textStreams,1<b.size&&shaka.log.warning("Multiple video tracks selected to be stored");for(var t=(b=$jscomp.makeIterator(e)).next();!t.done;t=b.next()){t=t.value;for(var r=$jscomp.makeIterator(e),n=r.next();!n.done;n=r.next())t!=(n=n.value)&&t.language==n.language&&shaka.log.warning("Similar audio tracks were selected to be stored",t.id,n.id)}for(b=(e=$jscomp.makeIterator(a)).next();!b.done;b=e.next())for(b=b.value,r=(t=$jscomp.makeIterator(a)).next();!r.done;r=t.next())b!=(r=r.value)&&b.language==r.language&&shaka.log.warning("Similar text tracks were selected to be stored",b.id,r.id)},goog.exportSymbol("shaka.offline.Storage",shaka.offline.Storage),goog.exportProperty(shaka.offline.Storage,"deleteAll",shaka.offline.Storage.deleteAll),goog.exportProperty(shaka.offline.Storage.prototype,"list",shaka.offline.Storage.prototype.list),goog.exportProperty(shaka.offline.Storage.prototype,"removeEmeSessions",shaka.offline.Storage.prototype.removeEmeSessions),goog.exportProperty(shaka.offline.Storage.prototype,"remove",shaka.offline.Storage.prototype.remove),goog.exportProperty(shaka.offline.Storage.prototype,"getStoreInProgress",shaka.offline.Storage.prototype.getStoreInProgress),goog.exportProperty(shaka.offline.Storage.prototype,"store",shaka.offline.Storage.prototype.store),goog.exportProperty(shaka.offline.Storage.prototype,"getNetworkingEngine",shaka.offline.Storage.prototype.getNetworkingEngine),goog.exportProperty(shaka.offline.Storage.prototype,"getConfiguration",shaka.offline.Storage.prototype.getConfiguration),goog.exportProperty(shaka.offline.Storage.prototype,"configure",shaka.offline.Storage.prototype.configure),goog.exportProperty(shaka.offline.Storage.prototype,"destroy",shaka.offline.Storage.prototype.destroy),goog.exportProperty(shaka.offline.Storage,"support",shaka.offline.Storage.support),shaka.offline.Storage.defaultSystemIds_=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb"),shaka.Player.registerSupportPlugin("offline",shaka.offline.Storage.support),shaka.polyfill=function(){},shaka.polyfill.installAll=function(){for(var a=$jscomp.makeIterator(shaka.polyfill.polyfills_),b=a.next();!b.done;b=a.next()){b=b.value;try{b.callback()}catch(e){shaka.log.alwaysWarn("Error installing polyfill!",e)}}},shaka.polyfill.register=function(a,b){for(var e={priority:b||0,callback:a},t=$jscomp.makeIterator(shaka.util.Iterables.enumerate(shaka.polyfill.polyfills_)),r=t.next();!r.done;r=t.next()){var n=(r=r.value).i;if(r.item.priority<e.priority)return void shaka.polyfill.polyfills_.splice(n,0,e)}shaka.polyfill.polyfills_.push(e)},goog.exportSymbol("shaka.polyfill",shaka.polyfill),goog.exportProperty(shaka.polyfill,"register",shaka.polyfill.register),goog.exportProperty(shaka.polyfill,"installAll",shaka.polyfill.installAll),shaka.polyfill.polyfills_=[],shaka.polyfill.EncryptionScheme=function(){},shaka.polyfill.EncryptionScheme.install=function(){EncryptionSchemePolyfills.install()},shaka.polyfill.register(shaka.polyfill.EncryptionScheme.install,-1),shaka.polyfill.Fullscreen=function(){},shaka.polyfill.Fullscreen.install=function(){if(window.Document){var a=Element.prototype;a.requestFullscreen=a.requestFullscreen||a.mozRequestFullScreen||a.msRequestFullscreen||a.webkitRequestFullscreen,(a=Document.prototype).exitFullscreen=a.exitFullscreen||a.mozCancelFullScreen||a.msExitFullscreen||a.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),a=shaka.polyfill.Fullscreen.proxyEvent_,document.addEventListener("webkitfullscreenchange",a),document.addEventListener("webkitfullscreenerror",a),document.addEventListener("mozfullscreenchange",a),document.addEventListener("mozfullscreenerror",a),document.addEventListener("MSFullscreenChange",a),document.addEventListener("MSFullscreenError",a)}},shaka.polyfill.Fullscreen.proxyEvent_=function(a){var b=a.type.replace(/^(webkit|moz|MS)/,"").toLowerCase();if("function"==typeof Event)var e=new Event(b,a);else(e=document.createEvent("Event")).initEvent(b,a.bubbles,a.cancelable);a.target.dispatchEvent(e)},shaka.polyfill.register(shaka.polyfill.Fullscreen.install),shaka.polyfill.IndexedDB=function(){},shaka.polyfill.IndexedDB.install=function(){shaka.log.debug("IndexedDB.install");var a=!1;if(shaka.util.Platform.isChromecast())shaka.log.debug("Removing IndexedDB from ChromeCast"),a=!0;else try{window.indexedDB&&(a=!1)}catch(e){shaka.log.debug("Removing IndexedDB due to an exception when accessing it"),a=!0}a&&(delete window.indexedDB,goog.asserts.assert(!window.indexedDB,"Failed to override window.indexedDB"))},shaka.polyfill.register(shaka.polyfill.IndexedDB.install),shaka.polyfill.InputEvent=function(){},shaka.polyfill.InputEvent.install=function(){shaka.log.debug("InputEvent.install"),shaka.util.Platform.isIE()&&!HTMLInputElement.prototype.originalAddEventListener&&(shaka.log.info("Patching input event support on IE."),HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=shaka.polyfill.InputEvent.addEventListener_)},shaka.polyfill.InputEvent.addEventListener_=function(a,b,e){if("input"==a)switch(this.type){case"range":a="change"}HTMLInputElement.prototype.originalAddEventListener.call(this,a,b,e)},shaka.polyfill.register(shaka.polyfill.InputEvent.install),shaka.polyfill.Languages=function(){},shaka.polyfill.Languages.install=function(){navigator.languages||Object.defineProperty(navigator,"languages",{get:function(){return navigator.language?[navigator.language]:["en"]}})},shaka.polyfill.register(shaka.polyfill.Languages.install),shaka.polyfill.MathRound=function(){},shaka.polyfill.MathRound.install=function(){shaka.log.debug("mathRound.install");var a=shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_+1;if(Math.round(a)!=a){shaka.log.debug("polyfill Math.round");var b=Math.round;Math.round=function(a){var e=a;return a<=shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_&&(e=b(a)),e}}},shaka.polyfill.MathRound.MAX_ACCURATE_INPUT_=4503599627370496,shaka.polyfill.register(shaka.polyfill.MathRound.install),shaka.polyfill.MediaSource=function(){},shaka.polyfill.MediaSource.install=function(){shaka.log.debug("MediaSource.install");var a=shaka.util.Platform.safariVersion();window.MediaSource?window.cast&&cast.__platform__&&cast.__platform__.canDisplayType?(shaka.log.info("Patching Chromecast MSE bugs."),shaka.polyfill.MediaSource.patchCastIsTypeSupported_()):a?(shaka.polyfill.MediaSource.rejectTsContent_(),12>=a?(shaka.log.info("Patching Safari 11 & 12 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_(),shaka.polyfill.MediaSource.patchRemovalRange_()):(shaka.log.info("Patching Safari 13 MSE bugs."),shaka.polyfill.MediaSource.stubAbort_())):shaka.util.Platform.isTizen2()||shaka.util.Platform.isTizen3()||shaka.util.Platform.isTizen4()?shaka.polyfill.MediaSource.rejectCodec_("opus"):shaka.log.info("Using native MSE as-is."):shaka.log.info("No MSE implementation available.")},shaka.polyfill.MediaSource.stubAbort_=function(){var a=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(b){for(var e=[],t=0;t<arguments.length;++t)e[t-0]=arguments[t];return(e=a.apply(this,e)).abort=function(){},e}},shaka.polyfill.MediaSource.patchRemovalRange_=function(){var a=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(b,e){return a.call(this,b,e-.001)}},shaka.polyfill.MediaSource.rejectTsContent_=function(){var a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(b){return"mp2t"!=b.split(/ *; */)[0].split("/")[1].toLowerCase()&&a(b)}},shaka.polyfill.MediaSource.rejectCodec_=function(a){var b=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(e){return shaka.util.MimeUtils.getCodecBase(e)!=a&&b(e)}},shaka.polyfill.MediaSource.patchCastIsTypeSupported_=function(){var a=MediaSource.isTypeSupported,b=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(e){for(var t=e.split(/ *; */),r=t.shift(),n={},g=(t=$jscomp.makeIterator(t)).next();!g.done;g=t.next()){var o=g.value.split("=");g=o[0],o=o[1].replace(/"(.*)"/,"$1"),n[g]=o}if(!(t=n.codecs))return a(e);var l=!1,h=!1;for(var d in e=t.split(",").filter((function(a){return b.test(a)&&(h=!0),/^(hev|hvc)1\.2/.test(a)&&(l=!0),!0})),h&&(l=!1),n.codecs=e.join(","),l&&(n.eotf="smpte2084"),n)r+="; "+d+'="'+n[d]+'"';return cast.__platform__.canDisplayType(r)}},shaka.polyfill.register(shaka.polyfill.MediaSource.install),shaka.polyfill.Orientation=function(){},shaka.polyfill.Orientation.install=function(){screen.orientation||null!=window.orientation&&shaka.polyfill.Orientation.installBasedOnWindowMethods_()},shaka.polyfill.Orientation.installBasedOnWindowMethods_=function(){var a=new shaka.polyfill.Orientation.FakeOrientation;screen.orientation=a;var b=function(){switch(window.orientation){case-90:a.type="landscape-secondary",a.angle=270;break;case 0:a.type="portrait-primary",a.angle=0;break;case 90:a.type="landscape-primary",a.angle=90;break;case 180:a.type="portrait-secondary",a.angle=180}};b(),window.addEventListener("orientationchange",(function(){b(),a.dispatchChangeEvent()}))},shaka.polyfill.Orientation.FakeOrientation=function(){shaka.util.FakeEventTarget.call(this),this.type="",this.angle=0},$jscomp.inherits(shaka.polyfill.Orientation.FakeOrientation,shaka.util.FakeEventTarget),shaka.polyfill.Orientation.FakeOrientation.prototype.dispatchChangeEvent=function(){var a=new shaka.util.FakeEvent("change",{});this.dispatchEvent(a)},shaka.polyfill.Orientation.FakeOrientation.prototype.lock=function(a){var b=function(a){return screen.lockOrientation?screen.lockOrientation(a):screen.mozLockOrientation?screen.mozLockOrientation(a):!!screen.msLockOrientation&&screen.msLockOrientation(a)},e=!1;switch(a){case"natural":e=b("default");break;case"any":e=!0,this.unlock();break;default:e=b(a)}return e?Promise.resolve():((a=Error("screen.orientation.lock() is not available on this device")).name="NotSupportedError",a.code=DOMException.NOT_SUPPORTED_ERR,Promise.reject(a))},shaka.polyfill.Orientation.FakeOrientation.prototype.unlock=function(){screen.unlockOrientation?screen.unlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},shaka.polyfill.register(shaka.polyfill.Orientation.install),shaka.polyfill.PatchedMediaKeysApple=function(){},shaka.polyfill.PatchedMediaKeysApple.install=function(){if(window.HTMLVideoElement&&window.WebKitMediaKeys){shaka.log.info("Using Apple-prefixed EME");var a=shaka.polyfill.PatchedMediaKeysApple;delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=a.setMediaKeys,window.MediaKeys=a.MediaKeys,window.MediaKeySystemAccess=a.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=a.requestMediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysApple.requestMediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysApple.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var e=shaka.polyfill.PatchedMediaKeysApple;try{var t=new e.MediaKeySystemAccess(a,b);return Promise.resolve(t)}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysApple.setMediaKeys=function(a){shaka.log.debug("PatchedMediaKeysApple.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var b=shaka.polyfill.PatchedMediaKeysApple,e=this.mediaKeys;return e&&e!=a&&(goog.asserts.assert(e instanceof b.MediaKeys,"non-polyfill instance of oldMediaKeys"),e.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=a)?(goog.asserts.assert(a instanceof b.MediaKeys,"non-polyfill instance of newMediaKeys"),a.setMedia(this)):Promise.resolve()},shaka.polyfill.PatchedMediaKeysApple.onWebkitNeedKey_=function(a){if(shaka.log.debug("PatchedMediaKeysApple.onWebkitNeedKey_",a),goog.asserts.assert(this.mediaKeys instanceof shaka.polyfill.PatchedMediaKeysApple.MediaKeys,"non-polyfill instance of newMediaKeys"),goog.asserts.assert(null!=a.initData,"missing init data!"),a=shaka.util.BufferUtils.toUint8(a.initData),shaka.util.BufferUtils.toDataView(a).getUint32(0,!0)+4!=a.byteLength)throw new RangeError("Malformed FairPlay init data");a=shaka.util.StringUtils.fromUTF16(a.subarray(4),!0),a=shaka.util.StringUtils.toUTF8(a);var b=new Event("encrypted");b.initDataType="skd",b.initData=shaka.util.BufferUtils.toArrayBuffer(a),this.dispatchEvent(b)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess=function(a,b){if(shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess"),this.keySystem=a,a.startsWith("com.apple.fps"))for(var e=$jscomp.makeIterator(b),t=e.next();!t.done;t=e.next())if(t=this.checkConfig_(t.value))return void(this.configuration_=t);throw(e=Error("Unsupported keySystem")).name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.checkConfig_=function(a){if("required"==a.persistentState)return null;var b={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:a.initDataTypes,sessionTypes:["temporary"],label:a.label},e=!1,t=!1;if(a.audioCapabilities)for(var r=$jscomp.makeIterator(a.audioCapabilities),n=r.next();!n.done;n=r.next())if((n=n.value).contentType){e=!0;var g=n.contentType.split(";")[0];WebKitMediaKeys.isTypeSupported(this.keySystem,g)&&(b.audioCapabilities.push(n),t=!0)}if(a.videoCapabilities)for(n=(a=$jscomp.makeIterator(a.videoCapabilities)).next();!n.done;n=a.next())(r=n.value).contentType&&(e=!0,n=r.contentType.split(";")[0],WebKitMediaKeys.isTypeSupported(this.keySystem,n)&&(b.videoCapabilities.push(r),t=!0));return e||(t=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),t?b:null},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.createMediaKeys");var a=new shaka.polyfill.PatchedMediaKeysApple.MediaKeys(this.keySystem);return Promise.resolve(a)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysApple.MediaKeys=function(a){shaka.log.debug("PatchedMediaKeysApple.MediaKeys"),this.nativeMediaKeys_=new WebKitMediaKeys(a),this.eventManager_=new shaka.util.EventManager},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.createSession=function(a){if(shaka.log.debug("PatchedMediaKeysApple.MediaKeys.createSession"),"temporary"!=(a=a||"temporary"))throw new TypeError("Session type "+a+" is unsupported on this platform.");return new shaka.polyfill.PatchedMediaKeysApple.MediaKeySession(this.nativeMediaKeys_,a)},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setServerCertificate=function(a){return shaka.log.debug("PatchedMediaKeysApple.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysApple.MediaKeys.prototype.setMedia=function(a){var b=this,e=shaka.polyfill.PatchedMediaKeysApple;if(this.eventManager_.removeAll(),!a)return Promise.resolve();this.eventManager_.listen(a,"webkitneedkey",e.onWebkitNeedKey_);try{return shaka.util.MediaReadyState.waitForReadyState(a,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){a.webkitSetMediaKeys(b.nativeMediaKeys_)})),Promise.resolve()}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession=function(a,b){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=a,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new shaka.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysApple.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.generateRequest=function(a,b){var e=this;shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.generateRequest"),this.generateRequestPromise_=new shaka.util.PublicPromise;try{var t=this.nativeMediaKeys_.createSession("video/mp4",shaka.util.BufferUtils.toUint8(b));this.nativeMediaKeySession_=t,this.sessionId=t.sessionId||"",this.eventManager_.listen(this.nativeMediaKeySession_,"webkitkeymessage",(function(a){return e.onWebkitKeyMessage_(a)})),this.eventManager_.listen(t,"webkitkeyadded",(function(a){return e.onWebkitKeyAdded_(a)})),this.eventManager_.listen(t,"webkitkeyerror",(function(a){return e.onWebkitKeyError_(a)})),this.updateKeyStatus_("status-pending")}catch(e){this.generateRequestPromise_.reject(e)}return this.generateRequestPromise_},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.load=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.update=function(a){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.update"),this.updatePromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_.update(shaka.util.BufferUtils.toUint8(a))}catch(e){this.updatePromise_.reject(e)}return this.updatePromise_},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.close=function(){shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(e){this.closed.reject(e)}return this.closed},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysApple.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyMessage_=function(a){shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyMessage_",a),goog.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ should be set before now!"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var b=null==this.keyStatuses.getStatus();a=new shaka.util.FakeEvent("message",{messageType:b?"license-request":"license-renewal",message:shaka.util.BufferUtils.toArrayBuffer(a.message)}),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyAdded_=function(a){shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyAdded_",a),goog.asserts.assert(!this.generateRequestPromise_,"Key added during generate!"),goog.asserts.assert(this.updatePromise_,"updatePromise_ should be set before now!"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null)},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.onWebkitKeyError_=function(a){if(shaka.log.debug("PatchedMediaKeysApple.onWebkitKeyError_",a),(a=Error("EME PatchedMediaKeysApple key error")).errorCode=this.nativeMediaKeySession_.error,null!=this.generateRequestPromise_)this.generateRequestPromise_.reject(a),this.generateRequestPromise_=null;else if(null!=this.updatePromise_)this.updatePromise_.reject(a),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},shaka.polyfill.PatchedMediaKeysApple.MediaKeySession.prototype.updateKeyStatus_=function(a){this.keyStatuses.setStatus(a),a=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.setStatus=function(a){this.size=null==a?0:1,this.status_=a},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.forEach=function(a){this.status_&&a(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.get=function(a){if(this.has(a))return this.status_},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.has=function(a){var b=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!(!this.status_||!shaka.util.BufferUtils.equal(a,b))},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysApple.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysApple.install),shaka.polyfill.PatchedMediaKeysMs=function(){},shaka.polyfill.PatchedMediaKeysMs.install=function(){if(window.HTMLVideoElement&&window.MSMediaKeys&&(!navigator.requestMediaKeySystemAccess||!MediaKeySystemAccess.prototype.getConfiguration)){shaka.log.info("Using ms-prefixed EME v20140218");var a=shaka.polyfill.PatchedMediaKeysMs;delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,window.MediaKeys=a.MediaKeys,window.MediaKeySystemAccess=a.MediaKeySystemAccess,navigator.requestMediaKeySystemAccess=a.requestMediaKeySystemAccess,HTMLMediaElement.prototype.setMediaKeys=a.MediaKeySystemAccess.setMediaKeys}},shaka.polyfill.PatchedMediaKeysMs.requestMediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysMs.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var e=shaka.polyfill.PatchedMediaKeysMs;try{var t=new e.MediaKeySystemAccess(a,b);return Promise.resolve(t)}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysMs.onMsNeedKey_=function(a){if(shaka.log.debug("PatchedMediaKeysMs.onMsNeedKey_",a),a.initData){var b=document.createEvent("CustomEvent");b.initCustomEvent("encrypted",!1,!1,null),b.initDataType="cenc",b.initData=shaka.util.BufferUtils.toArrayBuffer(shaka.util.Pssh.normaliseInitData(a.initData)),this.dispatchEvent(b)}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess"),this.keySystem=a;for(var e=!1,t=$jscomp.makeIterator(b),r=t.next();!r.done;r=t.next()){var n={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:(r=r.value).initDataTypes,sessionTypes:["temporary"],label:r.label},g=!1;if(r.audioCapabilities)for(var o=$jscomp.makeIterator(r.audioCapabilities),l=o.next();!l.done;l=o.next())if((l=l.value).contentType){g=!0;var h=l.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,h)&&(n.audioCapabilities.push(l),e=!0)}if(r.videoCapabilities)for(l=(o=$jscomp.makeIterator(r.videoCapabilities)).next();!l.done;l=o.next())(l=l.value).contentType&&(g=!0,h=l.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,h)&&(n.videoCapabilities.push(l),e=!0));if(g||(e=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==r.persistentState&&(e=!1),e)return void(this.configuration_=n)}throw(e=Error("Unsupported keySystem")).name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var a=new shaka.polyfill.PatchedMediaKeysMs.MediaKeys(this.keySystem);return Promise.resolve(a)},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySystemAccess.setMediaKeys=function(a){shaka.log.debug("PatchedMediaKeysMs.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var b=shaka.polyfill.PatchedMediaKeysMs,e=this.mediaKeys;return e&&e!=a&&(goog.asserts.assert(e instanceof b.MediaKeys,"non-polyfill instance of oldMediaKeys"),e.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=a)?(goog.asserts.assert(a instanceof b.MediaKeys,"non-polyfill instance of newMediaKeys"),a.setMedia(this)):Promise.resolve()},shaka.polyfill.PatchedMediaKeysMs.MediaKeys=function(a){shaka.log.debug("PatchedMediaKeysMs.MediaKeys"),this.nativeMediaKeys_=new MSMediaKeys(a),this.eventManager_=new shaka.util.EventManager},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.createSession=function(a){if(shaka.log.debug("PatchedMediaKeysMs.MediaKeys.createSession"),"temporary"!=(a=a||"temporary"))throw new TypeError("Session type "+a+" is unsupported on this platform.");return new shaka.polyfill.PatchedMediaKeysMs.MediaKeySession(this.nativeMediaKeys_,a)},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setServerCertificate=function(a){return shaka.log.debug("PatchedMediaKeysMs.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysMs.MediaKeys.prototype.setMedia=function(a){var b=this,e=shaka.polyfill.PatchedMediaKeysMs;if(this.eventManager_.removeAll(),!a)return Promise.resolve();this.eventManager_.listen(a,"msneedkey",e.onMsNeedKey_);try{return shaka.util.MediaReadyState.waitForReadyState(a,HTMLMediaElement.HAVE_METADATA,this.eventManager_,(function(){a.msSetMediaKeys(b.nativeMediaKeys_)})),Promise.resolve()}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession=function(a,b){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.nativeMediaKeySession_=null,this.nativeMediaKeys_=a,this.updatePromise_=this.generateRequestPromise_=null,this.eventManager_=new shaka.util.EventManager,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysMs.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.generateRequest=function(a,b){var e=this;shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.generateRequest"),this.generateRequestPromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_=this.nativeMediaKeys_.createSession("video/mp4",shaka.util.BufferUtils.toUint8(b),null),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeymessage",(function(a){return e.onMsKeyMessage_(a)})),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyadded",(function(a){return e.onMsKeyAdded_(a)})),this.eventManager_.listen(this.nativeMediaKeySession_,"mskeyerror",(function(a){return e.onMsKeyError_(a)})),this.updateKeyStatus_("status-pending")}catch(e){this.generateRequestPromise_.reject(e)}return this.generateRequestPromise_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.load=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.load"),Promise.reject(Error("MediaKeySession.load not yet supported"))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.update=function(a){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.update"),this.updatePromise_=new shaka.util.PublicPromise;try{this.nativeMediaKeySession_.update(shaka.util.BufferUtils.toUint8(a))}catch(e){this.updatePromise_.reject(e)}return this.updatePromise_},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.close=function(){shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.close");try{this.nativeMediaKeySession_.close(),this.closed.resolve(),this.eventManager_.removeAll()}catch(e){this.closed.reject(e)}return this.closed},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysMs.MediaKeySession.remove"),Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyMessage_=function(a){shaka.log.debug("PatchedMediaKeysMs.onMsKeyMessage_",a),goog.asserts.assert(this.generateRequestPromise_,"generateRequestPromise_ not set in onMsKeyMessage_"),this.generateRequestPromise_&&(this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null);var b=null==this.keyStatuses.getStatus();a=new shaka.util.FakeEvent("message",{messageType:b?"license-request":"license-renewal",message:shaka.util.BufferUtils.toArrayBuffer(a.message)}),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyAdded_=function(a){shaka.log.debug("PatchedMediaKeysMs.onMsKeyAdded_",a),this.generateRequestPromise_?(shaka.log.debug("Simulating completion for a PR persistent license."),goog.asserts.assert(!this.updatePromise_,"updatePromise_ and generateRequestPromise_ set in onMsKeyAdded_"),this.updateKeyStatus_("usable"),this.generateRequestPromise_.resolve(),this.generateRequestPromise_=null):(goog.asserts.assert(this.updatePromise_,"updatePromise_ not set in onMsKeyAdded_"),this.updatePromise_&&(this.updateKeyStatus_("usable"),this.updatePromise_.resolve(),this.updatePromise_=null))},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.onMsKeyError_=function(a){if(shaka.log.debug("PatchedMediaKeysMs.onMsKeyError_",a),(a=Error("EME PatchedMediaKeysMs key error")).errorCode=this.nativeMediaKeySession_.error,null!=this.generateRequestPromise_)this.generateRequestPromise_.reject(a),this.generateRequestPromise_=null;else if(null!=this.updatePromise_)this.updatePromise_.reject(a),this.updatePromise_=null;else switch(this.nativeMediaKeySession_.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:this.updateKeyStatus_("output-not-allowed");break;default:this.updateKeyStatus_("internal-error")}},shaka.polyfill.PatchedMediaKeysMs.MediaKeySession.prototype.updateKeyStatus_=function(a){this.keyStatuses.setStatus(a),a=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.setStatus=function(a){this.size=null==a?0:1,this.status_=a},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.forEach=function(a){this.status_&&a(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.get=function(a){if(this.has(a))return this.status_},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.has=function(a){var b=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!(!this.status_||!shaka.util.BufferUtils.equal(a,b))},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.PatchedMediaKeysMs.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for the compiler.")},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysMs.install),shaka.polyfill.PatchedMediaKeysNop=function(){},shaka.polyfill.PatchedMediaKeysNop.install=function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){shaka.log.info("EME not available.");var a=shaka.polyfill.PatchedMediaKeysNop;navigator.requestMediaKeySystemAccess=a.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=a.setMediaKeys,window.MediaKeys=a.MediaKeys,window.MediaKeySystemAccess=a.MediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysNop.requestMediaKeySystemAccess=function(a,b){return shaka.log.debug("PatchedMediaKeysNop.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess'),Promise.reject(Error("The key system specified is not supported."))},shaka.polyfill.PatchedMediaKeysNop.setMediaKeys=function(a){return shaka.log.debug("PatchedMediaKeysNop.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys'),null==a?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))},shaka.polyfill.PatchedMediaKeysNop.MediaKeys=function(){throw new TypeError("Illegal constructor.")},shaka.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.createSession=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeys.prototype.setServerCertificate=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess=function(){throw this.keySystem="",new TypeError("Illegal constructor.")},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.getConfiguration=function(){},shaka.polyfill.PatchedMediaKeysNop.MediaKeySystemAccess.prototype.createMediaKeys=function(){},shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysNop.install,-10),shaka.polyfill.PatchedMediaKeysWebkit=function(){},shaka.polyfill.PatchedMediaKeysWebkit.install=function(){var a=shaka.polyfill.PatchedMediaKeysWebkit;if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)shaka.log.info("Using webkit-prefixed EME v0.1b"),a.prefix_="webkit";else{if(!HTMLMediaElement.prototype.generateKeyRequest)return;shaka.log.info("Using nonprefixed EME v0.1b")}goog.asserts.assert(HTMLMediaElement.prototype[a.prefixApi_("generateKeyRequest")],"PatchedMediaKeysWebkit APIs not available!"),navigator.requestMediaKeySystemAccess=a.requestMediaKeySystemAccess,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=a.setMediaKeys,window.MediaKeys=a.MediaKeys,window.MediaKeySystemAccess=a.MediaKeySystemAccess}},shaka.polyfill.PatchedMediaKeysWebkit.prefixApi_=function(a){var b=shaka.polyfill.PatchedMediaKeysWebkit.prefix_;return b?b+a.charAt(0).toUpperCase()+a.slice(1):a},shaka.polyfill.PatchedMediaKeysWebkit.requestMediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysWebkit.requestMediaKeySystemAccess"),goog.asserts.assert(this==navigator,'bad "this" for requestMediaKeySystemAccess');var e=shaka.polyfill.PatchedMediaKeysWebkit;try{var t=new e.MediaKeySystemAccess(a,b);return Promise.resolve(t)}catch(e){return Promise.reject(e)}},shaka.polyfill.PatchedMediaKeysWebkit.setMediaKeys=function(a){shaka.log.debug("PatchedMediaKeysWebkit.setMediaKeys"),goog.asserts.assert(this instanceof HTMLMediaElement,'bad "this" for setMediaKeys');var b=shaka.polyfill.PatchedMediaKeysWebkit,e=this.mediaKeys;return e&&e!=a&&(goog.asserts.assert(e instanceof b.MediaKeys,"non-polyfill instance of oldMediaKeys"),e.setMedia(null)),delete this.mediaKeys,(this.mediaKeys=a)&&(goog.asserts.assert(a instanceof b.MediaKeys,"non-polyfill instance of newMediaKeys"),a.setMedia(this)),Promise.resolve()},shaka.polyfill.PatchedMediaKeysWebkit.getVideoElement_=function(){var a=document.getElementsByTagName("video");return a.length?a[0]:document.createElement("video")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess=function(a,b){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess"),this.internalKeySystem_=this.keySystem=a;var e=!1;"org.w3.clearkey"==a&&(this.internalKeySystem_="webkit-org.w3.clearkey",e=!1);for(var t=!1,r=shaka.polyfill.PatchedMediaKeysWebkit.getVideoElement_(),n=$jscomp.makeIterator(b),g=n.next();!g.done;g=n.next()){var o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:(g=g.value).initDataTypes,sessionTypes:["temporary"],label:g.label},l=!1;if(g.audioCapabilities)for(var h=$jscomp.makeIterator(g.audioCapabilities),d=h.next();!d.done;d=h.next())if((d=d.value).contentType){l=!0;var c=d.contentType.split(";")[0];r.canPlayType(c,this.internalKeySystem_)&&(o.audioCapabilities.push(d),t=!0)}if(g.videoCapabilities)for(d=(h=$jscomp.makeIterator(g.videoCapabilities)).next();!d.done;d=h.next())(d=d.value).contentType&&(l=!0,r.canPlayType(d.contentType,this.internalKeySystem_)&&(o.videoCapabilities.push(d),t=!0));if(l||(t=r.canPlayType("video/mp4",this.internalKeySystem_)||r.canPlayType("video/webm",this.internalKeySystem_)),"required"==g.persistentState&&(e?(o.persistentState="required",o.sessionTypes=["persistent-license"]):t=!1),t)return void(this.configuration_=o)}throw e="Unsupported keySystem","org.w3.clearkey"!=a&&"com.widevine.alpha"!=a||(e="None of the requested configurations were supported."),(e=Error(e)).name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,e},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.createMediaKeys=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var a=new shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys(this.internalKeySystem_);return Promise.resolve(a)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySystemAccess.prototype.getConfiguration=function(){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration"),this.configuration_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys=function(a){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys"),this.keySystem_=a,this.media_=null,this.eventManager_=new shaka.util.EventManager,this.newSessions_=[],this.sessionMap_=new Map},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setMedia=function(a){var b=this;this.media_=a,this.eventManager_.removeAll();var e=shaka.polyfill.PatchedMediaKeysWebkit.prefix_;a&&(this.eventManager_.listen(a,e+"needkey",(function(a){return b.onWebkitNeedKey_(a)})),this.eventManager_.listen(a,e+"keymessage",(function(a){return b.onWebkitKeyMessage_(a)})),this.eventManager_.listen(a,e+"keyadded",(function(a){return b.onWebkitKeyAdded_(a)})),this.eventManager_.listen(a,e+"keyerror",(function(a){return b.onWebkitKeyError_(a)})))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.createSession=function(a){if(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.createSession"),"temporary"!=(a=a||"temporary")&&"persistent-license"!=a)throw new TypeError("Session type "+a+" is unsupported on this platform.");var b=shaka.polyfill.PatchedMediaKeysWebkit,e=this.media_||document.createElement("video");return e.src||(e.src="about:blank"),a=new b.MediaKeySession(e,this.keySystem_,a),this.newSessions_.push(a),a},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.setServerCertificate=function(a){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate"),Promise.resolve(!1)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitNeedKey_=function(a){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitNeedKey_",a),goog.asserts.assert(this.media_,"media_ not set in onWebkitNeedKey_");var b=document.createEvent("CustomEvent");b.initCustomEvent("encrypted",!1,!1,null),b.initDataType="cenc",b.initData=shaka.util.BufferUtils.toArrayBuffer(a.initData),this.media_.dispatchEvent(b)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyMessage_=function(a){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyMessage_",a);var b=this.findSession_(a.sessionId);if(b){var e=null==b.keyStatuses.getStatus();a=new shaka.util.FakeEvent("message",{messageType:e?"licenserequest":"licenserenewal",message:a.message}),b.generated(),b.dispatchEvent(a)}else shaka.log.error("Session not found",a.sessionId)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyAdded_=function(a){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyAdded_",a),a=this.findSession_(a.sessionId),goog.asserts.assert(a,"unable to find session in onWebkitKeyAdded_"),a&&a.ready()},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.onWebkitKeyError_=function(a){shaka.log.debug("PatchedMediaKeysWebkit.onWebkitKeyError_",a);var b=this.findSession_(a.sessionId);goog.asserts.assert(b,"unable to find session in onWebkitKeyError_"),b&&b.handleError(a)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeys.prototype.findSession_=function(a){var b=this.sessionMap_.get(a);return b?(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",b),b):(b=this.newSessions_.shift())?(b.sessionId=a,this.sessionMap_.set(a,b),shaka.log.debug("PatchedMediaKeysWebkit.MediaKeys.findSession_",b),b):null},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession=function(a,b,e){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession"),shaka.util.FakeEventTarget.call(this),this.media_=a,this.initialized_=!1,this.updatePromise_=this.generatePromise_=null,this.keySystem_=b,this.type_=e,this.sessionId="",this.expiration=NaN,this.closed=new shaka.util.PublicPromise,this.keyStatuses=new shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap},$jscomp.inherits(shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession,shaka.util.FakeEventTarget),shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generated=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generated"),this.generatePromise_&&(this.generatePromise_.resolve(),this.generatePromise_=null)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.ready=function(){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.ready"),this.updateKeyStatus_("usable"),this.updatePromise_&&this.updatePromise_.resolve(),this.updatePromise_=null},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.handleError=function(a){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.handleError",a);var b=Error("EME v0.1b key error"),e=a.errorCode;e.systemCode=a.systemCode,b.errorCode=e,!a.sessionId&&this.generatePromise_?(45==a.systemCode&&(b.message="Unsupported session type."),this.generatePromise_.reject(b),this.generatePromise_=null):a.sessionId&&this.updatePromise_?(this.updatePromise_.reject(b),this.updatePromise_=null):(b=a.systemCode,a.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?this.updateKeyStatus_("output-restricted"):1==b?this.updateKeyStatus_("expired"):this.updateKeyStatus_("internal-error"))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generate_=function(a,b){var e=this,t=shaka.polyfill.PatchedMediaKeysWebkit;if(this.initialized_)return Promise.reject(Error("The session is already initialized."));this.initialized_=!0;try{if("persistent-license"==this.type_){var r=shaka.util.StringUtils;if(b)var n=shaka.util.BufferUtils.toUint8(r.toUTF8("LOAD_SESSION|"+b));else{goog.asserts.assert(a,"expecting init data");var g=r.toUTF8("PERSISTENT|");n=shaka.util.Uint8ArrayUtils.concat(g,a)}}else goog.asserts.assert("temporary"==this.type_,"expected temporary session"),goog.asserts.assert(!b,"unexpected offline session ID"),goog.asserts.assert(a,"expecting init data"),n=shaka.util.BufferUtils.toUint8(a);goog.asserts.assert(n,"init data not set!")}catch(e){return Promise.reject(e)}goog.asserts.assert(null==this.generatePromise_,"generatePromise_ should be null"),this.generatePromise_=new shaka.util.PublicPromise;var o=t.prefixApi_("generateKeyRequest");try{this.media_[o](this.keySystem_,n)}catch(t){if("InvalidStateError"!=t.name)return this.generatePromise_=null,Promise.reject(t);new shaka.util.Timer((function(){try{e.media_[o](e.keySystem_,n)}catch(t){e.generatePromise_.reject(t),e.generatePromise_=null}})).tickAfter(.01)}return this.generatePromise_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update_=function(a,b){var e=this,t=shaka.polyfill.PatchedMediaKeysWebkit;if(this.updatePromise_)this.updatePromise_.then((function(){return e.update_(a,b)})).catch((function(){return e.update_(a,b)}));else{if(this.updatePromise_=a,"webkit-org.w3.clearkey"==this.keySystem_){var r=shaka.util.Uint8ArrayUtils,n=shaka.util.StringUtils.fromUTF8(b),g=JSON.parse(n);"oct"!=g.keys[0].kty&&(this.updatePromise_.reject(Error("Response is not a valid JSON Web Key Set.")),this.updatePromise_=null),n=r.fromBase64(g.keys[0].k),r=r.fromBase64(g.keys[0].kid)}else n=shaka.util.BufferUtils.toUint8(b),r=null;t=t.prefixApi_("addKey");try{this.media_[t](this.keySystem_,n,r,this.sessionId)}catch(e){this.updatePromise_.reject(e),this.updatePromise_=null}}},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.updateKeyStatus_=function(a){this.keyStatuses.setStatus(a),a=new shaka.util.FakeEvent("keystatuseschange"),this.dispatchEvent(a)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.generateRequest=function(a,b){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.generateRequest"),this.generate_(b,null)},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.load=function(a){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.load"),"persistent-license"==this.type_?this.generate_(null,a):Promise.reject(Error("Not a persistent session."))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.update=function(a){shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.update",a),goog.asserts.assert(this.sessionId,"update without session ID");var b=new shaka.util.PublicPromise;return this.update_(b,a),b},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.close=function(){var a=shaka.polyfill.PatchedMediaKeysWebkit;if(shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.close"),"persistent-license"!=this.type_){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;a=a.prefixApi_("cancelKeyRequest");try{this.media_[a](this.keySystem_,this.sessionId)}catch(e){}}return this.closed.resolve(),this.closed},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeySession.prototype.remove=function(){return shaka.log.debug("PatchedMediaKeysWebkit.MediaKeySession.remove"),"persistent-license"!=this.type_?Promise.reject(Error("Not a persistent session.")):this.close()},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap=function(){this.size=0,this.status_=void 0},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.setStatus=function(a){this.size=null==a?0:1,this.status_=a},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.getStatus=function(){return this.status_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.forEach=function(a){this.status_&&a(this.status_,shaka.media.DrmEngine.DUMMY_KEY_ID.value())},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.get=function(a){if(this.has(a))return this.status_},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.has=function(a){var b=shaka.media.DrmEngine.DUMMY_KEY_ID.value();return!(!this.status_||!shaka.util.BufferUtils.equal(a,b))},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.entries=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.keys=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.MediaKeyStatusMap.prototype.values=function(){goog.asserts.assert(!1,"Not used!  Provided only for compiler.")},shaka.polyfill.PatchedMediaKeysWebkit.prefix_="",shaka.polyfill.register(shaka.polyfill.PatchedMediaKeysWebkit.install),shaka.polyfill.PiPWebkit=function(){},shaka.polyfill.PiPWebkit.install=function(){if(window.HTMLVideoElement){var a=HTMLVideoElement.prototype;if((!a.requestPictureInPicture||!document.exitPictureInPicture)&&a.webkitSupportsPresentationMode){var b=shaka.polyfill.PiPWebkit;shaka.log.debug("PiPWebkit.install"),document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,a.requestPictureInPicture=b.requestPictureInPicture_,Object.defineProperty(a,"disablePictureInPicture",{get:b.getDisablePictureInPicture_,set:b.setDisablePictureInPicture_,enumerable:!0,configurable:!0}),document.exitPictureInPicture=b.exitPictureInPicture_,document.addEventListener("webkitpresentationmodechanged",b.proxyEvent_,!0)}}},shaka.polyfill.PiPWebkit.proxyEvent_=function(a){if((a=a.target).webkitPresentationMode==shaka.polyfill.PiPWebkit.PIP_MODE_){document.pictureInPictureElement=a;var b=new Event("enterpictureinpicture");a.dispatchEvent(b)}else document.pictureInPictureElement==a&&(document.pictureInPictureElement=null),b=new Event("leavepictureinpicture"),a.dispatchEvent(b)},shaka.polyfill.PiPWebkit.requestPictureInPicture_=function(){var a=shaka.polyfill.PiPWebkit;return this.webkitSupportsPresentationMode(a.PIP_MODE_)?(this.webkitSetPresentationMode(a.PIP_MODE_),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))},shaka.polyfill.PiPWebkit.exitPictureInPicture_=function(){var a=shaka.polyfill.PiPWebkit,b=document.pictureInPictureElement;return b?(b.webkitSetPresentationMode(a.INLINE_MODE_),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))},shaka.polyfill.PiPWebkit.getDisablePictureInPicture_=function(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode(shaka.polyfill.PiPWebkit.PIP_MODE_)},shaka.polyfill.PiPWebkit.setDisablePictureInPicture_=function(a){a?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")},shaka.polyfill.PiPWebkit.PIP_MODE_="picture-in-picture",shaka.polyfill.PiPWebkit.INLINE_MODE_="inline",shaka.polyfill.register(shaka.polyfill.PiPWebkit.install),shaka.polyfill.VideoPlayPromise=function(){},shaka.polyfill.VideoPlayPromise.install=function(){if(shaka.log.debug("VideoPlayPromise.install"),window.HTMLMediaElement){var a=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var b=a.apply(this);return b&&b.catch((function(){})),b}}},shaka.polyfill.register(shaka.polyfill.VideoPlayPromise.install),shaka.polyfill.VideoPlaybackQuality=function(){},shaka.polyfill.VideoPlaybackQuality.install=function(){if(window.HTMLVideoElement){var a=HTMLVideoElement.prototype;!a.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in a&&(a.getVideoPlaybackQuality=shaka.polyfill.VideoPlaybackQuality.webkit_)}},shaka.polyfill.VideoPlaybackQuality.webkit_=function(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}},shaka.polyfill.register(shaka.polyfill.VideoPlaybackQuality.install),shaka.polyfill.VTTCue=function(){},shaka.polyfill.VTTCue.install=function(){if(window.VTTCue)shaka.log.info("Using native VTTCue.");else if(window.TextTrackCue){var a=TextTrackCue.length;3==a?(shaka.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),window.VTTCue=shaka.polyfill.VTTCue.from3ArgsTextTrackCue_):6==a?(shaka.log.info("Using VTTCue polyfill from 6 argument TextTrackCue."),window.VTTCue=shaka.polyfill.VTTCue.from6ArgsTextTrackCue_):shaka.polyfill.VTTCue.canUse3ArgsTextTrackCue_()&&(shaka.log.info("Using VTTCue polyfill from 3 argument TextTrackCue."),window.VTTCue=shaka.polyfill.VTTCue.from3ArgsTextTrackCue_)}else shaka.log.error("VTTCue not available.")},shaka.polyfill.VTTCue.from3ArgsTextTrackCue_=function(a,b,e){return new window.TextTrackCue(a,b,e)},shaka.polyfill.VTTCue.from6ArgsTextTrackCue_=function(a,b,e){return new window.TextTrackCue(a+"-"+b+"-"+e,a,b,e)},shaka.polyfill.VTTCue.canUse3ArgsTextTrackCue_=function(){try{return!!shaka.polyfill.VTTCue.from3ArgsTextTrackCue_(1,2,"")}catch(e){return!1}},shaka.polyfill.register(shaka.polyfill.VTTCue.install),shaka.text.TtmlTextParser=function(){},shaka.text.TtmlTextParser.prototype.parseInit=function(a){goog.asserts.assert(!1,"TTML does not have init segments")},shaka.text.TtmlTextParser.prototype.parseMedia=function(a,b){var e=shaka.text.TtmlTextParser,t=shaka.util.XmlUtils,r=e.parameterNs_,n=shaka.util.StringUtils.fromUTF8(a),g=[],o=new DOMParser,l=null;if(""==n)return g;try{l=o.parseFromString(n,"text/xml")}catch(e){throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"Failed to parse TTML.")}if(l){if(n=l.getElementsByTagName("parsererror")[0])throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,n.textContent);if(!(l=l.getElementsByTagName("tt")[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"TTML does not contain <tt> tag.");n=t.getAttributeNS(l,r,"frameRate"),o=t.getAttributeNS(l,r,"subFrameRate");var h=t.getAttributeNS(l,r,"frameRateMultiplier"),d=t.getAttributeNS(l,r,"tickRate"),c=t.getAttributeNS(l,r,"cellResolution");if(t=l.getAttribute("xml:space")||"default",r=l.getAttribute("tts:extent"),"default"!=t&&"preserve"!=t)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_XML,"Invalid xml:space value: "+t);t="default"==t,n=new e.RateInfo_(n,o,h,d),o=e.getCellResolution_(c),h=e.getLeafNodes_(l.getElementsByTagName("metadata")[0]),d=e.getLeafNodes_(l.getElementsByTagName("styling")[0]),c=e.getLeafNodes_(l.getElementsByTagName("layout")[0]);for(var p=[],q=$jscomp.makeIterator(c),m=q.next();!m.done;m=q.next())(m=e.parseCueRegion_(m.value,d,r))&&p.push(m);for(l=e.getLeafCues_(l.getElementsByTagName("body")[0]),r=(l=$jscomp.makeIterator(l)).next();!r.done;r=l.next())(r=e.parseCue_(r.value,b.periodStart,n,h,d,c,p,t,!1,o))&&g.push(r)}return g},shaka.text.TtmlTextParser.getLeafNodes_=function(a){var b=[];if(!a)return b;for(var e=$jscomp.makeIterator(a.childNodes),t=e.next();!t.done;t=e.next())(t=t.value).nodeType==Node.ELEMENT_NODE&&"br"!==t.nodeName&&(goog.asserts.assert(t instanceof Element,"Node should be Element!"),t=shaka.text.TtmlTextParser.getLeafNodes_(t),goog.asserts.assert(0<t.length,"Only a null Element should return no leaves!"),b=b.concat(t));return b.length||b.push(a),b},shaka.text.TtmlTextParser.getLeafCues_=function(a){if(!a)return[];for(var b=[],e=(a=$jscomp.makeIterator(a.childNodes)).next();!e.done;e=a.next())(e=e.value)instanceof Element&&(e.hasAttribute("begin")?b.push(e):b=b.concat(shaka.text.TtmlTextParser.getLeafCues_(e)));return b},shaka.text.TtmlTextParser.sanitizeTextContent_=function(a,b){for(var e="",t=$jscomp.makeIterator(a.childNodes),r=t.next();!r.done;r=t.next())"br"==(r=r.value).nodeName&&a.childNodes[0]!==r?e+="\n":r.childNodes&&0<r.childNodes.length?e+=shaka.text.TtmlTextParser.sanitizeTextContent_(r,b):b?e+=r=(r=r.textContent.trim()).replace(/\s+/g," "):e+=r.textContent;return e},shaka.text.TtmlTextParser.parseCue_=function(a,b,e,t,r,n,g,o,l,h){if(l&&"br"==a.nodeName)return(a=new shaka.text.Cue(0,0,"")).spacer=!0,a;var d=/^[\s\n]*$/.test(a.textContent),c=a.nodeType==Node.ELEMENT_NODE&&!a.hasAttribute("begin")&&!a.hasAttribute("end");if(a.nodeType!=Node.ELEMENT_NODE||c&&d||c&&!l)return null;d=shaka.text.TtmlTextParser.parseTime_(a.getAttribute("begin"),e),c=shaka.text.TtmlTextParser.parseTime_(a.getAttribute("end"),e);var p=shaka.text.TtmlTextParser.parseTime_(a.getAttribute("dur"),e);if(null==c&&null!=p&&(c=d+p),!l&&(null==d||null==c))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE);if(d=l&&null==d?0:d+b,c=l&&null==c?0:c+b,p="",l=[],Array.from(a.childNodes).some((function(a){return a.nodeType==Node.TEXT_NODE&&/\S+/.test(a.textContent)})))p=shaka.text.TtmlTextParser.sanitizeTextContent_(a,o);else for(var q=$jscomp.makeIterator(a.childNodes),m=q.next();!m.done;m=q.next())(m=shaka.text.TtmlTextParser.parseCue_(m.value,b,e,t,r,n,g,o,!0,h))&&(m.startTime=m.startTime||d,m.endTime=m.endTime||c,l.push(m));if((b=new shaka.text.Cue(d,c,p)).nestedCues=l,h&&(b.cellResolution=h),(n=shaka.text.TtmlTextParser.getElementsFromCollection_(a,"region",n,"")[0])&&n.getAttribute("xml:id")){var u=n.getAttribute("xml:id");b.region=g.filter((function(a){return a.id==u}))[0]}return t=shaka.text.TtmlTextParser.getElementsFromCollection_(a,"smpte:backgroundImage",t,"#")[0],shaka.text.TtmlTextParser.addStyle_(b,a,n,t,r),b},shaka.text.TtmlTextParser.parseCueRegion_=function(a,b,e){var g,t,r=shaka.text.TtmlTextParser,n=new shaka.text.CueRegion,o=a.getAttribute("xml:id");return o?(n.id=o,o=null,e&&(o=r.percentValues_.exec(e)||r.pixelValues_.exec(e)),e=o?Number(o[1]):null,o=o?Number(o[2]):null,(g=r.getStyleAttributeFromRegion_(a,b,"extent"))&&(null!=(g=(t=r.percentValues_.exec(g))||r.pixelValues_.exec(g))&&(n.width=null!=e?100*Number(g[1])/e:Number(g[1]),n.height=null!=o?100*Number(g[2])/o:Number(g[2]),n.widthUnits=t||null!=e?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX,n.heightUnits=t||null!=o?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX)),(a=r.getStyleAttributeFromRegion_(a,b,"origin"))&&(null!=(g=(t=r.percentValues_.exec(a))||r.pixelValues_.exec(a))&&(n.viewportAnchorX=null!=o?100*Number(g[1])/o:Number(g[1]),n.viewportAnchorY=null!=e?100*Number(g[2])/e:Number(g[2]),n.viewportAnchorUnits=t||null!=e?shaka.text.CueRegion.units.PERCENTAGE:shaka.text.CueRegion.units.PX)),n):(shaka.log.warning("TtmlTextParser parser encountered a region with no id. Region will be ignored."),null)},shaka.text.TtmlTextParser.addStyle_=function(a,b,e,t,r){var n=shaka.text.TtmlTextParser,g=shaka.text.Cue;"rtl"==n.getStyleAttribute_(b,e,r,"direction")&&(a.direction=g.direction.HORIZONTAL_RIGHT_TO_LEFT);var o=n.getStyleAttribute_(b,e,r,"writingMode");"tb"==o||"tblr"==o?a.writingMode=g.writingMode.VERTICAL_LEFT_TO_RIGHT:"tbrl"==o?a.writingMode=g.writingMode.VERTICAL_RIGHT_TO_LEFT:"rltb"==o||"rl"==o?a.direction=g.direction.HORIZONTAL_RIGHT_TO_LEFT:o&&(a.direction=g.direction.HORIZONTAL_LEFT_TO_RIGHT),(o=n.getStyleAttribute_(b,e,r,"textAlign"))?(a.positionAlign=n.textAlignToPositionAlign_[o],a.lineAlign=n.textAlignToLineAlign_[o],goog.asserts.assert(o.toUpperCase()in g.textAlign,o.toUpperCase()+" Should be in Cue.textAlign values!"),a.textAlign=g.textAlign[o.toUpperCase()]):a.textAlign=g.textAlign.START,(o=n.getStyleAttribute_(b,e,r,"displayAlign"))&&(goog.asserts.assert(o.toUpperCase()in g.displayAlign,o.toUpperCase()+" Should be in Cue.displayAlign values!"),a.displayAlign=g.displayAlign[o.toUpperCase()]),(o=n.getStyleAttribute_(b,e,r,"color"))&&(a.color=o),(o=n.getStyleAttribute_(b,e,r,"backgroundColor"))&&(a.backgroundColor=o),(o=n.getStyleAttribute_(b,e,r,"border"))&&(a.border=o),(o=n.getStyleAttribute_(b,e,r,"fontFamily"))&&(a.fontFamily=o),(o=n.getStyleAttribute_(b,e,r,"fontWeight"))&&"bold"==o&&(a.fontWeight=g.fontWeight.BOLD),(o=n.getStyleAttribute_(b,e,r,"wrapOption"))&&"noWrap"==o&&(a.wrapLine=!1),(o=n.getStyleAttribute_(b,e,r,"lineHeight"))&&o.match(n.unitValues_)&&(a.lineHeight=o),(o=n.getStyleAttribute_(b,e,r,"fontSize"))&&(o.match(n.unitValues_)||o.match(n.percentValue_))&&(a.fontSize=o),(o=n.getStyleAttribute_(b,e,r,"fontStyle"))&&(goog.asserts.assert(o.toUpperCase()in g.fontStyle,o.toUpperCase()+" Should be in Cue.fontStyle values!"),a.fontStyle=g.fontStyle[o.toUpperCase()]),t&&(g=t.getAttribute("imagetype"),o=t.getAttribute("encoding"),t=t.textContent.trim(),"PNG"==g&&"Base64"==o&&t&&(a.backgroundImage="data:image/png;base64,"+t)),(t=n.getStyleAttribute_(b,e,r,"letterSpacing"))&&t.match(n.unitValues_)&&(a.letterSpacing=t),(t=n.getStyleAttribute_(b,e,r,"linePadding"))&&t.match(n.unitValues_)&&(a.linePadding=t),(t=n.getStyleAttribute_(b,e,r,"opacity"))&&(a.opacity=parseFloat(t)),(e=n.getStyleAttributeFromRegion_(e,r,"textDecoration"))&&n.addTextDecoration_(a,e),(b=n.getStyleAttributeFromElement_(b,r,"textDecoration"))&&n.addTextDecoration_(a,b)},shaka.text.TtmlTextParser.addTextDecoration_=function(a,b){for(var e=shaka.text.Cue,t=$jscomp.makeIterator(b.split(" ")),r=t.next();!r.done;r=t.next())switch(r.value){case"underline":a.textDecoration.includes(e.textDecoration.UNDERLINE)||a.textDecoration.push(e.textDecoration.UNDERLINE);break;case"noUnderline":a.textDecoration.includes(e.textDecoration.UNDERLINE)&&shaka.util.ArrayUtils.remove(a.textDecoration,e.textDecoration.UNDERLINE);break;case"lineThrough":a.textDecoration.includes(e.textDecoration.LINE_THROUGH)||a.textDecoration.push(e.textDecoration.LINE_THROUGH);break;case"noLineThrough":a.textDecoration.includes(e.textDecoration.LINE_THROUGH)&&shaka.util.ArrayUtils.remove(a.textDecoration,e.textDecoration.LINE_THROUGH);break;case"overline":a.textDecoration.includes(e.textDecoration.OVERLINE)||a.textDecoration.push(e.textDecoration.OVERLINE);break;case"noOverline":a.textDecoration.includes(e.textDecoration.OVERLINE)&&shaka.util.ArrayUtils.remove(a.textDecoration,e.textDecoration.OVERLINE)}},shaka.text.TtmlTextParser.getStyleAttribute_=function(a,b,e,t){var r=shaka.text.TtmlTextParser;return(a=r.getStyleAttributeFromElement_(a,e,t))?a:r.getStyleAttributeFromRegion_(b,e,t)},shaka.text.TtmlTextParser.getStyleAttributeFromRegion_=function(a,b,e){for(var t=shaka.util.XmlUtils,r=shaka.text.TtmlTextParser.styleNs_,n=shaka.text.TtmlTextParser.getLeafNodes_(a),g=(n=$jscomp.makeIterator(n)).next();!g.done;g=n.next())if(g=t.getAttributeNS(g.value,r,e))return g;return(a=shaka.text.TtmlTextParser.getElementsFromCollection_(a,"style",b,"")[0])?t.getAttributeNS(a,r,e):null},shaka.text.TtmlTextParser.getStyleAttributeFromElement_=function(a,b,e){var t=shaka.util.XmlUtils,r=shaka.text.TtmlTextParser.styleNs_,n=shaka.text.TtmlTextParser.styleEbuttsNs_,g=t.getAttributeNS(a,r,e);if(g)return g;for(a=shaka.text.TtmlTextParser.getElementsFromCollection_(a,"style",b,""),b=null,g=0;g<a.length;g++){var o=t.getAttributeNS(a[g],r,e);o&&(b=o),(o=t.getAttributeNS(a[g],n,e))&&(b=o)}return b},shaka.text.TtmlTextParser.getElementsFromCollection_=function(a,b,e,t){var r=[];if(!a||1>e.length)return r;if(a=shaka.text.TtmlTextParser.getInheritedAttribute_(a,b))for(a=a.split(" "),b=(a=$jscomp.makeIterator(a)).next();!b.done;b=a.next()){b=b.value;for(var n=$jscomp.makeIterator(e),g=n.next();!g.done;g=n.next())if(t+(g=g.value).getAttribute("xml:id")==b){r.push(g);break}}return r},shaka.text.TtmlTextParser.getInheritedAttribute_=function(a,b){for(var e=null;a&&!(e=a.getAttribute(b));){var t=a.parentNode;if(!(t instanceof Element))break;a=t}return e},shaka.text.TtmlTextParser.parseTime_=function(a,b){var e=null,t=shaka.text.TtmlTextParser;return t.timeColonFormatFrames_.test(a)?e=t.parseColonTimeWithFrames_(b,a):t.timeColonFormat_.test(a)?e=t.parseTimeFromRegex_(t.timeColonFormat_,a):t.timeColonFormatMilliseconds_.test(a)?e=t.parseTimeFromRegex_(t.timeColonFormatMilliseconds_,a):t.timeFramesFormat_.test(a)?e=t.parseFramesTime_(b,a):t.timeTickFormat_.test(a)?e=t.parseTickTime_(b,a):t.timeHMSFormat_.test(a)&&(e=t.parseTimeFromRegex_(t.timeHMSFormat_,a)),e},shaka.text.TtmlTextParser.parseFramesTime_=function(a,b){var e=shaka.text.TtmlTextParser.timeFramesFormat_.exec(b);return Number(e[1])/a.frameRate},shaka.text.TtmlTextParser.parseTickTime_=function(a,b){var e=shaka.text.TtmlTextParser.timeTickFormat_.exec(b);return Number(e[1])/a.tickRate},shaka.text.TtmlTextParser.parseColonTimeWithFrames_=function(a,b){var e=shaka.text.TtmlTextParser.timeColonFormatFrames_.exec(b),t=Number(e[1]),r=Number(e[2]),n=Number(e[3]),g=Number(e[4]);return(n+=(g+=(Number(e[5])||0)/a.subFrameRate)/a.frameRate)+60*r+3600*t},shaka.text.TtmlTextParser.parseTimeFromRegex_=function(a,b){var e=a.exec(b);return null==e||""==e[0]?null:(Number(e[4])||0)/1e3+(Number(e[3])||0)+60*(Number(e[2])||0)+3600*(Number(e[1])||0)},shaka.text.TtmlTextParser.getCellResolution_=function(a){if(!a)return null;var b=/^(\d+) (\d+)$/.exec(a);return b?{columns:a=parseInt(b[1],10),rows:b=parseInt(b[2],10)}:null},goog.exportSymbol("shaka.text.TtmlTextParser",shaka.text.TtmlTextParser),goog.exportProperty(shaka.text.TtmlTextParser.prototype,"parseMedia",shaka.text.TtmlTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.TtmlTextParser.prototype,"parseInit",shaka.text.TtmlTextParser.prototype.parseInit),shaka.text.TtmlTextParser.RateInfo_=function(a,b,e,t){this.frameRate=Number(a)||30,this.subFrameRate=Number(b)||1,this.tickRate=Number(t),0==this.tickRate&&(this.tickRate=a?this.frameRate*this.subFrameRate:1),e&&(a=/^(\d+) (\d+)$/g.exec(e))&&(this.frameRate*=Number(a[1])/Number(a[2]))},shaka.text.TtmlTextParser.percentValues_=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,shaka.text.TtmlTextParser.percentValue_=/^(\d{1,2}(?:\.\d+)?|100)%$/;shaka.text.TtmlTextParser.unitValues_=/^(\d+px|\d+em|\d*\.?\d+c)$/,shaka.text.TtmlTextParser.pixelValues_=/^(\d+)px (\d+)px$/,shaka.text.TtmlTextParser.timeColonFormatFrames_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,shaka.text.TtmlTextParser.timeColonFormat_=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,shaka.text.TtmlTextParser.timeColonFormatMilliseconds_=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,shaka.text.TtmlTextParser.timeFramesFormat_=/^(\d*(?:\.\d*)?)f$/,shaka.text.TtmlTextParser.timeTickFormat_=/^(\d*(?:\.\d*)?)t$/,shaka.text.TtmlTextParser.timeHMSFormat_=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,shaka.text.TtmlTextParser.textAlignToLineAlign_={left:shaka.text.Cue.lineAlign.START,center:shaka.text.Cue.lineAlign.CENTER,right:shaka.text.Cue.lineAlign.END,start:shaka.text.Cue.lineAlign.START,end:shaka.text.Cue.lineAlign.END},shaka.text.TtmlTextParser.textAlignToPositionAlign_={left:shaka.text.Cue.positionAlign.LEFT,center:shaka.text.Cue.positionAlign.CENTER,right:shaka.text.Cue.positionAlign.RIGHT},shaka.text.TtmlTextParser.parameterNs_="http://www.w3.org/ns/ttml#parameter",shaka.text.TtmlTextParser.styleNs_="http://www.w3.org/ns/ttml#styling",shaka.text.TtmlTextParser.styleEbuttsNs_="urn:ebu:tt:style",shaka.text.TextEngine.registerParser("application/ttml+xml",(function(){return new shaka.text.TtmlTextParser})),shaka.text.Mp4TtmlParser=function(){this.parser_=new shaka.text.TtmlTextParser},shaka.text.Mp4TtmlParser.prototype.parseInit=function(a){var b=shaka.util.Mp4Parser,e=!1;if((new b).box("moov",b.children).box("trak",b.children).box("mdia",b.children).box("minf",b.children).box("stbl",b.children).fullBox("stsd",b.sampleDescription).box("stpp",(function(a){e=!0,a.parser.stop()})).parse(a),!e)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_TTML)},shaka.text.Mp4TtmlParser.prototype.parseMedia=function(a,b){var e=this,t=shaka.util.Mp4Parser,r=!1,n=[];if((new t).box("mdat",t.allData((function(a){r=!0,n=n.concat(e.parser_.parseMedia(a,b))}))).parse(a,!1),!r)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_TTML);return n},goog.exportSymbol("shaka.text.Mp4TtmlParser",shaka.text.Mp4TtmlParser),goog.exportProperty(shaka.text.Mp4TtmlParser.prototype,"parseMedia",shaka.text.Mp4TtmlParser.prototype.parseMedia),goog.exportProperty(shaka.text.Mp4TtmlParser.prototype,"parseInit",shaka.text.Mp4TtmlParser.prototype.parseInit),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp"',(function(){return new shaka.text.Mp4TtmlParser})),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp.ttml.im1t"',(function(){return new shaka.text.Mp4TtmlParser})),shaka.text.TextEngine.registerParser('application/mp4; codecs="stpp.TTML.im1t"',(function(){return new shaka.text.Mp4TtmlParser})),shaka.text.VttTextParser=function(){},shaka.text.VttTextParser.prototype.parseInit=function(a){goog.asserts.assert(!1,"VTT does not have init segments")},shaka.text.VttTextParser.prototype.parseMedia=function(a,b){var e=shaka.text.VttTextParser,t=shaka.util.StringUtils.fromUTF8(a);if(t=(t=t.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(t[0]))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_HEADER);var r=b.segmentStart;if(t[0].includes("X-TIMESTAMP-MAP")){var n=t[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),g=t[0].match(/MPEGTS:(\d+)/m);if(n&&g){if(r=new shaka.util.TextParser(n[1]),null==(r=shaka.text.VttTextParser.parseTime_(r)))throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_HEADER);g=Number(g[1]),n=shaka.text.VttTextParser.MPEG_TIMESCALE_;for(var o=shaka.text.VttTextParser.TS_ROLLOVER_/n,l=b.segmentStart;l>=o;)l-=o,g+=shaka.text.VttTextParser.TS_ROLLOVER_;r=b.periodStart+g/n-r}}for(g=[],o=(n=$jscomp.makeIterator(t[0].split("\n"))).next();!o.done;o=n.next())o=o.value,/^Region:/.test(o)&&(o=e.parseRegion_(o),g.push(o));for(n=[],o=(t=$jscomp.makeIterator(t.slice(1))).next();!o.done;o=t.next())o=o.value.split("\n"),(o=e.parseCue_(o,r,g))&&n.push(o);return n},shaka.text.VttTextParser.parseRegion_=function(a){var b=shaka.text.VttTextParser;a=new shaka.util.TextParser(a);var e=new shaka.text.CueRegion;a.readWord(),a.skipWhitespace();for(var t=a.readWord();t;)b.parseRegionSetting_(e,t)||shaka.log.warning("VTT parser encountered an invalid VTTRegion setting: ",t," The setting will be ignored."),a.skipWhitespace(),t=a.readWord();return e},shaka.text.VttTextParser.parseCue_=function(a,b,e){var t=shaka.text.VttTextParser;if(1==a.length&&!a[0]||/^NOTE($|[ \t])/.test(a[0])||"STYLE"==a[0])return null;var r=null;a[0].includes("--\x3e")||(r=a[0],a.splice(0,1));var n=new shaka.util.TextParser(a[0]),g=t.parseTime_(n),o=n.readRegex(/[ \t]+--\x3e[ \t]+/g),l=t.parseTime_(n);if(null==g||null==o||null==l)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_TEXT_CUE);for(g+=b,l+=b,a=a.slice(1).join("\n").trim(),g=new shaka.text.Cue(g,l,a),n.skipWhitespace(),l=n.readWord();l;)t.parseCueSetting(g,l,e)||shaka.log.warning("VTT parser encountered an invalid VTT setting: ",l," The setting will be ignored."),n.skipWhitespace(),l=n.readWord();return null!=r&&(g.id=r),g},shaka.text.VttTextParser.parseCueSetting=function(a,b,e){var t,r=shaka.text.VttTextParser;if(t=/^align:(start|middle|center|end|left|right)$/.exec(b))r.setTextAlign_(a,t[1]);else if(t=/^vertical:(lr|rl)$/.exec(b))r.setVerticalWritingMode_(a,t[1]);else if(t=/^size:([\d.]+)%$/.exec(b))a.size=Number(t[1]);else if(t=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(b))a.position=Number(t[1]),t[2]&&r.setPositionAlign_(a,t[2]);else{if(!(t=/^region:(.*)$/.exec(b)))return r.parsedLineValueAndInterpretation_(a,b);(b=r.getRegionById_(e,t[1]))&&(a.region=b)}return!0},shaka.text.VttTextParser.getRegionById_=function(a,b){var e=a.filter((function(a){return a.id==b}));return e.length?(goog.asserts.assert(1==e.length,"VTTRegion ids should be unique!"),e[0]):(shaka.log.warning("VTT parser could not find a region with id: ",b," The region will be ignored."),null)},shaka.text.VttTextParser.parseRegionSetting_=function(a,b){var e;if(e=/^id=(.*)$/.exec(b))a.id=e[1];else if(e=/^width=(\d{1,2}|100)%$/.exec(b))a.width=Number(e[1]);else if(e=/^lines=(\d+)$/.exec(b))a.height=Number(e[1]),a.heightUnits=shaka.text.CueRegion.units.LINES;else if(e=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(b))a.regionAnchorX=Number(e[1]),a.regionAnchorY=Number(e[2]);else if(e=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(b))a.viewportAnchorX=Number(e[1]),a.viewportAnchorY=Number(e[2]);else{if(!/^scroll=up$/.exec(b))return!1;a.scroll=shaka.text.CueRegion.scrollMode.UP}return!0},shaka.text.VttTextParser.setTextAlign_=function(a,b){var e=shaka.text.Cue;"middle"==b?a.textAlign=e.textAlign.CENTER:(goog.asserts.assert(b.toUpperCase()in e.textAlign,b.toUpperCase()+" Should be in Cue.textAlign values!"),a.textAlign=e.textAlign[b.toUpperCase()])},shaka.text.VttTextParser.setPositionAlign_=function(a,b){var e=shaka.text.Cue;a.positionAlign="line-left"==b||"start"==b?e.positionAlign.LEFT:"line-right"==b||"end"==b?e.positionAlign.RIGHT:e.positionAlign.CENTER},shaka.text.VttTextParser.setVerticalWritingMode_=function(a,b){var e=shaka.text.Cue;a.writingMode="lr"==b?e.writingMode.VERTICAL_LEFT_TO_RIGHT:e.writingMode.VERTICAL_RIGHT_TO_LEFT},shaka.text.VttTextParser.parsedLineValueAndInterpretation_=function(a,b){var e,t=shaka.text.Cue;if(e=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(b))a.lineInterpretation=t.lineInterpretation.PERCENTAGE,a.line=Number(e[1]),e[2]&&(goog.asserts.assert(e[2].toUpperCase()in t.lineAlign,e[2].toUpperCase()+" Should be in Cue.lineAlign values!"),a.lineAlign=t.lineAlign[e[2].toUpperCase()]);else{if(!(e=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(b)))return!1;a.lineInterpretation=t.lineInterpretation.LINE_NUMBER,a.line=Number(e[1]),e[2]&&(goog.asserts.assert(e[2].toUpperCase()in t.lineAlign,e[2].toUpperCase()+" Should be in Cue.lineAlign values!"),a.lineAlign=t.lineAlign[e[2].toUpperCase()])}return!0},shaka.text.VttTextParser.parseTime_=function(a){if(null==(a=a.readRegex(/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g)))return null;var b=Number(a[2]),e=Number(a[3]);return 59<b||59<e?null:Number(a[4])/1e3+e+60*b+3600*(Number(a[1])||0)},goog.exportSymbol("shaka.text.VttTextParser",shaka.text.VttTextParser),goog.exportProperty(shaka.text.VttTextParser.prototype,"parseMedia",shaka.text.VttTextParser.prototype.parseMedia),goog.exportProperty(shaka.text.VttTextParser.prototype,"parseInit",shaka.text.VttTextParser.prototype.parseInit),shaka.text.VttTextParser.MPEG_TIMESCALE_=9e4,shaka.text.VttTextParser.TS_ROLLOVER_=8589934592,shaka.text.TextEngine.registerParser("text/vtt",(function(){return new shaka.text.VttTextParser})),shaka.text.TextEngine.registerParser('text/vtt; codecs="vtt"',(function(){return new shaka.text.VttTextParser})),shaka.text.Mp4VttParser=function(){this.timescale_=null},shaka.text.Mp4VttParser.prototype.parseInit=function(a){var b=this,e=shaka.util.Mp4Parser,t=!1;if((new e).box("moov",e.children).box("trak",e.children).box("mdia",e.children).fullBox("mdhd",(function(a){goog.asserts.assert(0==a.version||1==a.version,"MDHD version can only be 0 or 1"),a=shaka.util.Mp4BoxParsers.parseMDHD(a.reader,a.version),b.timescale_=a.timescale})).box("minf",e.children).box("stbl",e.children).fullBox("stsd",e.sampleDescription).box("wvtt",(function(a){t=!0})).parse(a),!this.timescale_)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);if(!t)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT)},shaka.text.Mp4VttParser.prototype.parseMedia=function(a,b){if(!this.timescale_)throw shaka.log.error("No init segment for MP4+VTT!"),new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);var e,t=shaka.util.Mp4Parser,r=0,n=[],g=[],o=!1,l=!1,h=!1,d=null;if((new t).box("moof",t.children).box("traf",t.children).fullBox("tfdt",(function(a){o=!0,goog.asserts.assert(0==a.version||1==a.version,"TFDT version can only be 0 or 1"),r=shaka.util.Mp4BoxParsers.parseTFDT(a.reader,a.version).baseMediaDecodeTime})).fullBox("tfhd",(function(a){goog.asserts.assert(null!=a.flags,"A TFHD box should have a valid flags value"),d=shaka.util.Mp4BoxParsers.parseTFHD(a.reader,a.flags).defaultSampleDuration})).fullBox("trun",(function(a){l=!0,goog.asserts.assert(null!=a.version,"A TRUN box should have a valid version value"),goog.asserts.assert(null!=a.flags,"A TRUN box should have a valid flags value"),n=shaka.util.Mp4BoxParsers.parseTRUN(a.reader,a.version,a.flags).sampleData})).box("mdat",t.allData((function(a){goog.asserts.assert(!h,"VTT cues in mp4 with multiple MDAT are not currently supported"),h=!0,e=a}))).parse(a,!1),!h&&!o&&!l)throw new shaka.util.Error(shaka.util.Error.Severity.CRITICAL,shaka.util.Error.Category.TEXT,shaka.util.Error.Code.INVALID_MP4_VTT);t=r;for(var c=new shaka.util.DataViewReader(e,shaka.util.DataViewReader.Endianness.BIG_ENDIAN),p=$jscomp.makeIterator(n),q=p.next();!q.done;q=p.next()){var m=(q=q.value).sampleDuration||d,u=q.sampleCompositionTimeOffset?r+q.sampleCompositionTimeOffset:t;t=u+(m||0);var f=0;do{var _=c.readUint32();f+=_;var y=c.readUint32(),k=null;"vttc"==(y=shaka.util.Mp4Parser.typeToString(y))?8<_&&(k=c.readBytes(_-8)):("vtte"!=y&&shaka.log.error("Unknown box "+y+"! Skipping!"),c.skip(_-8)),m?k&&(goog.asserts.assert(null!=this.timescale_,"Timescale should not be null!"),_=shaka.text.Mp4VttParser.parseVTTC_(k,b.periodStart+u/this.timescale_,b.periodStart+t/this.timescale_),g.push(_)):shaka.log.error("WVTT sample duration unknown, and no default found!"),goog.asserts.assert(!q.sampleSize||f<=q.sampleSize,"The samples do not fit evenly into the sample sizes given in the TRUN box!")}while(q.sampleSize&&f<q.sampleSize)}return goog.asserts.assert(!c.hasMoreData(),"MDAT which contain VTT cues and non-VTT data are not currently supported!"),g.filter(shaka.util.Functional.isNotNull)},shaka.text.Mp4VttParser.parseVTTC_=function(a,b,e){var t,r,n;return(new shaka.util.Mp4Parser).box("payl",shaka.util.Mp4Parser.allData((function(a){t=shaka.util.StringUtils.fromUTF8(a)}))).box("iden",shaka.util.Mp4Parser.allData((function(a){r=shaka.util.StringUtils.fromUTF8(a)}))).box("sttg",shaka.util.Mp4Parser.allData((function(a){n=shaka.util.StringUtils.fromUTF8(a)}))).parse(a),t?shaka.text.Mp4VttParser.assembleCue_(t,r,n,b,e):null},shaka.text.Mp4VttParser.assembleCue_=function(a,b,e,t,r){if(a=new shaka.text.Cue(t,r,a),b&&(a.id=b),e)for(e=(b=new shaka.util.TextParser(e)).readWord();e;)shaka.text.VttTextParser.parseCueSetting(a,e,[])||shaka.log.warning("VTT parser encountered an invalid VTT setting: ",e," The setting will be ignored."),b.skipWhitespace(),e=b.readWord();return a},goog.exportSymbol("shaka.text.Mp4VttParser",shaka.text.Mp4VttParser),goog.exportProperty(shaka.text.Mp4VttParser.prototype,"parseMedia",shaka.text.Mp4VttParser.prototype.parseMedia),goog.exportProperty(shaka.text.Mp4VttParser.prototype,"parseInit",shaka.text.Mp4VttParser.prototype.parseInit),shaka.text.TextEngine.registerParser('application/mp4; codecs="wvtt"',(function(){return new shaka.text.Mp4VttParser}));var EmeEncryptionSchemePolyfill=function(){};EmeEncryptionSchemePolyfill.install=function(){EmeEncryptionSchemePolyfill.originalRMKSA_?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(EmeEncryptionSchemePolyfill.originalRMKSA_=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.probeRMKSA_):console.debug("EmeEncryptionSchemePolyfill: EME not found")},EmeEncryptionSchemePolyfill.probeRMKSA_=function(a,b){var e,t=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(r){return 1==r.nextAddress?(console.assert(t==navigator,'bad "this" for requestMediaKeySystemAccess'),r.yield(EmeEncryptionSchemePolyfill.originalRMKSA_.call(t,a,b),2)):hasEncryptionScheme(e=r.yieldResult)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.originalRMKSA_,r.return(e)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=EmeEncryptionSchemePolyfill.polyfillRMKSA_,r.return(EmeEncryptionSchemePolyfill.polyfillRMKSA_.call(t,a,b)))}))},EmeEncryptionSchemePolyfill.polyfillRMKSA_=function(a,b){var e,t,r,g,n,o,l,h,d,p,c=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(q){if(1==q.nextAddress){for(console.assert(c==navigator,'bad "this" for requestMediaKeySystemAccess'),e=guessSupportedScheme(a),t=[],r=$jscomp.makeIterator(b),g=r.next();!g.done;g=r.next())n=g.value,o=EmeEncryptionSchemePolyfill.filterCapabilities_(n.videoCapabilities,e),l=EmeEncryptionSchemePolyfill.filterCapabilities_(n.audioCapabilities,e),n.videoCapabilities&&n.videoCapabilities.length&&!o.length||n.audioCapabilities&&n.audioCapabilities.length&&!l.length||((h=Object.assign({},n)).videoCapabilities=o,h.audioCapabilities=l,t.push(h));if(!t.length)throw(d=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",d.code=DOMException.NOT_SUPPORTED_ERR,d;return q.yield(EmeEncryptionSchemePolyfill.originalRMKSA_.call(c,a,t),2)}return p=q.yieldResult,q.return(new EmeEncryptionSchemePolyfillMediaKeySystemAccess(p,e))}))},EmeEncryptionSchemePolyfill.filterCapabilities_=function(a,b){return a?a.filter((function(a){return!a.encryptionScheme||a.encryptionScheme==b})):a},goog.exportSymbol("EmeEncryptionSchemePolyfill",EmeEncryptionSchemePolyfill),goog.exportProperty(EmeEncryptionSchemePolyfill,"install",EmeEncryptionSchemePolyfill.install);var McEncryptionSchemePolyfill=function(){};McEncryptionSchemePolyfill.install=function(){navigator.mediaCapabilities?(McEncryptionSchemePolyfill.originalDecodingInfo_=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.probeDecodingInfo_):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")},McEncryptionSchemePolyfill.probeDecodingInfo_=function(a){var e,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(t){return 1==t.nextAddress?(console.assert(b==navigator.mediaCapabilities,'bad "this" for decodingInfo'),t.yield(McEncryptionSchemePolyfill.originalDecodingInfo_.call(b,a),2)):(e=t.yieldResult,a.keySystemConfiguration?hasEncryptionScheme(e.keySystemAccess)?(console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.originalDecodingInfo_,t.return(e)):(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=McEncryptionSchemePolyfill.polyfillDecodingInfo_,t.return(McEncryptionSchemePolyfill.polyfillDecodingInfo_.call(b,a))):t.return(e))}))},McEncryptionSchemePolyfill.polyfillDecodingInfo_=function(a){var e,t,r,n,g,o,l,b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(h){return 1==h.nextAddress?(console.assert(b==navigator.mediaCapabilities,'bad "this" for decodingInfo'),e=null,a.keySystemConfiguration&&(t=a.keySystemConfiguration,r=t.keySystem,n=t.audio&&t.audio.encryptionScheme,g=t.video&&t.video.encryptionScheme,e=guessSupportedScheme(r),o={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:a},n&&n!=e||g&&g!=e)?h.return(o):h.yield(McEncryptionSchemePolyfill.originalDecodingInfo_.call(b,a),2)):((l=h.yieldResult).keySystemAccess&&(l.keySystemAccess=new EmeEncryptionSchemePolyfillMediaKeySystemAccess(l.keySystemAccess,e)),h.return(l))}))},goog.exportSymbol("McEncryptionSchemePolyfill",McEncryptionSchemePolyfill),goog.exportProperty(McEncryptionSchemePolyfill,"install",McEncryptionSchemePolyfill.install);var EmeEncryptionSchemePolyfillMediaKeySystemAccess=function(a,b){this.mksa_=a,this.scheme_=b,this.keySystem=a.keySystem};function guessSupportedScheme(a){return a.startsWith("com.widevine")||a.startsWith("com.microsoft")||a.startsWith("com.adobe")||a.startsWith("org.w3")?"cenc":a.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",a,"Please contribute!"),null)}function hasEncryptionScheme(a){var b=(a=a.getConfiguration()).audioCapabilities&&a.audioCapabilities[0];return!(!(a=a.videoCapabilities&&a.videoCapabilities[0]||b)||void 0===a.encryptionScheme)}EmeEncryptionSchemePolyfillMediaKeySystemAccess.prototype.getConfiguration=function(){var a=this.mksa_.getConfiguration();if(a.videoCapabilities)for(var b=$jscomp.makeIterator(a.videoCapabilities),e=b.next();!e.done;e=b.next())e.value.encryptionScheme=this.scheme_;if(a.audioCapabilities)for(e=(b=$jscomp.makeIterator(a.audioCapabilities)).next();!e.done;e=b.next())e.value.encryptionScheme=this.scheme_;return a},EmeEncryptionSchemePolyfillMediaKeySystemAccess.prototype.createMediaKeys=function(){return this.mksa_.createMediaKeys()};var EncryptionSchemePolyfills=function(){};EncryptionSchemePolyfills.install=function(){EmeEncryptionSchemePolyfill.install(),McEncryptionSchemePolyfill.install()},goog.exportSymbol("EncryptionSchemePolyfills",EncryptionSchemePolyfills),goog.exportProperty(EncryptionSchemePolyfills,"install",EncryptionSchemePolyfills.install),void 0!==module&&module.exports&&(module.exports=EncryptionSchemePolyfills);for(var mozilla={LanguageMapping:{ach:{nativeName:"Lwo",englishName:"Acholi"},ady:{nativeName:"",englishName:"Adyghe"},af:{nativeName:"Afrikaans",englishName:"Afrikaans"},"af-NA":{nativeName:"Afrikaans (Namibia)",englishName:"Afrikaans (Namibia)"},"af-ZA":{nativeName:"Afrikaans (South Africa)",englishName:"Afrikaans (South Africa)"},ak:{nativeName:"Ti",englishName:"Akan"},ar:{nativeName:"",englishName:"Arabic"},"ar-AR":{nativeName:"",englishName:"Arabic"},"ar-MA":{nativeName:"",englishName:"Arabic (Morocco)"},"ar-SA":{nativeName:" ()",englishName:"Arabic (Saudi Arabia)"},"ay-BO":{nativeName:"Aymar aru",englishName:"Aymara"},az:{nativeName:"Azrbaycan dili",englishName:"Azerbaijani"},"az-AZ":{nativeName:"Azrbaycan dili",englishName:"Azerbaijani"},"be-BY":{nativeName:"",englishName:"Belarusian"},bg:{nativeName:"",englishName:"Bulgarian"},"bg-BG":{nativeName:"",englishName:"Bulgarian"},bn:{nativeName:"",englishName:"Bengali"},"bn-IN":{nativeName:" ()",englishName:"Bengali (India)"},"bn-BD":{nativeName:"()",englishName:"Bengali (Bangladesh)"},"bs-BA":{nativeName:"Bosanski",englishName:"Bosnian"},ca:{nativeName:"Catal",englishName:"Catalan"},"ca-ES":{nativeName:"Catal",englishName:"Catalan"},cak:{nativeName:"Maya Kaqchikel",englishName:"Kaqchikel"},"ck-US":{nativeName:" (tsalagi)",englishName:"Cherokee"},cs:{nativeName:"etina",englishName:"Czech"},"cs-CZ":{nativeName:"etina",englishName:"Czech"},cy:{nativeName:"Cymraeg",englishName:"Welsh"},"cy-GB":{nativeName:"Cymraeg",englishName:"Welsh"},da:{nativeName:"Dansk",englishName:"Danish"},"da-DK":{nativeName:"Dansk",englishName:"Danish"},de:{nativeName:"Deutsch",englishName:"German"},"de-AT":{nativeName:"Deutsch (sterreich)",englishName:"German (Austria)"},"de-DE":{nativeName:"Deutsch (Deutschland)",englishName:"German (Germany)"},"de-CH":{nativeName:"Deutsch (Schweiz)",englishName:"German (Switzerland)"},dsb:{nativeName:"Dolnoserbina",englishName:"Lower Sorbian"},el:{nativeName:"",englishName:"Greek"},"el-GR":{nativeName:"",englishName:"Greek (Greece)"},en:{nativeName:"English",englishName:"English"},"en-GB":{nativeName:"English (UK)",englishName:"English (UK)"},"en-AU":{nativeName:"English (Australia)",englishName:"English (Australia)"},"en-CA":{nativeName:"English (Canada)",englishName:"English (Canada)"},"en-IE":{nativeName:"English (Ireland)",englishName:"English (Ireland)"},"en-IN":{nativeName:"English (India)",englishName:"English (India)"},"en-PI":{nativeName:"English (Pirate)",englishName:"English (Pirate)"},"en-UD":{nativeName:"English (Upside Down)",englishName:"English (Upside Down)"},"en-US":{nativeName:"English (US)",englishName:"English (US)"},"en-ZA":{nativeName:"English (South Africa)",englishName:"English (South Africa)"},"en@pirate":{nativeName:"English (Pirate)",englishName:"English (Pirate)"},eo:{nativeName:"Esperanto",englishName:"Esperanto"},"eo-EO":{nativeName:"Esperanto",englishName:"Esperanto"},es:{nativeName:"Espaol",englishName:"Spanish"},"es-AR":{nativeName:"Espaol (Argentine)",englishName:"Spanish (Argentina)"},"es-419":{nativeName:"Espaol (Latinoamrica)",englishName:"Spanish (Latin America)"},"es-CL":{nativeName:"Espaol (Chile)",englishName:"Spanish (Chile)"},"es-CO":{nativeName:"Espaol (Colombia)",englishName:"Spanish (Colombia)"},"es-EC":{nativeName:"Espaol (Ecuador)",englishName:"Spanish (Ecuador)"},"es-ES":{nativeName:"Espaol (Espaa)",englishName:"Spanish (Spain)"},"es-LA":{nativeName:"Espaol (Latinoamrica)",englishName:"Spanish (Latin America)"},"es-NI":{nativeName:"Espaol (Nicaragua)",englishName:"Spanish (Nicaragua)"},"es-MX":{nativeName:"Espaol (Mxico)",englishName:"Spanish (Mexico)"},"es-US":{nativeName:"Espaol (Estados Unidos)",englishName:"Spanish (United States)"},"es-VE":{nativeName:"Espaol (Venezuela)",englishName:"Spanish (Venezuela)"},et:{nativeName:"eesti keel",englishName:"Estonian"},"et-EE":{nativeName:"Eesti (Estonia)",englishName:"Estonian (Estonia)"},eu:{nativeName:"Euskara",englishName:"Basque"},"eu-ES":{nativeName:"Euskara",englishName:"Basque"},fa:{nativeName:"",englishName:"Persian"},"fa-IR":{nativeName:"",englishName:"Persian"},"fb-LT":{nativeName:"Leet Speak",englishName:"Leet"},ff:{nativeName:"Fulah",englishName:"Fulah"},fi:{nativeName:"Suomi",englishName:"Finnish"},"fi-FI":{nativeName:"Suomi",englishName:"Finnish"},"fo-FO":{nativeName:"Froyskt",englishName:"Faroese"},fr:{nativeName:"Franais",englishName:"French"},"fr-CA":{nativeName:"Franais (Canada)",englishName:"French (Canada)"},"fr-FR":{nativeName:"Franais (France)",englishName:"French (France)"},"fr-BE":{nativeName:"Franais (Belgique)",englishName:"French (Belgium)"},"fr-CH":{nativeName:"Franais (Suisse)",englishName:"French (Switzerland)"},"fy-NL":{nativeName:"Frysk",englishName:"Frisian (West)"},ga:{nativeName:"Gaeilge",englishName:"Irish"},"ga-IE":{nativeName:"Gaeilge (Gaelic)",englishName:"Irish (Gaelic)"},gl:{nativeName:"Galego",englishName:"Galician"},"gl-ES":{nativeName:"Galego",englishName:"Galician"},"gn-PY":{nativeName:"Avae'",englishName:"Guarani"},"gu-IN":{nativeName:"",englishName:"Gujarati"},"gx-GR":{nativeName:" ",englishName:"Classical Greek"},he:{nativeName:"",englishName:"Hebrew"},"he-IL":{nativeName:"",englishName:"Hebrew"},hi:{nativeName:"",englishName:"Hindi"},"hi-IN":{nativeName:"",englishName:"Hindi"},hr:{nativeName:"Hrvatski",englishName:"Croatian"},"hr-HR":{nativeName:"Hrvatski",englishName:"Croatian"},hsb:{nativeName:"Hornjoserbina",englishName:"Upper Sorbian"},ht:{nativeName:"Kreyl",englishName:"Haitian Creole"},hu:{nativeName:"Magyar",englishName:"Hungarian"},"hu-HU":{nativeName:"Magyar",englishName:"Hungarian"},"hy-AM":{nativeName:"",englishName:"Armenian"},id:{nativeName:"Bahasa Indonesia",englishName:"Indonesian"},"id-ID":{nativeName:"Bahasa Indonesia",englishName:"Indonesian"},is:{nativeName:"slenska",englishName:"Icelandic"},"is-IS":{nativeName:"slenska (Iceland)",englishName:"Icelandic (Iceland)"},it:{nativeName:"Italiano",englishName:"Italian"},"it-IT":{nativeName:"Italiano",englishName:"Italian"},ja:{nativeName:"",englishName:"Japanese"},"ja-JP":{nativeName:"",englishName:"Japanese"},"jv-ID":{nativeName:"Basa Jawa",englishName:"Javanese"},"ka-GE":{nativeName:"",englishName:"Georgian"},"kk-KZ":{nativeName:"",englishName:"Kazakh"},km:{nativeName:"",englishName:"Khmer"},"km-KH":{nativeName:"",englishName:"Khmer"},kab:{nativeName:"Taqbaylit",englishName:"Kabyle"},kn:{nativeName:"",englishName:"Kannada"},"kn-IN":{nativeName:" (India)",englishName:"Kannada (India)"},ko:{nativeName:"",englishName:"Korean"},"ko-KR":{nativeName:" ()",englishName:"Korean (Korea)"},ku:{nativeName:"Kurd",englishName:"Kurdish"},"ku-TR":{nativeName:"Kurd",englishName:"Kurdish"},la:{nativeName:"Latin",englishName:"Latin"},"la-VA":{nativeName:"Latin",englishName:"Latin"},lb:{nativeName:"Ltzebuergesch",englishName:"Luxembourgish"},"li-NL":{nativeName:"Lmbrgs",englishName:"Limburgish"},lt:{nativeName:"Lietuvi",englishName:"Lithuanian"},"lt-LT":{nativeName:"Lietuvi",englishName:"Lithuanian"},lv:{nativeName:"Latvieu",englishName:"Latvian"},"lv-LV":{nativeName:"Latvieu",englishName:"Latvian"},mai:{nativeName:", ",englishName:"Maithili"},"mg-MG":{nativeName:"Malagasy",englishName:"Malagasy"},mk:{nativeName:"",englishName:"Macedonian"},"mk-MK":{nativeName:" ()",englishName:"Macedonian (Macedonian)"},ml:{nativeName:"",englishName:"Malayalam"},"ml-IN":{nativeName:"",englishName:"Malayalam"},"mn-MN":{nativeName:"",englishName:"Mongolian"},mr:{nativeName:"",englishName:"Marathi"},"mr-IN":{nativeName:"",englishName:"Marathi"},ms:{nativeName:"Bahasa Melayu",englishName:"Malay"},"ms-MY":{nativeName:"Bahasa Melayu",englishName:"Malay"},mt:{nativeName:"Malti",englishName:"Maltese"},"mt-MT":{nativeName:"Malti",englishName:"Maltese"},my:{nativeName:"",englishName:"Burmese"},nb:{nativeName:"Norsk (bokml)",englishName:"Norwegian (bokmal)"},"nb-NO":{nativeName:"Norsk (bokml)",englishName:"Norwegian (bokmal)"},ne:{nativeName:"",englishName:"Nepali"},"ne-NP":{nativeName:"",englishName:"Nepali"},nl:{nativeName:"Nederlands",englishName:"Dutch"},"nl-BE":{nativeName:"Nederlands (Belgi)",englishName:"Dutch (Belgium)"},"nl-NL":{nativeName:"Nederlands (Nederland)",englishName:"Dutch (Netherlands)"},"nn-NO":{nativeName:"Norsk (nynorsk)",englishName:"Norwegian (nynorsk)"},no:{nativeName:"Norsk",englishName:"Norwegian"},oc:{nativeName:"Occitan",englishName:"Occitan"},"or-IN":{nativeName:"",englishName:"Oriya"},pa:{nativeName:"",englishName:"Punjabi"},"pa-IN":{nativeName:" ( )",englishName:"Punjabi (India)"},pl:{nativeName:"Polski",englishName:"Polish"},"pl-PL":{nativeName:"Polski",englishName:"Polish"},"ps-AF":{nativeName:"",englishName:"Pashto"},pt:{nativeName:"Portugus",englishName:"Portuguese"},"pt-BR":{nativeName:"Portugus (Brasil)",englishName:"Portuguese (Brazil)"},"pt-PT":{nativeName:"Portugus (Portugal)",englishName:"Portuguese (Portugal)"},"qu-PE":{nativeName:"Qhichwa",englishName:"Quechua"},"rm-CH":{nativeName:"Rumantsch",englishName:"Romansh"},ro:{nativeName:"Romn",englishName:"Romanian"},"ro-RO":{nativeName:"Romn",englishName:"Romanian"},ru:{nativeName:"",englishName:"Russian"},"ru-RU":{nativeName:"",englishName:"Russian"},"sa-IN":{nativeName:"",englishName:"Sanskrit"},"se-NO":{nativeName:"Davvismegiella",englishName:"Northern Smi"},"si-LK":{nativeName:"",englishName:"Sinhala (Sri Lanka)"},sk:{nativeName:"Slovenina",englishName:"Slovak"},"sk-SK":{nativeName:"Slovenina (Slovakia)",englishName:"Slovak (Slovakia)"},sl:{nativeName:"Slovenina",englishName:"Slovenian"},"sl-SI":{nativeName:"Slovenina",englishName:"Slovenian"},"so-SO":{nativeName:"Soomaaliga",englishName:"Somali"},sq:{nativeName:"Shqip",englishName:"Albanian"},"sq-AL":{nativeName:"Shqip",englishName:"Albanian"},sr:{nativeName:"",englishName:"Serbian"},"sr-RS":{nativeName:" (Serbia)",englishName:"Serbian (Serbia)"},su:{nativeName:"Basa Sunda",englishName:"Sundanese"},sv:{nativeName:"Svenska",englishName:"Swedish"},"sv-SE":{nativeName:"Svenska",englishName:"Swedish"},sw:{nativeName:"Kiswahili",englishName:"Swahili"},"sw-KE":{nativeName:"Kiswahili",englishName:"Swahili (Kenya)"},ta:{nativeName:"",englishName:"Tamil"},"ta-IN":{nativeName:"",englishName:"Tamil"},te:{nativeName:"",englishName:"Telugu"},"te-IN":{nativeName:"",englishName:"Telugu"},tg:{nativeName:" ",englishName:"Tajik"},"tg-TJ":{nativeName:"",englishName:"Tajik"},th:{nativeName:"",englishName:"Thai"},"th-TH":{nativeName:" ()",englishName:"Thai (Thailand)"},tl:{nativeName:"Filipino",englishName:"Filipino"},"tl-PH":{nativeName:"Filipino",englishName:"Filipino"},tlh:{nativeName:"tlhIngan-Hol",englishName:"Klingon"},tr:{nativeName:"Trke",englishName:"Turkish"},"tr-TR":{nativeName:"Trke",englishName:"Turkish"},"tt-RU":{nativeName:"",englishName:"Tatar"},uk:{nativeName:"",englishName:"Ukrainian"},"uk-UA":{nativeName:"",englishName:"Ukrainian"},ur:{nativeName:"",englishName:"Urdu"},"ur-PK":{nativeName:"",englishName:"Urdu"},uz:{nativeName:"O'zbek",englishName:"Uzbek"},"uz-UZ":{nativeName:"O'zbek",englishName:"Uzbek"},vi:{nativeName:"Ting Vit",englishName:"Vietnamese"},"vi-VN":{nativeName:"Ting Vit",englishName:"Vietnamese"},"xh-ZA":{nativeName:"isiXhosa",englishName:"Xhosa"},yi:{nativeName:"",englishName:"Yiddish"},"yi-DE":{nativeName:" (German)",englishName:"Yiddish (German)"},zh:{nativeName:"",englishName:"Chinese"},"zh-HANS":{nativeName:"",englishName:"Chinese Simplified"},"zh-HANT":{nativeName:"",englishName:"Chinese Traditional"},"zh-CN":{nativeName:"",englishName:"Chinese Simplified (China)"},"zh-HK":{nativeName:"",englishName:"Chinese Traditional (Hong Kong)"},"zh-SG":{nativeName:"",englishName:"Chinese Simplified (Singapore)"},"zh-TW":{nativeName:"",englishName:"Chinese Traditional (Taiwan)"},"zu-ZA":{nativeName:"isiZulu",englishName:"Zulu"}}},$jscomp$iter$348=$jscomp.makeIterator(Object.keys(mozilla.LanguageMapping)),$jscomp$key$key=$jscomp$iter$348.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$348.next()){var key=$jscomp$key$key.value;mozilla.LanguageMapping[key.toLowerCase()]=mozilla.LanguageMapping[key]}shaka.ui.Element=function(a,b){var e=this;this.parent=a,this.controls=b,this.eventManager=new shaka.util.EventManager,this.localization=this.controls.getLocalization(),this.player=this.controls.getPlayer(),this.video=this.controls.getVideo(),this.adManager=this.player.getAdManager(),this.ad=null,this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,(function(a){e.ad=a.ad})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,(function(){e.ad=null}))},shaka.ui.Element.prototype.release=function(){this.eventManager.release(),this.ad=this.adManager=this.video=this.player=this.localization=this.eventManager=this.controls=this.parent=null},goog.exportSymbol("shaka.ui.Element",shaka.ui.Element),goog.exportProperty(shaka.ui.Element.prototype,"release",shaka.ui.Element.prototype.release),shaka.ui.Utils=function(){},shaka.ui.Utils.getFirstDescendantWithClassName=function(a,b){var e=shaka.ui.Utils.getDescendantIfExists(a,b);return goog.asserts.assert(null!=e,"Should not be null!"),e},shaka.ui.Utils.getDescendantIfExists=function(a,b){var e=a.getElementsByClassName(b);return e.length?e[0]:null},shaka.ui.Utils.focusOnTheChosenItem=function(a){a&&(a=shaka.ui.Utils.getDescendantIfExists(a,"shaka-chosen-item"))&&a.parentElement.focus()},shaka.ui.Utils.checkmarkIcon=function(){var a=shaka.util.Dom.createHTMLElement("i");return a.classList.add("material-icons-round"),a.classList.add("shaka-chosen-item"),a.textContent=shaka.ui.Enums.MaterialDesignIcons.CHECKMARK,a.setAttribute("aria-hidden","true"),a},shaka.ui.Utils.setDisplay=function(a,b){a&&(goog.asserts.assert(!(a instanceof SVGElement),"Do not use setDisplay with SVG elements!"),b?a.classList.remove("shaka-hidden"):a.classList.add("shaka-hidden"))},shaka.ui.Utils.buildTimeString=function(a,b){var e=Math.floor(a/3600),t=Math.floor(a/60%60),r=Math.floor(a%60);return 10>r&&(r="0"+r),r=t+":"+r,b&&(10>t&&(r="0"+r),r=e+":"+r),r},shaka.ui.AdCounter=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.container_=shaka.util.Dom.createHTMLElement("div"),this.container_.classList.add("shaka-ad-counter"),this.parent.appendChild(this.container_),this.span_=shaka.util.Dom.createHTMLElement("span"),this.span_.classList.add("shaka-ad-counter-span"),this.container_.appendChild(this.span_),this.timer_=new shaka.util.Timer((function(){e.onTimerTick_()})),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,(function(){e.onAdStarted_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,(function(){e.reset_()}))},$jscomp.inherits(shaka.ui.AdCounter,shaka.ui.Element),shaka.ui.AdCounter.prototype.updateAriaLabel_=function(){},shaka.ui.AdCounter.prototype.onAdStarted_=function(){this.timer_.tickNow(),this.timer_.tickEvery(.5)},shaka.ui.AdCounter.prototype.onTimerTick_=function(){goog.asserts.assert(null!=this.ad,"this.ad should exist at this point");var a=Math.round(this.ad.getRemainingTime()),b=this.ad.getDuration();-1!=a&&-1!=b&&(0<a?(b=(a=shaka.ui.Utils.buildTimeString(b-a,!1))+" / "+(b=shaka.ui.Utils.buildTimeString(b,!1)),1<this.ad.getSequenceLength()?this.span_.textContent=b:(a=this.localization.resolve(shaka.ui.Locales.Ids.AD_TIME),this.span_.textContent=a.replace("[AD_TIME]",b))):this.reset_())},shaka.ui.AdCounter.prototype.reset_=function(){this.timer_.stop(),this.span_.textContent=""},shaka.ui.AdCounter.prototype.release=function(){this.timer_.stop(),this.timer_=null,shaka.ui.Element.prototype.release.call(this)},goog.exportSymbol("shaka.ui.AdCounter",shaka.ui.AdCounter),shaka.ui.AdPosition=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.container_=shaka.util.Dom.createHTMLElement("div"),this.container_.classList.add("shaka-ad-position"),shaka.ui.Utils.setDisplay(this.container_,!1),this.parent.appendChild(this.container_),this.span_=shaka.util.Dom.createHTMLElement("span"),this.span_.classList.add("shaka-ad-position-span"),this.container_.appendChild(this.span_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.ad&&(e.updateAriaLabel_(),e.setPosition_())})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.ad&&(e.updateAriaLabel_(),e.setPosition_())})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,(function(){e.setPosition_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,(function(){e.span_.textContent="",shaka.ui.Utils.setDisplay(e.container_,!1)}))},$jscomp.inherits(shaka.ui.AdPosition,shaka.ui.Element),shaka.ui.AdPosition.prototype.updateAriaLabel_=function(){},shaka.ui.AdPosition.prototype.setPosition_=function(){var a=this.ad.getSequenceLength();if(1<a){var b=shaka.ui.Locales.Ids,e=this.ad.getPositionInSequence();this.span_.textContent=this.localization.resolve(b.AD_PROGRESS).replace("[AD_ON]",String(e)).replace("[NUM_ADS]",String(a)),shaka.ui.Utils.setDisplay(this.container_,!0)}},goog.exportSymbol("shaka.ui.AdPosition",shaka.ui.AdPosition),shaka.ui.Constants={},shaka.ui.Constants.ARIA_LABEL="aria-label",shaka.ui.Constants.MIN_SEEK_WINDOW_TO_SHOW_SEEKBAR=5,shaka.ui.RangeElement=function(a,b,e,t){shaka.ui.Element.call(this,a,b);var r=this;this.container=shaka.util.Dom.createHTMLElement("div"),this.container.classList.add("shaka-range-container"),this.container.classList.add.apply(this.container.classList,$jscomp.arrayFromIterable(e)),this.isChanging_=!1,this.bar=document.createElement("input"),this.bar.classList.add("shaka-range-element"),this.bar.classList.add.apply(this.bar.classList,$jscomp.arrayFromIterable(t)),this.bar.type="range",this.bar.step="any",this.bar.min="0",this.bar.max="1",this.bar.value="0",this.container.appendChild(this.bar),this.parent.appendChild(this.container),this.eventManager.listen(this.bar,"mousedown",(function(){r.isChanging_=!0,r.onChangeStart()})),this.eventManager.listen(this.bar,"touchstart",(function(a){r.isChanging_=!0,r.setBarValueForTouch_(a),r.onChangeStart()})),this.eventManager.listen(this.bar,"input",(function(){r.onChange()})),this.eventManager.listen(this.bar,"touchmove",(function(a){r.setBarValueForTouch_(a),r.onChange()})),this.eventManager.listen(this.bar,"touchend",(function(a){r.isChanging_=!1,r.setBarValueForTouch_(a),r.onChangeEnd()})),this.eventManager.listen(this.bar,"mouseup",(function(){r.isChanging_=!1,r.onChangeEnd()}))},$jscomp.inherits(shaka.ui.RangeElement,shaka.ui.Element),shaka.ui.RangeElement.prototype.setRange=function(a,b){this.bar.min=a,this.bar.max=b},shaka.ui.RangeElement.prototype.onChangeStart=function(){},shaka.ui.RangeElement.prototype.onChange=function(){},shaka.ui.RangeElement.prototype.onChangeEnd=function(){},shaka.ui.RangeElement.prototype.getValue=function(){return parseFloat(this.bar.value)},shaka.ui.RangeElement.prototype.setValue=function(a){this.isChanging_||(this.bar.value=a)},shaka.ui.RangeElement.prototype.setBarValueForTouch_=function(a){a.preventDefault();var b=a.changedTouches[0],e=this.bar.getBoundingClientRect();a=parseFloat(this.bar.min);var t=parseFloat(this.bar.max);(b=a+(t-a)/e.width*(b.clientX-e.left))<a?b=a:b>t&&(b=t),this.bar.value=b},goog.exportSymbol("shaka.ui.RangeElement",shaka.ui.RangeElement),shaka.ui.SeekBar=function(a,b){shaka.ui.RangeElement.call(this,a,b,["shaka-seek-bar-container"],["shaka-seek-bar","shaka-no-propagation","shaka-show-controls-on-mouse-over"]);var e=this;this.adMarkerContainer_=shaka.util.Dom.createHTMLElement("div"),this.adMarkerContainer_.classList.add("shaka-ad-markers"),this.container.insertBefore(this.adMarkerContainer_,this.container.childNodes[0]),this.config_=this.controls.getConfig(),this.seekTimer_=new shaka.util.Timer((function(){e.video.currentTime=e.getValue()})),this.adBreaksTimer_=new shaka.util.Timer((function(){e.markAdBreaks_()})),this.adCuePoints_=[],this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){return e.updateAriaLabel_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){return e.updateAriaLabel_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,(function(){shaka.ui.Utils.setDisplay(e.container,!1)})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,(function(){e.shouldBeDisplayed_()&&shaka.ui.Utils.setDisplay(e.container,!0)})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.CUEPOINTS_CHANGED,(function(a){e.adCuePoints_=a.cuepoints,e.onAdCuePointsChanged_()})),this.eventManager.listen(this.player,"unloading",(function(){e.adCuePoints_=[],e.onAdCuePointsChanged_()})),this.setValue(this.video.currentTime),this.update(),this.updateAriaLabel_()},$jscomp.inherits(shaka.ui.SeekBar,shaka.ui.RangeElement),shaka.ui.SeekBar.prototype.release=function(){this.seekTimer_&&(this.seekTimer_.stop(),this.seekTimer_=null,this.adBreaksTimer_.stop(),this.adBreaksTimer_=null),shaka.ui.RangeElement.prototype.release.call(this)},shaka.ui.SeekBar.prototype.onChangeStart=function(){this.controls.setSeeking(!0),this.video.pause()},shaka.ui.SeekBar.prototype.onChange=function(){this.video.duration&&(this.update(),this.seekTimer_.tickAfter(.125))},shaka.ui.SeekBar.prototype.onChangeEnd=function(){this.seekTimer_.tickNow(),this.controls.setSeeking(!1),this.video.play()},shaka.ui.SeekBar.prototype.isShowing=function(){return!this.container.classList.contains("shaka-hidden")},shaka.ui.SeekBar.prototype.update=function(){var a=this.config_.seekBarColors,b=this.getValue(),e=this.video.buffered.length,t=e?this.video.buffered.start(0):0,r=e?this.video.buffered.end(e-1):0,n=this.player.seekRange(),g=n.end-n.start;this.setRange(n.start,n.end),this.shouldBeDisplayed_()?(shaka.ui.Utils.setDisplay(this.container,!0),0==e?this.container.style.background=a.base:(e=(Math.max(t,n.start)-n.start)/g||0,r=(Math.min(r,n.end)-n.start)/g||0,b=(Math.min(Math.max(b,n.start),n.end)-n.start)/g||0,a=["to right",this.makeColor_(this.config_.showUnbufferedStart?a.base:a.played,e),this.makeColor_(a.played,e),this.makeColor_(a.played,b),this.makeColor_(a.buffered,b),this.makeColor_(a.buffered,r),this.makeColor_(a.base,r)],this.container.style.background="linear-gradient("+a.join(",")+")")):shaka.ui.Utils.setDisplay(this.container,!1)},shaka.ui.SeekBar.prototype.markAdBreaks_=function(){if(this.adCuePoints_.length){for(var a=this.player.seekRange(),b=a.end-a.start,e=["to right"],t=[],r=this.config_.seekBarColors.adBreaks,n=!1,g=$jscomp.makeIterator(this.adCuePoints_),o=g.next();!o.done;o=g.next())if(-1!=(o=o.value).start||o.end||(n=!0),o.start>=a.start&&o.start<a.end&&!(o.end&&o.end>a.end)){var l=(o.start-a.start)/b||0,h=l+.01;o.end&&(h=(o.end-a.start)/b||0),t.push({start:l,end:h})}for(o=(a=$jscomp.makeIterator(t)).next();!o.done;o=a.next())b=o.value,e.push(this.makeColor_("transparent",b.start)),e.push(this.makeColor_(r,b.start)),e.push(this.makeColor_(r,b.end)),e.push(this.makeColor_("transparent",b.end));n&&(e.push(this.makeColor_("transparent",.99)),e.push(this.makeColor_(r,.99))),this.adMarkerContainer_.style.background="linear-gradient("+e.join(",")+")"}else this.adMarkerContainer_.style.background="transparent"},shaka.ui.SeekBar.prototype.makeColor_=function(a,b){return a+" "+100*b+"%"},shaka.ui.SeekBar.prototype.onAdCuePointsChanged_=function(){this.markAdBreaks_();var a=this.player.seekRange();a=a.end-a.start;var b=shaka.ui.Constants.MIN_SEEK_WINDOW_TO_SHOW_SEEKBAR;this.player.isLive()&&a>b&&this.adBreaksTimer_.tickEvery(1)},shaka.ui.SeekBar.prototype.shouldBeDisplayed_=function(){var a=this.player.seekRange();return a=a.end-a.start,!(this.player.isLive()&&a<shaka.ui.Constants.MIN_SEEK_WINDOW_TO_SHOW_SEEKBAR)&&null==this.ad},shaka.ui.SeekBar.prototype.updateAriaLabel_=function(){this.bar.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.SEEK))},goog.exportSymbol("shaka.ui.SeekBar",shaka.ui.SeekBar),shaka.ui.ControlsPanel={},shaka.ui.Controls=function(a,b,e,t){shaka.util.FakeEventTarget.call(this);var r=this;this.enabled_=!0,this.config_=t,this.castProxy_=new shaka.cast.CastProxy(e,a,this.config_.castReceiverAppId),this.castAllowed_=!0,this.video_=this.castProxy_.getVideo(),this.localVideo_=e,this.player_=this.castProxy_.getPlayer(),this.localPlayer_=a,this.videoContainer_=b,this.adManager_=this.player_.getAdManager(),this.seekBar_=this.ad_=null,this.isSeeking_=!1,this.settingsMenus_=[],this.showOnHoverControls_=[],this.recentMouseMovement_=!1,this.mouseStillTimer_=new shaka.util.Timer((function(){r.onMouseStill_()})),this.fadeControlsTimer_=new shaka.util.Timer((function(){r.controlsContainer_.removeAttribute("shown"),r.hideSettingsMenusTimer_.tickAfter(2)})),this.hideSettingsMenusTimer_=new shaka.util.Timer((function(){for(var a=$jscomp.makeIterator(r.settingsMenus_),b=a.next();!b.done;b=a.next())shaka.ui.Utils.setDisplay(b.value,!1)})),this.timeAndSeekRangeTimer_=new shaka.util.Timer((function(){r.isOpaque_()&&r.updateTimeAndSeekRange_()})),this.lastTouchEventTime_=null,this.elements_=[],this.localization_=shaka.ui.Controls.createLocalization_(),this.eventManager_=new shaka.util.EventManager,this.configure(this.config_),this.addEventListeners_(),this.pressedKeys_=new Set,this.onCastStatusChange_(),this.timeAndSeekRangeTimer_.tickEvery(.125),this.eventManager_.listen(this.localization_,shaka.ui.Localization.LOCALE_CHANGED,(function(a){r.adManager_.setLocale(a.locales[0])}))},$jscomp.inherits(shaka.ui.Controls,shaka.util.FakeEventTarget),shaka.ui.Controls.prototype.destroy=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){switch(b.nextAddress){case 1:if(a.eventManager_&&(a.eventManager_.release(),a.eventManager_=null),a.mouseStillTimer_&&(a.mouseStillTimer_.stop(),a.mouseStillTimer_=null),a.fadeControlsTimer_&&(a.fadeControlsTimer_.stop(),a.fadeControlsTimer_=null),a.hideSettingsMenusTimer_&&(a.hideSettingsMenusTimer_.stop(),a.hideSettingsMenusTimer_=null),a.timeAndSeekRangeTimer_&&(a.timeAndSeekRangeTimer_.stop(),a.timeAndSeekRangeTimer_=null),a.releaseChildElements_(),a.controlsContainer_&&(a.videoContainer_.removeChild(a.controlsContainer_),a.controlsContainer_=null),!a.castProxy_){b.jumpTo(2);break}return b.yield(a.castProxy_.destroy(),3);case 3:a.castProxy_=null;case 2:if(!a.localPlayer_){b.jumpTo(4);break}return b.yield(a.localPlayer_.destroy(),5);case 5:a.localPlayer_=null;case 4:a.player_=null,a.localVideo_=null,a.video_=null,a.localization_=null,a.pressedKeys_.clear(),b.jumpToEnd()}}))},shaka.ui.Controls.prototype.releaseChildElements_=function(){for(var a=$jscomp.makeIterator(this.elements_),b=a.next();!b.done;b=a.next())b.value.release();this.elements_=[]},shaka.ui.Controls.registerElement=function(a,b){shaka.ui.ControlsPanel.elementNamesToFactories_.set(a,b)},shaka.ui.Controls.prototype.allowCast=function(a){this.castAllowed_=a,this.onCastStatusChange_()},shaka.ui.Controls.prototype.loadComplete=function(){this.onPlayStateChange_()},shaka.ui.Controls.prototype.configure=function(a){this.config_=a,this.castProxy_.changeReceiverId(a.castReceiverAppId),this.seekBar_&&(this.seekBar_=null),this.playButton_&&(this.playButton_=null),this.controlsContainer_?(shaka.util.Dom.removeAllChildren(this.controlsContainer_),this.releaseChildElements_()):this.addControlsContainer_(),this.createDOM_(),this.onPlayStateChange_(),a=this.videoContainer_.getElementsByClassName("shaka-no-propagation");for(var b=(a=$jscomp.makeIterator(a)).next();!b.done;b=a.next()){b=b.value;var e=function(a){return a.stopPropagation()};this.eventManager_.listen(b,"click",e),this.eventManager_.listen(b,"dblclick",e)}},shaka.ui.Controls.prototype.setEnabledShakaControls=function(a){(this.enabled_=a)?(this.videoContainer_.setAttribute("shaka-controls","true"),this.localVideo_.tabIndex=-1,this.localVideo_.controls=!1):this.videoContainer_.removeAttribute("shaka-controls"),this.onPlayStateChange_()},shaka.ui.Controls.prototype.setEnabledNativeControls=function(a){this.localVideo_.controls=a,this.localVideo_.tabIndex=a?0:-1,a&&this.setEnabledShakaControls(!1)},shaka.ui.Controls.prototype.getCastProxy=function(){return this.castProxy_},shaka.ui.Controls.prototype.getLocalization=function(){return this.localization_},shaka.ui.Controls.prototype.getVideoContainer=function(){return this.videoContainer_},shaka.ui.Controls.prototype.getVideo=function(){return this.video_},shaka.ui.Controls.prototype.getLocalVideo=function(){return this.localVideo_},shaka.ui.Controls.prototype.getPlayer=function(){return this.player_},shaka.ui.Controls.prototype.getLocalPlayer=function(){return this.localPlayer_},shaka.ui.Controls.prototype.getControlsContainer=function(){return goog.asserts.assert(this.controlsContainer_,"No controls container after destruction!"),this.controlsContainer_},shaka.ui.Controls.prototype.getServerSideAdContainer=function(){return this.daiAdContainer_},shaka.ui.Controls.prototype.getConfig=function(){return this.config_},shaka.ui.Controls.prototype.isSeeking=function(){return this.isSeeking_},shaka.ui.Controls.prototype.setSeeking=function(a){this.isSeeking_=a},shaka.ui.Controls.prototype.isCastAllowed=function(){return this.castAllowed_},shaka.ui.Controls.prototype.getDisplayTime=function(){return this.seekBar_?this.seekBar_.getValue():this.video_.currentTime},shaka.ui.Controls.prototype.setLastTouchEventTime=function(a){this.lastTouchEventTime_=a},shaka.ui.Controls.prototype.anySettingsMenusAreOpen=function(){return this.settingsMenus_.some((function(a){return!a.classList.contains("shaka-hidden")}))},shaka.ui.Controls.prototype.hideSettingsMenus=function(){this.hideSettingsMenusTimer_.tickNow()},shaka.ui.Controls.prototype.toggleFullScreen=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){switch(e.nextAddress){case 1:if(document.fullscreenElement)return screen.orientation&&screen.orientation.unlock(),e.yield(document.exitFullscreen(),0);if(e.setCatchFinallyBlocks(4),!document.pictureInPictureElement){e.jumpTo(6);break}return e.yield(document.exitPictureInPicture(),6);case 6:return e.yield(a.videoContainer_.requestFullscreen({navigationUI:"hide"}),8);case 8:if(!a.config_.forceLandscapeOnFullscreen||!screen.orientation){e.jumpTo(9);break}return e.setCatchFinallyBlocks(10),e.yield(screen.orientation.lock("landscape"),12);case 12:e.leaveTryBlock(9,4);break;case 10:e.enterCatchBlock(4);case 9:e.leaveTryBlock(0);break;case 4:b=e.enterCatchBlock(),a.dispatchEvent(new shaka.util.FakeEvent("error",{detail:b})),e.jumpTo(0)}}))},shaka.ui.Controls.prototype.showAdUI=function(){shaka.ui.Utils.setDisplay(this.adPanel_,!0)},shaka.ui.Controls.prototype.hideAdUI=function(){shaka.ui.Utils.setDisplay(this.adPanel_,!1)},shaka.ui.Controls.prototype.playPausePresentation=function(){this.enabled_&&this.video_.duration&&(this.player_.cancelTrickPlay(),this.presentationIsPaused()?this.video_.play():this.video_.pause())},shaka.ui.Controls.prototype.playPauseAd=function(){this.ad_&&this.ad_.isPaused()?this.ad_.play():this.ad_&&this.ad_.pause()},shaka.ui.Controls.prototype.presentationIsPaused=function(){return this.video_.paused&&!this.isSeeking()},shaka.ui.Controls.prototype.createDOM_=function(){if(this.videoContainer_.classList.add("shaka-video-container"),this.localVideo_.classList.add("shaka-video"),this.addScrimContainer_(),this.config_.addBigPlayButton&&this.addPlayButton_(),this.spinnerContainer_||this.addBufferingSpinner_(),this.addDaiAdContainer_(),this.addControlsButtonPanel_(),this.settingsMenus_=Array.from(this.videoContainer_.getElementsByClassName("shaka-settings-menu")),this.config_.addSeekBar)this.seekBar_=new shaka.ui.SeekBar(this.bottomControls_,this),this.elements_.push(this.seekBar_);else for(var a=$jscomp.makeIterator(this.settingsMenus_),b=a.next();!b.done;b=a.next())b.value.classList.add("shaka-low-position");this.showOnHoverControls_=Array.from(this.videoContainer_.getElementsByClassName("shaka-show-controls-on-mouse-over"))},shaka.ui.Controls.prototype.addControlsContainer_=function(){var a=this;this.controlsContainer_=shaka.util.Dom.createHTMLElement("div"),this.controlsContainer_.classList.add("shaka-controls-container"),this.videoContainer_.appendChild(this.controlsContainer_),this.videoContainer_.setAttribute("shaka-controls","true"),this.eventManager_.listen(this.controlsContainer_,"touchstart",(function(b){a.onContainerTouch_(b)}),{passive:!1}),this.eventManager_.listen(this.controlsContainer_,"click",(function(){a.onContainerClick_()}))},shaka.ui.Controls.prototype.addPlayButton_=function(){var a=shaka.util.Dom.createHTMLElement("div");a.classList.add("shaka-play-button-container"),this.controlsContainer_.appendChild(a),this.playButton_=new shaka.ui.BigPlayButton(a,this),this.elements_.push(this.playButton_)},shaka.ui.Controls.prototype.addScrimContainer_=function(){var a=shaka.util.Dom.createHTMLElement("div");a.classList.add("shaka-scrim-container"),this.controlsContainer_.appendChild(a)},shaka.ui.Controls.prototype.addAdControls_=function(){this.adPanel_=shaka.util.Dom.createHTMLElement("div"),this.adPanel_.classList.add("shaka-ad-controls"),shaka.ui.Utils.setDisplay(this.adPanel_,!1),this.bottomControls_.appendChild(this.adPanel_);var a=new shaka.ui.AdPosition(this.adPanel_,this);this.elements_.push(a),a=new shaka.ui.AdCounter(this.adPanel_,this),this.elements_.push(a)},shaka.ui.Controls.prototype.addBufferingSpinner_=function(){this.spinnerContainer_=shaka.util.Dom.createHTMLElement("div"),this.spinnerContainer_.classList.add("shaka-spinner-container"),this.videoContainer_.appendChild(this.spinnerContainer_);var a=shaka.util.Dom.createHTMLElement("div");a.classList.add("shaka-spinner"),this.spinnerContainer_.appendChild(a);var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("class","shaka-spinner-svg"),b.setAttribute("viewBox","0 0 30 30"),a.appendChild(b),(a=document.createElementNS("http://www.w3.org/2000/svg","circle")).setAttribute("class","shaka-spinner-path"),a.setAttribute("cx","15"),a.setAttribute("cy","15"),a.setAttribute("r","14.5"),a.setAttribute("fill","none"),a.setAttribute("stroke-width","1"),a.setAttribute("stroke-miterlimit","10"),b.appendChild(a)},shaka.ui.Controls.prototype.addControlsButtonPanel_=function(){var a=this;this.bottomControls_=shaka.util.Dom.createHTMLElement("div"),this.bottomControls_.classList.add("shaka-bottom-controls"),this.bottomControls_.classList.add("shaka-no-propagation"),this.controlsContainer_.appendChild(this.bottomControls_),this.eventManager_.listen(this.bottomControls_,"click",(function(){a.hideSettingsMenus()})),this.addAdControls_(),this.controlsButtonPanel_=shaka.util.Dom.createHTMLElement("div"),this.controlsButtonPanel_.classList.add("shaka-controls-button-panel"),this.controlsButtonPanel_.classList.add("shaka-show-controls-on-mouse-over"),this.bottomControls_.appendChild(this.controlsButtonPanel_);for(var b={},e=$jscomp.makeIterator(this.config_.controlPanelElements),t=e.next();!t.done;b={$jscomp$loop$prop$moddableElement$569:b.$jscomp$loop$prop$moddableElement$569},t=e.next())t=t.value,shaka.ui.ControlsPanel.elementNamesToFactories_.get(t)?("function"!=typeof(t=shaka.ui.ControlsPanel.elementNamesToFactories_.get(t).create(this.controlsButtonPanel_,this)).release&&(shaka.Deprecate.deprecateFeature(4,"shaka.extern.IUIElement","Please update UI elements to have a release() method."),b.$jscomp$loop$prop$moddableElement$569=t,b.$jscomp$loop$prop$moddableElement$569.release=function(a){return function(){a.$jscomp$loop$prop$moddableElement$569.destroy&&a.$jscomp$loop$prop$moddableElement$569.destroy()}}(b)),this.elements_.push(t)):shaka.log.alwaysWarn("Unrecognized control panel element requested:",t)},shaka.ui.Controls.prototype.addDaiAdContainer_=function(){this.daiAdContainer_=shaka.util.Dom.createHTMLElement("div"),this.daiAdContainer_.classList.add("shaka-server-side-ad-container"),this.controlsContainer_.appendChild(this.daiAdContainer_)},shaka.ui.Controls.prototype.addEventListeners_=function(){var a=this;this.eventManager_.listen(this.player_,"buffering",(function(){a.onBufferingStateChange_()})),this.onBufferingStateChange_(),this.eventManager_.listen(window,"keydown",(function(b){a.onKeyDown_(b)})),this.eventManager_.listen(window,"click",(function(){return a.hideSettingsMenus()})),this.eventManager_.listen(this.controlsContainer_,"dblclick",(function(){a.config_.doubleClickForFullscreen&&a.toggleFullScreen()})),this.eventManager_.listen(this.video_,"play",(function(){a.onPlayStateChange_()})),this.eventManager_.listen(this.video_,"pause",(function(){a.onPlayStateChange_()})),this.eventManager_.listen(this.video_,"ended",(function(){a.onPlayStateChange_()})),this.eventManager_.listen(this.videoContainer_,"mousemove",(function(b){a.onMouseMove_(b)})),this.eventManager_.listen(this.videoContainer_,"touchmove",(function(b){a.onMouseMove_(b)}),{passive:!0}),this.eventManager_.listen(this.videoContainer_,"touchend",(function(b){a.onMouseMove_(b)}),{passive:!0}),this.eventManager_.listen(this.videoContainer_,"mouseleave",(function(){a.onMouseLeave_()})),this.eventManager_.listen(this.castProxy_,"caststatuschanged",(function(){a.onCastStatusChange_()})),this.eventManager_.listen(this.videoContainer_,"keyup",(function(b){a.onKeyUp_(b)})),this.eventManager_.listen(this.adManager_,shaka.ads.AdManager.AD_STARTED,(function(b){a.ad_=b.ad,a.showAdUI()})),this.eventManager_.listen(this.adManager_,shaka.ads.AdManager.AD_STOPPED,(function(){a.ad_=null,a.hideAdUI()})),screen.orientation&&this.eventManager_.listen(screen.orientation,"change",(function(){return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return b.yield(a.onScreenRotation_(),0)}))})),this.eventManager_.listen(document,"fullscreenchange",(function(){a.ad_&&a.ad_.resize(a.localVideo_.offsetWidth,a.localVideo_.offsetHeight)}))},shaka.ui.Controls.prototype.onScreenRotation_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return a.video_&&0!=a.video_.readyState&&!a.castProxy_.isCasting()&&a.config_.enableFullscreenOnRotation?screen.orientation.type.includes("landscape")&&!document.fullscreenElement?b.yield(a.videoContainer_.requestFullscreen({navigationUI:"hide"}),0):screen.orientation.type.includes("portrait")&&document.fullscreenElement?b.yield(document.exitFullscreen(),0):b.jumpTo(0):b.return()}))},shaka.ui.Controls.prototype.onMouseMove_=function(a){"mousemove"==a.type&&(this.controlsContainer_.classList.remove("shaka-keyboard-navigation"),this.computeOpacity()),"touchstart"==a.type||"touchmove"==a.type||"touchend"==a.type||"keyup"==a.type?this.lastTouchEventTime_=Date.now():this.lastTouchEventTime_+1e3<Date.now()&&(this.lastTouchEventTime_=null),this.lastTouchEventTime_&&"mousemove"==a.type||(this.videoContainer_.style.cursor="",this.recentMouseMovement_=!0,this.hideSettingsMenusTimer_.stop(),this.isOpaque_()||(this.updateTimeAndSeekRange_(),this.computeOpacity()),this.mouseStillTimer_.stop(),"touchend"!=a.type&&"keyup"!=a.type&&this.lastTouchEventTime_||this.mouseStillTimer_.tickAfter(3))},shaka.ui.Controls.prototype.onMouseLeave_=function(){this.lastTouchEventTime_||this.mouseStillTimer_.tickNow()},shaka.ui.Controls.prototype.onMouseStill_=function(){this.videoContainer_.style.cursor="none",this.recentMouseMovement_=!1,this.computeOpacity()},shaka.ui.Controls.prototype.isHovered_=function(){return this.showOnHoverControls_.some((function(a){return a.matches(":hover")}))},shaka.ui.Controls.prototype.computeOpacity=function(){var a=!!this.ad_&&this.ad_.isPaused(),b=this.video_.paused&&!this.isSeeking_,e=this.controlsContainer_.classList.contains("shaka-keyboard-navigation");a||!this.ad_&&b||this.recentMouseMovement_||e||this.isHovered_()?(this.updateTimeAndSeekRange_(),this.controlsContainer_.setAttribute("shown","true"),this.fadeControlsTimer_.stop()):this.fadeControlsTimer_.tickAfter(this.config_.fadeDelay)},shaka.ui.Controls.prototype.onContainerTouch_=function(a){this.video_.duration&&(this.isOpaque_()?this.lastTouchEventTime_=Date.now():(this.onMouseMove_(a),a.preventDefault()))},shaka.ui.Controls.prototype.onContainerClick_=function(){this.enabled_&&(this.anySettingsMenusAreOpen()?this.hideSettingsMenusTimer_.tickNow():this.onPlayPauseClick_())},shaka.ui.Controls.prototype.onPlayPauseClick_=function(){this.ad_?this.playPauseAd():this.playPausePresentation()},shaka.ui.Controls.prototype.onCastStatusChange_=function(){var a=this.castProxy_.isCasting();this.dispatchEvent(new shaka.util.FakeEvent("caststatuschanged",{newStatus:a})),a?this.controlsContainer_.setAttribute("casting","true"):this.controlsContainer_.removeAttribute("casting")},shaka.ui.Controls.prototype.onPlayStateChange_=function(){this.video_.ended&&!this.video_.paused&&this.video_.pause(),this.computeOpacity()},shaka.ui.Controls.prototype.onKeyUp_=function(a){var b=document.activeElement,e=!(!b||!b.classList)&&b.classList.contains("shaka-volume-bar"),t=b&&b.classList&&b.classList.contains("shaka-seek-bar");if(this.controlsContainer_.contains(b)&&this.onMouseMove_(a),this.pressedKeys_.delete(a.key),this.config_.enableKeyboardPlaybackControls)switch(a.key){case"ArrowLeft":e||this.seek_(this.video_.currentTime-5,a);break;case"ArrowRight":e||this.seek_(this.video_.currentTime+5,a);break;case"Home":this.seek_(this.player_.seekRange().start,a);break;case"End":this.seek_(this.player_.seekRange().end,a);break;case" ":t&&this.onPlayPauseClick_()}},shaka.ui.Controls.prototype.onBufferingStateChange_=function(){this.enabled_&&shaka.ui.Utils.setDisplay(this.spinnerContainer_,this.player_.isBuffering())},shaka.ui.Controls.prototype.isOpaque_=function(){return!!this.enabled_&&(null!=this.controlsContainer_.getAttribute("shown")||null!=this.controlsContainer_.getAttribute("casting"))},shaka.ui.Controls.prototype.seek_=function(a,b){this.video_.currentTime=a,this.isOpaque_()&&this.updateTimeAndSeekRange_()},shaka.ui.Controls.prototype.updateTimeAndSeekRange_=function(){if(this.seekBar_)if(this.seekBar_.setValue(this.video_.currentTime),this.seekBar_.update(),this.seekBar_.isShowing())for(var a=$jscomp.makeIterator(this.settingsMenus_),b=a.next();!b.done;b=a.next())b.value.classList.remove("shaka-low-position");else for(b=(a=$jscomp.makeIterator(this.settingsMenus_)).next();!b.done;b=a.next())b.value.classList.add("shaka-low-position");this.dispatchEvent(new shaka.util.FakeEvent("timeandseekrangeupdated"))},shaka.ui.Controls.prototype.onKeyDown_=function(a){var b=this;this.pressedKeys_.add(a.key);var e=this.anySettingsMenusAreOpen();"Tab"==a.key&&(this.controlsContainer_.classList.add("shaka-keyboard-navigation"),this.computeOpacity(),this.eventManager_.listen(window,"mousedown",(function(){return b.onMouseDown_()}))),"Escape"==a.key&&this.hideSettingsMenusTimer_.tickNow(),e&&this.pressedKeys_.has("Tab")&&this.keepFocusInMenu_(a)},shaka.ui.Controls.prototype.keepFocusInMenu_=function(a){var b=this.settingsMenus_.filter((function(a){return!a.classList.contains("shaka-hidden")}))[0];if(b.childNodes.length){for(var e=b.firstElementChild;e&&e.classList.contains("shaka-hidden");)e=e.nextElementSibling;for(b=b.lastElementChild;b&&b.classList.contains("shaka-hidden");)b=b.previousElementSibling;var t=document.activeElement;this.pressedKeys_.has("Shift")?t==e&&(a.preventDefault(),b.focus()):t==b&&(a.preventDefault(),e.focus())}},shaka.ui.Controls.prototype.onMouseDown_=function(){this.eventManager_.unlisten(window,"mousedown")},shaka.ui.Controls.createLocalization_=function(){var a=new shaka.ui.Localization("en");return shaka.ui.Locales.addTo(a),a.changeLocale(navigator.languages||[]),a},goog.exportSymbol("shaka.ui.Controls",shaka.ui.Controls),goog.exportProperty(shaka.ui.Controls.prototype,"hideAdUI",shaka.ui.Controls.prototype.hideAdUI),goog.exportProperty(shaka.ui.Controls.prototype,"showAdUI",shaka.ui.Controls.prototype.showAdUI),goog.exportProperty(shaka.ui.Controls.prototype,"toggleFullScreen",shaka.ui.Controls.prototype.toggleFullScreen),goog.exportProperty(shaka.ui.Controls.prototype,"hideSettingsMenus",shaka.ui.Controls.prototype.hideSettingsMenus),goog.exportProperty(shaka.ui.Controls.prototype,"anySettingsMenusAreOpen",shaka.ui.Controls.prototype.anySettingsMenusAreOpen),goog.exportProperty(shaka.ui.Controls.prototype,"setLastTouchEventTime",shaka.ui.Controls.prototype.setLastTouchEventTime),goog.exportProperty(shaka.ui.Controls.prototype,"getDisplayTime",shaka.ui.Controls.prototype.getDisplayTime),goog.exportProperty(shaka.ui.Controls.prototype,"isCastAllowed",shaka.ui.Controls.prototype.isCastAllowed),goog.exportProperty(shaka.ui.Controls.prototype,"setSeeking",shaka.ui.Controls.prototype.setSeeking),goog.exportProperty(shaka.ui.Controls.prototype,"isSeeking",shaka.ui.Controls.prototype.isSeeking),goog.exportProperty(shaka.ui.Controls.prototype,"getConfig",shaka.ui.Controls.prototype.getConfig),goog.exportProperty(shaka.ui.Controls.prototype,"getServerSideAdContainer",shaka.ui.Controls.prototype.getServerSideAdContainer),goog.exportProperty(shaka.ui.Controls.prototype,"getControlsContainer",shaka.ui.Controls.prototype.getControlsContainer),goog.exportProperty(shaka.ui.Controls.prototype,"getLocalPlayer",shaka.ui.Controls.prototype.getLocalPlayer),goog.exportProperty(shaka.ui.Controls.prototype,"getPlayer",shaka.ui.Controls.prototype.getPlayer),goog.exportProperty(shaka.ui.Controls.prototype,"getLocalVideo",shaka.ui.Controls.prototype.getLocalVideo),goog.exportProperty(shaka.ui.Controls.prototype,"getVideo",shaka.ui.Controls.prototype.getVideo),goog.exportProperty(shaka.ui.Controls.prototype,"getVideoContainer",shaka.ui.Controls.prototype.getVideoContainer),goog.exportProperty(shaka.ui.Controls.prototype,"getLocalization",shaka.ui.Controls.prototype.getLocalization),goog.exportProperty(shaka.ui.Controls.prototype,"getCastProxy",shaka.ui.Controls.prototype.getCastProxy),goog.exportProperty(shaka.ui.Controls.prototype,"setEnabledNativeControls",shaka.ui.Controls.prototype.setEnabledNativeControls),goog.exportProperty(shaka.ui.Controls.prototype,"setEnabledShakaControls",shaka.ui.Controls.prototype.setEnabledShakaControls),goog.exportProperty(shaka.ui.Controls.prototype,"configure",shaka.ui.Controls.prototype.configure),goog.exportProperty(shaka.ui.Controls.prototype,"loadComplete",shaka.ui.Controls.prototype.loadComplete),goog.exportProperty(shaka.ui.Controls.prototype,"allowCast",shaka.ui.Controls.prototype.allowCast),goog.exportProperty(shaka.ui.Controls,"registerElement",shaka.ui.Controls.registerElement),goog.exportProperty(shaka.ui.Controls.prototype,"destroy",shaka.ui.Controls.prototype.destroy),shaka.ui.ControlsPanel.elementNamesToFactories_=new Map,shaka.ui.Enums={},shaka.ui.Enums.MaterialDesignIcons={FULLSCREEN:"fullscreen",EXIT_FULLSCREEN:"fullscreen_exit",CLOSED_CAPTIONS:"closed_caption",CHECKMARK:"done",LANGUAGE:"language",PIP:"picture_in_picture_alt",EXIT_PIP:"branding_watermark",BACK:"arrow_back",RESOLUTION:"settings",MUTE:"volume_up",UNMUTE:"volume_off",CAST:"cast",EXIT_CAST:"cast_connected",OPEN_OVERFLOW:"more_vert",REWIND:"fast_rewind",FAST_FORWARD:"fast_forward",PLAY:"play_arrow",PLAYBACK_RATE:"slow_motion_video",PAUSE:"pause",LOOP:"loop",AIRPLAY:"airplay"},shaka.ui.OverflowMenu=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.config_=this.controls.getConfig(),this.controlsContainer_=this.controls.getControlsContainer(),this.children_=[],this.addOverflowMenuButton_(),this.addOverflowMenu_(),this.createChildren_();for(var t=this.controls.getVideoContainer().getElementsByClassName("shaka-back-to-overflow-button"),r=(t=$jscomp.makeIterator(t)).next();!r.done;r=t.next())this.eventManager.listen(r.value,"click",(function(){e.controls.hideSettingsMenus(),shaka.ui.Utils.setDisplay(e.overflowMenu_,!0),e.overflowMenu_.childNodes.length&&e.overflowMenu_.childNodes[0].focus(),e.controls.computeOpacity()}));this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,(function(){shaka.ui.Utils.setDisplay(e.overflowMenuButton_,!1)})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,(function(){shaka.ui.Utils.setDisplay(e.overflowMenuButton_,!0)})),this.eventManager.listen(this.controls,"submenuopen",(function(){shaka.ui.Utils.setDisplay(e.overflowMenu_,!1)})),this.eventManager.listen(this.overflowMenu_,"touchstart",(function(a){e.controls.setLastTouchEventTime(Date.now()),a.stopPropagation()})),this.eventManager.listen(this.overflowMenuButton_,"click",(function(){e.onOverflowMenuButtonClick_()})),this.eventManager.listen(this.controlsContainer_,"touchstart",(function(a){e.overflowMenu_.classList.contains("shaka-hidden")||(shaka.ui.Utils.setDisplay(e.overflowMenu_,!1),a.preventDefault())})),this.updateAriaLabel_()},$jscomp.inherits(shaka.ui.OverflowMenu,shaka.ui.Element),shaka.ui.OverflowMenu.prototype.release=function(){this.controlsContainer_=null;for(var a=$jscomp.makeIterator(this.children_),b=a.next();!b.done;b=a.next())b.value.release();this.children_=[],shaka.ui.Element.prototype.release.call(this)},shaka.ui.OverflowMenu.registerElement=function(a,b){shaka.ui.OverflowMenu.elementNamesToFactories_.set(a,b)},shaka.ui.OverflowMenu.prototype.addOverflowMenu_=function(){this.overflowMenu_=shaka.util.Dom.createHTMLElement("div"),this.overflowMenu_.classList.add("shaka-overflow-menu"),this.overflowMenu_.classList.add("shaka-no-propagation"),this.overflowMenu_.classList.add("shaka-show-controls-on-mouse-over"),this.overflowMenu_.classList.add("shaka-settings-menu"),this.overflowMenu_.classList.add("shaka-hidden"),this.controlsContainer_.appendChild(this.overflowMenu_)},shaka.ui.OverflowMenu.prototype.addOverflowMenuButton_=function(){this.overflowMenuButton_=shaka.util.Dom.createButton(),this.overflowMenuButton_.classList.add("shaka-overflow-menu-button"),this.overflowMenuButton_.classList.add("shaka-no-propagation"),this.overflowMenuButton_.classList.add("material-icons-round"),this.overflowMenuButton_.textContent=shaka.ui.Enums.MaterialDesignIcons.OPEN_OVERFLOW,this.parent.appendChild(this.overflowMenuButton_)},shaka.ui.OverflowMenu.prototype.createChildren_=function(){for(var a=$jscomp.makeIterator(this.config_.overflowMenuButtons),b=a.next();!b.done;b=a.next())b=b.value,shaka.ui.OverflowMenu.elementNamesToFactories_.get(b)?(b=shaka.ui.OverflowMenu.elementNamesToFactories_.get(b),goog.asserts.assert(this.controls,"Controls should not be null!"),this.children_.push(b.create(this.overflowMenu_,this.controls))):shaka.log.alwaysWarn("Unrecognized overflow menu element requested:",b)},shaka.ui.OverflowMenu.prototype.onOverflowMenuButtonClick_=function(){if(this.controls.anySettingsMenusAreOpen())this.controls.hideSettingsMenus();else{shaka.ui.Utils.setDisplay(this.overflowMenu_,!0),this.controls.computeOpacity();var a=function(a){return 0==a.classList.contains("shaka-hidden")},b=shaka.util.Iterables;b.some(this.overflowMenu_.childNodes,a)&&b.filter(this.overflowMenu_.childNodes,a)[0].focus()}},shaka.ui.OverflowMenu.prototype.updateAriaLabel_=function(){this.overflowMenuButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.MORE_SETTINGS))},goog.exportSymbol("shaka.ui.OverflowMenu",shaka.ui.OverflowMenu),goog.exportProperty(shaka.ui.OverflowMenu,"registerElement",shaka.ui.OverflowMenu.registerElement),shaka.ui.OverflowMenu.Factory=function(){},shaka.ui.OverflowMenu.Factory.prototype.create=function(a,b){return new shaka.ui.OverflowMenu(a,b)},shaka.ui.Controls.registerElement("overflow_menu",new shaka.ui.OverflowMenu.Factory),shaka.ui.OverflowMenu.elementNamesToFactories_=new Map,shaka.ui.AirPlayButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.airplayButton_=shaka.util.Dom.createButton(),this.airplayButton_.classList.add("shaka-airplay-button"),this.airplayButton_.setAttribute("aria-pressed","false"),this.airplayIcon_=shaka.util.Dom.createHTMLElement("i"),this.airplayIcon_.classList.add("material-icons-round"),this.airplayIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.AIRPLAY,this.airplayButton_.appendChild(this.airplayIcon_);var t=shaka.util.Dom.createHTMLElement("label");t.classList.add("shaka-overflow-button-label"),this.airplayNameSpan_=shaka.util.Dom.createHTMLElement("span"),t.appendChild(this.airplayNameSpan_),this.airplayCurrentSelectionSpan_=shaka.util.Dom.createHTMLElement("span"),this.airplayCurrentSelectionSpan_.classList.add("shaka-current-selection-span"),t.appendChild(this.airplayCurrentSelectionSpan_),this.airplayButton_.appendChild(t),this.parent.appendChild(this.airplayButton_),this.updateLocalizedStrings_(),this.onAirPlayStatusChange_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.airplayButton_,"click",(function(){e.onAirPlayClick_()})),t=this.controls.getVideo(),goog.asserts.assert(null!=t,"Should have a video!"),this.eventManager.listen(t,"webkitplaybacktargetavailabilitychanged",(function(a){e.onAirPlayAvailabilityChange_(a)})),this.eventManager.listen(t,"webkitcurrentplaybacktargetiswirelesschanged",(function(){e.onAirPlayStatusChange_()}))},$jscomp.inherits(shaka.ui.AirPlayButton,shaka.ui.Element),shaka.ui.AirPlayButton.prototype.onAirPlayClick_=function(){var a=this.controls.getVideo();goog.asserts.assert(null!=a,"Should have a video!"),a.webkitShowPlaybackTargetPicker()},shaka.ui.AirPlayButton.prototype.onAirPlayAvailabilityChange_=function(a){a="available"==a.availability;var b=this.player.getLoadMode()==shaka.Player.LoadMode.SRC_EQUALS;shaka.ui.Utils.setDisplay(this.airplayButton_,a&&b)},shaka.ui.AirPlayButton.prototype.onAirPlayStatusChange_=function(){var a=this.controls.getVideo();goog.asserts.assert(null!=a,"Should have a video!"),a&&a.webkitCurrentPlaybackTargetIsWireless?this.airplayButton_.setAttribute("aria-pressed","true"):this.airplayButton_.setAttribute("aria-pressed","false")},shaka.ui.AirPlayButton.prototype.updateLocalizedStrings_=function(){var a=shaka.ui.Locales.Ids;this.airplayButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.AIRPLAY)),this.airplayNameSpan_.textContent=this.localization.resolve(a.AIRPLAY)},goog.exportSymbol("shaka.ui.AirPlayButton",shaka.ui.AirPlayButton),shaka.ui.AirPlayButton.Factory=function(){},shaka.ui.AirPlayButton.Factory.prototype.create=function(a,b){return new shaka.ui.AirPlayButton(a,b)},shaka.ui.OverflowMenu.registerElement("airplay",new shaka.ui.AirPlayButton.Factory),shaka.ui.LanguageUtils=function(){},shaka.ui.LanguageUtils.updateTracks=function(a,b,e,t,r,n,g){var o=a.filter((function(a){return 1==a.active}))[0],l=shaka.ui.Utils.getFirstDescendantWithClassName(b,"shaka-back-to-overflow-button");shaka.util.Dom.removeAllChildren(b),b.appendChild(l),l=function(a){return"variant"==a.type?a.audioRoles?a.audioRoles.join(", "):void 0:a.roles.join(", ")};for(var h=function(a,b){return a+": "+b},d=new Map,c=$jscomp.makeIterator(a),p=c.next();!p.done;p=c.next())p=p.value,d.has(p.language)||d.set(p.language,new Set),d.get(p.language).add(l(p));for(d=new Set,o=o?h(o.language,l(o)):"",c={},p=(a=$jscomp.makeIterator(a)).next();!p.done;c={$jscomp$loop$prop$track$519$571:c.$jscomp$loop$prop$track$519$571},p=a.next()){c.$jscomp$loop$prop$track$519$571=p.value,p=c.$jscomp$loop$prop$track$519$571.language;var q=l(c.$jscomp$loop$prop$track$519$571),m=h(p,q);if(!d.has(m)){d.add(m);var u=shaka.util.Dom.createButton();u.addEventListener("click",function(a){return function(){e(a.$jscomp$loop$prop$track$519$571)}}(c));var f=shaka.util.Dom.createHTMLElement("span");switch(u.appendChild(f),f.textContent=shaka.ui.LanguageUtils.getLanguageName(p,n),g){case shaka.ui.TrackLabelFormat.ROLE:q?f.textContent=q:(shaka.log.alwaysWarn("Track #"+c.$jscomp$loop$prop$track$519$571.id+" does not have a role, but the UI is configured to only show role."),f.textContent="?");break;case shaka.ui.TrackLabelFormat.LANGUAGE_ROLE:q&&(f.textContent+=": "+q)}t&&m==o&&(u.appendChild(shaka.ui.Utils.checkmarkIcon()),f.classList.add("shaka-chosen-item"),u.setAttribute("aria-selected","true"),r.textContent=f.textContent),b.appendChild(u)}}},shaka.ui.LanguageUtils.getLanguageName=function(a,b){if(!a&&!b)return"";switch(a){case"mul":return b.resolve(shaka.ui.Locales.Ids.MULTIPLE_LANGUAGES);case"und":return b.resolve(shaka.ui.Locales.Ids.UNDETERMINED_LANGUAGE);case"zxx":return b.resolve(shaka.ui.Locales.Ids.NOT_APPLICABLE)}var e=shaka.util.LanguageUtils.getBase(a);return a in mozilla.LanguageMapping?mozilla.LanguageMapping[a].nativeName:e in mozilla.LanguageMapping?mozilla.LanguageMapping[e].nativeName+" ("+a+")":b.resolve(shaka.ui.Locales.Ids.UNRECOGNIZED_LANGUAGE)+" ("+a+")"},shaka.ui.SettingsMenu=function(a,b,e){shaka.ui.Element.call(this,a,b);var t=this;this.addButton_(e),this.addMenu_(),this.eventManager.listen(this.button,"click",(function(){t.onButtonClick_()}))},$jscomp.inherits(shaka.ui.SettingsMenu,shaka.ui.Element),shaka.ui.SettingsMenu.prototype.addButton_=function(a){this.button=shaka.util.Dom.createButton(),this.icon=shaka.util.Dom.createHTMLElement("i"),this.icon.classList.add("material-icons-round"),this.icon.textContent=a,this.button.appendChild(this.icon),(a=shaka.util.Dom.createHTMLElement("label")).classList.add("shaka-overflow-button-label"),this.nameSpan=shaka.util.Dom.createHTMLElement("span"),a.appendChild(this.nameSpan),this.currentSelection=shaka.util.Dom.createHTMLElement("span"),this.currentSelection.classList.add("shaka-current-selection-span"),a.appendChild(this.currentSelection),this.button.appendChild(a),this.parent.appendChild(this.button)},shaka.ui.SettingsMenu.prototype.addMenu_=function(){this.menu=shaka.util.Dom.createHTMLElement("div"),this.menu.classList.add("shaka-no-propagation"),this.menu.classList.add("shaka-show-controls-on-mouse-over"),this.menu.classList.add("shaka-settings-menu"),this.menu.classList.add("shaka-hidden"),this.backButton=shaka.util.Dom.createButton(),this.backButton.classList.add("shaka-back-to-overflow-button"),this.menu.appendChild(this.backButton);var a=shaka.util.Dom.createHTMLElement("i");a.classList.add("material-icons-round"),a.textContent=shaka.ui.Enums.MaterialDesignIcons.BACK,this.backButton.appendChild(a),this.backSpan=shaka.util.Dom.createHTMLElement("span"),this.backButton.appendChild(this.backSpan),this.controls.getControlsContainer().appendChild(this.menu)},shaka.ui.SettingsMenu.prototype.onButtonClick_=function(){this.controls.dispatchEvent(new shaka.util.FakeEvent("submenuopen")),shaka.ui.Utils.setDisplay(this.menu,!0),shaka.ui.Utils.focusOnTheChosenItem(this.menu)},goog.exportSymbol("shaka.ui.SettingsMenu",shaka.ui.SettingsMenu),shaka.ui.AudioLanguageSelection=function(a,b){shaka.ui.SettingsMenu.call(this,a,b,shaka.ui.Enums.MaterialDesignIcons.LANGUAGE);var e=this;this.button.classList.add("shaka-language-button"),this.menu.classList.add("shaka-audio-languages"),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.player,"trackschanged",(function(){e.onTracksChanged_()})),this.eventManager.listen(this.player,"variantchanged",(function(){e.updateAudioLanguages_()})),this.updateLocalizedStrings_(),this.updateAudioLanguages_()},$jscomp.inherits(shaka.ui.AudioLanguageSelection,shaka.ui.SettingsMenu),shaka.ui.AudioLanguageSelection.prototype.updateAudioLanguages_=function(){var a=this,b=this.player.getVariantTracks();shaka.ui.LanguageUtils.updateTracks(b,this.menu,(function(b){return a.onAudioTrackSelected_(b)}),!0,this.currentSelection,this.localization,this.controls.getConfig().trackLabelFormat),shaka.ui.Utils.focusOnTheChosenItem(this.menu),this.controls.dispatchEvent(new shaka.util.FakeEvent("languageselectionupdated"))},shaka.ui.AudioLanguageSelection.prototype.onTracksChanged_=function(){var a=0<this.player.getVariantTracks().length;shaka.ui.Utils.setDisplay(this.button,a),this.updateAudioLanguages_()},shaka.ui.AudioLanguageSelection.prototype.onAudioTrackSelected_=function(a){this.player.selectAudioLanguage(a.language,a.roles[0])},shaka.ui.AudioLanguageSelection.prototype.updateLocalizedStrings_=function(){var a=shaka.ui.Locales.Ids;this.backButton.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.BACK)),this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.LANGUAGE)),this.nameSpan.textContent=this.localization.resolve(a.LANGUAGE),this.backSpan.textContent=this.localization.resolve(a.LANGUAGE)},goog.exportSymbol("shaka.ui.AudioLanguageSelection",shaka.ui.AudioLanguageSelection),shaka.ui.AudioLanguageSelection.Factory=function(){},shaka.ui.AudioLanguageSelection.Factory.prototype.create=function(a,b){return new shaka.ui.AudioLanguageSelection(a,b)},shaka.ui.OverflowMenu.registerElement("language",new shaka.ui.AudioLanguageSelection.Factory),shaka.ui.PlayButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this,t=shaka.ads.AdManager;this.button=shaka.util.Dom.createButton(),this.parent.appendChild(this.button),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateAriaLabel()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateAriaLabel()})),this.eventManager.listen(this.video,"play",(function(){e.updateAriaLabel(),e.updateIcon()})),this.eventManager.listen(this.video,"pause",(function(){e.updateAriaLabel(),e.updateIcon()})),this.eventManager.listen(this.adManager,t.AD_PAUSED,(function(){e.updateAriaLabel(),e.updateIcon()})),this.eventManager.listen(this.adManager,t.AD_RESUMED,(function(){e.updateAriaLabel(),e.updateIcon()})),this.eventManager.listen(this.adManager,t.AD_STARTED,(function(){e.updateAriaLabel(),e.updateIcon()})),this.eventManager.listen(this.button,"click",(function(){e.ad?e.controls.playPauseAd():e.controls.playPausePresentation()}))},$jscomp.inherits(shaka.ui.PlayButton,shaka.ui.Element),shaka.ui.PlayButton.prototype.isPaused=function(){return this.ad?this.ad.isPaused():this.controls.presentationIsPaused()},shaka.ui.PlayButton.prototype.updateAriaLabel=function(){var a=shaka.ui.Locales.Ids;a=this.isPaused()?a.PLAY:a.PAUSE,this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a))},shaka.ui.PlayButton.prototype.updateIcon=function(){},goog.exportSymbol("shaka.ui.PlayButton",shaka.ui.PlayButton),shaka.ui.BigPlayButton=function(a,b){shaka.ui.PlayButton.call(this,a,b),this.button.classList.add("shaka-play-button"),this.button.classList.add("shaka-no-propagation"),this.updateIcon(),this.updateAriaLabel()},$jscomp.inherits(shaka.ui.BigPlayButton,shaka.ui.PlayButton),shaka.ui.BigPlayButton.prototype.updateIcon=function(){this.isPaused()?this.button.setAttribute("icon","play"):this.button.setAttribute("icon","pause")},goog.exportSymbol("shaka.ui.BigPlayButton",shaka.ui.BigPlayButton),shaka.ui.CastButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.castProxy_=this.controls.getCastProxy(),this.castButton_=shaka.util.Dom.createButton(),this.castButton_.classList.add("shaka-cast-button"),this.castButton_.setAttribute("aria-pressed","false"),this.castIcon_=shaka.util.Dom.createHTMLElement("i"),this.castIcon_.classList.add("material-icons-round"),this.castIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.CAST,this.castButton_.appendChild(this.castIcon_);var t=shaka.util.Dom.createHTMLElement("label");t.classList.add("shaka-overflow-button-label"),this.castNameSpan_=shaka.util.Dom.createHTMLElement("span"),t.appendChild(this.castNameSpan_),this.castCurrentSelectionSpan_=shaka.util.Dom.createHTMLElement("span"),this.castCurrentSelectionSpan_.classList.add("shaka-current-selection-span"),t.appendChild(this.castCurrentSelectionSpan_),this.castButton_.appendChild(t),this.parent.appendChild(this.castButton_),this.updateLocalizedStrings_(),this.onCastStatusChange_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.castButton_,"click",(function(){e.onCastClick_()})),this.eventManager.listen(this.controls,"caststatuschanged",(function(){e.onCastStatusChange_()}))},$jscomp.inherits(shaka.ui.CastButton,shaka.ui.Element),shaka.ui.CastButton.prototype.onCastClick_=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?a.castProxy_.isCasting()?(a.castProxy_.suggestDisconnect(),e.jumpTo(0)):(e.setCatchFinallyBlocks(3),a.castButton_.disabled=!0,e.yield(a.castProxy_.cast(),5)):3!=e.nextAddress?(a.castButton_.disabled=!1,e.leaveTryBlock(0)):(b=e.enterCatchBlock(),a.castButton_.disabled=!1,b.code!=shaka.util.Error.Code.CAST_CANCELED_BY_USER&&a.controls.dispatchEvent(new shaka.util.FakeEvent("error",{detail:b})),void e.jumpToEnd())}))},shaka.ui.CastButton.prototype.onCastStatusChange_=function(){var a=this.castProxy_.canCast()&&this.controls.isCastAllowed(),b=this.castProxy_.isCasting(),e=shaka.ui.Enums.MaterialDesignIcons;shaka.ui.Utils.setDisplay(this.castButton_,a),this.castIcon_.textContent=b?e.EXIT_CAST:e.CAST,a&&(b?this.castButton_.setAttribute("aria-pressed","true"):this.castButton_.setAttribute("aria-pressed","false")),this.setCurrentCastSelection_()},shaka.ui.CastButton.prototype.setCurrentCastSelection_=function(){this.castProxy_.isCasting()?this.castCurrentSelectionSpan_.textContent=this.castProxy_.receiverName():this.castCurrentSelectionSpan_.textContent=this.localization.resolve(shaka.ui.Locales.Ids.OFF)},shaka.ui.CastButton.prototype.updateLocalizedStrings_=function(){var a=shaka.ui.Locales.Ids;this.castButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.CAST)),this.castNameSpan_.textContent=this.localization.resolve(a.CAST),this.setCurrentCastSelection_()},goog.exportSymbol("shaka.ui.CastButton",shaka.ui.CastButton),shaka.ui.CastButton.Factory=function(){},shaka.ui.CastButton.Factory.prototype.create=function(a,b){return new shaka.ui.CastButton(a,b)},shaka.ui.OverflowMenu.registerElement("cast",new shaka.ui.CastButton.Factory),shaka.ui.FastForwardButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("material-icons-round"),this.button_.classList.add("shaka-fast-forward-button"),this.button_.textContent=shaka.ui.Enums.MaterialDesignIcons.FAST_FORWARD,this.parent.appendChild(this.button_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.button_,"click",(function(){e.fastForward_()}))},$jscomp.inherits(shaka.ui.FastForwardButton,shaka.ui.Element),shaka.ui.FastForwardButton.prototype.updateAriaLabel_=function(){this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.FAST_FORWARD))},shaka.ui.FastForwardButton.prototype.fastForward_=function(){if(this.video.duration){var a=this.player.getPlaybackRate();this.player.trickPlay(0>a||4<a?1:2*a)}},goog.exportSymbol("shaka.ui.FastForwardButton",shaka.ui.FastForwardButton),shaka.ui.FastForwardButton.Factory=function(){},shaka.ui.FastForwardButton.Factory.prototype.create=function(a,b){return new shaka.ui.FastForwardButton(a,b)},shaka.ui.Controls.registerElement("fast_forward",new shaka.ui.FastForwardButton.Factory),shaka.ui.FullscreenButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("shaka-fullscreen-button"),this.button_.classList.add("material-icons-round"),document.fullscreenEnabled||this.button_.classList.add("shaka-hidden"),this.button_.textContent=shaka.ui.Enums.MaterialDesignIcons.FULLSCREEN,this.parent.appendChild(this.button_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.button_,"click",(function(){return $jscomp.asyncExecutePromiseGeneratorProgram((function(a){return a.yield(e.controls.toggleFullScreen(),0)}))})),this.eventManager.listen(document,"fullscreenchange",(function(){e.updateIcon_(),e.updateAriaLabel_()}))},$jscomp.inherits(shaka.ui.FullscreenButton,shaka.ui.Element),shaka.ui.FullscreenButton.prototype.updateAriaLabel_=function(){var a=shaka.ui.Locales.Ids;this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(document.fullscreenElement?a.EXIT_FULL_SCREEN:a.FULL_SCREEN))},shaka.ui.FullscreenButton.prototype.updateIcon_=function(){this.button_.textContent=document.fullscreenElement?shaka.ui.Enums.MaterialDesignIcons.EXIT_FULLSCREEN:shaka.ui.Enums.MaterialDesignIcons.FULLSCREEN},goog.exportSymbol("shaka.ui.FullscreenButton",shaka.ui.FullscreenButton),shaka.ui.FullscreenButton.Factory=function(){},shaka.ui.FullscreenButton.Factory.prototype.create=function(a,b){return new shaka.ui.FullscreenButton(a,b)},shaka.ui.Controls.registerElement("fullscreen",new shaka.ui.FullscreenButton.Factory),shaka.ui.LoopButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this,t=shaka.ui.Locales.Ids;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("shaka-loop-button"),this.icon_=shaka.util.Dom.createHTMLElement("i"),this.icon_.classList.add("material-icons-round"),this.icon_.textContent=shaka.ui.Enums.MaterialDesignIcons.LOOP,this.button_.appendChild(this.icon_);var r=shaka.util.Dom.createHTMLElement("label");r.classList.add("shaka-overflow-button-label"),this.nameSpan_=shaka.util.Dom.createHTMLElement("span"),this.nameSpan_.textContent=this.localization.resolve(t.LOOP),r.appendChild(this.nameSpan_),this.currentState_=shaka.util.Dom.createHTMLElement("span"),this.currentState_.classList.add("shaka-current-selection-span"),r.appendChild(this.currentState_),this.button_.appendChild(r),this.updateLocalizedStrings_(),this.parent.appendChild(this.button_),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.button_,"click",(function(){e.onClick_()})),this.loopEnabled_=this.video.loop,this.timer_=new shaka.util.Timer((function(){e.onTimerTick_()})),this.timer_.tickEvery(1)},$jscomp.inherits(shaka.ui.LoopButton,shaka.ui.Element),shaka.ui.LoopButton.prototype.release=function(){this.timer_.stop(),this.timer_=null,shaka.ui.Element.prototype.release.call(this)},shaka.ui.LoopButton.prototype.onClick_=function(){this.video.loop=!this.video.loop,this.timer_.tickNow(),this.timer_.tickEvery(1)},shaka.ui.LoopButton.prototype.onTimerTick_=function(){this.loopEnabled_!=this.video.loop&&(this.updateLocalizedStrings_(),this.loopEnabled_=this.video.loop)},shaka.ui.LoopButton.prototype.updateLocalizedStrings_=function(){var a=shaka.ui.Locales.Ids;this.nameSpan_.textContent=this.localization.resolve(a.LOOP),this.currentState_.textContent=this.localization.resolve(this.video.loop?a.ON:a.OFF),this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(this.video.loop?a.EXIT_LOOP_MODE:a.ENTER_LOOP_MODE))},goog.exportSymbol("shaka.ui.LoopButton",shaka.ui.LoopButton),shaka.ui.LoopButton.Factory=function(){},shaka.ui.LoopButton.Factory.prototype.create=function(a,b){return new shaka.ui.LoopButton(a,b)},shaka.ui.OverflowMenu.registerElement("loop",new shaka.ui.LoopButton.Factory),shaka.ui.MuteButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("shaka-mute-button"),this.button_.classList.add("material-icons-round"),this.button_.textContent=shaka.ui.Enums.MaterialDesignIcons.MUTE,this.parent.appendChild(this.button_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.button_,"click",(function(){e.ad?e.ad.setMuted(!e.ad.isMuted()):e.video.muted=!e.video.muted})),this.eventManager.listen(this.video,"volumechange",(function(){e.updateAriaLabel_(),e.updateIcon_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_VOLUME_CHANGED,(function(){e.updateAriaLabel_(),e.updateIcon_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_MUTED,(function(){e.updateAriaLabel_(),e.updateIcon_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,(function(){e.ad=null,e.updateAriaLabel_(),e.updateIcon_()}))},$jscomp.inherits(shaka.ui.MuteButton,shaka.ui.Element),shaka.ui.MuteButton.prototype.updateAriaLabel_=function(){var a=shaka.ui.Locales.Ids;a=this.ad?this.ad.isMuted()?a.UNMUTE:a.MUTE:this.video.muted?a.UNMUTE:a.MUTE,this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a))},shaka.ui.MuteButton.prototype.updateIcon_=function(){var a=shaka.ui.Enums.MaterialDesignIcons;a=this.ad?this.ad.isMuted()?a.UNMUTE:a.MUTE:this.video.muted?a.UNMUTE:a.MUTE,this.button_.textContent=a},goog.exportSymbol("shaka.ui.MuteButton",shaka.ui.MuteButton),shaka.ui.MuteButton.Factory=function(){},shaka.ui.MuteButton.Factory.prototype.create=function(a,b){return new shaka.ui.MuteButton(a,b)},shaka.ui.Controls.registerElement("mute",new shaka.ui.MuteButton.Factory),shaka.ui.PipButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.localVideo_=this.controls.getLocalVideo();var t=shaka.ui.Locales.Ids;this.pipButton_=shaka.util.Dom.createButton(),this.pipButton_.classList.add("shaka-pip-button"),this.pipIcon_=shaka.util.Dom.createHTMLElement("i"),this.pipIcon_.classList.add("material-icons-round"),this.pipIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.PIP,this.pipButton_.appendChild(this.pipIcon_);var r=shaka.util.Dom.createHTMLElement("label");r.classList.add("shaka-overflow-button-label"),this.pipNameSpan_=shaka.util.Dom.createHTMLElement("span"),this.pipNameSpan_.textContent=this.localization.resolve(t.PICTURE_IN_PICTURE),r.appendChild(this.pipNameSpan_),this.currentPipState_=shaka.util.Dom.createHTMLElement("span"),this.currentPipState_.classList.add("shaka-current-selection-span"),r.appendChild(this.currentPipState_),this.pipButton_.appendChild(r),this.updateLocalizedStrings_(),this.parent.appendChild(this.pipButton_),this.isPipAllowed_()||shaka.ui.Utils.setDisplay(this.pipButton_,!1),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.pipButton_,"click",(function(){e.onPipClick_()})),this.eventManager.listen(this.localVideo_,"enterpictureinpicture",(function(){e.onEnterPictureInPicture_()})),this.eventManager.listen(this.localVideo_,"leavepictureinpicture",(function(){e.onLeavePictureInPicture_()})),this.eventManager.listen(this.controls,"caststatuschanged",(function(a){e.onCastStatusChange_(a)})),this.eventManager.listen(this.player,"trackschanged",(function(){e.onTracksChanged_()}))},$jscomp.inherits(shaka.ui.PipButton,shaka.ui.Element),shaka.ui.PipButton.prototype.isPipAllowed_=function(){return document.pictureInPictureEnabled&&!this.video.disablePictureInPicture},shaka.ui.PipButton.prototype.onPipClick_=function(){var b,a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return 1==e.nextAddress?(e.setCatchFinallyBlocks(2),document.pictureInPictureElement?e.yield(document.exitPictureInPicture(),5):(document.fullscreenElement&&document.exitFullscreen(),e.yield(a.video.requestPictureInPicture(),5))):2!=e.nextAddress?e.leaveTryBlock(0):(b=e.enterCatchBlock(),a.controls.dispatchEvent(new shaka.util.FakeEvent("error",{detail:b})),void e.jumpToEnd())}))},shaka.ui.PipButton.prototype.onEnterPictureInPicture_=function(){var a=shaka.ui.Locales.Ids;this.pipIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.EXIT_PIP,this.pipButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.EXIT_PICTURE_IN_PICTURE)),this.currentPipState_.textContent=this.localization.resolve(a.ON)},shaka.ui.PipButton.prototype.onLeavePictureInPicture_=function(){var a=shaka.ui.Locales.Ids;this.pipIcon_.textContent=shaka.ui.Enums.MaterialDesignIcons.PIP,this.pipButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.ENTER_PICTURE_IN_PICTURE)),this.currentPipState_.textContent=this.localization.resolve(a.OFF)},shaka.ui.PipButton.prototype.updateLocalizedStrings_=function(){var a=shaka.ui.Locales.Ids;this.pipNameSpan_.textContent=this.localization.resolve(a.PICTURE_IN_PICTURE),this.pipButton_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(document.pictureInPictureElement?a.EXIT_PICTURE_IN_PICTURE:a.ENTER_PICTURE_IN_PICTURE)),this.currentPipState_.textContent=this.localization.resolve(document.pictureInPictureElement?a.ON:a.OFF)},shaka.ui.PipButton.prototype.onCastStatusChange_=function(a){a.newStatus?this.isPipAllowed_()&&shaka.ui.Utils.setDisplay(this.pipButton_,!1):this.isPipAllowed_()&&shaka.ui.Utils.setDisplay(this.pipButton_,!0)},shaka.ui.PipButton.prototype.onTracksChanged_=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return a.isPipAllowed_()?a.player&&a.player.isAudioOnly()?(shaka.ui.Utils.setDisplay(a.pipButton_,!1),document.pictureInPictureElement?b.yield(document.exitPictureInPicture(),0):b.jumpTo(0)):(shaka.ui.Utils.setDisplay(a.pipButton_,!0),b.jumpTo(0)):(shaka.ui.Utils.setDisplay(a.pipButton_,!1),b.jumpTo(0))}))},goog.exportSymbol("shaka.ui.PipButton",shaka.ui.PipButton),shaka.ui.PipButton.Factory=function(){},shaka.ui.PipButton.Factory.prototype.create=function(a,b){return new shaka.ui.PipButton(a,b)},shaka.ui.OverflowMenu.registerElement("picture_in_picture",new shaka.ui.PipButton.Factory),shaka.ui.PlaybackRateSelection=function(a,b){shaka.ui.SettingsMenu.call(this,a,b,shaka.ui.Enums.MaterialDesignIcons.PLAYBACK_RATE);var e=this;this.button.classList.add("shaka-playbackrate-button"),this.menu.classList.add("shaka-playback-rates"),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.player,"ratechange",(function(){e.updatePlaybackRateSelection_(e.player.getPlaybackRate())})),this.playbackRates_=new Map([["0.5x",.5],["0.75x",.75],["1x",1],["1.25x",1.25],["1.5x",1.5],["1.75x",1.75],["2x",2]]),this.updateLocalizedStrings_(),this.addPlaybackRates_(),this.updatePlaybackRateSelection_(this.player.getPlaybackRate())},$jscomp.inherits(shaka.ui.PlaybackRateSelection,shaka.ui.SettingsMenu),shaka.ui.PlaybackRateSelection.prototype.updateLocalizedStrings_=function(){var a=shaka.ui.Locales.Ids;this.backButton.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.BACK)),this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.PLAYBACK_RATE)),this.nameSpan.textContent=this.localization.resolve(a.PLAYBACK_RATE),this.backSpan.textContent=this.localization.resolve(a.PLAYBACK_RATE)},shaka.ui.PlaybackRateSelection.prototype.updatePlaybackRateSelection_=function(a){var b=this,e=shaka.ui.Utils.getDescendantIfExists(this.menu,"material-icons-round shaka-chosen-item");if(e){var t=e.parentElement;t.removeAttribute("aria-selected"),t.getElementsByTagName("span")[0].classList.remove("shaka-chosen-item"),t.removeChild(e)}(e=Array.from(this.menu.querySelectorAll("span")).find((function(e){return b.playbackRates_.get(e.textContent)==a})))&&((t=e.parentElement).appendChild(shaka.ui.Utils.checkmarkIcon()),t.setAttribute("aria-selected","true"),e.classList.add("shaka-chosen-item")),this.currentSelection.textContent=a+"x"},shaka.ui.PlaybackRateSelection.prototype.addPlaybackRates_=function(){for(var a=this,b={},e=$jscomp.makeIterator(this.playbackRates_.keys()),t=e.next();!t.done;b={$jscomp$loop$prop$rateStr$573:b.$jscomp$loop$prop$rateStr$573},t=e.next()){b.$jscomp$loop$prop$rateStr$573=t.value,t=shaka.util.Dom.createButton();var r=shaka.util.Dom.createHTMLElement("span");r.textContent=b.$jscomp$loop$prop$rateStr$573,t.appendChild(r),this.eventManager.listen(t,"click",function(b){return function(){a.video.playbackRate=a.playbackRates_.get(b.$jscomp$loop$prop$rateStr$573)}}(b)),this.menu.appendChild(t)}shaka.ui.Utils.focusOnTheChosenItem(this.menu)},goog.exportSymbol("shaka.ui.PlaybackRateSelection",shaka.ui.PlaybackRateSelection),shaka.ui.PlaybackRateSelection.Factory=function(){},shaka.ui.PlaybackRateSelection.Factory.prototype.create=function(a,b){return new shaka.ui.PlaybackRateSelection(a,b)},shaka.ui.OverflowMenu.registerElement("playback_rate",new shaka.ui.PlaybackRateSelection.Factory),shaka.ui.PresentationTimeTracker=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.currentTime_=shaka.util.Dom.createButton(),this.currentTime_.classList.add("shaka-current-time"),this.setValue_("0:00"),this.parent.appendChild(this.currentTime_),this.eventManager.listen(this.currentTime_,"click",(function(){e.player.isLive()&&(e.video.currentTime=e.player.seekRange().end)})),this.eventManager.listen(this.controls,"timeandseekrangeupdated",(function(){e.updateTime_()})),this.eventManager.listen(this.player,"trackschanged",(function(){e.onTracksChanged_()}))},$jscomp.inherits(shaka.ui.PresentationTimeTracker,shaka.ui.Element),shaka.ui.PresentationTimeTracker.prototype.setValue_=function(a){a!=this.currentTime_.textContent&&(this.currentTime_.textContent=a)},shaka.ui.PresentationTimeTracker.prototype.updateTime_=function(){var a=this.controls.isSeeking(),b=this.controls.getDisplayTime(),e=this.video.duration,t=this.player.seekRange(),r=t.end-t.start,n=shaka.ui.Utils;this.player.isLive()?(e=3600<=r,1<=(b=Math.max(0,Math.floor(t.end-b)))||a?(this.setValue_("- "+n.buildTimeString(b,e)),this.currentTime_.disabled=!1):(this.setValue_(this.localization.resolve(shaka.ui.Locales.Ids.LIVE)),this.currentTime_.disabled=!0)):(a=3600<=e,b=n.buildTimeString(b,a),e&&(b+=" / "+n.buildTimeString(e,a)),this.setValue_(b),this.currentTime_.disabled=!0)},shaka.ui.PresentationTimeTracker.prototype.onTracksChanged_=function(){this.player.isLive()&&this.currentTime_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.SKIP_TO_LIVE))},goog.exportSymbol("shaka.ui.PresentationTimeTracker",shaka.ui.PresentationTimeTracker),shaka.ui.PresentationTimeTracker.Factory=function(){},shaka.ui.PresentationTimeTracker.Factory.prototype.create=function(a,b){return new shaka.ui.PresentationTimeTracker(a,b)},shaka.ui.Controls.registerElement("time_and_duration",new shaka.ui.PresentationTimeTracker.Factory),shaka.ui.ResolutionSelection=function(a,b){shaka.ui.SettingsMenu.call(this,a,b,shaka.ui.Enums.MaterialDesignIcons.RESOLUTION);var e=this;this.button.classList.add("shaka-resolution-button"),this.menu.classList.add("shaka-resolutions"),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateLocalizedStrings_()})),this.eventManager.listen(this.player,"variantchanged",(function(){e.updateResolutionSelection_()})),this.eventManager.listen(this.player,"trackschanged",(function(){e.updateResolutionSelection_()})),this.eventManager.listen(this.player,"abrstatuschanged",(function(){e.updateResolutionSelection_()})),this.updateResolutionSelection_(),this.updateLocalizedStrings_()},$jscomp.inherits(shaka.ui.ResolutionSelection,shaka.ui.SettingsMenu),shaka.ui.ResolutionSelection.prototype.updateResolutionSelection_=function(){var a=this,b=this.player.getVariantTracks();if(b.length&&!b[0].height)shaka.ui.Utils.setDisplay(this.menu,!1),shaka.ui.Utils.setDisplay(this.button,!1);else{shaka.ui.Utils.setDisplay(this.button,!0),b.sort((function(a,b){return goog.asserts.assert(null!=a.height,"Null height"),goog.asserts.assert(null!=b.height,"Null height"),b.height-a.height}));var e=b.find((function(a){return a.active}));e&&(b=b.filter((function(a){return a.language==e.language&&a.channelsCount==e.channelsCount}))),b=b.filter((function(a,e){return b.findIndex((function(b){return b.height==a.height}))==e}));var t=shaka.ui.Utils.getFirstDescendantWithClassName(this.menu,"shaka-back-to-overflow-button");shaka.util.Dom.removeAllChildren(this.menu),this.menu.appendChild(t),t=this.player.getConfiguration().abr.enabled;for(var r={},n=$jscomp.makeIterator(b),g=n.next();!g.done;r={$jscomp$loop$prop$track$575:r.$jscomp$loop$prop$track$575},g=n.next()){r.$jscomp$loop$prop$track$575=g.value,(g=shaka.util.Dom.createButton()).classList.add("explicit-resolution"),this.eventManager.listen(g,"click",function(b){return function(){return a.onTrackSelected_(b.$jscomp$loop$prop$track$575)}}(r));var o=shaka.util.Dom.createHTMLElement("span");o.textContent=r.$jscomp$loop$prop$track$575.height+"p",g.appendChild(o),t||r.$jscomp$loop$prop$track$575!=e||(g.setAttribute("aria-selected","true"),g.appendChild(shaka.ui.Utils.checkmarkIcon()),o.classList.add("shaka-chosen-item"),this.currentSelection.textContent=o.textContent),this.menu.appendChild(g)}(r=shaka.util.Dom.createButton()).classList.add("shaka-enable-abr-button"),this.eventManager.listen(r,"click",(function(){a.player.configure({abr:{enabled:!0}}),a.updateResolutionSelection_()})),this.abrOnSpan_=shaka.util.Dom.createHTMLElement("span"),this.abrOnSpan_.classList.add("shaka-auto-span"),this.abrOnSpan_.textContent=this.localization.resolve(shaka.ui.Locales.Ids.AUTO_QUALITY),r.appendChild(this.abrOnSpan_),t&&(r.setAttribute("aria-selected","true"),r.appendChild(shaka.ui.Utils.checkmarkIcon()),this.abrOnSpan_.classList.add("shaka-chosen-item"),this.currentSelection.textContent=this.localization.resolve(shaka.ui.Locales.Ids.AUTO_QUALITY)),this.menu.appendChild(r),shaka.ui.Utils.focusOnTheChosenItem(this.menu),this.controls.dispatchEvent(new shaka.util.FakeEvent("resolutionselectionupdated"))}},shaka.ui.ResolutionSelection.prototype.onTrackSelected_=function(a){this.player.configure({abr:{enabled:!1}});var b=this.controls.getConfig().clearBufferOnQualityChange;this.player.selectVariantTrack(a,b)},shaka.ui.ResolutionSelection.prototype.updateLocalizedStrings_=function(){var a=shaka.ui.Locales.Ids;this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.RESOLUTION)),this.backButton.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.RESOLUTION)),this.backSpan.textContent=this.localization.resolve(a.RESOLUTION),this.nameSpan.textContent=this.localization.resolve(a.RESOLUTION),this.abrOnSpan_.textContent=this.localization.resolve(a.AUTO_QUALITY),this.player.getConfiguration().abr.enabled&&(this.currentSelection.textContent=this.localization.resolve(shaka.ui.Locales.Ids.AUTO_QUALITY))},goog.exportSymbol("shaka.ui.ResolutionSelection",shaka.ui.ResolutionSelection),shaka.ui.ResolutionSelection.Factory=function(){},shaka.ui.ResolutionSelection.Factory.prototype.create=function(a,b){return new shaka.ui.ResolutionSelection(a,b)},shaka.ui.OverflowMenu.registerElement("quality",new shaka.ui.ResolutionSelection.Factory),shaka.ui.RewindButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("material-icons-round"),this.button_.classList.add("shaka-rewind-button"),this.button_.textContent=shaka.ui.Enums.MaterialDesignIcons.REWIND,this.parent.appendChild(this.button_),this.updateAriaLabel_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateAriaLabel_()})),this.eventManager.listen(this.button_,"click",(function(){e.rewind_()}))},$jscomp.inherits(shaka.ui.RewindButton,shaka.ui.Element),shaka.ui.RewindButton.prototype.updateAriaLabel_=function(){this.button_.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.REWIND))},shaka.ui.RewindButton.prototype.rewind_=function(){if(this.video.duration){var a=this.player.getPlaybackRate();this.player.trickPlay(0<a||-4>a?-1:2*a)}},goog.exportSymbol("shaka.ui.RewindButton",shaka.ui.RewindButton),shaka.ui.RewindButton.Factory=function(){},shaka.ui.RewindButton.Factory.prototype.create=function(a,b){return new shaka.ui.RewindButton(a,b)},shaka.ui.Controls.registerElement("rewind",new shaka.ui.RewindButton.Factory),shaka.ui.SkipAdButton=function(a,b){shaka.ui.Element.call(this,a,b);var e=this;this.container_=shaka.util.Dom.createHTMLElement("div"),this.container_.classList.add("shaka-skip-ad-container"),this.parent.appendChild(this.container_),this.counter_=shaka.util.Dom.createHTMLElement("div"),this.counter_.classList.add("shaka-skip-ad-counter"),shaka.ui.Utils.setDisplay(this.counter_,!1),this.container_.appendChild(this.counter_),this.button_=shaka.util.Dom.createButton(),this.button_.classList.add("shaka-skip-ad-button"),this.button_.disabled=!0,shaka.ui.Utils.setDisplay(this.button_,!1),this.button_.classList.add("shaka-no-propagation"),this.container_.appendChild(this.button_),this.updateAriaLabel_(),this.updateLocalizedStrings_(),this.timer_=new shaka.util.Timer((function(){e.onTimerTick_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateAriaLabel_(),e.updateLocalizedStrings_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateAriaLabel_(),e.updateLocalizedStrings_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STARTED,(function(){e.onAdStarted_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_SKIP_STATE_CHANGED,(function(){e.onSkipStateChanged_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,(function(){e.reset_()})),this.eventManager.listen(this.button_,"click",(function(){e.ad.skip()}))},$jscomp.inherits(shaka.ui.SkipAdButton,shaka.ui.Element),shaka.ui.SkipAdButton.prototype.release=function(){this.timer_.stop(),this.timer_=null,shaka.ui.Element.prototype.release.call(this)},shaka.ui.SkipAdButton.prototype.updateLocalizedStrings_=function(){this.button_.textContent=this.localization.resolve(shaka.ui.Locales.Ids.SKIP_AD)},shaka.ui.SkipAdButton.prototype.updateAriaLabel_=function(){},shaka.ui.SkipAdButton.prototype.onAdStarted_=function(){this.ad.isSkippable()&&(shaka.ui.Utils.setDisplay(this.button_,!0),shaka.ui.Utils.setDisplay(this.counter_,!0),this.counter_.textContent="",this.timer_.tickNow(),this.timer_.tickEvery(.5))},shaka.ui.SkipAdButton.prototype.onTimerTick_=function(){goog.asserts.assert(null!=this.ad,"this.ad should exist at this point");var a=Math.round(this.ad.getTimeUntilSkippable());0<a?this.counter_.textContent=a:(this.timer_.stop(),shaka.ui.Utils.setDisplay(this.counter_,!1))},shaka.ui.SkipAdButton.prototype.onSkipStateChanged_=function(){this.ad.canSkipNow()&&(this.button_.disabled=!1,this.timer_.stop(),shaka.ui.Utils.setDisplay(this.counter_,!1))},shaka.ui.SkipAdButton.prototype.reset_=function(){this.timer_.stop(),this.button_.disabled=!0,shaka.ui.Utils.setDisplay(this.button_,!1),shaka.ui.Utils.setDisplay(this.counter_,!1)},goog.exportSymbol("shaka.ui.SkipAdButton",shaka.ui.SkipAdButton),shaka.ui.SmallPlayButton=function(a,b){shaka.ui.PlayButton.call(this,a,b),this.button.classList.add("shaka-small-play-button"),this.button.classList.add("material-icons-round"),this.updateIcon(),this.updateAriaLabel()},$jscomp.inherits(shaka.ui.SmallPlayButton,shaka.ui.PlayButton),shaka.ui.SmallPlayButton.prototype.updateIcon=function(){var a=shaka.ui.Enums.MaterialDesignIcons;this.button.textContent=this.isPaused()?a.PLAY:a.PAUSE},goog.exportSymbol("shaka.ui.SmallPlayButton",shaka.ui.SmallPlayButton),shaka.ui.SmallPlayButton.Factory=function(){},shaka.ui.SmallPlayButton.Factory.prototype.create=function(a,b){return new shaka.ui.SmallPlayButton(a,b)},shaka.ui.Controls.registerElement("play_pause",new shaka.ui.SmallPlayButton.Factory),shaka.ui.Spacer=function(a,b){shaka.ui.Element.call(this,a,b);var e=shaka.util.Dom.createHTMLElement("div");e.classList.add("shaka-spacer"),e.setAttribute("aria-hidden",!0),this.parent.appendChild(e)},$jscomp.inherits(shaka.ui.Spacer,shaka.ui.Element),goog.exportSymbol("shaka.ui.Spacer",shaka.ui.Spacer),shaka.ui.Spacer.Factory=function(){},shaka.ui.Spacer.Factory.prototype.create=function(a,b){return new shaka.ui.Spacer(a,b)},shaka.ui.Controls.registerElement("spacer",new shaka.ui.Spacer.Factory),shaka.ui.TextSelection=function(a,b){shaka.ui.SettingsMenu.call(this,a,b,shaka.ui.Enums.MaterialDesignIcons.CLOSED_CAPTIONS);var e=this;this.button.classList.add("shaka-caption-button"),this.menu.classList.add("shaka-text-languages"),this.player&&this.player.isTextTrackVisible()?this.button.setAttribute("aria-pressed","true"):this.button.setAttribute("aria-pressed","false"),this.addOffOption_(),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){e.updateLocalizedStrings_(),e.updateTextLanguages_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){e.updateLocalizedStrings_(),e.updateTextLanguages_()})),this.eventManager.listen(this.player,"texttrackvisibility",(function(){e.onCaptionStateChange_()})),this.eventManager.listen(this.player,"textchanged",(function(){e.updateTextLanguages_()})),this.eventManager.listen(this.player,"trackschanged",(function(){e.onTracksChanged_()})),this.onCaptionStateChange_(),this.updateLocalizedStrings_(),this.updateTextLanguages_(),this.onTracksChanged_()},$jscomp.inherits(shaka.ui.TextSelection,shaka.ui.SettingsMenu),shaka.ui.TextSelection.prototype.addOffOption_=function(){var a=shaka.util.Dom.createButton();a.setAttribute("aria-selected","true"),this.menu.appendChild(a),a.appendChild(shaka.ui.Utils.checkmarkIcon()),this.captionsOffSpan_=shaka.util.Dom.createHTMLElement("span"),this.captionsOffSpan_.classList.add("shaka-auto-span"),a.appendChild(this.captionsOffSpan_)},shaka.ui.TextSelection.prototype.onCaptionStateChange_=function(){this.player.isTextTrackVisible()?(this.icon.classList.add("shaka-captions-on"),this.icon.classList.remove("shaka-captions-off"),this.button.setAttribute("aria-pressed","true")):(this.icon.classList.add("shaka-captions-off"),this.icon.classList.remove("shaka-captions-on"),this.button.setAttribute("aria-pressed","false")),this.controls.dispatchEvent(new shaka.util.FakeEvent("captionselectionupdated"))},shaka.ui.TextSelection.prototype.updateTextLanguages_=function(){var a=this,b=this.player.getTextTracks();shaka.ui.LanguageUtils.updateTracks(b,this.menu,(function(b){return a.onTextTrackSelected_(b)}),this.player.isTextTrackVisible(),this.currentSelection,this.localization,this.controls.getConfig().trackLabelFormat),(b=shaka.util.Dom.createButton()).classList.add("shaka-turn-captions-off-button"),this.eventManager.listen(b,"click",(function(){a.player.setTextTrackVisibility(!1),a.updateTextLanguages_()})),b.appendChild(this.captionsOffSpan_),this.menu.appendChild(b),this.player.isTextTrackVisible()||(b.setAttribute("aria-selected","true"),b.appendChild(shaka.ui.Utils.checkmarkIcon()),this.captionsOffSpan_.classList.add("shaka-chosen-item"),this.currentSelection.textContent=this.localization.resolve(shaka.ui.Locales.Ids.OFF)),shaka.ui.Utils.focusOnTheChosenItem(this.menu),this.controls.dispatchEvent(new shaka.util.FakeEvent("captionselectionupdated"))},shaka.ui.TextSelection.prototype.onTextTrackSelected_=function(a){var b=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(e){return b.player.selectTextLanguage(a.language,a.roles[0]),e.yield(b.player.setTextTrackVisibility(!0),0)}))},shaka.ui.TextSelection.prototype.updateLocalizedStrings_=function(){var a=shaka.ui.Locales.Ids;this.button.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.CAPTIONS)),this.backButton.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(a.BACK)),this.nameSpan.textContent=this.localization.resolve(a.CAPTIONS),this.backSpan.textContent=this.localization.resolve(a.CAPTIONS),this.captionsOffSpan_.textContent=this.localization.resolve(a.OFF)},shaka.ui.TextSelection.prototype.onTracksChanged_=function(){var a=0<this.player.getTextTracks().length;shaka.ui.Utils.setDisplay(this.button,a),this.updateTextLanguages_()},goog.exportSymbol("shaka.ui.TextSelection",shaka.ui.TextSelection),shaka.ui.TextSelection.Factory=function(){},shaka.ui.TextSelection.Factory.prototype.create=function(a,b){return new shaka.ui.TextSelection(a,b)},shaka.ui.OverflowMenu.registerElement("captions",new shaka.ui.TextSelection.Factory),shaka.ui.Overlay=function(a,b,e){this.player_=a,this.config_=this.defaultConfig_(),b.dataset.shakaPlayerContainer="",b.ui=this,this.isMobile()&&b.classList.add("shaka-mobile"),this.controls_=new shaka.ui.Controls(a,b,e,this.config_),this.configure({}),e.controls||a.setVideoContainer(b),b.ui=this,e.ui=this},shaka.ui.Overlay.prototype.destroy=function(){var a=this;return $jscomp.asyncExecutePromiseGeneratorProgram((function(b){return 1==b.nextAddress?a.controls_?b.yield(a.controls_.destroy(),2):b.jumpTo(2):4!=b.nextAddress?(a.controls_=null,a.player_?b.yield(a.player_.destroy(),4):b.jumpTo(4)):(a.player_=null,void b.jumpToEnd())}))},shaka.ui.Overlay.prototype.isMobile=function(){return shaka.util.Platform.isMobile()},shaka.ui.Overlay.prototype.getConfiguration=function(){var a=this.defaultConfig_();return shaka.util.ConfigUtils.mergeConfigObjects(a,this.config_,this.defaultConfig_(),{},""),a},shaka.ui.Overlay.prototype.configure=function(a,b){goog.asserts.assert("object"==typeof a||2==arguments.length,"String configs should have values!"),2==arguments.length&&"string"==typeof a&&(a=shaka.util.ConfigUtils.convertToConfigObject(a,b)),goog.asserts.assert("object"==typeof a,"Should be an object!"),shaka.util.ConfigUtils.mergeConfigObjects(this.config_,a,this.defaultConfig_(),{},""),this.config_.castReceiverAppId&&!this.config_.overflowMenuButtons.includes("cast")&&this.config_.overflowMenuButtons.push("cast"),goog.asserts.assert(null!=this.player_,"Should have a player!"),this.controls_.configure(this.config_),this.controls_.dispatchEvent(new shaka.util.FakeEvent("uiupdated"))},shaka.ui.Overlay.prototype.getControls=function(){return this.controls_},shaka.ui.Overlay.prototype.setEnabled=function(a){this.controls_.setEnabledShakaControls(a)},shaka.ui.Overlay.prototype.defaultConfig_=function(){var a={controlPanelElements:"play_pause time_and_duration spacer mute volume fullscreen overflow_menu".split(" "),overflowMenuButtons:"captions quality language picture_in_picture cast playback_rate".split(" "),addSeekBar:!0,addBigPlayButton:!1,castReceiverAppId:"",clearBufferOnQualityChange:!0,showUnbufferedStart:!1,seekBarColors:{base:"rgba(255, 255, 255, 0.3)",buffered:"rgba(255, 255, 255, 0.54)",played:"rgb(255, 255, 255)",adBreaks:"rgb(255, 204, 0)"},volumeBarColors:{base:"rgba(255, 255, 255, 0.54)",level:"rgb(255, 255, 255)"},trackLabelFormat:shaka.ui.TrackLabelFormat.LANGUAGE,fadeDelay:0,doubleClickForFullscreen:!0,enableKeyboardPlaybackControls:!0,enableFullscreenOnRotation:!0,forceLandscapeOnFullscreen:!0};return window.WebKitPlaybackTargetAvailabilityEvent&&a.overflowMenuButtons.push("airplay"),this.isMobile()&&(a.addBigPlayButton=!0,a.controlPanelElements=a.controlPanelElements.filter((function(a){return"play_pause"!=a&&"volume"!=a}))),a},shaka.ui.Overlay.scanPageForShakaElements_=function(){var a,b,e,t,r,n,o,l,h,d,c,p,q;return $jscomp.asyncExecutePromiseGeneratorProgram((function(m){switch(m.nextAddress){case 1:if(shaka.polyfill.installAll(),!shaka.Player.isBrowserSupported())return shaka.log.error("Shaka Player does not support this browser. Please see https://tinyurl.com/y7s4j9tr for the list of supported browsers."),shaka.ui.Overlay.dispatchLoadedEvent_("shaka-ui-load-failed",shaka.ui.FailReasonCode.NO_BROWSER_SUPPORT),m.return();if(a=document.querySelectorAll("[data-shaka-player-container]"),!(b=document.querySelectorAll("[data-shaka-player]")).length&&!a.length){m.jumpTo(2);break}if(b.length&&!a.length){for(e=$jscomp.makeIterator(b),t=e.next();!t.done;t=e.next())(r=t.value).ui||(goog.asserts.assert("video"==r.tagName.toLowerCase(),"Should be a video element!"),n=document.createElement("div"),r.parentElement.replaceChild(n,r),n.appendChild(r),shaka.ui.Overlay.setupUIandAutoLoad_(n,r));m.jumpTo(2);break}o=$jscomp.makeIterator(a),l=o.next();case 4:if(l.done){m.jumpTo(2);break}if((h=l.value).ui){m.jumpTo(5);break}for(goog.asserts.assert("div"==h.tagName.toLowerCase(),"Container should be a div!"),d=null,c=$jscomp.makeIterator(b),t=c.next();!t.done;t=c.next())if(p=t.value,goog.asserts.assert("video"==p.tagName.toLowerCase(),"Should be a video element!"),p.parentElement==h){d=p;break}return d||((d=document.createElement("video")).setAttribute("playsinline",""),h.appendChild(d)),m.setCatchFinallyBlocks(7),m.yield(shaka.ui.Overlay.setupUIandAutoLoad_(h,d),9);case 9:m.leaveTryBlock(5);break;case 7:return q=m.enterCatchBlock(),shaka.log.error("Error setting up Shaka Player",q),shaka.ui.Overlay.dispatchLoadedEvent_("shaka-ui-load-failed",shaka.ui.FailReasonCode.PLAYER_FAILED_TO_LOAD),m.return();case 5:l=o.next(),m.jumpTo(4);break;case 2:shaka.ui.Overlay.dispatchLoadedEvent_("shaka-ui-loaded"),m.jumpToEnd()}}))},shaka.ui.Overlay.dispatchLoadedEvent_=function(a,b){var e=document.createEvent("CustomEvent"),t=null;null!=b&&(t={reasonCode:b}),e.initCustomEvent(a,!1,!1,t),document.dispatchEvent(e)},shaka.ui.Overlay.setupUIandAutoLoad_=function(a,b){var e,t,r,n,g,o,l,h,d;return $jscomp.asyncExecutePromiseGeneratorProgram((function(c){switch(c.nextAddress){case 1:e=new shaka.Player(shaka.util.Dom.asHTMLMediaElement(b)),t=new shaka.ui.Overlay(e,shaka.util.Dom.asHTMLElement(a),shaka.util.Dom.asHTMLMediaElement(b)),r="",a.dataset&&a.dataset.shakaPlayerCastReceiverId?r=a.dataset.shakaPlayerCastReceiverId:b.dataset&&b.dataset.shakaPlayerCastReceiverId&&(r=b.dataset.shakaPlayerCastReceiverId),r.length&&t.configure({castReceiverAppId:r}),shaka.util.Dom.asHTMLMediaElement(b).controls&&t.getControls().setEnabledNativeControls(!0),(n=b.getAttribute("src"))&&((g=document.createElement("source")).setAttribute("src",n),b.appendChild(g),b.removeAttribute("src")),o=$jscomp.makeIterator(b.querySelectorAll("source")),l=o.next();case 2:if(l.done){c.jumpTo(0);break}return h=l.value,c.setCatchFinallyBlocks(5),c.yield(t.getControls().getPlayer().load(h.getAttribute("src")),7);case 7:c.jumpTo(0);break;case 5:d=c.enterCatchBlock(),shaka.log.error("Error auto-loading asset",d);case 3:l=o.next(),c.jumpTo(2)}}))},goog.exportSymbol("shaka.ui.Overlay",shaka.ui.Overlay),goog.exportProperty(shaka.ui.Overlay.prototype,"setEnabled",shaka.ui.Overlay.prototype.setEnabled),goog.exportProperty(shaka.ui.Overlay.prototype,"getControls",shaka.ui.Overlay.prototype.getControls),goog.exportProperty(shaka.ui.Overlay.prototype,"configure",shaka.ui.Overlay.prototype.configure),goog.exportProperty(shaka.ui.Overlay.prototype,"getConfiguration",shaka.ui.Overlay.prototype.getConfiguration),goog.exportProperty(shaka.ui.Overlay.prototype,"isMobile",shaka.ui.Overlay.prototype.isMobile),goog.exportProperty(shaka.ui.Overlay.prototype,"destroy",shaka.ui.Overlay.prototype.destroy),shaka.ui.TrackLabelFormat={LANGUAGE:0,ROLE:1,LANGUAGE_ROLE:2},goog.exportSymbol("shaka.ui.TrackLabelFormat",shaka.ui.TrackLabelFormat),shaka.ui.FailReasonCode={NO_BROWSER_SUPPORT:0,PLAYER_FAILED_TO_LOAD:1},goog.exportSymbol("shaka.ui.FailReasonCode",shaka.ui.FailReasonCode),"complete"==document.readyState?$jscomp.asyncExecutePromiseGeneratorProgram((function(a){if(1==a.nextAddress)return a.yield(Promise.resolve(),2);shaka.ui.Overlay.scanPageForShakaElements_(),a.jumpToEnd()})):window.addEventListener("load",shaka.ui.Overlay.scanPageForShakaElements_),shaka.ui.VolumeBar=function(a,b){shaka.ui.RangeElement.call(this,a,b,["shaka-volume-bar-container"],["shaka-volume-bar"]);var e=this;this.config_=this.controls.getConfig(),this.eventManager.listen(this.video,"volumechange",(function(){return e.onPresentationVolumeChange_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_VOLUME_CHANGED,(function(){return e.onAdVolumeChange_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_MUTED,(function(){return e.onAdVolumeChange_()})),this.eventManager.listen(this.adManager,shaka.ads.AdManager.AD_STOPPED,(function(){return e.onPresentationVolumeChange_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_UPDATED,(function(){return e.updateAriaLabel_()})),this.eventManager.listen(this.localization,shaka.ui.Localization.LOCALE_CHANGED,(function(){return e.updateAriaLabel_()})),this.onPresentationVolumeChange_(),this.updateAriaLabel_()},$jscomp.inherits(shaka.ui.VolumeBar,shaka.ui.RangeElement),shaka.ui.VolumeBar.prototype.onChange=function(){this.ad?this.ad.setVolume(this.getValue()):(this.video.volume=this.getValue(),this.video.muted=0==this.video.volume)},shaka.ui.VolumeBar.prototype.onPresentationVolumeChange_=function(){this.video.muted?this.setValue(0):this.setValue(this.video.volume),this.updateColors_()},shaka.ui.VolumeBar.prototype.onAdVolumeChange_=function(){goog.asserts.assert(null!=this.ad,"This.ad should exist at this point!");var a=this.ad.getVolume();this.setValue(a),this.updateColors_()},shaka.ui.VolumeBar.prototype.updateColors_=function(){var a=this.config_.volumeBarColors,b=["to right"];b.push(a.level+100*this.getValue()+"%"),b.push(a.base+100*this.getValue()+"%"),b.push(a.base+"100%"),this.container.style.background="linear-gradient("+b.join(",")+")"},shaka.ui.VolumeBar.prototype.updateAriaLabel_=function(){this.bar.setAttribute(shaka.ui.Constants.ARIA_LABEL,this.localization.resolve(shaka.ui.Locales.Ids.VOLUME))},goog.exportSymbol("shaka.ui.VolumeBar",shaka.ui.VolumeBar),shaka.ui.VolumeBar.Factory=function(){},shaka.ui.VolumeBar.Factory.prototype.create=function(a,b){return new shaka.ui.VolumeBar(a,b)},shaka.ui.Controls.registerElement("volume",new shaka.ui.VolumeBar.Factory)}.call(exportTo,innerGlobal,innerGlobal,void 0),exportTo.shaka)exports[k]=exportTo.shaka[k]})()}).call(this,__webpack_require__(16))}}]);